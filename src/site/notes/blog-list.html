<div
  :class="'blog-list ' + attrs.class + (attrs.animated ? ' blog-list-animated ' : '')"
>
  <!-- textlint-disable -->
  <script render>
    for (const item of index){
      const tags = item.tags.map(tag => `<tag>${tag}</tag>`).join(" ");
      yield html`<blog-list-item href="${item.href}" date="${item.date}">${item.title} ${tags}</blog-list-item>`;
    }
  </script>
  <!-- textlint-enable -->
</div>

<script render>
  if (!attrs.animated) return;

  function delay(index) {
    const seconds = Math.min(index - 1, Math.log(index) * 2) * 0.1 - 0.1;
    return Math.round(seconds * 1000) / 1000 + "s";
  }

  const maxDelayed = 20;
  const itemCount = index.length;
  const max = Math.min(itemCount, maxDelayed);

  let styles = "";
  for (let i = 1; i <= max; i++) {
    styles += `
    .blog-list > *:nth-child(${i}) {
      --blog-list-item-delay: ${delay(i)};
    }`;
  }

  if (itemCount > maxDelayed) {
    styles += `
    .card-grid > *:nth-child(n + ${maxDelayed + 1}) {
      --card-grid-item-delay: ${delay(maxDelayed + 1)};
    }`;
  }

  return html`<head>
    <style>
      ${styles}
    </style>
  </head>`;
</script>

<script static>
  const combinedIndex = require("./index.generated.combined.json");
  const dev = process.env.NODE_ENV === "development";

  const { filterTag, limit = Infinity, devHidden } = attrs;

  let index = combinedIndex
    .filter((item) => item.public)
    .filter((item) => !filterTag || item.tags.includes(filterTag));

  // newest first
  index.sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime());

  if (devHidden && dev) {
    index = combinedIndex
      .filter((item) => !item.public)
      .filter((item) => !filterTag || item.tags.includes(filterTag))
      .map((item) => ({ ...item, tags: ["âœŽhidden", ...item.tags] }))
      .concat(index);
  }

  index = index.slice(0, limit);
</script>

<style>
  .blog-list {
    margin: auto;
    max-width: 800px;
  }
</style>
