<common />

<dynamic-patrol-demo-client {...attrs} />

<style>
  dynamic-patrol-demo-client {
    display: block;
    min-height: 500px;
    min-width: 500px;
    border-radius: 12px;
    background: white;
  }
</style>

<script async src="/vendor/two.min.js"></script>

<script type="module" client defer>
  // Warn: URL is relative to the page, not the component
  import DynamicPatrolDemo from "./dynamic-patrol-demo.mjs";

  (() => {
    customElements.define(
      "dynamic-patrol-demo-client",
      class DynamicPatrolDemoClient extends BaseElement {
        constructor() {
          super();
          this.two = null;
          this.model = null;
          this.isVisible = false;
        }

        connectedCallback() {
          super.connectedCallback();
          this.preinit();
        }

        disconnectedCallback() {
          super.disconnectedCallback();
          this.two = null;
          this.model = null;
          this.replaceChildren();
        }

        async preinit() {
          await globalThis.waitFor(
            () =>
              typeof Two !== "undefined" &&
              typeof DynamicPatrolDemo !== "undefined"
          );
          this.init();
        }

        init() {
          if (!this.isConnected) return;

          this.two = new Two({ fitted: true });
          this.two.appendTo(this);
          this.two.addEventListener("update", this.update);

          this.model = new DynamicPatrolDemo();

          this.visibilityListener({
            show: () => {
              this.isVisible = true;
              this.two.play();
            },
            hide: () => {
              this.two.pause();
              this.isVisible = false;
            },
          });
        }

        update = () => {};
      }
    );
  })();
</script>
