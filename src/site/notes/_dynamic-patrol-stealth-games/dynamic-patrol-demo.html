<dynamic-patrol-demo-client {...attrs} />

<style>
  dynamic-patrol-demo-client {
    display: block;
    min-height: 500px;
    min-width: 500px;
    border-radius: 12px;
    background: white;
  }
</style>

<script type="module" client defer>
  import Two from "/lib/vendor/two.module.js";
  import { waitFor } from "/lib/wait_for.mjs";
  import { BaseElement } from "/lib/base_element.mjs";
  // Warn: Module path is relative to the page, not the component
  import DynamicPatrolDemo from "./dynamic-patrol-demo.mjs";

  customElements.define(
    "dynamic-patrol-demo-client",
    class DynamicPatrolDemoClient extends BaseElement {
      constructor() {
        super();
        this.two = null;
        this.model = null;
        this.isVisible = false;
      }

      connectedCallback() {
        super.connectedCallback();
        this.init();
      }

      disconnectedCallback() {
        super.disconnectedCallback();
        this.two = null;
        this.model = null;
        this.replaceChildren();
      }

      init() {
        if (!this.isConnected) return;

        this.two = new Two({ fitted: true });
        this.two.appendTo(this);
        this.two.addEventListener("update", this.update);

        this.model = new DynamicPatrolDemo();

        this.visibilityListener({
          show: () => {
            this.isVisible = true;
            this.two.play();
          },
          hide: () => {
            this.two.pause();
            this.isVisible = false;
          },
        });
      }

      update = () => {};
    }
  );
</script>
