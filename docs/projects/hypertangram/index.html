<html>
<head>
  <title>Hypertangram</title>
  <style>
    @font-face {
      font-family: "Space Mono";
      src: url("/fonts/SpaceMono-Regular.ttf") format("truetype");
    }

    @font-face {
      font-family: "Space Mono";
      font-style: italic;
      src: url("/fonts/SpaceMono-Italic.ttf") format("truetype");
    }

    @font-face {
      font-family: "Miriam Libre";
      src: url("/fonts/MiriamLibre-Regular.ttf") format("truetype");
    }

    @font-face {
      font-family: "Miriam Libre";
      font-weight: bold;
      src: url("/fonts/MiriamLibre-Bold.ttf") format("truetype");
    }

    body {
      margin: 0;
      background-color: #111;
      color: #fff;
      font-family: "Space Mono", monaco, Consolas, Lucida Console, monospace;
    }

    :root {
      --bg-clr: #111;
      --clr0: #0ad591;
      --clr0-light: #52f8c1;
      --clr0-dark: #018b5d;
      --ease: cubic-bezier(0.6, 0, 0.2, 1);
    }

    a {
      color: var(--clr0, #fff);
    }

    a:visited {
      color: var(--clr0-dark, #fff);
    }
  </style>
  <style>
    .main-header {
      position: sticky;
      top: 0;
      width: 100%;
      height: 60px;
      padding: 0 calc(25% - 150px);
      z-index: 100;
      box-sizing: border-box;
    }

    .main-header.float {
      position: fixed;
    }

    .main-header-bar {
      position: relative;
      display: flex;
      justify-content: space-evenly;
      align-items: flex-end;
      height: 100%;
    }

    .main-header-item,
    .main-header-item:visited {
      display: inline-flex;
      justify-content: center;
      align-items: center;
      width: 6ch;
      height: 36px;
      padding: 0 18px;
      border-radius: 18px;
      font-size: 15px;
      font-weight: bold;
      text-decoration: none;
      text-transform: uppercase;
      color: #fff;
      backdrop-filter: blur(8px);
    }

    .main-header-item:hover {
      background: #fff2;
    }

    .main-header-icon {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      image-rendering: pixelated;
      filter: invert(1);
      backdrop-filter: blur(8px) invert(1);
      cursor: pointer;
      z-index: 1;
    }
  </style>
  <style>
    .blog-page {
      display: flex;
      justify-content: center;
      overflow: hidden;
    }

    .content {
      margin: 60px 0;
      max-width: 700px;
      font-size: 18px;
      line-height: 2.2;
      letter-spacing: 0.02em;
      color: #ddd;
    }

    .markdown h1,
    .markdown h2,
    .markdown h3,
    .markdown h4,
    .markdown h5,
    .markdown h6 {
      font-weight: lighter;
      font-style: italic;
      letter-spacing: 0.04em;
      margin: 36px 0;
    }

    .markdown h1 {
      text-align: center;
      font-size: 200%;
    }

    .markdown h2 {
      font-size: 150%;
    }

    .markdown h3,
    .markdown h4,
    .markdown h5,
    .markdown h6 {
      font-size: 120%;
    }

    .markdown p {
      font-family: "Miriam Libre", Futura, "Trebuchet MS", Arial, sans-serif;
      margin: 36px 0;
    }

    .markdown hr {
      margin: 90px -25%;
      border: solid 1px #222;
    }

    .markdown .center {
      text-align: center;
    }

    .markdown .center-flex {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }

    /* todo: convert to component <caption>, reuse across <blog-media> */
    .markdown .caption {
      display: block;
      font-size: 15px;
    }
  </style>
  <style>
    .blog-media {
      text-align: center;
    }

    .blog-media-bleed {
      margin: 90px 0;
      max-height: 80vh;
    }

    .blog-media-element {
      display: inline-block;
      max-width: 100%;
      max-height: 80vh;
      border-radius: 18px;
    }

    .blog-media-bleed .blog-media-element {
      position: relative;
      left: 50%;
      max-width: 80vw;
      transform: translateX(-50%);
    }

    .blog-media-caption {
      display: block;
      font-size: 15px;
    }
  </style>
</head>


<body>

  <div class="main-header ">
    <div class="main-header-bar">
      <a href="/" class="main-header-item">Home</a>
      <img class="main-header-icon" src="/icons/tada.png">
      <a href="/projects/" class="main-header-item">Works</a>
    </div>
  </div>

  <div class="blog-page">
    <div class="content">

      <!-- prettier-ignore -->
      <div class="markdown">
        <h1 id="hypertangram">Hypertangram</h1>
        <div class="blog-media blog-media-default">
          <img class="blog-media-element" src="media/hypertangram_1.jpg" alt="screenshot of Hypertangram" srcset="media/hypertangram_1_75.jpg 75w,media/hypertangram_1_150.jpg 150w,media/hypertangram_1_225.jpg 225w,media/hypertangram_1_300.jpg 300w,media/hypertangram_1_375.jpg 375w,media/hypertangram_1_450.jpg 450w" sizes="(max-width:375px) 75px,(max-width:750px) 150px,(max-width:1125px) 225px,(max-width:1500px) 300px,(max-width:1875px) 375px, 450px">
        </div>

        <h2 id="hypertangram-is-tangram-with-a-twist">Hypertangram is tangram with a twist.</h2>
        <p><strong>Hypertangram</strong> (2018) is a mind-bending geometric puzzle game on Android based on the classic tangram puzzle. What’s different with this one is that, in addition to regular dragging and rotating, <em>pieces can be resized</em>.</p>
        <p>The resizing mechanic adds a lot of state space to an otherwise regular <a href="https://en.wikipedia.org/wiki/Dissection_puzzle">dissection puzzle</a>.</p>
        <p>The idea had been sitting in the back of my mind for quite a time, and I finally did it in about 6 months of development in my free time.</p>
        <div class="blog-media blog-media-default">
          <video class="blog-media-element" muted="" autoplay="" loop="" aria-label="Demo video">
            <source src="media/hypertangram_2.mp4">
            <a href="media/hypertangram_2.mp4">Demo video</a>
          </video>
        </div>

        <p>It wasn’t all smooth sailing. There were lots of problems with the geometry code.</p>
        <p>See, I didn’t want grid-based movement like in other tangram apps. I wanted free dragging, rotation, and scaling, with smart edge-snapping.</p>
        <p>This design decision proved to be technically demanding later on.</p>
        <div class="blog-media blog-media-default">
          <video class="blog-media-element" muted="" autoplay="" loop="" aria-label="Video of old development version">
            <source src="media/hypertangram_3.mp4">
            <a href="media/hypertangram_3.mp4">Video of old development version</a>
          </video><span class="blog-media-caption">Old prototype</span>
        </div>

        <p>But that’s not all. There were more <em>geometrials</em> ahead. Due to the nature of the main game mechanic, there can be several solutions to a single puzzle.</p>
        <div class="blog-media blog-media-default">
          <img class="blog-media-element" src="media/ht_solutions.jpg" alt="illustration of multiple solutions" srcset="media/ht_solutions_350.jpg 350w,media/ht_solutions_700.jpg 700w" sizes="(max-width:350px) 350px, 700px"><span class="blog-media-caption">Multiple solutions for a single puzzle</span>
        </div>

        <p>There is no easy way to find them all by hand, nor by algorithm, as far as I know. The solution checking algorithm went through rounds of rethinking.</p>
        <p>I ended up with an algorithmic approach, using <a href="https://en.wikipedia.org/wiki/Boolean_operations_on_polygons">boolean operations on polygons</a>, in order to implement the win condition.</p>
        <p><em>Note to self: Don’t mix geometric operations and floating point numbers. They are oil and water.</em></p>
        <p>Other notable features include the smart edge-snapping (there is no grid, and no predetermined solution), and an accessible single-finger mode for resizing and rotating pieces without the need for a second finger.</p>
        <div class="blog-media blog-media-default">
          <img class="blog-media-element" src="media/hypertangram_notes1.jpg" alt="graphic design notes" srcset="media/hypertangram_notes1_350.jpg 350w,media/hypertangram_notes1_700.jpg 700w" sizes="(max-width:350px) 350px, 700px"><span class="blog-media-caption">Some design sketches</span>
        </div>

        <p>Aside from design &amp; programming, I also created the music and graphics myself. For the look, I wanted it minimal with a physical feel. Abstract, yet tangible.</p>
        <p>The game’s graphics are procedurally rendered using Android’s <a href="https://developer.android.com/reference/android/graphics/Canvas"><code>Canvas</code></a> API.</p>
        <div class="blog-media blog-media-default">
          <img class="blog-media-element" src="media/hypertangram_4.jpg" alt="screenshot detail" srcset="media/hypertangram_4_225.jpg 225w,media/hypertangram_4_450.jpg 450w,media/hypertangram_4_700.jpg 700w" sizes="(max-width:225px) 225px,not (min-width:700px) 450px, 700px"><span class="blog-media-caption">Close-up of “abstract tangible”</span>
        </div>

        <p>I really liked what I did here. Of course, there’s always room for improvement, but finished is better than perfect.</p>
        <p>This was my first “complete” game in terms of features and polish.</p>
        <p><em>It was a <strong>geometriumph</strong>.</em></p>
        <p>Try it out! It’s free.</p>
        <p class="center">
          <a class="anchor-plain" href="https://play.google.com/store/apps/details?id=com.kalabasagames.hypertangram&amp;referrer=utm_source%3Dkalabasa.github.io&amp;pcampaignid=MKT-Other-global-all-co-prtnr-py-PartBadge-Mar2515-1"><img class="media-plain" width="200px" alt="Get it on Google Play" src="https://play.google.com/intl/en_gb/badges/images/generic/en_badge_web_generic.png"></a>
        </p>

      </div>

    </div>
  </div>

  <script>
    (() => {
      const mainHeader = document.querySelector(".main-header");
      const mainHeaderIcon = document.querySelector(".main-header-icon");

      let currentY = 0;
      let currentYTarget = 0;

      let mouseHovering = false;

      let lastScrollY = window.scrollY;
      let lastMouseY = 0;
      window.addEventListener("scroll", debounce(onScroll));
      window.addEventListener("mousemove", debounce(onMouseMove, 100));

      function onScroll(event) {
        const dy = window.scrollY - lastScrollY;

        // move with the page
        currentY -= dy;
        if (currentY > 0) {
          currentY = 0;
        } else if (currentY < -mainHeader.offsetHeight) {
          currentY = -mainHeader.offsetHeight;
        }

        currentYTarget = currentY;
        updateDOM();

        lastScrollY = window.scrollY;
      }

      function onMouseMove(event) {
        const dy = event.clientY - lastMouseY;

        // show when mouse goes near the top
        const scaledDy = Math.sign(dy) * Math.log1p(Math.abs(dy)) * 20;
        if (dy < 0 && event.clientY + scaledDy < mainHeader.offsetHeight) {
          currentYTarget = 0;
          mouseHovering = true;
        } else if (
          mouseHovering &&
          dy > 0 &&
          event.clientY > mainHeader.offsetHeight * 4
        ) {
          currentYTarget = Math.max(-window.scrollY, -mainHeader.offsetHeight);
          mouseHovering = false;
        }

        updateDOM();
        lastMouseY = event.clientY;
      }

      const updateDOM = debounce(() => {
        mainHeader.style.transform = `translateY(${currentY.toFixed(2)}px)`;

        if (Math.abs(currentY - currentYTarget) > 1) {
          currentY += (currentYTarget - currentY) * 0.2;
          requestAnimationFrame(updateDOM);
        } else {
          currentY = currentYTarget;
        }
      });

      let iconY = 0;
      let iconVy = null;

      const fallIcon = debounce(() => {
        if (iconVy == null) iconVy = -5;
        iconVy += 0.8;
        iconY += iconVy;
        mainHeaderIcon.style.transform = `translateY(${iconY}px)`;
        if (iconY >= window.innerHeight) {
          mainHeaderIcon.style.visibility = "hidden";
        } else {
          requestAnimationFrame(fallIcon);
        }
      });

      mainHeaderIcon.addEventListener("click", fallIcon, {
        once: true
      });

      function debounce(fn, ms = 0) {
        let recentlyFired = false;
        return (...args) => {
          if (recentlyFired) return;
          recentlyFired = true;
          if (ms === 0) {
            requestAnimationFrame(() => (recentlyFired = false));
          } else {
            setTimeout(() => (recentlyFired = false), ms);
          }
          return fn(...args);
        };
      }
    })();
  </script>
</body>
</html>