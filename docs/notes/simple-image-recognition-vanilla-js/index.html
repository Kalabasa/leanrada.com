<!DOCTYPE html>
<html lang="en">
<head>
  <title>Simple image recognition with vanilla JavaScript · leanrada.com</title>
  <script async="" src="/lib/vendor/perlin-noise-3d.min.js"></script>
  <link rel="preload" href="/fonts/space/SpaceMono-Italic.ttf" as="font" type="font/ttf" crossorigin="">
  <link rel="icon" type="image/png" href="/favicon.png">
  <link rel="webmention" href="https://webmention.io/leanrada.com/webmention">
  <link rel="alternate" type="application/rss+xml" title="leanrada.com notes" href="/rss.xml">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="color-scheme" content="only dark">
  <meta charset="utf-8">
  <script async="" src="https://leanrada.com/analytics/analytics.js"></script>
  <style>
  .reactions {
    display: grid;
    grid-template-rows: repeat(3, auto);
    grid-auto-flow: column;
    justify-content: center;
    justify-items: center;
    gap: 6px;
    border: solid 1px var(--card-clr);
    border-radius: 6px;
    padding: 18px;
    font-family: var(--default-font);
  }

  .reaction-title {
    grid-column: span 5;
    margin: 0 0 6px;
    font-size: 18px;
  }

  .reaction-title-error {
    color: var(--clr1);
  }

  .reaction-heart-btn,
  .reaction-heart-count {
    --reaction-color: #bf1852;
  }
  .reaction-fire-btn,
  .reaction-fire-count {
    --reaction-color: #c68306;
  }
  .reaction-bubble-btn,
  .reaction-bubble-count {
    --reaction-color: #07bd80;
  }
  .reaction-sun-btn,
  .reaction-sun-count {
    --reaction-color: #a09b00;
  }
  .reaction-cloud-btn,
  .reaction-cloud-count {
    --reaction-color: #8063ff;
  }

  .reaction-count {
    position: relative;
    font-size: 18px;
    width: 100%;
    height: 18px;
    text-align: center;
    overflow: hidden;
  }
  .reaction-count-prev,
  .reaction-count-next {
    position: relative;
    height: 100%;
    animation: reaction-tick 0.3s var(--ease) forwards;
  }

  @keyframes reaction-tick {
    from {
      top: 0;
    }
    to {
      top: -100%;
    }
  }

  .reaction-count.reaction-spark::after {
    position: absolute;
    content: "";
    width: 36px;
    height: 36px;
    left: calc(50% - 18px);
    top: calc(100% - 18px);
    border-radius: 50%;
    animation: reaction-spark 0.1s ease-out;
  }

  @keyframes reaction-spark {
    from {
      box-shadow: inset 0 0 0 18px var(--reaction-color);
    }
    to {
      box-shadow: inset 0 0 0 0px var(--reaction-color);
    }
  }

  .reaction-btn {
    background: none;
    border: none;
    border-radius: 6px;
    width: 32px;
    height: 32px;
    padding: 2px;
    box-sizing: content-box;
    cursor: pointer;
  }
  .reaction-btn:focus-visible,
  .reaction-btn:hover {
    background: var(--reaction-color);
  }
  .reaction-btn:focus-visible .reaction-icon,
  .reaction-btn:hover .reaction-icon {
    animation-duration: 0.5s;
  }
  .reaction-btn:active .reaction-icon {
    position: relative;
    top: 2px;
  }

  .reaction-icon {
    display: block;
    width: 100%;
    height: 100%;
    image-rendering: pixelated;
    background-image: url("/icons/reactions.png");
    background-size: 500% 200%;
    animation: reaction-icon 1.5s steps(2) infinite;
  }
  .reactions-invisible .reaction-icon {
    background-image: none;
  }
  .reaction-heart-btn .reaction-icon {
    --sheet-x: 25%;
  }
  .reaction-bubble-btn .reaction-icon {
    --sheet-x: 0%;
  }
  .reaction-sun-btn .reaction-icon {
    --sheet-x: 100%;
  }
  .reaction-cloud-btn .reaction-icon {
    --sheet-x: 75%;
  }
  .reaction-fire-btn .reaction-icon {
    --sheet-x: 50%;
  }

  @keyframes reaction-icon {
    0% {
      background-position: var(--sheet-x) 0%;
    }
    100% {
      background-position: var(--sheet-x) 200%;
    }
  }
</style>
  <style>
  /**
   * Modified by Kalabasa.
   * Based on:
   * a11y-dark theme for JavaScript, CSS, and HTML
   * Based on the okaidia theme: https://github.com/PrismJS/prism/blob/gh-pages/hemes/prism-okaidia.css
   * @author ericwbailey
   */

  .code-block .token.inserted:not(.prefix) {
    background: #00b6a71c;
    display: block;
  }

  .code-block .token.comment,
  .code-block .token.prolog,
  .code-block .token.doctype,
  .code-block .token.cdata {
    color: #628b9e;
    font-style: italic;
  }

  .code-block .token.punctuation {
    color: #fefefe;
  }

  .code-block .token.property,
  .code-block .token.tag,
  .code-block .token.constant,
  .code-block .token.symbol,
  .code-block .token.deleted {
    color: #ffa07a;
  }

  .code-block .token.boolean,
  .code-block .token.number {
    color: #00e0e0;
  }

  .code-block .token.selector,
  .code-block .token.attr-name,
  .code-block .token.string,
  .code-block .token.char,
  .code-block .token.builtin,
  .code-block .token.inserted {
    color: #abe338;
  }

  .code-block .token.operator,
  .code-block .token.entity,
  .code-block .token.url,
  .code-block .token.variable {
    color: #00e0e0;
  }

  .code-block .token.atrule,
  .code-block .token.attr-value,
  .code-block .token.function {
    color: #ffd700;
  }

  .code-block .token.keyword {
    color: #00e0e0;
  }

  .code-block .token.regex,
  .code-block .token.important {
    color: #ffd700;
  }

  .code-block .token.important,
  .code-block .token.bold {
    font-weight: bold;
  }

  .code-block .token.italic {
    font-style: italic;
  }

  .code-block .token.entity {
    cursor: help;
  }

  @media screen and (-ms-high-contrast: active) {
    .code-block .token.important {
      background: highlight;
      color: window;
      font-weight: normal;
    }

    .code-block .token.atrule,
    .code-block .token.attr-value,
    .code-block .token.function,
    .code-block .token.keyword,
    .code-block .token.operator,
    .code-block .token.selector {
      font-weight: bold;
    }

    .code-block .token.attr-value,
    .code-block .token.comment,
    .code-block .token.doctype,
    .code-block .token.function,
    .code-block .token.keyword,
    .code-block .token.operator,
    .code-block .token.property,
    .code-block .token.string {
      color: highlight;
    }

    .code-block .token.attr-value,
    .code-block .token.url {
      font-weight: normal;
    }
  }
</style>
  <style>
  .code-block {
    margin: 0 -18px; /* bleed content padding */
    padding: 0 18px; /* bleed content padding */
    overflow-x: auto;
  }
  .code-block-code {
    display: inline-block;
    padding: 18px;
    min-width: 100%;
    box-sizing: border-box;
    border-radius: 18px;
    font-family: var(--default-font, monospace);
    font-size: 15px;
    line-height: 1.6;
    background: var(--card-clr);
    white-space: pre;
  }

  .code-block-wrap-char {
    word-break: break-all;
  }
  .code-block-wrap-char .code-block-code {
    white-space: pre-wrap;
  }

  .code-block-wrap-word {
    word-break: normal;
  }
  .code-block-wrap-word .code-block-code {
    white-space: pre-wrap;
  }
</style>
  <style>
  .box-note {
    display: block;
    padding: 12px 18px;
    border-radius: 12px;
    border: solid 2px var(--clr0-dark);
    box-sizing: border-box;
  }
</style>
  <style>
  .blog-media {
    position: relative;
    text-align: center;
    /* external margin because it’s expected to be in an article */
    margin: 36px 0;
  }
  .blog-media-bleed {
    margin: 90px 0;
    max-height: 80vh;
  }

  .blog-media-element {
    display: inline-block;
    max-width: 100%;
    max-height: 80vh;
    border-radius: 18px;
    box-sizing: border-box;
  }
  .blog-media-bleed .blog-media-element {
    position: relative;
    left: 50%;
    max-width: max(min(100vw, 800px), 80vw);
    transform: translateX(-50%);
  }
  .blog-media-windowed .blog-media-element {
    width: 100%;
    border-radius: 0;
  }

  .blog-media-caption {
    display: block;
    font-size: 15px;
  }
</style>
  <style>
  .tag-row {
    font-family: var(--default-font);
    font-size: 12px;
    font-weight: bold;
  }
</style>
  <style>
  .blog-post-info {
    margin: 24px 0;
    font-family: var(--default-font);
    font-size: 12px;
    font-weight: bold;
    text-align: center;
    color: var(--text2-clr);
  }
  .blog-post-info-hidden {
    display: none;
  }
</style>
  <style>
  .text-with-bg-span {
    display: inline;
    margin: 0;
    padding: 0.7em;
    padding: 0.35lh;
    border-radius: 18px;
    box-decoration-break: clone;
    -webkit-box-decoration-break: clone;
    font: inherit;
    background: var(--text-with-bg-color);
  }
</style>
  <style>
  .blog-header {
    isolation: isolate;
    margin: 90px 0 24px;
    position: relative;
    left: 50%;
    height: 400px; /* .blog-header-title::before must match */
    width: max(800px, 60vw);
    transform: translateX(-50%);
    box-sizing: border-box;
  }
  @media (max-width: 600px) {
    .blog-header {
      margin-top: 60px;
    }
  }

  .blog-header-title {
    position: relative;
    max-width: 800px;
    font-family: var(--display-font);
    font-size: 36px;
    font-weight: bold;
    font-style: italic;
    text-align: left;
    z-index: 2;
  }
  .blog-header-title-inner {
    border-top-left-radius: 0;
    border-bottom-left-radius: 0;
  }
  /* Wrap lines in an angle */
  .blog-header-title::before {
    content: "";
    width: 0;
    width: calc(min(50%, 120vw - 600px));
    height: 400px;
    float: right;
    shape-outside: polygon(100% 0%, 20% 30%, 0% 100%, 100% 100%, 100% 0%);
  }

  .blog-header-hero {
    position: absolute;
    inset: 1px;
    width: 100%;
    height: 100%;
    object-fit: cover;
    border-radius: 18px;
    background: gray;
    z-index: -1;
  }

  .blog-header-decor {
    position: absolute;
    inset: 0;
    pointer-events: none;
    fill: var(--bg-clr);
    z-index: 1;
  }

  @media (max-width: 800px) {
    .blog-header {
      width: 100vw;
      width: 100svw;
      height: 400px;
      padding-right: 36px;
    }
    .blog-header-title {
      font-size: clamp(24px, 20px + 2vw, 36px);
    }
  }
</style>
  <style>
  @font-face {
    font-family: "Space Mono";
    font-display: swap;
    font-weight: normal;
    font-style: normal;
    src: url("/fonts/space/SpaceMono-Regular.ttf") format("truetype");
  }

  @font-face {
    font-family: "Space Mono";
    font-display: swap;
    font-weight: normal;
    font-style: italic;
    src: url("/fonts/space/SpaceMono-Italic.ttf") format("truetype");
  }

  @font-face {
    font-family: "Iosevka";
    font-display: swap;
    font-weight: normal;
    font-style: normal;
    src: url("/fonts/iosevka/iosevka-custom-regular.woff2") format("woff2");
  }

  @font-face {
    font-family: "Iosevka";
    font-display: swap;
    font-weight: normal;
    font-style: italic;
    src: url("/fonts/iosevka/iosevka-custom-italic.woff2") format("woff2");
  }

  @font-face {
    font-family: "Miriam Libre";
    font-display: swap;
    font-weight: normal;
    font-style: normal;
    src: url("/fonts/miriam/MiriamLibre-Regular.ttf") format("truetype");
  }

  :root {
    --default-font: "Iosevka", "Space Mono", monaco, Consolas, "Lucida Console",
      monospace;
    --display-font: "Space Mono", "Iosevka", monaco, Consolas, "Lucida Console",
      monospace;
    --reading-font: "Miriam Libre", Futura, "Trebuchet MS", Arial, sans-serif;

    --bg-clr: #111616;
    --card-clr: #222c2c;
    --clr0-light: #54f8c1;
    --clr0: #0ad591;
    --clr0-dark: #05b97d;
    --clr1: #df2063;

    --text-clr: #fff;
    --text2-clr: #999;

    --ease: cubic-bezier(0.8, 0, 1, 1);
  }

  body {
    margin: 0;
    min-height: 100vh;
    font-family: var(--default-font, monospace);
    font-size: 15px;
    font-display: swap;
    font-variant-ligatures: none;
    background-color: var(--bg-clr, #111);
    color: var(--text-clr, #fff);
    overflow-x: hidden;
  }
  .page-wrapper {
    display: flex;
    flex-direction: column;
    min-height: 100vh;
  }
  .page-wrapper-content {
    flex: 1 1 auto;
  }
</style>
  <style>
  nebula-client {
    position: relative;
  }
  nebula-client > canvas {
    width: 100%;
    height: 100%;
  }
  .nebula-noise {
    position: absolute;
    inset: 0;
    background: url("/noise.png"); /* todo: encapsulate noise.png */
    opacity: 0.1;
    animation: nebula-noise-x 0.16s steps(2, jump-start) infinite,
      nebula-noise-y 0.48s steps(3, jump-start) infinite;
  }
  @supports (mix-blend-mode: overlay) {
    .nebula-noise {
      mix-blend-mode: overlay;
      opacity: 0.2;
    }
  }
  @keyframes nebula-noise-x {
    to {
      background-position-x: 100px;
    }
  }
  @keyframes nebula-noise-y {
    to {
      background-position-y: 100px;
    }
  }
</style>
  <style>
  .main-footer-web-link {
    text-decoration: none;
  }

  .main-footer-web-link-icon {
    width: 32px;
    height: 32px;
    image-rendering: pixelated;
  }
  .main-footer-web-link-icon:hover {
    filter: invert(1);
  }
</style>
  <style>
  .main-footer {
    position: relative;
    display: flex;
    justify-content: space-between;
    gap: 60px;
    padding: 42px calc(max(36px, 50vw - 600px));
    font-family: var(--display-font);
    font-size: 15px;
    font-weight: bold;
    background: var(--clr0);
    color: #000;
    overflow: hidden;
    content-visibility: auto;
    contain-intrinsic-height: 200px;
  }

  .main-footer-links-heading {
    margin: 18px 0;
    font-size: inherit;
  }

  .main-footer-line {
    margin: 12px 0;
  }

  .main-footer-link {
    color: #000;
  }
  .main-footer-link:hover {
    color: #000;
  }

  .main-footer-webring-icon {
    width: 16px;
    height: 16px;
    image-rendering: pixelated;
  }

  .main-footer-signature {
    width: 64px;
    height: 64px;
    image-rendering: pixelated;
    vertical-align: top;
  }

  .main-footer-content-part {
    z-index: 1;
  }

  .main-footer-nebula {
    position: absolute;
    left: -30%;
    top: -30%;
    width: 160%;
    height: 160%;
    z-index: 0;
  }

  .main-footer-top-btn {
    display: block;
    z-index: 2;
    position: absolute;
    right: 0;
    top: 0;
    width: 72px;
    height: 36px;
    padding-right: 9px;
    box-sizing: border-box;
    display: flex;
    justify-content: center;
    align-items: center;
    border: none;
    border-bottom-left-radius: 18px;
    background: var(--bg-clr);
    text-decoration: none;
    color: var(--clr0-light);
    font: inherit;
    font-size: 18px;
    font-weight: bold;
    cursor: pointer;
  }
  .main-footer-top-btn:hover {
    color: var(--clr1);
  }
  .main-footer-top-btn::before {
    content: "";
    position: absolute;
    right: 0;
    top: 0;
    width: 36px;
    height: 18px;
    border-top-right-radius: 18px;
    transform: translateX(-72px);
    box-shadow: 18px 0 0 var(--bg-clr);
  }

  @media (max-width: 700px) {
    .main-footer {
      flex-direction: column-reverse;
    }
  }
</style>
  <style>
  .main-header {
    position: sticky;
    top: 0;
    width: 100%;
    height: 60px;
    padding: 0 calc(25% - 150px);
    z-index: 100;
    box-sizing: border-box;
    pointer-events: none;
  }
  .main-header.float {
    position: fixed;
  }

  .main-header-bar {
    position: relative;
    display: flex;
    justify-content: space-evenly;
    align-items: flex-end;
    height: 100%;
  }

  .main-header-item {
    display: inline-flex;
    justify-content: center;
    align-items: center;
    width: 6ch;
    height: 36px;
    padding: 0 18px;
    padding: 0 calc(min(18px,  -18px + 8vw));
    border-radius: 18px;
    font-family: var(--display-font);
    font-size: 13px;
    font-weight: bold;
    letter-spacing: 1px;
    text-decoration: none;
    text-transform: uppercase;
    color: #fff;
    backdrop-filter: blur(8px);
    background-color: #2222;
    background-image: linear-gradient(60deg, #9994 60%, transparent 60%);
    background-repeat: no-repeat;
    background-size: 220% 100%;
    background-position: 115%;
    pointer-events: all;
    transition: background-color 0.2s var(--ease),
      background-position 0.2s var(--ease);
  }
  .main-header-item:hover {
    background-image: linear-gradient(
      60deg,
      #9994 50%,
      #fff 50%,
      #fff 60%,
      transparent 60%
    );
    background-position: 0%;
  }
  .main-header-item.select {
    background: #9994;
  }

  .main-header-icon {
    width: 48px;
    height: 48px;
    border-radius: 25%;
    image-rendering: pixelated;
    object-fit: cover;
    filter: invert(1);
    backdrop-filter: blur(8px) invert(1);
    pointer-events: all;
  }
  .main-header-icon-yay {
    border-radius: 50%;
    object-position: 0 0;
  }
  .main-header-icon-yay:hover {
    object-position: 100% 0;
  }

  @media (max-width: 600px) {
    .main-header {
      height: 90px;
      padding-top: 6px;
    }
    .main-header-bar {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      justify-items: center;
      row-gap: 6px;
    }
    .main-header-icon {
      display: none;
    }
  }

  .main-header-indicator {
    position: absolute;
    width: 6px;
    height: 6px;
    left: 50%;
    top: calc(100% + 12px);
    transform: translate(-50%, -50%);
    /* border acts as extended touch area */
    border: solid 6mm transparent;
    border-left-width: 45vw;
    border-right-width: 45vw;
    border-radius: 50%;
    background: #fff;
    background-clip: padding-box;
    opacity: 0;
    transition: opacity 50ms;
  }
  .main-header.hidden .main-header-indicator {
    opacity: 0.4;
    pointer-events: all;
  }
</style>
  <style>
  .blog-page {
    margin: auto;
    overflow: hidden;
  }

  .content {
    margin: auto;
    padding: 0 18px 60px;
    width: 100%;
    max-width: 700px;
    font-family: var(--reading-font, sans-serif);
    font-size: 16px;
    line-height: 2.2;
    letter-spacing: 0.02em;
    color: #ddd;
    box-sizing: border-box;
  }

  .postcontent {
    margin: auto;
    padding: 0 0 60px;
    width: 100%;
    box-sizing: border-box;
  }
  .postcontent-narrow {
    margin: auto;
    padding: 0 18px;
    width: 100%;
    max-width: 700px;
    box-sizing: border-box;
  }

  .blog-signature {
    position: relative;
    margin: 0 0 60px;
    line-height: 21px;
  }
  .blog-signature::before {
    content: "❝";
    position: absolute;
    left: -15px;
    top: 0;
    font-size: 60px;
    opacity: 0.2;
  }
  .blog-signature a {
    font-weight: bold;
  }
  .blog-signature-name {
    white-space: nowrap;
  }
  .blog-signature-img {
    position: relative;
    top: 3px;
  }

  .markdown > h1,
  .markdown > h2,
  .markdown > h3,
  .markdown > h4,
  .markdown > h5,
  .markdown > h6 {
    margin: 48px 0 36px;
    font-family: var(--display-font);
    font-weight: normal;
    font-style: italic;
    line-height: 1.6;
    letter-spacing: 0.04em;
    text-wrap: balance;
  }
  .markdown > h1 {
    text-align: center;
    font-size: 200%;
  }
  .markdown > h2 {
    font-size: 150%;
  }
  .markdown > h3,
  .markdown > h4,
  .markdown > h5,
  .markdown > h6 {
    font-size: 120%;
    font-weight: bold;
  }

  .markdown > p {
    margin: 36px 0;
  }
  .markdown .box-note > p {
    margin: 18px 0;
  }
  .markdown .box-note > p:first-child {
    margin-top: 0;
  }
  .markdown .box-note > p:last-child {
    margin-bottom: 0;
  }

  .markdown-table {
    margin: 0 -18px; /* bleed content padding */
    padding: 0 18px; /* bleed content padding */
    overflow-x: auto;
  }
  .markdown-table > table {
    min-width: 100%;
    box-sizing: border-box;
    border-collapse: collapse;
    background-color: var(--card-clr);
    border-radius: 12px;
  }
  .markdown-table > table th,
  .markdown-table > table td {
    min-width: min(25vw, 8ch);
    box-sizing: border-box;
    text-align: start;
    padding: 9px 6px;
    padding-inline-end: 18px;
    border-bottom: solid 1px #444;
  }
  .markdown-table > table th:first-child,
  .markdown-table > table td:first-child {
    padding-left: 12px;
  }
  .markdown-table > table th:last-child,
  .markdown-table > table td:last-child {
    padding-right: 12px;
  }
  .markdown-table > table > tbody > tr:last-child > td {
    border-bottom: none;
  }

  .markdown > hr {
    width: 36px;
    margin: 90px auto;
    border: solid 1.5px #ccc;
    background: #ccc;
    border-radius: 3px;
  }

  .markdown code:not([class]):not([class]) {
    display: inline-block;
    padding: 0 6px;
    border-radius: 6px;
    font-family: var(--default-font, monospace);
    font-size: 15px;
    background: var(--card-clr);
  }
  .markdown > pre:not([class]) > code:not([class]) {
    display: block;
    padding: 18px;
    border-radius: 18px;
    line-height: 1.6;
    font-size: 15px;
    overflow-x: auto;
  }

  .markdown > blockquote {
    position: relative;
    margin: 0;
    padding: 18px 24px;
    border-radius: 18px;
    border: solid 1px var(--clr0);
    font-size: 21px;
  }
  .markdown > blockquote::before {
    content: "";
    position: absolute;
    right: 100%;
    top: 0;
    height: 24px;
    width: 24px;
    border-bottom: solid 1px var(--clr0);
    box-sizing: border-box;
  }
  .markdown > blockquote::after {
    content: "";
    position: absolute;
    right: 100%;
    top: 24px;
    bottom: 18px;
    width: 24px;
    border-top-right-radius: 24px;
    border: solid var(--clr0);
    border-width: 1px 1px 0 0;
    box-shadow: 9px 0 0 var(--bg-clr), 18px 0 0 var(--bg-clr);
    box-sizing: border-box;
  }
  .markdown > blockquote > :first-child {
    margin-top: 0;
  }
  .markdown > blockquote > :last-child {
    margin-bottom: 0;
  }
  .markdown > blockquote cite {
    display: block;
    margin-top: 12px;
    font-size: 15px;
    font-style: inherit;
  }
  .markdown > blockquote cite::before {
    content: "—";
  }

  .markdown > iframe,
  .markdown > p > iframe {
    max-width: calc(100vw - 18px);
    border: none;
    border-radius: 18px;
    background: #fff;
  }

  .markdown .center {
    text-align: center;
  }
  .markdown .center-flex {
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
  }

  /* todo? convert to component <blog-bleed>, reuse across <blog-media> */
  .markdown .bleed {
    position: relative;
    left: 50%;
    width: 100vh;
    max-width: max(min(100vw, 800px), 80vw);
    transform: translateX(-50%);
  }

  /* todo: convert to component <caption>, reuse across <blog-media> */
  .markdown .caption {
    display: block;
    font-size: 15px;
    text-align: center;
  }
</style>
  <style>
  .card-grid {
    display: grid;
    justify-content: center;
    grid-template-columns: repeat(auto-fit, calc(min(546px, 100%)));
    gap: 60px;
  }
  .card-grid-tall {
    gap: 90px 60px;
  }
  @media (max-width: 900px) {
    .card-grid {
      gap: 30px;
    }
  }
  @media (prefers-reduced-motion) {
    .card-grid * {
      animation: none !important;
    }
  }
</style>
  <style>
  .blog-suggestions {
    margin: 120px auto 0;
    padding: 0 18px;
    width: 100%;
    max-width: 1800px;
    box-sizing: border-box;
  }

  .blog-suggestions-title {
    margin: 0 0 30px;
    text-align: center;
  }
</style>
  <style>
  .card-grid-item {
    display: block;
    text-decoration: none;
    text-align: start;
    color: var(--text-clr);
    overflow: hidden;
    transition: 0.2s var(--ease);
    transition-property: margin, padding;
  }
  .card-grid-animated .card-grid-item {
    animation: card-grid-item-reveal 0.8s var(--ease) backwards;
    animation-delay: var(--card-grid-item-delay);
  }
  @keyframes card-grid-item-reveal {
    0% {
      clip-path: inset(20% 100% 60% 0 round 18px);
      filter: brightness(0);
    }
    50% {
      clip-path: inset(20% 0 60% 0 round 18px);
      filter: brightness(1);
    }
    100% {
      clip-path: inset(0 0 0 0 round 18px);
    }
  }

  .card-grid-image-container {
    position: relative;
    width: 100%;
    height: 340px;
    border-radius: 18px;
    overflow: hidden;
    z-index: 0;
  }
  .card-grid-image-container::after {
    content: "";
    position: absolute;
    left: 0;
    right: 0;
    top: 0;
    bottom: 0;
    background: var(--clr0);
    mix-blend-mode: darken;
    transition: background 1s;
  }

  .card-grid-image {
    width: 101%;
    height: 101%;
    object-fit: cover;
    object-position: top;
    filter: contrast(0.8);
    transform: scale(1);
    transform-origin: 9px 9px;
    transition: filter 1s, transform 1s;
  }
  .card-grid-thumbalign-center .card-grid-image {
    object-position: center;
    transform-origin: center;
  }

  .card-grid-title-wrap {
    position: relative;
    max-width: 80%;
    height: 0;
  }
  .card-grid-title-bar {
    position: absolute;
    bottom: 0;
    border-top-right-radius: 18px;
    background: var(--bg-clr);
  }
  .card-grid-title-content {
    position: relative;
    padding: 12px 24px 0 0;
    transition: padding 0.2s var(--ease);
  }
  .card-grid-title-content::before {
    content: "";
    position: absolute;
    left: 0;
    bottom: 100%;
    width: 18px;
    height: 36px;
    border-bottom-left-radius: 18px;
    box-shadow: 0 18px 0 var(--bg-clr);
  }
  .card-grid-title-content::after {
    content: "";
    position: absolute;
    left: 100%;
    bottom: 0;
    width: 36px;
    height: 18px;
    border-bottom-left-radius: 18px;
    box-shadow: -18px 0 0 var(--bg-clr);
  }

  .card-grid-title {
    font-family: var(--display-font);
    font-size: 18px;
    font-style: italic;
    font-weight: bold;
  }

  .card-grid-posttitle {
    margin-top: 12px;
    font-size: 15px;
    font-style: italic;
    font-weight: bold;
    opacity: 0.8;
  }
  .card-grid-posttitle:empty {
    margin-top: 0;
  }

  .card-grid-postitle-small {
    display: none;
  }

  .card-grid-actions {
    display: none;
    gap: 5mm;
    max-height: 48px;
    padding-top: 6px;
    overflow: hidden;
  }
  .card-grid-action {
    display: inline-block;
    font-weight: bold;
    text-decoration: underline;
    color: var(--text2-clr);
    cursor: pointer;
    position: relative;
  }
  .card-grid-info {
    margin: -2.5mm;
    padding: 2.5mm;
  }
  .card-grid-story::after {
    content: "→";
    display: inline-block;
  }

  .card-grid-content {
    margin: 18px 0;
    font-size: 15px;
    line-height: 2;
    transition: margin 0.2s var(--ease);
  }

  .card-grid-animated .card-grid-title {
    animation: card-grid-text-reveal 0.4s cubic-bezier(0, 0.8, 0.6, 1) backwards;
    animation-delay: calc(var(--card-grid-item-delay) + 0.8s);
  }
  .card-grid-animated .card-grid-posttitle {
    animation: card-grid-text-reveal 0.4s cubic-bezier(0, 0.8, 0.6, 1) backwards;
    animation-delay: calc(var(--card-grid-item-delay) + 0.9s);
  }

  @keyframes card-grid-text-reveal {
    from {
      transform: translateY(-100%);
      clip-path: inset(100% 0 0 0);
    }
    to {
      clip-path: inset(0 0 0 0);
    }
  }

  .card-grid-animated .card-grid-content {
    animation: card-grid-content 0.6s 1.5s backwards;
  }
  @keyframes card-grid-content {
    from {
      opacity: 0;
    }
  }

  @media (hover: hover) {
    .card-grid-item:hover {
      margin: -12px -24px 0;
      padding-bottom: 12px;
    }
    .card-grid-item:hover .card-grid-image-container::after {
      background: var(--text-clr);
      transition: background 2s;
    }
    .card-grid-item:hover .card-grid-image {
      filter: contrast(1);
      transform: scale(1.1);
      transition: filter 1s, transform 2s;
    }
    .card-grid-item:hover .card-grid-title-content {
      padding: 24px;
    }
    .card-grid-item:hover .card-grid-content {
      margin-left: 24px;
      margin-right: 24px;
    }
  }

  @media (max-width: 600px) {
    .card-grid-content {
      margin: 12px 0;
    }

    .card-grid-image-container {
      height: 200px;
    }

    .card-grid-posttitle {
      display: none;
    }
    .card-grid-postitle-small {
      display: block;
    }

    .card-grid-actions {
      display: flex;
    }
    .card-grid-item-expanded .card-grid-actions {
      max-height: 0;
      transition: max-height 0.2s cubic-bezier(0.2, 0, 0.8, 1);
    }

    .card-grid-description {
      max-height: 0;
      overflow: hidden;
    }
    .card-grid-item-expanded .card-grid-description {
      max-height: 100vh;
      transition: max-height 1s cubic-bezier(0.2, 0, 1, 1);
    }
  }
</style>
  <style>
  .tag-component {
    display: inline-block;
    padding: 0 3px;
    height: 16px;
    line-height: 16px;
    font-family: var(--default-font);
    font-size: 12px;
    font-weight: bold;
    background: #ccc;
    color: #444;
    border-radius: 3px;
  }
</style>
  <style>
  .btn,
  .btn:visited {
    padding: 6px 12px;
    border-radius: 12px;
    border: none;
    font-family: var(--display-font);
    font-size: 12px;
    font-weight: bold;
    text-decoration: none;
    background: var(--clr0-dark);
    color: #fff;
    cursor: pointer;
  }
  .btn:not(:disabled):hover {
    background: var(--clr0);
  }
  .btn:not(:disabled):active {
    background: var(--clr0-dark);
  }
  .btn:disabled {
    color: #888;
    cursor: not-allowed;
  }
</style>
  <style>
  .blog-rss-link {
    margin: 60px auto 0;
    width: 100%;
    text-align: center;
  }

  .blog-rss-link-combo {
    display: flex;
    justify-content: center;
  }
  .blog-rss-link-a {
    padding: 0 12px;
    border: solid 1px var(--clr0);
    border-top-left-radius: 12px;
    border-bottom-left-radius: 12px;
    box-sizing: border-box;
    height: 30px;
    line-height: 30px;
    font-size: 12px;
    color: var(--text2-clr);
  }
  .blog-rss-link-button {
    height: 30px;
    border-top-left-radius: 0;
    border-bottom-left-radius: 0;
  }
</style>
  <style>
  .text-link {
    color: var(--clr0-light, #fff);
  }
  .text-link:visited {
    color: var(--clr0, #fff);
  }
</style>
  <script async="" src="/scripts/cursor.js"></script>
</head>


<body>

  <div class="page-wrapper">
    <header class="main-header">
      <div class="main-header-bar">
        <a href="/" class="main-header-item ">Home</a>
        <a href="/notes/" class="main-header-item select">Notes</a>
        <a href="/about/" class="main-header-item ">About</a>
        <img class="main-header-icon main-header-icon-yay" src="/icons/yay_sheet.png" alt="">
        <a href="/wares/" class="main-header-item ">Wares</a>
        <a href="/art/" class="main-header-item ">Art</a>
        <a href="/music/" class="main-header-item ">Music</a>
        <div class="main-header-indicator"></div>
      </div>
    </header>
    <div class="page-wrapper-content">

      <div class="blog-page">

        <div class="content">

          <!-- prettier-ignore -->
          <div class="markdown">
            <p>
            <div class="blog-header">
              <div class="text-with-bg blog-header-title" style="--text-with-bg-color: var(--bg-clr)">
                <h1 class="text-with-bg-span blog-header-title-inner">
                  Simple image recognition with vanilla JavaScript
                </h1>
              </div>
              <img srcset="/notes/simple-image-recognition-vanilla-js/hero_800.generated.png 800w,/notes/simple-image-recognition-vanilla-js/hero_1020.generated.png 1020w,/notes/simple-image-recognition-vanilla-js/hero_1400.generated.png 1400w" sizes="not (min-width:800px) 800px,(max-width:1275px) 1020px, 1400px" class="blog-header-hero" src="/notes/simple-image-recognition-vanilla-js/hero.png" alt="" spec="100% [800) 80%">
              <svg xmlns="http://www.w3.org/2000/svg" class="blog-header-decor">
                <path></path>
              </svg>
            </div>
            </p>
            <p>
            <div class="blog-post-info ">
              25 Feb 2023 · 10 min read
            </div>
            </p>
            <div class="tag-row">tags:
              <span class="tag-component" style="background: #f0de91; color: #725f15">js</span>
            </div>

            <p>Hi there! I want to share my experience with an <a target="_blank" class="text-link " href="https://en.wikipedia.org/wiki/Computer_vision#Recognition"><strong>image recognition</strong></a> problem I faced in an art project (It was an <a target="_self" class="text-link " href="/wares/dimensions/">augmented reality art project</a>).</p>
            <p>
            <div class="blog-media blog-media-default">
              <img srcset="/notes/simple-image-recognition-vanilla-js/image-recognition_664.generated.png 664w" sizes=" 664px" class="blog-media-element" alt="Image recognition illustration" src="/notes/simple-image-recognition-vanilla-js/image-recognition.png" spec="100% [664) 664" loading="lazy" width="100%" height="" style="aspect-ratio: 2; background: #48c8d8"><span class="blog-media-caption">Image recognition problems come in different forms.</span>
            </div>
            </p>
            <p>As part of the project, I needed a mobile app to be able to recognize a particular art piece. Then it can overlay virtual effects onto the real-world image. The goal was to have a unique and engaging experience!</p>
            <p>
            <div class="blog-media blog-media-default">
              <video class="blog-media-element" muted="" autoplay="" loop="" aria-label="Demo video">
                <source src="/notes/simple-image-recognition-vanilla-js/demo.mp4">
                <a href="/notes/simple-image-recognition-vanilla-js/demo.mp4">Demo video</a>
              </video><span class="blog-media-caption">The app should recognize when the target art piece has been aligned.</span>
            </div>
            </p>
            <p>There are various solutions available for tackling this problem, ranging from basic histogram matching to advanced convolutional neural networks. There are even libraries that can provide a solution right out of the box! But I decided to take on the challenge of developing my own solution instead of relying on existing tools. Not only did this allow me to learn something new, but it also let me have some fun approaching the problem!</p>
            <p><span class="box-note "><strong>TL;DR</strong> - It converts the camera image into a feature vector and then compares that against a predefined target reference.</span></p>
            <h2 id="color-and-illumination-theory">Color and illumination theory</h2>
            <p>To begin solving the problem, we first need to understand the mechanics. It all starts by capturing an image from the camera.</p>
            <p>Now, it’s important to keep in mind that the camera’s perception of color can be influenced by various factors. Factors include the lighting conditions in the room or the quality of the camera itself. We need to account for these variables in our solution.</p>
            <p>
            <div class="blog-media blog-media-default">
              <img srcset="/notes/simple-image-recognition-vanilla-js/tc-vs-pc_664.generated.jpg 664w" sizes=" 664px" class="blog-media-element" alt="diagram" src="/notes/simple-image-recognition-vanilla-js/tc-vs-pc.jpg" spec="100% [664) 664" loading="lazy" width="100%" height="" style="aspect-ratio: 2; background: #f8f8f8"><span class="blog-media-caption">True color (TC) vs perceived color (PC)</span>
            </div>
            </p>
            <p>Simply comparing raw pixel data against the target image would likely fail due to the unknown environmental factors. One way of addressing this is to massage the input to isolate the true color from the environmental factors.</p>
            <p>For this, I created a graphical model for the perceived color. It’s roughly based on CGI illumination models. This was the key to making the image recognition algorithm more robust.</p>
            <p>Here’s the equation:</p>
            <pre><code>PC = TC * a + b
</code></pre>
            <ul>
              <li><code>PC</code> is the color perceived from the camera sensor.</li>
              <li><code>TC</code> (unknown variable) is the true color of the material.</li>
              <li><code>a</code> and <code>b</code> (unknown variables) are parameters that together describe the vague real-world lighting variables like white balance, environmental illumination, camera sensor quality, and other factors.</li>
            </ul>
            <p>The algorithm begins by calculating the average colors of three predetermined regions within the image. While these regions are specific to my art piece, you can adapt the algorithm to work with any configuration of (at least) three regions.</p>
            <p>
            <div class="blog-media blog-media-default">
              <img srcset="/notes/simple-image-recognition-vanilla-js/dimensions_illo2_664.generated.jpg 664w" sizes=" 664px" class="blog-media-element" alt="diagram" src="/notes/simple-image-recognition-vanilla-js/dimensions_illo2.jpg" spec="100% [664) 664" loading="lazy" width="100%" height="" style="aspect-ratio: 2; background: #f8f8f8"><span class="blog-media-caption">The regions were specifically chosen to capture key features.</span>
            </div>
            </p>
            <p>Let’s call the three colors <code>PC1</code>, <code>PC2</code>, and <code>PC3</code>.</p>
            <p>To get the average, you can either (1) read over the pixels in those regions and average them, or (2) downsample the image and directly use pixel colors (typically faster). For this case, I used the former, which is reading over the pixels within each region to calculate the average color.</p>
            <pre class="code-block "><code class="code-block-code"><span class="token comment">// &lt;video&gt; element streams the camera, not shown here how</span>
video <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'video'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// &lt;canvas&gt; to hold a video frame for reading pixels</span>
canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'canvas'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 

<span class="token comment">// Capture a video frame into the canvas</span>
<span class="token keyword">const</span> canvasContext <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">'2d'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
canvasContext<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span>video<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> imageData <span class="token operator">=</span> canvasContext
    <span class="token punctuation">.</span><span class="token function">getImageData</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">)</span>
    <span class="token punctuation">.</span>data<span class="token punctuation">;</span>

<span class="token comment">// Get the colors</span>
<span class="token keyword">const</span> pc1 <span class="token operator">=</span> <span class="token function">getRegionAverageColor</span><span class="token punctuation">(</span>imageData<span class="token punctuation">,</span> regionRect1<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> pc2 <span class="token operator">=</span> <span class="token function">getRegionAverageColor</span><span class="token punctuation">(</span>imageData<span class="token punctuation">,</span> regionRect2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> pc3 <span class="token operator">=</span> <span class="token function">getRegionAverageColor</span><span class="token punctuation">(</span>imageData<span class="token punctuation">,</span> regionRect3<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">getRegionAverageColor</span><span class="token punctuation">(</span><span class="token parameter">imageData<span class="token punctuation">,</span> rect</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> lineStride <span class="token operator">=</span> <span class="token number">4</span> <span class="token operator">*</span> width<span class="token punctuation">;</span>
  <span class="token keyword">let</span> r <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> g <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> b <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> j <span class="token operator">=</span> rect<span class="token punctuation">.</span>y<span class="token punctuation">;</span> j <span class="token operator">&lt;</span> rect<span class="token punctuation">.</span>y <span class="token operator">+</span> rect<span class="token punctuation">.</span>height<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> rect<span class="token punctuation">.</span>x<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> rect<span class="token punctuation">.</span>x <span class="token operator">+</span> rect<span class="token punctuation">.</span>width<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      r <span class="token operator">+=</span> imageData<span class="token punctuation">[</span>j <span class="token operator">*</span> lineStride <span class="token operator">+</span> i <span class="token operator">*</span> <span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">/</span> <span class="token number">0xff</span><span class="token punctuation">;</span>
      g <span class="token operator">+=</span> imageData<span class="token punctuation">[</span>j <span class="token operator">*</span> lineStride <span class="token operator">+</span> i <span class="token operator">*</span> <span class="token number">4</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">/</span> <span class="token number">0xff</span><span class="token punctuation">;</span>
      b <span class="token operator">+=</span> imageData<span class="token punctuation">[</span>j <span class="token operator">*</span> lineStride <span class="token operator">+</span> i <span class="token operator">*</span> <span class="token number">4</span> <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">/</span> <span class="token number">0xff</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> count <span class="token operator">=</span> rect<span class="token punctuation">.</span>width <span class="token operator">*</span> rect<span class="token punctuation">.</span>height<span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">r</span><span class="token operator">:</span> r <span class="token operator">/</span> count<span class="token punctuation">,</span>
    <span class="token literal-property property">g</span><span class="token operator">:</span> g <span class="token operator">/</span> count<span class="token punctuation">,</span>
    <span class="token literal-property property">b</span><span class="token operator">:</span> b <span class="token operator">/</span> count
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
            <p>Refer to these MDN articles <a target="_blank" class="text-link " href="https://developer.mozilla.org/en-US/docs/Web/API/Canvas_API/Manipulating_video_using_canvas">Manipulating_video_using_canvas</a> and <a target="_blank" class="text-link " href="https://developer.mozilla.org/en-US/docs/Web/API/ImageData">ImageData</a> for details about the Web APIs.</p>
            <p>After getting the colors, we can start processing them. First, subtract the top <code>PC1</code> and middle <code>PC2</code> colors, as well as the middle <code>PC2</code> and bottom <code>PC3</code> - like a 1-dimensional convolution. The order of subtraction doesn’t really matter. This produces two difference colors.</p>
            <p>Let’s call the resulting colors <code>D1</code> and <code>D2</code>:</p>
            <p>
            <div class="blog-media blog-media-default">
              <img srcset="/notes/simple-image-recognition-vanilla-js/dimensions_illo3_664.generated.jpg 664w" sizes=" 664px" class="blog-media-element" alt="diagram" src="/notes/simple-image-recognition-vanilla-js/dimensions_illo3.jpg" spec="100% [664) 664" loading="lazy" width="100%" height="" style="aspect-ratio: 2; background: #f8f8f8">
            </div>
            </p>
            <pre class="code-block "><code class="code-block-code"><span class="token comment">// To subtract two colors, we subtract each RGB component</span>
<span class="token keyword">const</span> d1 <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">r</span><span class="token operator">:</span> pc1<span class="token punctuation">.</span>r <span class="token operator">-</span> pc2<span class="token punctuation">.</span>r<span class="token punctuation">,</span>
  <span class="token literal-property property">g</span><span class="token operator">:</span> pc1<span class="token punctuation">.</span>g <span class="token operator">-</span> pc2<span class="token punctuation">.</span>g<span class="token punctuation">,</span>
  <span class="token literal-property property">b</span><span class="token operator">:</span> pc1<span class="token punctuation">.</span>b <span class="token operator">-</span> pc2<span class="token punctuation">.</span>b
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> d2 <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">r</span><span class="token operator">:</span> pc2<span class="token punctuation">.</span>r <span class="token operator">-</span> pc3<span class="token punctuation">.</span>r<span class="token punctuation">,</span>
  <span class="token literal-property property">g</span><span class="token operator">:</span> pc2<span class="token punctuation">.</span>g <span class="token operator">-</span> pc3<span class="token punctuation">.</span>g<span class="token punctuation">,</span>
  <span class="token literal-property property">b</span><span class="token operator">:</span> pc2<span class="token punctuation">.</span>b <span class="token operator">-</span> pc3<span class="token punctuation">.</span>b
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
            <p>Subtracting two perceived colors eliminates the unknown lighting variable <code>b</code>, as demonstrated in the following derivation:</p>
            <pre><code>D1 = PC2 - PC1
  = (TC2 * a + b) - (TC1 * a + b)
  = TC2 * a - TC1 * a
  = (TC2 - TC1) * a
</code></pre>
            <p>The resulting <code>D1</code> and <code>D2</code> are actually proportional to the true colors. But, they’re still both influenced by the lighting factor <code>a</code>:</p>
            <pre><code>D1 = (TC2 - TC1) * a
D2 = (TC3 - TC2) * a
</code></pre>
            <p>To remove the remaining lighting variable <code>a</code>, we can "normalize" the values. That is, divide each by the largest value among them.</p>
            <pre><code>N1 = D1 / max(|D1|, |D2|)
N2 = D2 / max(|D1|, |D2|)
</code></pre>
            <p>The resulting values <code>N1</code> and <code>N2</code> represent normalized <code>D1</code> and <code>D2</code> respectively.</p>
            <p>
            <div class="blog-media blog-media-default">
              <img srcset="/notes/simple-image-recognition-vanilla-js/dimensions_illo4_664.generated.jpg 664w" sizes=" 664px" class="blog-media-element" alt="diagram" src="/notes/simple-image-recognition-vanilla-js/dimensions_illo4.jpg" spec="100% [664) 664" loading="lazy" width="100%" height="" style="aspect-ratio: 2; background: #f8f8f8">
            </div>
            </p>
            <p>And here’s the code for that:</p>
            <pre class="code-block "><code class="code-block-code"><span class="token comment">// Get 'max(|D1|, |D2|)'</span>
<span class="token keyword">const</span> d1Magnitude <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">hypot</span><span class="token punctuation">(</span>d1<span class="token punctuation">.</span>r<span class="token punctuation">,</span> d1<span class="token punctuation">.</span>g<span class="token punctuation">,</span> d1<span class="token punctuation">.</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> d2Magnitude <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">hypot</span><span class="token punctuation">(</span>d2<span class="token punctuation">.</span>r<span class="token punctuation">,</span> d2<span class="token punctuation">.</span>g<span class="token punctuation">,</span> d2<span class="token punctuation">.</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Add 0.001 to avoid division by zero</span>
<span class="token keyword">const</span> max <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>d1Magnitude<span class="token punctuation">,</span> d2Magnitude<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">0.001</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> n1 <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">r</span><span class="token operator">:</span> d1<span class="token punctuation">.</span>r <span class="token operator">/</span> max<span class="token punctuation">,</span>
  <span class="token literal-property property">g</span><span class="token operator">:</span> d1<span class="token punctuation">.</span>g <span class="token operator">/</span> max<span class="token punctuation">,</span>
  <span class="token literal-property property">b</span><span class="token operator">:</span> d1<span class="token punctuation">.</span>b <span class="token operator">/</span> max<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> n2 <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">r</span><span class="token operator">:</span> d2<span class="token punctuation">.</span>r <span class="token operator">/</span> max<span class="token punctuation">,</span>
  <span class="token literal-property property">g</span><span class="token operator">:</span> d2<span class="token punctuation">.</span>g <span class="token operator">/</span> max<span class="token punctuation">,</span>
  <span class="token literal-property property">b</span><span class="token operator">:</span> d2<span class="token punctuation">.</span>b <span class="token operator">/</span> max<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
            <p>I’m not showing the full derivation here, but normalizing will get rid of the common factor <code>a</code>. The handwavy explanation is, if you divide two values having a common factor, that factor gets canceled out.</p>
            <p>Thus, if we expand all the terms:</p>
            <pre><code>N1 = (TC2 - TC1) / max(TC2 - TC1, TC3 - TC2)
N2 = (TC3 - TC2) / max(TC2 - TC1, TC3 - TC2)
</code></pre>
            <p>The result is that the final values <code>N1</code> and <code>N2</code> are derived purely from true color and are not affected by lighting parameters. <small>According to the model anyway.</small></p>
            <p>This whole preprocessing ensures that the algorithm is robust across different lighting conditions and phone cameras, as it only uses true color data.</p>
            <p>
            <div class="blog-media blog-media-default">
              <img srcset="/notes/simple-image-recognition-vanilla-js/dimensions_tester_664.generated.jpg 664w" sizes=" 664px" class="blog-media-element" alt="" src="/notes/simple-image-recognition-vanilla-js/dimensions_tester.jpg" spec="100% [664) 664" loading="lazy" width="100%" height="" style="aspect-ratio: 1; background: #d8c8b8"><span class="blog-media-caption">Actual test piece used in development. Even this badly-printed image in poor lighting can be recognized by the algorithm.</span>
            </div>
            </p>
            <h2 id="feature-vectors">Feature vectors</h2>
            <p>At this point, we can start looking at individual RGB values instead of thinking about "colors". You see, colors are just numbers representing red, green, and blue values.</p>
            <p>
            <div class="blog-media blog-media-default">
              <img srcset="/notes/simple-image-recognition-vanilla-js/rgb_664.generated.png 664w" sizes=" 664px" class="blog-media-element" alt="" src="/notes/simple-image-recognition-vanilla-js/rgb.png" spec="100% [664) 664" loading="lazy" width="100%" height="" style="aspect-ratio: 1.3333333333333333; background: #282828"><span class="blog-media-caption">A color is composed of RGB values</span>
            </div>
            </p>
            <p>From the normalized colors <code>N1</code> and <code>N2</code>, we can obtain six numerical values (three from each). These values can be rolled into one combined series of numbers, which we’ll call the <strong>feature vector</strong> of the image. The feature vector can be thought of as a numerical representation of certain characteristics of the image.</p>
            <pre class="code-block "><code class="code-block-code"><span class="token keyword">const</span> featureVector <span class="token operator">=</span> <span class="token punctuation">[</span>
  n1<span class="token punctuation">.</span>r<span class="token punctuation">,</span>
  n1<span class="token punctuation">.</span>g<span class="token punctuation">,</span>
  n1<span class="token punctuation">.</span>b<span class="token punctuation">,</span>
  n2<span class="token punctuation">.</span>r<span class="token punctuation">,</span>
  n2<span class="token punctuation">.</span>g<span class="token punctuation">,</span>
  n2<span class="token punctuation">.</span>b<span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span></code></pre>
            <p>In short, the feature vector <em>summarizes</em> the image.</p>
            <p>
            <div class="blog-media blog-media-default">
              <img srcset="/notes/simple-image-recognition-vanilla-js/dimensions_illo5_664.generated.jpg 664w" sizes=" 664px" class="blog-media-element" alt="diagram" src="/notes/simple-image-recognition-vanilla-js/dimensions_illo5.jpg" spec="100% [664) 664" loading="lazy" width="100%" height="" style="aspect-ratio: 2; background: #f8f8f8">
            </div>
            </p>
            <p>By turning colors into plain numbers, we say goodbye to subjective perceptions of color and enter the objective and computable realm of mathematics.</p>
            <p>This reduces the problem of comparing image similarity into a simple numerical comparison. If the numbers match, then the images match!</p>
            <p>Now, we just need the feature vector of the <em>target image</em> to compare with. We can precompute the same normalization process on the target image and hardcode the resulting feature vector in the app.</p>
            <p>I also got a couple more samples from real photos of the print for good measure.</p>
            <pre class="code-block "><code class="code-block-code"><span class="token comment">// (original + real sample 1 + real sample 2) / 3</span>
<span class="token keyword">const</span> targetFeatureVector <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">(</span>
    <span class="token operator">-</span><span class="token number">0.3593924173784146</span> <span class="token operator">+</span>
    <span class="token operator">-</span><span class="token number">0.3030924568415693</span> <span class="token operator">+</span>
    <span class="token operator">-</span><span class="token number">0.27620639981601575</span>
  <span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">3</span><span class="token punctuation">,</span>
  <span class="token punctuation">(</span>
    <span class="token operator">-</span><span class="token number">0.611915816235142</span> <span class="token operator">+</span>
    <span class="token operator">-</span><span class="token number">0.590167832630535</span> <span class="token operator">+</span>
    <span class="token operator">-</span><span class="token number">0.5946857824325745</span>
  <span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">3</span><span class="token punctuation">,</span>
  <span class="token punctuation">(</span>
    <span class="token operator">-</span><span class="token number">0.498629075974555</span> <span class="token operator">+</span>
    <span class="token operator">-</span><span class="token number">0.4975375806689763</span> <span class="token operator">+</span>
    <span class="token operator">-</span><span class="token number">0.49879828486061084</span>
  <span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">3</span><span class="token punctuation">,</span>
  <span class="token punctuation">(</span>
    <span class="token number">0.35716016633879705</span> <span class="token operator">+</span>
    <span class="token number">0.4556467533062926</span> <span class="token operator">+</span>
    <span class="token number">0.47164734468790415</span>
  <span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">3</span><span class="token punctuation">,</span>
  <span class="token punctuation">(</span>
    <span class="token number">0.17718492626963767</span> <span class="token operator">+</span>
    <span class="token number">0.1053991137797178</span> <span class="token operator">+</span>
    <span class="token number">0.13449453064454686</span>
  <span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">3</span><span class="token punctuation">,</span>
  <span class="token punctuation">(</span>
    <span class="token number">0.2980055137889341</span> <span class="token operator">+</span>
    <span class="token number">0.30589264583678</span> <span class="token operator">+</span>
    <span class="token number">0.2811110391693084</span>
  <span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">3</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span></code></pre>
            <p>Now that we’ve got the feature vectors for both the camera image and target image, we can compare them apples to apples.</p>
            <p>
            <div class="blog-media blog-media-default">
              <img srcset="/notes/simple-image-recognition-vanilla-js/dimensions_illo6_664.generated.jpg 664w" sizes=" 664px" class="blog-media-element" alt="diagram" src="/notes/simple-image-recognition-vanilla-js/dimensions_illo6.jpg" spec="100% [664) 664" loading="lazy" width="100%" height="" style="aspect-ratio: 2; background: #f8f8f8">
            </div>
            </p>
            <p>We can use Euclidean distance as a measure of vector similarity. Remember, vector similarity is our proxy for image similarity!</p>
            <pre class="code-block "><code class="code-block-code"><span class="token keyword">const</span> vectorDistance <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">hypot</span><span class="token punctuation">(</span>
  <span class="token operator">...</span>featureVector<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>
    <span class="token punctuation">(</span><span class="token parameter">value<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
        targetFeatureVector<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">-</span> value
  <span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>vectorDistance <span class="token operator">&lt;</span> <span class="token constant">THRESHOLD</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Image recognized!</span>
<span class="token punctuation">}</span></code></pre>
            <p>If the distance between the two vectors is below a certain threshold, then it’s a match!</p>
            <p>Voilà! That’s the algorithm. You take the input image, turn it into a feature vector, and compare it to a precomputed target vector. The whole image detection code totals less than 200 lines and requires no external library! This algorithm was integrated into the AR app that came along with the art exhibition.</p>
            <h2 id="conclusion">Conclusion</h2>
            <p>So, that’s the image detection algorithm I developed for my AR art app. It’s pretty straightforward and efficient, with just a few lines of code. It’s also fast enough to run in real-time on a phone camera feed, which is nice.</p>
            <p>Although it was designed for the specific images I had, you can customize it to suit your needs.</p>
            <p>Now, the algorithm does have a few limitations. It doesn’t take into account the positioning of the input image, so it has to be in the exact orientation as the target image. Also, extreme lighting conditions, irregular shadows, shiny surfaces, and the like might affect its accuracy.</p>
            <p>Overall, I’m pretty happy with how it turned out. While it’s not a general-purpose algorithm, it solved the problem for my art project perfectly. 😄</p>
            <h3 id="demo">Demo!</h3>
            <p>Want to try out the algorithm? Open this page on a desktop, and then use your phone to scan the QR code in the piece.</p>
            <p>
            <div class="blog-media blog-media-bleed">
              <img srcset="/wares/dimensions/media/dimensions_finalset_800.generated.jpg 800w,/wares/dimensions/media/dimensions_finalset_1020.generated.jpg 1020w,/wares/dimensions/media/dimensions_finalset_1400.generated.jpg 1400w" sizes="not (min-width:800px) 800px,(max-width:1275px) 1020px, 1400px" class="blog-media-element" alt="" src="/wares/dimensions/media/dimensions_finalset.jpg" spec="100% [800) 80% [1750) 1400" loading="lazy" width="400%" height="" style="aspect-ratio: 2.296875; background: #080808"><span class="blog-media-caption">Go to kalabasa.github.io/dimensions/ on your phone if QR doesn’t work.</span>
            </div>
            </p>
            <p><span class="box-note ">Want to learn more about the art project that this image detection algorithm was a part of? Check out the <a target="_self" class="text-link " href="/wares/dimensions/">Dimensions project</a>!</span>
            </p>

          </div>

        </div>
        <div class="postcontent">
          <div class="postcontent-narrow">
            <p class="blog-signature">Thanks for reading! I like making interactive visualisations for my <a target="_self" class="text-link " href="/notes/">programming blog</a>. Sometimes I do <a target="_self" class="text-link " href="/wares/">projects</a> too. Oh, and before you go, sign <a target="_self" class="text-link " href="/guestbook/">the guestbook</a>! See you around! <span class="blog-signature-name"><i>—Lean</i><img class="blog-signature-img" src="/icons/sig.png" alt="liyan"></span></p>
            <reactions-client class="reactions reactions-invisible">
              <h2 class="reaction-title">React to this post</h2>
              <button class="reaction-btn reaction-heart-btn">
                <span class="reaction-icon" aria-label="Heart"></span>
              </button>
              <div class="reaction-count reaction-heart-count"></div>
              <button class="reaction-btn reaction-fire-btn">
                <span class="reaction-icon" aria-label="Fire"></span>
              </button>
              <div class="reaction-count reaction-fire-count"></div>
              <button class="reaction-btn reaction-bubble-btn">
                <span class="reaction-icon" aria-label="Bubble"></span>
              </button>
              <div class="reaction-count reaction-bubble-count"></div>
              <button class="reaction-btn reaction-sun-btn">
                <span class="reaction-icon" aria-label="Sun"></span>
              </button>
              <div class="reaction-count reaction-sun-count"></div>
              <button class="reaction-btn reaction-cloud-btn">
                <span class="reaction-icon" aria-label="Cloud"></span>
              </button>
              <div class="reaction-count reaction-cloud-count"></div>
              <div class="reaction-error"></div>
            </reactions-client>
          </div>
          <aside class="blog-rss-link">
            <p>
              Want me to spam your inbox? Me neither.<br>Forget newsletters; use RSS!
            </p>
            <div class="blog-rss-link-combo">
              <a href="/rss.xml" target="_blank" class="blog-rss-link-a">
                leanrada.com/rss.xml
              </a>
              <button class="btn blog-rss-link-button">
                Copy
              </button>
            </div>
          </aside>
          <aside class="blog-suggestions">
            <h2 class="blog-suggestions-title">More posts</h2>
            <div class="card-grid ">

              <a class="card-grid-item card-grid-thumbalign-center card-grid-item-expanded" href="/notes/introducing-portabl.ink/">
                <div class="card-grid-image-container">
                  <img srcset="/notes/placeholder_546.generated.png 546w" sizes=" 546px" class="card-grid-image" src="/notes/placeholder.png" alt="" spec="546" loading="lazy">
                </div>
                <div class="card-grid-title-wrap">
                  <div class="card-grid-title-bar">
                    <div class="card-grid-title-content">
                      <div class="card-grid-title">Introducing portabl.ink</div>
                      <div class="card-grid-posttitle">25 Sep 2023</div>
                    </div>
                  </div>
                </div>
                <div class="card-grid-content">
                  <div class="card-grid-posttitle card-grid-postitle-small">
                    25 Sep 2023
                  </div>
                  <div class="card-grid-actions">
                    <span class="card-grid-action card-grid-info">Deets…</span>
                    <span class="card-grid-action card-grid-story">Read post</span>
                  </div>
                  <div class="card-grid-description">

                    <span class="tag-component" style="background: #f0de91; color: #725f15">js</span> <span class="tag-component" title="micropost" style="background: #cccccc; color: #444444">µpost</span>

                    <span class="card-grid-action card-grid-story" aria-label="Read post - Introducing portabl.ink">Read post</span>
                  </div>
                </div>
              </a><a class="card-grid-item card-grid-thumbalign-center card-grid-item-expanded" href="/notes/compressing-websites-into-urls/">
                <div class="card-grid-image-container">
                  <img srcset="/notes/placeholder_546.generated.png 546w" sizes=" 546px" class="card-grid-image" src="/notes/placeholder.png" alt="" spec="546" loading="lazy">
                </div>
                <div class="card-grid-title-wrap">
                  <div class="card-grid-title-bar">
                    <div class="card-grid-title-content">
                      <div class="card-grid-title">Compressing a website into a URL</div>
                      <div class="card-grid-posttitle">10 Oct 2023</div>
                    </div>
                  </div>
                </div>
                <div class="card-grid-content">
                  <div class="card-grid-posttitle card-grid-postitle-small">
                    10 Oct 2023
                  </div>
                  <div class="card-grid-actions">
                    <span class="card-grid-action card-grid-info">Deets…</span>
                    <span class="card-grid-action card-grid-story">Read post</span>
                  </div>
                  <div class="card-grid-description">

                    <span class="tag-component" style="background: #f0de91; color: #725f15">js</span>

                    <span class="card-grid-action card-grid-story" aria-label="Read post - Compressing a website into a URL">Read post</span>
                  </div>
                </div>
              </a><a class="card-grid-item card-grid-thumbalign-center card-grid-item-expanded" href="/notes/developing-bitwise-input-method/">
                <div class="card-grid-image-container">
                  <img srcset="/notes/placeholder_546.generated.png 546w" sizes=" 546px" class="card-grid-image" src="/notes/placeholder.png" alt="" spec="546" loading="lazy">
                </div>
                <div class="card-grid-title-wrap">
                  <div class="card-grid-title-bar">
                    <div class="card-grid-title-content">
                      <div class="card-grid-title">Bitwise keyboard input method</div>
                      <div class="card-grid-posttitle">16 Mar 2023</div>
                    </div>
                  </div>
                </div>
                <div class="card-grid-content">
                  <div class="card-grid-posttitle card-grid-postitle-small">
                    16 Mar 2023
                  </div>
                  <div class="card-grid-actions">
                    <span class="card-grid-action card-grid-info">Deets…</span>
                    <span class="card-grid-action card-grid-story">Read post</span>
                  </div>
                  <div class="card-grid-description">

                    <span class="tag-component" style="background: #e2bb9e; color: #603e25">c</span> <span class="tag-component" style="background: #d8aef3; color: #4d1f6a">keyboard</span>

                    <span class="card-grid-action card-grid-story" aria-label="Read post - Bitwise keyboard input method">Read post</span>
                  </div>
                </div>
              </a>

            </div>


          </aside>
        </div>
      </div>

    </div>
    <footer class="main-footer">
      <div class="main-footer-content-part">
        <p class="main-footer-line">
          <a target="_self" class="main-footer-link" href="/">Home</a> ·
          <a target="_self" class="main-footer-link" href="/notes/">Notes</a> ·
          <a target="_self" class="main-footer-link" href="/about/">About</a> ·
          <a target="_self" class="main-footer-link" href="/wares/">Software</a> ·
          <a target="_self" class="main-footer-link" href="/art/">Art</a> ·
          <a target="_self" class="main-footer-link" href="/music/">Music</a>
        </p>
        <p class="main-footer-line">
          <img class="main-footer-signature" alt="" src="/icons/laptop_user.png" loading="lazy">
          <span style="display: inline-block">
            ·
            <a target="_self" class="main-footer-link" href="/guestbook/">Sign the guestbook!</a>
            <br>
            · Drop a
            <a target="_blank" class="main-footer-link" href="mailto:mail%40leanrada.com">
              mail＠leanrada·com
            </a>
            <br>
          </span>
        </p>
        <p class="main-footer-line">
          (C) 2015-2024 Lean Rada.
          <a target="_blank" class="main-footer-link" href="https://github.com/Kalabasa/kalabasa.github.io">
            Source</a>.
        </p>
      </div>
      <div class="main-footer-content-part">
        <h2 class="main-footer-links-heading">On the web</h2>
        <a target="_blank" class="main-footer-web-link" href="https://www.linkedin.com/in/leanrada/">
          <img class="main-footer-web-link-icon" alt="LinkedIn" src="/icons/linkedin.png" loading="lazy">
        </a>
        <a target="_blank" class="main-footer-web-link" href="https://codepen.io/kalabasa">
          <img class="main-footer-web-link-icon" alt="CodePen" src="/icons/codepen.png" loading="lazy">
        </a>
        <a target="_blank" class="main-footer-web-link" href="https://github.com/Kalabasa" rel="me">
          <img class="main-footer-web-link-icon" alt="GitHub" src="/icons/github.png" loading="lazy">
        </a>
        <a target="_blank" class="main-footer-web-link" href="https://mastodon.social/@Kalabasa">
          <img class="main-footer-web-link-icon" alt="Mastodon" src="/icons/mastodon.png" loading="lazy">
        </a>
        <h2 class="main-footer-links-heading">Webrings</h2>
        <p class="main-footer-line">
          <img class="main-footer-webring-icon" alt="" src="/icons/planet.png" loading="lazy">
          <a target="_blank" class="main-footer-link" href="http://geekring.net/">geekring.net</a>
          [<a target="_blank" class="main-footer-link" href="http://geekring.net/site/288/previous" aria-label="Previous site">←</a>
          <a target="_blank" class="main-footer-link" href="http://geekring.net/site/288/random" aria-label="Random site">⁙</a>
          <a target="_blank" class="main-footer-link" href="http://geekring.net/site/288/next" aria-label="Next site">→</a>
          <a target="_blank" class="main-footer-link" href="http://geekring.net/site/288/frameset" aria-label="Frameset browsing">▣</a>]
        </p>
        <p class="main-footer-line">
          <img class="main-footer-webring-icon" alt="" src="/icons/planet.png" loading="lazy">
          <a target="_blank" class="main-footer-link" href="https://cs.sjoy.lol/">CSS JOY</a>
          [<a target="_blank" class="main-footer-link" href="https://webri.ng/webring/cssjoy/previous?via=https%3A%2F%2Fleanrada.com" aria-label="Previous site">←</a>
          <a target="_blank" class="main-footer-link" href="https://webri.ng/webring/cssjoy/random?via=https%3A%2F%2Fleanrada.com" aria-label="Random site">⁙</a>
          <a target="_blank" class="main-footer-link" href="https://webri.ng/webring/cssjoy/next?via=https%3A%2F%2Fleanrada.com" aria-label="Next site">→</a>]
        </p>
      </div>
      <nebula-client class="main-footer-nebula" palette="#0ad591 #ff2b75 #ffb833 #0ad591 #0ad591 #4d4aff #0ad591" width="40" height="10">
        <canvas style="filter: contrast(1.5)"></canvas>
        <div class="nebula-noise"></div>
      </nebula-client>
      <a class="main-footer-top-btn" href="#top" aria-label="Back to top">^</a>
    </footer>
  </div>






  <script type="module" async="" defer="" src="/scripts/reactions.js"></script>
  <script defer="" src="/scripts/blog-media.js"></script>
  <script defer="" src="/scripts/blog-header.js"></script>
  <script type="module" async="" defer="" src="/scripts/nebula.js"></script>
  <script defer="" src="/scripts/main-footer-main-header.js"></script>
  <script defer="">
  (() => {
    const items = document.querySelectorAll(".card-grid-item");
    for (const item of items) {
      const info = item.querySelector(".card-grid-info");
      info.addEventListener("click", (event) => {
        event.preventDefault();
        item.classList.add("card-grid-item-expanded");
      });
    }
  })();
</script>
  <script defer="" async="" src="/scripts/blog-rss-link.js"></script>
</body>
</html>