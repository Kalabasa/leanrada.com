<!DOCTYPE html>
<html lang="en">
<head>
  <title>Sort, sweep, and prune: Collision detection algorithms · leanrada.com</title>
  <script async="" src="/lib/vendor/perlin-noise-3d.min.js"></script>
  <link rel="preload" href="/fonts/space/SpaceMono-Italic.ttf" as="font" type="font/ttf" crossorigin="">
  <link rel="icon" type="image/png" href="/favicon.png">
  <link rel="webmention" href="https://webmention.io/leanrada.com/webmention">
  <link rel="alternate" type="application/rss+xml" title="leanrada.com notes" href="/rss.xml">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="color-scheme" content="only dark">
  <meta charset="utf-8">
  <script async="" src="https://leanrada.com/analytics/analytics.js"></script>
  <style>
  .reactions {
    display: grid;
    grid-template-rows: repeat(3, auto);
    grid-auto-flow: column;
    justify-content: center;
    justify-items: center;
    gap: 6px;
    border: solid 1px var(--card-clr);
    border-radius: 6px;
    padding: 18px;
    font-family: var(--default-font);
  }

  .reaction-title {
    grid-column: span 5;
    margin: 0 0 6px;
    font-size: 18px;
  }

  .reaction-title-error {
    color: var(--clr1);
  }

  .reaction-heart-btn,
  .reaction-heart-count {
    --reaction-color: #bf1852;
  }
  .reaction-fire-btn,
  .reaction-fire-count {
    --reaction-color: #c68306;
  }
  .reaction-bubble-btn,
  .reaction-bubble-count {
    --reaction-color: #07bd80;
  }
  .reaction-sun-btn,
  .reaction-sun-count {
    --reaction-color: #a09b00;
  }
  .reaction-cloud-btn,
  .reaction-cloud-count {
    --reaction-color: #8063ff;
  }

  .reaction-count {
    position: relative;
    font-size: 18px;
    width: 100%;
    height: 18px;
    text-align: center;
    overflow: hidden;
  }
  .reaction-count-prev,
  .reaction-count-next {
    position: relative;
    height: 100%;
    animation: reaction-tick 0.3s var(--ease) forwards;
  }

  @keyframes reaction-tick {
    from {
      top: 0;
    }
    to {
      top: -100%;
    }
  }

  .reaction-count.reaction-spark::after {
    position: absolute;
    content: "";
    width: 36px;
    height: 36px;
    left: calc(50% - 18px);
    top: calc(100% - 18px);
    border-radius: 50%;
    animation: reaction-spark 0.1s ease-out;
  }

  @keyframes reaction-spark {
    from {
      box-shadow: inset 0 0 0 18px var(--reaction-color);
    }
    to {
      box-shadow: inset 0 0 0 0px var(--reaction-color);
    }
  }

  .reaction-btn {
    background: none;
    border: none;
    border-radius: 6px;
    width: 32px;
    height: 32px;
    padding: 2px;
    box-sizing: content-box;
    cursor: pointer;
  }
  .reaction-btn:focus-visible,
  .reaction-btn:hover {
    background: var(--reaction-color);
  }
  .reaction-btn:focus-visible .reaction-icon,
  .reaction-btn:hover .reaction-icon {
    animation-duration: 0.5s;
  }
  .reaction-btn:active .reaction-icon {
    position: relative;
    top: 2px;
  }

  .reaction-icon {
    display: block;
    width: 100%;
    height: 100%;
    image-rendering: pixelated;
    background-image: url("/icons/reactions.png");
    background-size: 500% 200%;
    animation: reaction-icon 1.5s steps(2) infinite;
  }
  .reactions-invisible .reaction-icon {
    background-image: none;
  }
  .reaction-heart-btn .reaction-icon {
    --sheet-x: 25%;
  }
  .reaction-bubble-btn .reaction-icon {
    --sheet-x: 0%;
  }
  .reaction-sun-btn .reaction-icon {
    --sheet-x: 100%;
  }
  .reaction-cloud-btn .reaction-icon {
    --sheet-x: 75%;
  }
  .reaction-fire-btn .reaction-icon {
    --sheet-x: 50%;
  }

  @keyframes reaction-icon {
    0% {
      background-position: var(--sheet-x) 0%;
    }
    100% {
      background-position: var(--sheet-x) 200%;
    }
  }
</style>
  <style>
  .box-note {
    display: block;
    padding: 12px 18px;
    border-radius: 12px;
    border: solid 2px var(--clr0-dark);
    box-sizing: border-box;
  }
</style>
  <style>
  /**
   * Modified by Kalabasa.
   * Based on:
   * a11y-dark theme for JavaScript, CSS, and HTML
   * Based on the okaidia theme: https://github.com/PrismJS/prism/blob/gh-pages/hemes/prism-okaidia.css
   * @author ericwbailey
   */

  .code-block .token.inserted:not(.prefix) {
    background: #00b6a71c;
    display: block;
  }

  .code-block .token.comment,
  .code-block .token.prolog,
  .code-block .token.doctype,
  .code-block .token.cdata {
    color: #628b9e;
    font-style: italic;
  }

  .code-block .token.punctuation {
    color: #fefefe;
  }

  .code-block .token.property,
  .code-block .token.tag,
  .code-block .token.constant,
  .code-block .token.symbol,
  .code-block .token.deleted {
    color: #ffa07a;
  }

  .code-block .token.boolean,
  .code-block .token.number {
    color: #00e0e0;
  }

  .code-block .token.selector,
  .code-block .token.attr-name,
  .code-block .token.string,
  .code-block .token.char,
  .code-block .token.builtin,
  .code-block .token.inserted {
    color: #abe338;
  }

  .code-block .token.operator,
  .code-block .token.entity,
  .code-block .token.url,
  .code-block .token.variable {
    color: #00e0e0;
  }

  .code-block .token.atrule,
  .code-block .token.attr-value,
  .code-block .token.function {
    color: #ffd700;
  }

  .code-block .token.keyword {
    color: #00e0e0;
  }

  .code-block .token.regex,
  .code-block .token.important {
    color: #ffd700;
  }

  .code-block .token.important,
  .code-block .token.bold {
    font-weight: bold;
  }

  .code-block .token.italic {
    font-style: italic;
  }

  .code-block .token.entity {
    cursor: help;
  }

  @media screen and (-ms-high-contrast: active) {
    .code-block .token.important {
      background: highlight;
      color: window;
      font-weight: normal;
    }

    .code-block .token.atrule,
    .code-block .token.attr-value,
    .code-block .token.function,
    .code-block .token.keyword,
    .code-block .token.operator,
    .code-block .token.selector {
      font-weight: bold;
    }

    .code-block .token.attr-value,
    .code-block .token.comment,
    .code-block .token.doctype,
    .code-block .token.function,
    .code-block .token.keyword,
    .code-block .token.operator,
    .code-block .token.property,
    .code-block .token.string {
      color: highlight;
    }

    .code-block .token.attr-value,
    .code-block .token.url {
      font-weight: normal;
    }
  }
</style>
  <style>
  .code-block {
    margin: 0 -18px; /* bleed content padding */
    padding: 0 18px; /* bleed content padding */
    overflow-x: auto;
  }
  .code-block-code {
    display: inline-block;
    padding: 18px;
    min-width: 100%;
    box-sizing: border-box;
    border-radius: 18px;
    font-family: var(--default-font, monospace);
    font-size: 15px;
    line-height: 1.6;
    background: var(--card-clr);
    white-space: pre;
  }

  .code-block-wrap-char {
    word-break: break-all;
  }
  .code-block-wrap-char .code-block-code {
    white-space: pre-wrap;
  }

  .code-block-wrap-word {
    word-break: normal;
  }
  .code-block-wrap-word .code-block-code {
    white-space: pre-wrap;
  }
</style>
  <style>
  sap-demo-client {
    display: flex;
  }
  sap-demo-client > canvas {
    width: 100%;
    border: solid 2px #ccc;
    border-radius: 12px;
  }
  .sap-demo-draggable > canvas {
    touch-action: none;
  }
</style>
  <style>
  .blog-media {
    position: relative;
    text-align: center;
    /* external margin because it’s expected to be in an article */
    margin: 36px 0;
  }
  .blog-media-bleed {
    margin: 90px 0;
    max-height: 80vh;
  }

  .blog-media-element {
    display: inline-block;
    max-width: 100%;
    max-height: 80vh;
    border-radius: 18px;
    box-sizing: border-box;
  }
  .blog-media-bleed .blog-media-element {
    position: relative;
    left: 50%;
    max-width: max(min(100vw, 800px), 80vw);
    transform: translateX(-50%);
  }
  .blog-media-windowed .blog-media-element {
    width: 100%;
    border-radius: 0;
  }

  .blog-media-caption {
    display: block;
    font-size: 15px;
  }
</style>
  <style>
  .tag-row {
    font-family: var(--default-font);
    font-size: 12px;
    font-weight: bold;
  }
</style>
  <style>
  .blog-post-info {
    margin: 24px 0;
    font-family: var(--default-font);
    font-size: 12px;
    font-weight: bold;
    text-align: center;
    color: var(--text2-clr);
  }
  .blog-post-info-hidden {
    display: none;
  }
</style>
  <style>
  .text-with-bg-span {
    display: inline;
    margin: 0;
    padding: 0.7em;
    padding: 0.35lh;
    border-radius: 18px;
    box-decoration-break: clone;
    -webkit-box-decoration-break: clone;
    font: inherit;
    background: var(--text-with-bg-color);
  }
</style>
  <style>
  .blog-header {
    isolation: isolate;
    margin: 90px 0 24px;
    position: relative;
    left: 50%;
    height: 400px; /* .blog-header-title::before must match */
    width: max(800px, 60vw);
    transform: translateX(-50%);
    box-sizing: border-box;
  }

  .blog-header-title {
    position: relative;
    max-width: 800px;
    font-family: var(--display-font);
    font-size: 36px;
    font-weight: bold;
    font-style: italic;
    text-align: left;
    z-index: 2;
  }
  .blog-header-title-inner {
    border-top-left-radius: 0;
    border-bottom-left-radius: 0;
  }
  /* Wrap lines in an angle */
  .blog-header-title::before {
    content: "";
    width: 0;
    width: calc(min(50%, 120vw - 600px));
    height: 400px;
    float: right;
    shape-outside: polygon(100% 0%, 20% 30%, 0% 100%, 100% 100%, 100% 0%);
  }

  .blog-header-hero {
    position: absolute;
    inset: 1px;
    width: 100%;
    height: 100%;
    object-fit: cover;
    border-radius: 18px;
    background: gray;
    z-index: -1;
  }

  .blog-header-decor {
    position: absolute;
    inset: 0;
    pointer-events: none;
    fill: var(--bg-clr);
    z-index: 1;
  }

  @media (max-width: 800px) {
    .blog-header {
      width: 100vw;
      width: 100svw;
      height: 400px;
      padding-right: 36px;
    }
    .blog-header-title {
      font-size: clamp(24px, 20px + 2vw, 36px);
    }
  }
</style>
  <style>
  @font-face {
    font-family: "Space Mono";
    font-display: swap;
    font-weight: normal;
    font-style: normal;
    src: url("/fonts/space/SpaceMono-Regular.ttf") format("truetype");
  }

  @font-face {
    font-family: "Space Mono";
    font-display: swap;
    font-weight: normal;
    font-style: italic;
    src: url("/fonts/space/SpaceMono-Italic.ttf") format("truetype");
  }

  @font-face {
    font-family: "Iosevka";
    font-display: swap;
    font-weight: normal;
    font-style: normal;
    src: url("/fonts/iosevka/iosevka-custom-regular.woff2") format("woff2");
  }

  @font-face {
    font-family: "Iosevka";
    font-display: swap;
    font-weight: normal;
    font-style: italic;
    src: url("/fonts/iosevka/iosevka-custom-italic.woff2") format("woff2");
  }

  @font-face {
    font-family: "Miriam Libre";
    font-display: swap;
    font-weight: normal;
    font-style: normal;
    src: url("/fonts/miriam/MiriamLibre-Regular.ttf") format("truetype");
  }

  :root {
    --default-font: "Iosevka", "Space Mono", monaco, Consolas, "Lucida Console",
      monospace;
    --display-font: "Space Mono", "Iosevka", monaco, Consolas, "Lucida Console",
      monospace;
    --reading-font: "Miriam Libre", Futura, "Trebuchet MS", Arial, sans-serif;

    --bg-clr: #111616;
    --card-clr: #222c2c;
    --clr0-light: #54f8c1;
    --clr0: #0ad591;
    --clr0-dark: #05b97d;
    --clr1: #df2063;

    --text-clr: #fff;
    --text2-clr: #999;

    --ease: cubic-bezier(0.8, 0, 1, 1);
  }

  body {
    margin: 0;
    min-height: 100vh;
    font-family: var(--default-font, monospace);
    font-size: 15px;
    font-display: swap;
    font-variant-ligatures: none;
    background-color: var(--bg-clr, #111);
    color: var(--text-clr, #fff);
    overflow-x: hidden;
  }
  .page-wrapper {
    display: flex;
    flex-direction: column;
    min-height: 100vh;
  }
  .page-wrapper-content {
    flex: 1 1 auto;
  }
</style>
  <style>
  nebula-client {
    position: relative;
  }
  nebula-client > canvas {
    width: 100%;
    height: 100%;
  }
  .nebula-noise {
    position: absolute;
    inset: 0;
    background: url("/noise.png"); /* todo: encapsulate noise.png */
    opacity: 0.1;
    animation: nebula-noise-x 0.16s steps(2, jump-start) infinite,
      nebula-noise-y 0.48s steps(3, jump-start) infinite;
  }
  @supports (mix-blend-mode: overlay) {
    .nebula-noise {
      mix-blend-mode: overlay;
      opacity: 0.2;
    }
  }
  @keyframes nebula-noise-x {
    to {
      background-position-x: 100px;
    }
  }
  @keyframes nebula-noise-y {
    to {
      background-position-y: 100px;
    }
  }
</style>
  <style>
  .main-footer-web-link {
    text-decoration: none;
  }

  .main-footer-web-link-icon {
    width: 32px;
    height: 32px;
    image-rendering: pixelated;
  }
  .main-footer-web-link-icon:hover {
    filter: invert(1);
  }
</style>
  <style>
  .main-footer {
    position: relative;
    display: flex;
    justify-content: space-between;
    gap: 60px;
    padding: 42px calc(max(36px, 50vw - 600px));
    font-family: var(--display-font);
    font-size: 15px;
    font-weight: bold;
    background: var(--clr0);
    color: #000;
    overflow: hidden;
    content-visibility: auto;
    contain-intrinsic-height: 200px;
  }

  .main-footer-links-heading {
    margin: 18px 0;
    font-size: inherit;
  }

  .main-footer-line {
    margin: 12px 0;
  }

  .main-footer-link {
    color: #000;
  }
  .main-footer-link:hover {
    color: #000;
  }

  .main-footer-webring-icon {
    width: 16px;
    height: 16px;
    image-rendering: pixelated;
  }

  .main-footer-signature {
    width: 64px;
    height: 64px;
    image-rendering: pixelated;
    vertical-align: top;
  }

  .main-footer-content-part {
    z-index: 1;
  }

  .main-footer-nebula {
    position: absolute;
    left: -30%;
    top: -30%;
    width: 160%;
    height: 160%;
    z-index: 0;
  }

  .main-footer-top-btn {
    display: block;
    z-index: 2;
    position: absolute;
    right: 0;
    top: 0;
    width: 72px;
    height: 36px;
    padding-right: 9px;
    box-sizing: border-box;
    display: flex;
    justify-content: center;
    align-items: center;
    border: none;
    border-bottom-left-radius: 18px;
    background: var(--bg-clr);
    text-decoration: none;
    color: var(--clr0-light);
    font: inherit;
    font-size: 18px;
    font-weight: bold;
    cursor: pointer;
  }
  .main-footer-top-btn:hover {
    color: var(--clr1);
  }
  .main-footer-top-btn::before {
    content: "";
    position: absolute;
    right: 0;
    top: 0;
    width: 36px;
    height: 18px;
    border-top-right-radius: 18px;
    transform: translateX(-72px);
    box-shadow: 18px 0 0 var(--bg-clr);
  }

  @media (max-width: 700px) {
    .main-footer {
      flex-direction: column-reverse;
    }
  }
</style>
  <style>
  .main-header {
    position: sticky;
    top: 0;
    width: 100%;
    height: 60px;
    padding: 0 calc(25% - 150px);
    z-index: 100;
    box-sizing: border-box;
    pointer-events: none;
  }
  .main-header.float {
    position: fixed;
  }

  .main-header-bar {
    position: relative;
    display: flex;
    justify-content: space-evenly;
    align-items: flex-end;
    height: 100%;
  }

  .main-header-item {
    display: inline-flex;
    justify-content: center;
    align-items: center;
    width: 6ch;
    height: 36px;
    padding: 0 18px;
    padding: 0 calc(min(18px,  -18px + 8vw));
    border-radius: 18px;
    font-family: var(--display-font);
    font-size: 13px;
    font-weight: bold;
    letter-spacing: 1px;
    text-decoration: none;
    text-transform: uppercase;
    color: #fff;
    backdrop-filter: blur(8px);
    background-color: #2222;
    background-image: linear-gradient(60deg, #9994 60%, transparent 60%);
    background-repeat: no-repeat;
    background-size: 220% 100%;
    background-position: 115%;
    pointer-events: all;
    transition: background-color 0.2s var(--ease),
      background-position 0.2s var(--ease);
  }
  .main-header-item:hover {
    background-image: linear-gradient(
      60deg,
      #9994 50%,
      #fff 50%,
      #fff 60%,
      transparent 60%
    );
    background-position: 0%;
  }
  .main-header-item.select {
    background: #9994;
  }

  .main-header-icon {
    width: 48px;
    height: 48px;
    border-radius: 25%;
    image-rendering: pixelated;
    object-fit: cover;
    filter: invert(1);
    backdrop-filter: blur(8px) invert(1);
    pointer-events: all;
  }
  @media (max-width: 450px) {
    .main-header-icon {
      display: none;
    }
  }
  .main-header-icon-yay {
    border-radius: 50%;
    object-position: 0 0;
  }
  .main-header-icon-yay:hover {
    object-position: 100% 0;
  }

  .main-header-indicator {
    position: absolute;
    width: 6px;
    height: 6px;
    left: 50%;
    top: calc(100% + 12px);
    transform: translate(-50%, -50%);
    /* border acts as extended touch area */
    border: solid 6mm transparent;
    border-left-width: 45vw;
    border-right-width: 45vw;
    border-radius: 50%;
    background: #fff;
    background-clip: padding-box;
    opacity: 0;
    transition: opacity 50ms;
  }
  .main-header.hidden .main-header-indicator {
    opacity: 0.6;
    pointer-events: all;
  }
</style>
  <style>
  .blog-page {
    margin: auto;
    overflow: hidden;
  }

  .content {
    margin: auto;
    padding: 0 18px 60px;
    width: 100%;
    max-width: 700px;
    font-family: var(--reading-font, sans-serif);
    font-size: 16px;
    line-height: 2.2;
    letter-spacing: 0.02em;
    color: #ddd;
    box-sizing: border-box;
  }

  .postcontent {
    margin: auto;
    padding: 0 0 60px;
    width: 100%;
    box-sizing: border-box;
  }
  .postcontent-narrow {
    margin: auto;
    padding: 0 18px;
    width: 100%;
    max-width: 700px;
    box-sizing: border-box;
  }

  .blog-signature {
    position: relative;
    margin: 60px 0 0;
    line-height: 21px;
  }
  .blog-signature::before {
    content: "❝";
    position: absolute;
    left: -15px;
    top: 0;
    font-size: 60px;
    opacity: 0.2;
  }
  .blog-signature a {
    font-weight: bold;
  }
  .blog-signature-name {
    white-space: nowrap;
  }
  .blog-signature-img {
    position: relative;
    top: 3px;
  }

  .markdown > h1,
  .markdown > h2,
  .markdown > h3,
  .markdown > h4,
  .markdown > h5,
  .markdown > h6 {
    margin: 48px 0 36px;
    font-family: var(--display-font);
    font-weight: normal;
    font-style: italic;
    line-height: 1.6;
    letter-spacing: 0.04em;
    text-wrap: balance;
  }
  .markdown > h1 {
    text-align: center;
    font-size: 200%;
  }
  .markdown > h2 {
    font-size: 150%;
  }
  .markdown > h3,
  .markdown > h4,
  .markdown > h5,
  .markdown > h6 {
    font-size: 120%;
    font-weight: bold;
  }

  .markdown > p {
    margin: 36px 0;
  }
  .markdown .box-note > p {
    margin: 18px 0;
  }
  .markdown .box-note > p:first-child {
    margin-top: 0;
  }
  .markdown .box-note > p:last-child {
    margin-bottom: 0;
  }

  .markdown-table {
    margin: 0 -18px; /* bleed content padding */
    padding: 0 18px; /* bleed content padding */
    overflow-x: auto;
  }
  .markdown-table > table {
    min-width: 100%;
    box-sizing: border-box;
    border-collapse: collapse;
    background-color: var(--card-clr);
    border-radius: 12px;
  }
  .markdown-table > table th,
  .markdown-table > table td {
    min-width: min(25vw, 8ch);
    box-sizing: border-box;
    text-align: start;
    padding: 9px 6px;
    padding-inline-end: 18px;
    border-bottom: solid 1px #444;
  }
  .markdown-table > table th:first-child,
  .markdown-table > table td:first-child {
    padding-left: 12px;
  }
  .markdown-table > table th:last-child,
  .markdown-table > table td:last-child {
    padding-right: 12px;
  }
  .markdown-table > table > tbody > tr:last-child > td {
    border-bottom: none;
  }

  .markdown > hr {
    width: 36px;
    margin: 90px auto;
    border: solid 1.5px #ccc;
    background: #ccc;
    border-radius: 3px;
  }

  .markdown code:not([class]):not([class]) {
    display: inline-block;
    padding: 0 6px;
    border-radius: 6px;
    font-family: var(--default-font, monospace);
    font-size: 15px;
    background: var(--card-clr);
  }
  .markdown > pre:not([class]) > code:not([class]) {
    display: block;
    padding: 18px;
    border-radius: 18px;
    line-height: 1.6;
    font-size: 15px;
    overflow-x: auto;
  }

  .markdown > blockquote {
    position: relative;
    margin: 0;
    padding: 18px 24px;
    border-radius: 18px;
    border: solid 1px var(--clr0);
    font-size: 21px;
  }
  .markdown > blockquote::before {
    content: "";
    position: absolute;
    right: 100%;
    top: 0;
    height: 24px;
    width: 24px;
    border-bottom: solid 1px var(--clr0);
    box-sizing: border-box;
  }
  .markdown > blockquote::after {
    content: "";
    position: absolute;
    right: 100%;
    top: 24px;
    bottom: 18px;
    width: 24px;
    border-top-right-radius: 24px;
    border: solid var(--clr0);
    border-width: 1px 1px 0 0;
    box-shadow: 9px 0 0 var(--bg-clr), 18px 0 0 var(--bg-clr);
    box-sizing: border-box;
  }
  .markdown > blockquote > :first-child {
    margin-top: 0;
  }
  .markdown > blockquote > :last-child {
    margin-bottom: 0;
  }
  .markdown > blockquote cite {
    display: block;
    margin-top: 12px;
    font-size: 15px;
    font-style: inherit;
  }
  .markdown > blockquote cite::before {
    content: "—";
  }

  .markdown > iframe,
  .markdown > p > iframe {
    max-width: calc(100vw - 18px);
    border: none;
    border-radius: 18px;
    background: #fff;
  }

  .markdown .center {
    text-align: center;
  }
  .markdown .center-flex {
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
  }

  /* todo? convert to component <blog-bleed>, reuse across <blog-media> */
  .markdown .bleed {
    position: relative;
    left: 50%;
    width: 100vh;
    max-width: max(min(100vw, 800px), 80vw);
    transform: translateX(-50%);
  }

  /* todo: convert to component <caption>, reuse across <blog-media> */
  .markdown .caption {
    display: block;
    font-size: 15px;
    text-align: center;
  }
</style>
  <style>
  .btn,
  .btn:visited {
    padding: 6px 12px;
    border-radius: 12px;
    border: none;
    font-family: var(--display-font);
    font-size: 12px;
    font-weight: bold;
    text-decoration: none;
    background: var(--clr0-dark);
    color: #fff;
    cursor: pointer;
  }
  .btn:not(:disabled):hover {
    background: var(--clr0);
  }
  .btn:not(:disabled):active {
    background: var(--clr0-dark);
  }
  .btn:disabled {
    color: #888;
    cursor: not-allowed;
  }
</style>
  <style>
  .blog-rss-link {
    margin: 60px auto 0;
    width: 100%;
    text-align: center;
  }

  .blog-rss-link-combo {
    display: flex;
    justify-content: center;
  }
  .blog-rss-link-a {
    padding: 0 12px;
    border: solid 1px var(--clr0);
    border-top-left-radius: 12px;
    border-bottom-left-radius: 12px;
    box-sizing: border-box;
    height: 30px;
    line-height: 30px;
    font-size: 12px;
    color: var(--text2-clr);
  }
  .blog-rss-link-button {
    height: 30px;
    border-top-left-radius: 0;
    border-bottom-left-radius: 0;
  }
</style>
  <style>
  .card-grid {
    display: grid;
    justify-content: center;
    grid-template-columns: repeat(auto-fit, calc(min(546px, 100%)));
    gap: 60px;
  }
  .card-grid-tall {
    gap: 90px 60px;
  }
  @media (max-width: 900px) {
    .card-grid {
      gap: 30px;
    }
  }
  @media (prefers-reduced-motion) {
    .card-grid * {
      animation: none !important;
    }
  }
</style>
  <style>
  .blog-suggestions {
    margin: 120px auto 0;
    padding: 0 18px;
    width: 100%;
    max-width: 1800px;
    box-sizing: border-box;
  }

  .blog-suggestions-title {
    margin: 0 0 30px;
    text-align: center;
  }
</style>
  <style>
  .card-grid-item {
    display: block;
    text-decoration: none;
    text-align: start;
    color: var(--text-clr);
    overflow: hidden;
    transition: 0.2s var(--ease);
    transition-property: margin, padding;
  }
  .card-grid-animated .card-grid-item {
    animation: card-grid-item-reveal 0.8s var(--ease) backwards;
    animation-delay: var(--card-grid-item-delay);
  }
  @keyframes card-grid-item-reveal {
    0% {
      clip-path: inset(20% 100% 60% 0 round 18px);
      filter: brightness(0);
    }
    50% {
      clip-path: inset(20% 0 60% 0 round 18px);
      filter: brightness(1);
    }
    100% {
      clip-path: inset(0 0 0 0 round 18px);
    }
  }

  .card-grid-image-container {
    position: relative;
    width: 100%;
    height: 340px;
    border-radius: 18px;
    overflow: hidden;
    z-index: 0;
  }
  .card-grid-image-container::after {
    content: "";
    position: absolute;
    left: 0;
    right: 0;
    top: 0;
    bottom: 0;
    background: var(--clr0);
    mix-blend-mode: darken;
    transition: background 1s;
  }

  .card-grid-image {
    width: 101%;
    height: 101%;
    object-fit: cover;
    object-position: top;
    filter: contrast(0.8);
    transform: scale(1);
    transform-origin: 9px 9px;
    transition: filter 1s, transform 1s;
  }
  .card-grid-thumbalign-center .card-grid-image {
    object-position: center;
    transform-origin: center;
  }

  .card-grid-title-wrap {
    position: relative;
    max-width: 80%;
    height: 0;
  }
  .card-grid-title-bar {
    position: absolute;
    bottom: 0;
    border-top-right-radius: 18px;
    background: var(--bg-clr);
  }
  .card-grid-title-content {
    position: relative;
    padding: 12px 24px 0 0;
    transition: padding 0.2s var(--ease);
  }
  .card-grid-title-content::before {
    content: "";
    position: absolute;
    left: 0;
    bottom: 100%;
    width: 18px;
    height: 36px;
    border-bottom-left-radius: 18px;
    box-shadow: 0 18px 0 var(--bg-clr);
  }
  .card-grid-title-content::after {
    content: "";
    position: absolute;
    left: 100%;
    bottom: 0;
    width: 36px;
    height: 18px;
    border-bottom-left-radius: 18px;
    box-shadow: -18px 0 0 var(--bg-clr);
  }

  .card-grid-title {
    font-family: var(--display-font);
    font-size: 18px;
    font-style: italic;
    font-weight: bold;
  }

  .card-grid-posttitle {
    margin-top: 12px;
    font-size: 15px;
    font-style: italic;
    font-weight: bold;
    opacity: 0.8;
  }

  .card-grid-postitle-small {
    display: none;
  }

  .card-grid-actions {
    display: none;
    gap: 5mm;
    max-height: 48px;
    padding-top: 12px;
    overflow: hidden;
  }
  .card-grid-action {
    display: inline-block;
    font-weight: bold;
    text-decoration: underline;
    color: var(--text2-clr);
    cursor: pointer;
    position: relative;
  }
  .card-grid-info {
    margin: -2.5mm;
    padding: 2.5mm;
  }
  .card-grid-story::after {
    content: "→";
    display: inline-block;
  }

  .card-grid-content {
    margin: 30px 0;
    font-size: 15px;
    line-height: 2;
    transition: margin 0.2s var(--ease);
  }

  .card-grid-animated .card-grid-title {
    animation: card-grid-text-reveal 0.4s cubic-bezier(0, 0.8, 0.6, 1) backwards;
    animation-delay: calc(var(--card-grid-item-delay) + 0.8s);
  }
  .card-grid-animated .card-grid-posttitle {
    animation: card-grid-text-reveal 0.4s cubic-bezier(0, 0.8, 0.6, 1) backwards;
    animation-delay: calc(var(--card-grid-item-delay) + 0.9s);
  }

  @keyframes card-grid-text-reveal {
    from {
      transform: translateY(-100%);
      clip-path: inset(100% 0 0 0);
    }
    to {
      clip-path: inset(0 0 0 0);
    }
  }

  .card-grid-animated .card-grid-content {
    animation: card-grid-content 0.6s 1.5s backwards;
  }
  @keyframes card-grid-content {
    from {
      opacity: 0;
    }
  }

  @media (hover: hover) {
    .card-grid-item:hover {
      margin: -12px -24px 0;
      padding-bottom: 12px;
    }
    .card-grid-item:hover .card-grid-image-container::after {
      background: var(--text-clr);
      transition: background 2s;
    }
    .card-grid-item:hover .card-grid-image {
      filter: contrast(1);
      transform: scale(1.1);
      transition: filter 1s, transform 2s;
    }
    .card-grid-item:hover .card-grid-title-content {
      padding: 24px;
    }
    .card-grid-item:hover .card-grid-content {
      margin-left: 24px;
      margin-right: 24px;
    }
  }

  @media (max-width: 600px) {
    .card-grid-content {
      margin: 12px 0;
    }

    .card-grid-image-container {
      height: 200px;
    }

    .card-grid-posttitle {
      display: none;
    }
    .card-grid-postitle-small {
      display: block;
    }

    .card-grid-actions {
      display: flex;
    }
    .card-grid-item-expanded .card-grid-actions {
      max-height: 0;
      transition: max-height 0.2s cubic-bezier(0.2, 0, 0.8, 1);
    }

    .card-grid-description {
      max-height: 0;
      overflow: hidden;
    }
    .card-grid-item-expanded .card-grid-description {
      max-height: 100vh;
      transition: max-height 1s cubic-bezier(0.2, 0, 1, 1);
    }
  }
</style>
  <style>
  .tag-component {
    display: inline-block;
    padding: 0 3px;
    height: 16px;
    line-height: 16px;
    font-family: var(--default-font);
    font-size: 12px;
    font-weight: bold;
    background: #ccc;
    color: #444;
    border-radius: 3px;
  }
</style>
  <style>
  .text-link {
    color: var(--clr0-light, #fff);
  }
  .text-link:visited {
    color: var(--clr0, #fff);
  }
</style>
  <style>
  .demo-row {
    margin: 18px 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 6px;
  }
  .demo-caption {
    max-width: 600px;
  }

  .drag-hint {
    padding: 0 0.3rem;
    font-weight: bold;
    border: dashed 2px #fff7;
    border-radius: 2rem;
  }

  .abc-demo-intersects-ac-run,
  .abc-demo-intersects-ac-skip {
    animation: highlight-change 2s 0.5s both;
  }

  @keyframes highlight-change {
    from {
      background: #55440088;
    }
  }

  .pair-legend {
    display: inline-block;
    position: relative;
    top: -4px;
    margin: 0 4px;
    width: 22px;
    height: 2px;
    background: currentColor;
  }
  .pair-legend::before,
  .pair-legend::after {
    content: "";
    position: absolute;
    top: -4px;
    display: block;
    width: 10px;
    height: 10px;
    border-radius: 50%;
    background: currentColor;
  }
  .pair-legend::before {
    left: -2px;
  }
  .pair-legend::after {
    right: -2px;
  }
</style>
  <style>
        .eq-op {
          color: var(--clr0-light);
        }
        .eq-i {
          color: #e79907;
        }
        .eq-c {
          color: var(--clr1); 
        }
      </style>
  <script async="" src="/scripts/cursor.js"></script>
</head>


<body>

  <div class="page-wrapper">
    <header class="main-header">
      <div class="main-header-bar">
        <a href="/" class="main-header-item ">Home</a> <a href="/wares/" class="main-header-item ">Wares</a>
        <img class="main-header-icon main-header-icon-yay" src="/icons/yay_sheet.png" alt="">
        <a href="/art/" class="main-header-item ">Art</a> <a href="/notes/" class="main-header-item select">Notes</a>
        <div class="main-header-indicator"></div>
      </div>
    </header>
    <div class="page-wrapper-content">

      <div class="blog-page">

        <div class="content">

          <!-- prettier-ignore -->
          <div class="markdown">
            <p>
            <div class="blog-header">
              <div class="text-with-bg blog-header-title" style="--text-with-bg-color: var(--bg-clr)">
                <h1 class="text-with-bg-span blog-header-title-inner">
                  Sort, sweep, and prune: Collision detection algorithms
                </h1>
              </div>
              <img srcset="/notes/sweep-and-prune/hero_800.generated.jpg 800w,/notes/sweep-and-prune/hero_1200.generated.jpg 1200w" sizes="not (min-width:800px) 800px, 1200px" class="blog-header-hero" src="/notes/sweep-and-prune/hero.jpg" alt="" spec="100% [800) 80%">
              <svg xmlns="http://www.w3.org/2000/svg" class="blog-header-decor">
                <path></path>
              </svg>
            </div>
            </p>
            <p>
            <div class="blog-post-info ">
              5 Aug 2023 · 13 min read
            </div>
            </p>
            <div class="tag-row">tags:
              <span class="tag-component" title="algorithm" style="background: #6bfbfa; color: #097d7c">algo</span>
              <span class="tag-component" style="background: #b7eaa6; color: #336920">games</span>
            </div>

            <p>Sweep-and-prune is my go-to algorithm when I want to quickly implement collision detection for a game. I think it’s an awesome and elegant algorithm, so I wrote a post about it.</p>
            <p>This post is lengthy with many examples and explanations, thus split into two parts. You can jump to specific bits using this special springboard:</p>
            <ul>
              <li><strong>Part 1:</strong> <a target="_self" class="text-link " href="/notes/sweep-and-prune/">Simplified version</a>
                <ul>
                  <li>🔍 <a target="_self" class="text-link " href="/notes/sweep-and-prune/#comparisons">Visual comparison</a></li>
                  <li>📝 <a target="_self" class="text-link " href="/notes/sweep-and-prune/#code1">Code</a></li>
                </ul>
              </li>
              <li><strong>Part 2:</strong> <a target="_self" class="text-link " href="/notes/sweep-and-prune-2/">Sophisticated versions</a>
                <ul>
                  <li>🔍 <a target="_self" class="text-link " href="/notes/sweep-and-prune-2/#comparisons">Visual comparison</a></li>
                  <li>📝 <a target="_self" class="text-link " href="/notes/sweep-and-prune-2/#final-code">Final code</a></li>
                </ul>
              </li>
            </ul>
            <p>As for the rest of the post, I try to paint a picture of what I think are first principles and show it with <strong>interactive demos</strong>! Let’s go!</p>
            <hr>
            <h2 id="collision-detection">Collision detection</h2>
            <p>As you may know, the problem of collision detection is pretty common in video game programming. It’s a prerequisite to the implementation of certain game mechanics or simulations.</p>
            <p>
            <div class="blog-media blog-media-default">
              <img class="blog-media-element" alt="video of mario with goombas bumping into each other" src="/notes/sweep-and-prune/mario.gif" loading="lazy" width="100%" height="" style="aspect-ratio: 1.3333333333333333; background: #6888f8"><span class="blog-media-caption">Goombas colliding</span>
            </div>
            </p>
            <p>Some of these mechanics include: preventing characters from passing through each other, <a target="_blank" class="text-link " href="https://youtu.be/Ky69PjyHCqg">goombas</a> turning around when bumping into another, big cells eating smaller cells in <a target="_blank" class="text-link " href="https://agar.io/">agar.io</a>, or just about any game physics. All of these need some kind of collision detection.</p>
            <p>
            <div class="blog-media blog-media-default">
              <img class="blog-media-element" alt="video of agar.io with cells eating smaller cells" src="/notes/sweep-and-prune/agario.gif" loading="lazy" width="100%" height="" style="aspect-ratio: 1.3333333333333333; background: #f8f8f8"><span class="blog-media-caption">Cells consuming smaller cells on contact</span>
            </div>
            </p>
            <p>Here I’ll cover several related approaches, starting with the simplest and building up to the <a target="_blank" class="text-link " href="https://en.wikipedia.org/wiki/Sweep_and_prune"><strong>sweep-and-prune</strong></a> algorithm. I won’t cover other approaches, such as space partitioning or spatial tree subdivision.</p>
            <p>Balls.</p>
            <p>I’ll use this <strong>rigid-body ball simulation</strong> as a recurring example to demonstrate the algorithms throughout the post:</p>
            <div class="demo-row">
              <sap-demo-client class="" data-rss="interactive" alt="demo of the collision detection algorithm using 'sap-nativesort' strategy" strategy="sap-nativesort"></sap-demo-client>
            </div>

            <p>Alright, let’s dive in! How do we detect these collisions?</p>
            <h2 id="naive-approach-🐥">Naive approach 🐥</h2>
            <p>The straightforward solution is to test every potential pair of objects for collision. That is, <em>check every ball against every other ball</em>.</p>
            <pre class="code-block "><code class="code-block-code"><span class="token comment">// for each ball</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> balls<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> ball1 <span class="token operator">=</span> balls<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token comment">// check each of the other balls</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> j <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> balls<span class="token punctuation">.</span>length<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> ball2 <span class="token operator">=</span> balls<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">// check for collision</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">intersects</span><span class="token punctuation">(</span>ball1<span class="token punctuation">,</span> ball2<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">bounce</span><span class="token punctuation">(</span>ball1<span class="token punctuation">,</span> ball2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
            <p>Note in the above code that the inner loop starts at <code>i + 1</code> to prevent duplicate pairs from being counted (A-B vs B-A). Other than that, it’s a pretty simple solution.</p>
            <p>These checks are done on every time step, ensuring that balls will bounce exactly when they collide.</p>
            <p>Here’s a slowed-down, highlighted simulation, showing pairs being tested for intersection per time step:</p>
            <div class="demo-row">
              <sap-demo-client class="" data-rss="interactive" alt="demo of the collision detection algorithm using 'pairwise' strategy" strategy="pairwise" skip-interval="4" decorations="checks:#4c8"></sap-demo-client>
              <div class="demo-caption">
                Pairs are highlighted <span aria-label="a connecting green line" style="color:#4c8" class="pair-legend"></span> when being tested via <code>intersects()</code>.
              </div>
            </div>

            <p>And it works. But if we had more than just a handful of balls we would start seeing performance issues.</p>
            <h2 id="performance-or-lack-thereof">Performance, or lack thereof</h2>
            <p>This naive algorithm runs in <em><strong>O(n<sup>2</sup>)</strong></em> time in <a target="_blank" class="text-link " href="https://en.wikipedia.org/wiki/Big_O_notation">Big O terms</a>. That is, for an input of <em>n</em> balls, the algorithm’s running time grows proportionally to the <em>square</em> of the input <em>n</em>. That’s a lot! 📈</p>
            <p>This is because for <em>n</em> balls, there are around <em>(n&nbsp;*&nbsp;(n-1))/2</em> pairs to test, or <em>0.5n<sup>2</sup>&nbsp;-&nbsp;0.5n</em>. For example, if n = 5 there would be a total of 10 pairs. For n = 10, there would be 45 pairs. For n = 15, 105 pairs (!). And so on… Using Big O notation, we can simplify this information into a compact expression <em>“O(n<sup>2</sup>)”</em></p>
            <p>To (painfully) demonstrate how the performance scales badly for bigger inputs, here’s a simulation with n&nbsp;=&nbsp;20:</p>
            <div class="demo-row">
              <sap-demo-client class="" data-rss="interactive" alt="demo of the collision detection algorithm using 'pairwise' strategy" balls="20" strategy="pairwise" skip-interval="4" decorations="checks:#4c8"></sap-demo-client>
              <div class="demo-caption">
                20 balls = 190 pairs to test
              </div>
            </div>

            <p>That’s a lot of tests per frame! Clearly, the naive solution does not scale well for large numbers of objects.</p>
            <p>How can we improve this solution?</p>
            <span class="box-note ">
              <p>The worst case running time for <em>any</em> collision detection algorithm is always <em>O(n<sup>2</sup>)</em>. That’s when all objects intersect simultaneously and you have no choice but to process each of the n<sup>2</sup> collisions.</p>
              <p>Thus, it’s more practical to compare the average and best cases.</p>
              <p>Having said that, the naive algorithm is still <em>Θ(n<sup>2</sup>)</em> for <em>any</em> case, no matter the number of actual collisions. A lot of room for improvement!</p>
            </span>

            <h2 id="prologue-improving-the-solution">Prologue: Improving the solution</h2>
            <p>Usually when optimising algorithms, you wanna find <strong>redundant or unnecessary work</strong>. Then find a way to consolidate that redundancy. (That sounded corporate-ish.)</p>
            <p>A good place to start would be the <code>intersects()</code> function since it is called for every candidate pair. If we take the <a target="_blank" class="text-link " href="https://gdbooks.gitbooks.io/3dcollisions/content/Chapter2/static_aabb_aabb.html">typical object intersection test</a> to be its implementation, we get a bunch of these <strong>inequality checks</strong>:</p>
            <pre class="code-block "><code class="code-block-code"><span class="token keyword">function</span> <span class="token function">intersects</span><span class="token punctuation">(</span><span class="token parameter">object1<span class="token punctuation">,</span> object2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// compare objects' bounds to see if they overlap</span>
  <span class="token keyword">return</span> object1<span class="token punctuation">.</span>left <span class="token operator">&lt;</span> object2<span class="token punctuation">.</span>right
      <span class="token operator">&amp;&amp;</span> object1<span class="token punctuation">.</span>right <span class="token operator">&gt;</span> object2<span class="token punctuation">.</span>left
      <span class="token operator">&amp;&amp;</span> object1<span class="token punctuation">.</span>top <span class="token operator">&lt;</span> object2<span class="token punctuation">.</span>bottom
      <span class="token operator">&amp;&amp;</span> object1<span class="token punctuation">.</span>bottom <span class="token operator">&gt;</span> object2<span class="token punctuation">.</span>top<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
            <p>In the above code, the <code>intersects()</code> function checks if two objects intersect by comparing their opposing bounds for each direction. (Refer to <a target="_blank" class="text-link " href="https://developer.mozilla.org/en-US/docs/Games/Techniques/3D_collision_detection#aabb_vs._aabb">this MDN article</a> for a better explanation.)</p>
            <p>We can break the test down to its constituent checks:</p>
            <ol>
              <li><code>object1.left &lt; object2.right</code></li>
              <li><code>object1.right &gt; object2.left</code></li>
              <li><code>object1.top &lt; object2.bottom</code></li>
              <li><code>object1.bottom &gt; object2.top</code></li>
            </ol>
            <p>Each check is solely concerned with one particular axis in a specific direction.</p>
            <p>Here’s the key thing: Due to the <code>&amp;&amp;</code> operator’s <a target="_blank" class="text-link " href="https://en.wikipedia.org/wiki/Short-circuit_evaluation">short-circuit evaluation</a>, if any one of these checks turns out to be false, then the overall test will immediately evaluate to false.</p>
            <p>Our goal then is to generalise the case where at least <em>one</em> of these checks is false across many tests as possible.</p>
            <p><span class="box-note ">It’s the same idea as the <a target="_blank" class="text-link " href="https://personal.math.vt.edu/mrlugo/sat.html">separating axis theorem</a>, which implies that two objects can’t be colliding if there’s at least one axis where their shadows don’t overlap.</span></p>
            <p>Let’s say we focus only on the second check - <code>object1.right &gt; object2.left</code>. Don’t worry about the rest of the checks. As hinted above, optimising in just one axis can still make a big difference later, so we’ll focus on this single check for now.</p>
            <p>
            <div class="blog-media blog-media-default">
              <img srcset="/notes/sweep-and-prune/surprise-tool_200.generated.jpg 200w" sizes=" 200px" class="blog-media-element" alt="Still of a cartoon mouse saying, 'that’s a surprise tool that can help us later'" src="/notes/sweep-and-prune/surprise-tool.jpg" spec="200" loading="lazy" width="100%" height="" style="aspect-ratio: 1.2127659574468086; background: #080808">
            </div>
            </p>
            <p>Let’s look at it in the context of multiple objects. Consider three objects - A, B, and C - in this horizontal configuration:</p>
            <p>
            <div class="blog-media blog-media-default">
              <img srcset="/notes/sweep-and-prune/abc_527.generated.png 527w,/notes/sweep-and-prune/abc_664.generated.png 664w" sizes="not (min-width:664px) 527px, 664px" class="blog-media-element" alt="Three objects, from left to right: A, B, and C" src="/notes/sweep-and-prune/abc.png" spec="100% [664) 664" loading="lazy" width="100%" height="" style="aspect-ratio: 2.034749034749035; background: #f8f8f8">
            </div>
            </p>
            <p>There are three potential pairs to be checked here: A-B, B-C, and A-C. Remember, we’re trying to find redundant work. Pretend we’re running all the pairs through the check, like so:</p>
            <pre class="code-block "><code class="code-block-code"><span class="token constant">A</span><span class="token punctuation">.</span>right <span class="token operator">&gt;</span> <span class="token constant">B</span><span class="token punctuation">.</span>left <span class="token comment">// returns false</span>
<span class="token constant">B</span><span class="token punctuation">.</span>right <span class="token operator">&gt;</span> <span class="token constant">C</span><span class="token punctuation">.</span>left <span class="token comment">// returns false</span>
<span class="token constant">A</span><span class="token punctuation">.</span>right <span class="token operator">&gt;</span> <span class="token constant">C</span><span class="token punctuation">.</span>left <span class="token comment">// returns false</span></code></pre>
            <p>See any redundant work? Maybe abstractify it a little…</p>
            <pre class="code-block "><code class="code-block-code"><span class="token constant">A</span> <span class="token operator">&gt;</span> <span class="token constant">B</span> <span class="token comment">// returns false</span>
<span class="token constant">B</span> <span class="token operator">&gt;</span> <span class="token constant">C</span> <span class="token comment">// returns false</span>
<span class="token constant">A</span> <span class="token operator">&gt;</span> <span class="token constant">C</span> <span class="token comment">// returns false</span></code></pre>
            <p>Voilà. Due to the <a target="_blank" class="text-link " href="https://www.mathwords.com/t/transitive_property_inequalities.htm"><strong>transitive property of inequality</strong></a>, realise that we don’t need to run the <strong>third test</strong>! <em>If we know that <code>A&nbsp;&gt;&nbsp;B</code> and <code>B&nbsp;&gt;&nbsp;C</code> are both <code>false</code>, then we would know that <code>A&nbsp;&gt;&nbsp;C</code> is <code>false</code> as well.</em></p>
            <blockquote>
              <p>“If <i>a ≤ b</i> and <i>b ≤ c</i>, then <i>a ≤ c</i>.”
                <cite>the transitive property of inequality</cite>
              </p>
            </blockquote>
            <p>So in this example, we don’t really need to run <code>intersects(A, C)</code>.</p>
            <pre class="code-block "><code class="code-block-code"><span class="token comment">// 1. Test A-B</span>
<span class="token function">intersects</span><span class="token punctuation">(</span><span class="token constant">A</span><span class="token punctuation">,</span> <span class="token constant">B</span><span class="token punctuation">)</span> <span class="token comment">// A.right &gt; B.left evals to false.</span>

<span class="token comment">// 2. Test B-C</span>
<span class="token function">intersects</span><span class="token punctuation">(</span><span class="token constant">B</span><span class="token punctuation">,</span> <span class="token constant">C</span><span class="token punctuation">)</span> <span class="token comment">// B.right &gt; C.left evals to false.</span>

<span class="token comment">// 3. Infer that A.right &gt; C.left is false.</span>
<span class="token comment">// ∴ Therefore I don’t need to call intersects(A, C)</span>
<span class="token comment">// to know that it will return false.</span></code></pre>
            <p>We’ve skipped one <code>intersects()</code> call for free! ✨</p>
            <span class="box-note ">
              I’m handwaving the fact that <code>P.left ≤ P.right</code> is implied for any object P. Nevertheless, working those details out would just mean more transitivity.
            </span>

            <p>You might be wondering how this contrived example could apply to general n-body collision detection. A smart reader such as you might also have realised that this skip only works if A, B, and C are in a <strong>particular order</strong>.</p>
            <p>What particular order? Try <span class="drag-hint">dragging</span> the balls below to see when the optimisation applies and when it does not:</p>
            <div class="demo-row">
              <sap-demo-client class=" sap-demo-draggable" data-rss="interactive" alt="interactive diagram showing a specific mechanism" id="abc-demo" balls="[[150,250,50],[300,150,55],[450,275,60]]" strategy="sap-nativesort" static="" draggable="" labels="A,B,C" rainbow=""></sap-demo-client>
              <pre class="code-block" style="width: 100%; max-width: 600px"><code class="code-block-code"><span class="token comment">// LIVE OUTPUT:</span>
<span class="token function">intersects</span><span class="token punctuation">(</span><span class="token constant">A</span><span class="token punctuation">,</span> <span class="token constant">B</span><span class="token punctuation">)</span> <span class="token comment">// A.right &gt; B.left evals to <span class="abc-demo-intersects-ab-return">false</span></span>
<span class="token function">intersects</span><span class="token punctuation">(</span><span class="token constant">B</span><span class="token punctuation">,</span> <span class="token constant">C</span><span class="token punctuation">)</span> <span class="token comment">// B.right &gt; C.left evals to <span class="abc-demo-intersects-bc-return">false</span></span>
<span class="abc-demo-intersects-ac-run" style="display: none"><span class="token function">intersects</span><span class="token punctuation">(</span><span class="token constant">A</span><span class="token punctuation">,</span> <span class="token constant">C</span><span class="token punctuation">)</span> <span class="token comment">// Can’t skip, returns <span class="abc-demo-intersects-ac-return">false</span></span></span><span class="abc-demo-intersects-ac-skip token comment">// Deduce that intersects(A, C) will be <span class="abc-demo-intersects-ac-return">false</span></span></code></pre>
            </div>



            <p><span class="box-note "><strong>Tip:</strong> Drag the balls so that they’re horizontally spaced out in this order: A‑B‑C</span></p>
            <p>While it’s true that this skip only works when A, B, and C are ordered, remember that these labels are <em>arbitrary</em>! What if we simply decided to always call the leftmost ball A, the middle ball B, and the rightmost C? Then the optimisation would always be applicable! 🌌🧠</p>
            <p>But wait… labeling objects according to some logical ordering is essentially ✨<strong>sorting</strong>✨! What if we sorted the list of objects every time? Would the number of skipped tests be worth the cost of sorting?</p>
            <h2 id="chapter-1-sorting">Chapter 1. Sorting</h2>
            <p>Sorting, inequalities, and optimisation go hand in hand in hand. <em>A sorted list allows us to exploit the transitive property of inequality en masse.</em></p>
            <p>
            <div class="blog-media blog-media-default">
              <img srcset="/notes/sweep-and-prune/sorted_664.generated.png 664w" sizes=" 664px" class="blog-media-element" alt="a[0] ≤ a[1] ≤ a[2] ≤ ... ≤ a[n-1]" src="/notes/sweep-and-prune/sorted.png" spec="100% [664) 664" loading="lazy" width="100%" height="" style="aspect-ratio: 10; background: #f8f8f8"><span class="blog-media-caption">The inequality relationships of elements in a sorted list.</span>
            </div>
            </p>
            <p><span class="box-note ">Even if we had to sort the list of objects every frame, the quickest general sorting algorithm runs in <em>O(n log n)</em> time which is certainly lower than <em>O(n<sup>2</sup>)</em>.</span></p>
            <p>As shown by the tri-object example above, to achieve the power to skip tests we need to sort the list of objects by x position.</p>
            <p>However, objects aren’t zero-width points. They’re <em>widthy</em>, by which I mean having a size thus occupying an interval in the x-axis, also known as “width”. How can one unambiguously sort by x position if objects span intervals in the x-axis?</p>
            <h2 id="sort-by-min-x">Sort by min x</h2>
            <p>A solution to sorting widthy objects is to sort them by their <strong>minimum x</strong> (their left edge’s x-coordinate). This technique can be applied to improve the naive approach.</p>
            <p>It involves minimal modifications to the O(n<sup>2</sup>) solution. But it will result in a good chunk of tests skipped. I’ll explain later.</p>
            <p>First, the modified code:</p>
            <pre class="code-block "><code class="code-block-code"><span class="token inserted-sign inserted language-javascript"><span class="token prefix inserted">+</span> <span class="token comment">// sort by min x</span>
<span class="token prefix inserted">+</span> <span class="token function">sortByLeft</span><span class="token punctuation">(</span>balls<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token prefix inserted">+</span> 
</span><span class="token unchanged language-javascript"><span class="token prefix unchanged"> </span> <span class="token comment">// for each ball</span>
<span class="token prefix unchanged"> </span> <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> balls<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token prefix unchanged"> </span>   <span class="token keyword">const</span> ball1 <span class="token operator">=</span> balls<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token prefix unchanged"> </span>   <span class="token comment">// check each of the other balls</span>
<span class="token prefix unchanged"> </span>   <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> j <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> balls<span class="token punctuation">.</span>length<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token prefix unchanged"> </span>     <span class="token keyword">const</span> ball2 <span class="token operator">=</span> balls<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>
</span><span class="token inserted-sign inserted language-javascript"><span class="token prefix inserted">+</span> 
<span class="token prefix inserted">+</span>     <span class="token comment">// stop when too far away</span>
<span class="token prefix inserted">+</span>     <span class="token keyword">if</span> <span class="token punctuation">(</span>ball2<span class="token punctuation">.</span>left <span class="token operator">&gt;</span> ball1<span class="token punctuation">.</span>right<span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
<span class="token prefix inserted">+</span> 
</span><span class="token unchanged language-javascript"><span class="token prefix unchanged"> </span>     <span class="token comment">// check for collision</span>
<span class="token prefix unchanged"> </span>     <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">intersects</span><span class="token punctuation">(</span>ball1<span class="token punctuation">,</span> ball2<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token prefix unchanged"> </span>       <span class="token function">bounce</span><span class="token punctuation">(</span>ball1<span class="token punctuation">,</span> ball2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token prefix unchanged"> </span>     <span class="token punctuation">}</span>
<span class="token prefix unchanged"> </span>   <span class="token punctuation">}</span>
<span class="token prefix unchanged"> </span> <span class="token punctuation">}</span></span></code></pre>
            <p>It’s mostly the same as the naive solution, differing only in two extra lines of code.</p>
            <p>The first line <code>sortByLeft(balls)</code> simply sorts the list, with ranking based on the balls’ left edge x-coords.</p>
            <pre class="code-block "><code class="code-block-code"><span class="token keyword">function</span> <span class="token function">sortByLeft</span><span class="token punctuation">(</span><span class="token parameter">balls</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  balls<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span>b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> a<span class="token punctuation">.</span>left <span class="token operator">-</span> b<span class="token punctuation">.</span>left<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
            <p>And in the inner loop, there is now this break:</p>
            <pre class="code-block "><code class="code-block-code"><span class="token keyword">if</span> <span class="token punctuation">(</span>ball2<span class="token punctuation">.</span>left <span class="token operator">&gt;</span> ball1<span class="token punctuation">.</span>right<span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span></code></pre>
            <p>Let’s break that down.</p>
            <p>First, we know that the list is sorted, so the following statement
              holds true for any positive integer
              <code class="eq-c">c</code>:
            </p>
            <p class="center">
              <code>balls[<span class="eq-i">j</span> + <span class="eq-c">c</span>].left <span class="eq-op">&gt;=</span> balls[<span class="eq-i">j</span>].left</code>
            </p>

            <p>The break condition, which is derived from the first operand of the intersection test, if true indicates early that the current pair being tested for intersection would fail:</p>
            <p class="center">
              <code>balls2.left <span class="eq-op">&gt;</span> ball1.right</code><br>
              or <code>balls[<span class="eq-i">j</span>].left <span class="eq-op">&gt;</span> ball1.right</code>
            </p>

            <p>But there are more implications. If it was true, then by combining the above two inequations…</p>
            <p class="center">
              <code>balls[<span class="eq-i">j</span> + <span class="eq-c">c</span>].left <span class="eq-op">&gt;=</span> balls[<span class="eq-i">j</span>].left <span class="eq-op">&gt;</span> ball1.right</code>
            </p>

            <p>And by transitive property, the following statement would also be true!</p>
            <p class="center">
              <code>balls[<span class="eq-i">j</span> + <span class="eq-c">c</span>].left <span class="eq-op">&gt;</span> ball1.right</code>
            </p>

            <p>Which means the intersection tests of balls at
              <code>balls[<span class="eq-i">j</span> + <span class="eq-c">c</span>]</code>
              would also fail. We know this without needing to test those balls individually. A range of balls have been eliminated from testing!
            </p>
            <p>In conclusion, when the current <em>ball2</em>
              <code>balls[<span class="eq-i">j</span>]</code>
              stops overlapping with the current <em>ball1</em>, then any further <em>ball2</em>s in the iteration
              <code>balls[<span class="eq-i">j</span> + <span class="eq-c">c</span>]</code>
              would be guaranteed to not overlap <em>ball1</em> as well. In other words, we stop the inner loop when it gets too far away.
            </p>
            <p>Finally, here’s a demo:</p>
            <div class="demo-row">
              <sap-demo-client class="" data-rss="interactive" alt="demo of the collision detection algorithm using 'simple-sap' strategy" strategy="simple-sap" skip-interval="4" decorations="checks:#4c8"></sap-demo-client>
              <div class="demo-caption">
                Pairs highlighted <span aria-label="a connecting green line" style="color:#4c8" class="pair-legend"></span> when tested by <code>intersects()</code>.
              </div>
            </div>

            <p>Pretty cool, right! It’s much faster now.</p>
            <p>Some observations:</p>
            <ul>
              <li>Since the list is sorted, the tests are performed from left to right.</li>
              <li>More importantly, it visibly does fewer tests than the naive approach. 📉 This is due the above optimisation which effectively limits pairs to those that overlap in the x-axis!</li>
            </ul>
            <p>Let’s analyse the time complexity. 👓</p>
            <p>The sort - if we take the "fastest" sorting algorithm, like mergesort or quicksort - would add an <em>O(n log n)</em> term.</p>
            <p>The two-level loop, now with an early break, would average out to <em>O(n&nbsp;+&nbsp;m)</em> where <em>m</em> is the total number of x-overlaps. This could degenerate into n<sup>2</sup> but as mentioned above, it’s more useful to look at the average and best cases. At best, the loop would be <em>O(n)</em>, wasting no excess processing when there are no overlaps. On average it’s <em>O(n&nbsp;+&nbsp;m)</em>.</p>
            <p><span class="box-note ">The average case refers to a world where objects are mostly evenly distributed and only a couple intersections per object is happening. I think this is a reasonable assumption for a relatively simple video game like a platformer or side-scroller.</span></p>
            <p>Here’s the code with running time annotations:</p>
            <pre class="code-block "><code class="code-block-code"><span class="token comment">// O(n log n)</span>
<span class="token function">sortByLeft</span><span class="token punctuation">(</span>balls<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// O(n + m)</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> balls<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> ball1 <span class="token operator">=</span> balls<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token comment">// O(1) at best; O(m/n) on average; O(n) at worst</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> j <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> balls<span class="token punctuation">.</span>length<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> ball2 <span class="token operator">=</span> balls<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>ball2<span class="token punctuation">.</span>left <span class="token operator">&gt;</span> ball1<span class="token punctuation">.</span>right<span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">intersects</span><span class="token punctuation">(</span>ball1<span class="token punctuation">,</span> ball2<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">bounce</span><span class="token punctuation">(</span>ball1<span class="token punctuation">,</span> ball2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
            <p>Adding those together we get <em><strong>O(n&nbsp;log&nbsp;n&nbsp;+&nbsp;m)</strong></em>.</p>
            <p>This is a super good improvement over the naive approach’s <em>O(n<sup>2</sup>)</em>, because <strong>[1]</strong> <em>n&nbsp;log&nbsp;n</em> is <a target="_blank" class="text-link " href="https://bigocheatsheet.com/">much smaller</a> than <em>n<sup>2</sup></em> and <strong>[2]</strong> it is partially output-based - depending on the number of overlaps, it does not process more than necessary.</p>
            <a target="_blank" class="text-link " href="https://www.bigocheatsheet.com">
              <div class="blog-media blog-media-default">
                <img class="blog-media-element" alt="" src="https://www.bigocheatsheet.com/img/big-o-complexity-chart.png" loading="lazy"><span class="blog-media-caption">bigocheatsheet.com</span>
              </div>
            </a>

            <p>Furthermore, the choice of sorting algorithm could be improved. We’ll look into that in the next part (somehow better than <em>n&nbsp;log&nbsp;n</em>!).</p>
            <span class="box-note ">
              If you got this far trying to find a decent collision detection algorithm, then you can stop reading and take the above design! It’s the perfect balance between programming effort and running time performance. If you are curious how this develops or just want to see more interactive demos, read on to the next part.
            </span>

            <h2 id="visual-comparison">Visual comparison</h2>
            <p><a id="comparisons"></a>Here’s a side-by-side comparison of the strategies we’ve covered so far! Observe the amount of intersection tests required per frame. 🔍 n = 10</p>
            <div class="demo-row">
              <sap-demo-client class="" data-rss="interactive" alt="demo of the collision detection algorithm using 'pairwise' strategy" balls="10" strategy="pairwise" skip-interval="1" decorations="checks:#cbb:30"></sap-demo-client>
              <div class="demo-caption">Global pairwise</div>
            </div>

            <div class="demo-row">
              <sap-demo-client class="" data-rss="interactive" alt="demo of the collision detection algorithm using 'sap-nativesort' strategy" balls="10" strategy="sap-nativesort" skip-interval="1" decorations="checks:#bcb:30"></sap-demo-client>
              <div class="demo-caption">Sorted pairwise</div>
            </div>

            <p>(Not shown: the cost of sorting. Let’s just say the intersection test is sufficiently expensive.)</p>
            <p>Aaand that concludes the first part. Those two lines of code definitely were the MVPs.</p>
            <p>How will it compare to the more advanced versions?</p>
            <p><a target="_self" class="text-link " href="/notes/sweep-and-prune-2/">Continued in part 2.</a>
            </p>

          </div>

        </div>
        <div class="postcontent">
          <div class="postcontent-narrow">
            <reactions-client class="reactions reactions-invisible">
              <h2 class="reaction-title">React to this post</h2>
              <button class="reaction-btn reaction-heart-btn">
                <span class="reaction-icon" aria-label="Heart"></span>
              </button>
              <div class="reaction-count reaction-heart-count"></div>
              <button class="reaction-btn reaction-fire-btn">
                <span class="reaction-icon" aria-label="Fire"></span>
              </button>
              <div class="reaction-count reaction-fire-count"></div>
              <button class="reaction-btn reaction-bubble-btn">
                <span class="reaction-icon" aria-label="Bubble"></span>
              </button>
              <div class="reaction-count reaction-bubble-count"></div>
              <button class="reaction-btn reaction-sun-btn">
                <span class="reaction-icon" aria-label="Sun"></span>
              </button>
              <div class="reaction-count reaction-sun-count"></div>
              <button class="reaction-btn reaction-cloud-btn">
                <span class="reaction-icon" aria-label="Cloud"></span>
              </button>
              <div class="reaction-count reaction-cloud-count"></div>
              <div class="reaction-error"></div>
            </reactions-client>
            <p class="blog-signature">Thanks for reading! I’m Lean, and I like making interactive visualisations for my <a target="_self" class="text-link " href="/notes/">programming blog</a>. Sometimes I do <a target="_self" class="text-link " href="/wares/">projects</a> too. Oh, and before you go, sign <a target="_self" class="text-link " href="/guestbook/">the guestbook</a>! See you around! <span class="blog-signature-name"><i>—Lean</i><img class="blog-signature-img" src="/icons/sig.png" alt="liyan"></span></p>
          </div>
          <aside class="blog-suggestions">
            <h2 class="blog-suggestions-title">More posts</h2>
            <div class="card-grid ">

              <a class="card-grid-item card-grid-thumbalign-center card-grid-item-expanded" href="/notes/sweep-and-prune-2/">
                <div class="card-grid-image-container">
                  <img srcset="/notes/placeholder_546.generated.png 546w" sizes=" 546px" class="card-grid-image" src="/notes/placeholder.png" alt="" spec="546" loading="lazy">
                </div>
                <div class="card-grid-title-wrap">
                  <div class="card-grid-title-bar">
                    <div class="card-grid-title-content">
                      <div class="card-grid-title">Sort, sweep, and prune: Part 2</div>
                      <div class="card-grid-posttitle">6 Aug 2023</div>
                    </div>
                  </div>
                </div>
                <div class="card-grid-content">
                  <div class="card-grid-posttitle card-grid-postitle-small">
                    6 Aug 2023
                  </div>
                  <div class="card-grid-actions">
                    <span class="card-grid-action card-grid-info">info</span>
                    <span class="card-grid-action card-grid-story">story</span>
                  </div>
                  <div class="card-grid-description">

                    <span class="tag-component" title="algorithm" style="background: #6bfbfa; color: #097d7c">algo</span> <span class="tag-component" style="background: #b7eaa6; color: #336920">games</span>

                    <span class="card-grid-action card-grid-story" aria-label="Read post - Sort, sweep, and prune: Part 2">Read post</span>
                  </div>
                </div>
              </a><a class="card-grid-item card-grid-thumbalign-center card-grid-item-expanded" href="/notes/2023-review/">
                <div class="card-grid-image-container">
                  <img srcset="/notes/placeholder_546.generated.png 546w" sizes=" 546px" class="card-grid-image" src="/notes/placeholder.png" alt="" spec="546" loading="lazy">
                </div>
                <div class="card-grid-title-wrap">
                  <div class="card-grid-title-bar">
                    <div class="card-grid-title-content">
                      <div class="card-grid-title">2023 in review</div>
                      <div class="card-grid-posttitle">25 Dec 2023</div>
                    </div>
                  </div>
                </div>
                <div class="card-grid-content">
                  <div class="card-grid-posttitle card-grid-postitle-small">
                    25 Dec 2023
                  </div>
                  <div class="card-grid-actions">
                    <span class="card-grid-action card-grid-info">info</span>
                    <span class="card-grid-action card-grid-story">story</span>
                  </div>
                  <div class="card-grid-description">



                    <span class="card-grid-action card-grid-story" aria-label="Read post - 2023 in review">Read post</span>
                  </div>
                </div>
              </a><a class="card-grid-item card-grid-thumbalign-center card-grid-item-expanded" href="/notes/introducing-portabl.ink/">
                <div class="card-grid-image-container">
                  <img srcset="/notes/placeholder_546.generated.png 546w" sizes=" 546px" class="card-grid-image" src="/notes/placeholder.png" alt="" spec="546" loading="lazy">
                </div>
                <div class="card-grid-title-wrap">
                  <div class="card-grid-title-bar">
                    <div class="card-grid-title-content">
                      <div class="card-grid-title">Introducing portabl.ink</div>
                      <div class="card-grid-posttitle">25 Sep 2023</div>
                    </div>
                  </div>
                </div>
                <div class="card-grid-content">
                  <div class="card-grid-posttitle card-grid-postitle-small">
                    25 Sep 2023
                  </div>
                  <div class="card-grid-actions">
                    <span class="card-grid-action card-grid-info">info</span>
                    <span class="card-grid-action card-grid-story">story</span>
                  </div>
                  <div class="card-grid-description">

                    <span class="tag-component" style="background: #f0de91; color: #725f15">js</span> <span class="tag-component" title="micropost" style="background: #cccccc; color: #444444">µpost</span>

                    <span class="card-grid-action card-grid-story" aria-label="Read post - Introducing portabl.ink">Read post</span>
                  </div>
                </div>
              </a>

            </div>


          </aside>
          <aside class="blog-rss-link">
            <p>
              Want me to spam your inbox? Me neither.<br>Forget newsletters; use RSS!
            </p>
            <div class="blog-rss-link-combo">
              <a href="/rss.xml" target="_blank" class="blog-rss-link-a">
                leanrada.com/rss.xml
              </a>
              <button class="btn blog-rss-link-button">
                Copy
              </button>
            </div>
          </aside>
        </div>
      </div>

    </div>
    <footer class="main-footer">
      <div class="main-footer-content-part">
        <p class="main-footer-line">
          <a target="_self" class="main-footer-link" href="/">Home</a> ·
          <a target="_self" class="main-footer-link" href="/wares/">Software</a> ·
          <a target="_self" class="main-footer-link" href="/art/">Art</a> ·
          <a target="_self" class="main-footer-link" href="/music/">Music</a> ·
          <a target="_self" class="main-footer-link" href="/notes/">Notes</a> ·
          <a target="_self" class="main-footer-link" href="/about/">About</a>
        </p>
        <p class="main-footer-line">
          <img class="main-footer-signature" alt="" src="/icons/laptop_user.png" loading="lazy">
          <span style="display: inline-block">
            ·
            <a target="_self" class="main-footer-link" href="/guestbook/">Sign the guestbook!</a>
            <br>
            · Drop a
            <a target="_blank" class="main-footer-link" href="mailto:mail%40leanrada.com">
              mail＠leanrada·com
            </a>
            <br>
          </span>
        </p>
        <p class="main-footer-line">
          (C) 2023 Lean Rada.
          <a target="_blank" class="main-footer-link" href="https://github.com/Kalabasa/kalabasa.github.io">
            Source</a>.
        </p>
      </div>
      <div class="main-footer-content-part">
        <h2 class="main-footer-links-heading">On the web</h2>
        <a target="_blank" class="main-footer-web-link" href="https://www.linkedin.com/in/leanrada/">
          <img class="main-footer-web-link-icon" alt="LinkedIn" src="/icons/linkedin.png" loading="lazy">
        </a>
        <a target="_blank" class="main-footer-web-link" href="https://codepen.io/kalabasa">
          <img class="main-footer-web-link-icon" alt="CodePen" src="/icons/codepen.png" loading="lazy">
        </a>
        <a target="_blank" class="main-footer-web-link" href="https://stackoverflow.com/users/3144156/kalabasa">
          <img class="main-footer-web-link-icon" alt="Stack Overflow" src="/icons/stackoverflow.png" loading="lazy">
        </a>
        <a target="_blank" class="main-footer-web-link" href="https://github.com/Kalabasa" rel="me">
          <img class="main-footer-web-link-icon" alt="GitHub" src="/icons/github.png" loading="lazy">
        </a>
        <h2 class="main-footer-links-heading">Webrings</h2>
        <p class="main-footer-line">
          <img class="main-footer-webring-icon" alt="" src="/icons/planet.png" loading="lazy">
          <a target="_blank" class="main-footer-link" href="http://geekring.net/">geekring.net</a>
          [<a target="_blank" class="main-footer-link" href="http://geekring.net/site/288/previous" aria-label="Previous site">←</a>
          <a target="_blank" class="main-footer-link" href="http://geekring.net/site/288/random" aria-label="Random site">⁙</a>
          <a target="_blank" class="main-footer-link" href="http://geekring.net/site/288/next" aria-label="Next site">→</a>
          <a target="_blank" class="main-footer-link" href="http://geekring.net/site/288/frameset" aria-label="Frameset browsing">▣</a>]
        </p>
        <p class="main-footer-line">
          <img class="main-footer-webring-icon" alt="" src="/icons/planet.png" loading="lazy">
          <a target="_blank" class="main-footer-link" href="https://cs.sjoy.lol/">CSS JOY</a>
          [<a target="_blank" class="main-footer-link" href="https://webri.ng/webring/cssjoy/previous?via=https%3A%2F%2Fleanrada.com" aria-label="Previous site">←</a>
          <a target="_blank" class="main-footer-link" href="https://webri.ng/webring/cssjoy/random?via=https%3A%2F%2Fleanrada.com" aria-label="Random site">⁙</a>
          <a target="_blank" class="main-footer-link" href="https://webri.ng/webring/cssjoy/next?via=https%3A%2F%2Fleanrada.com" aria-label="Next site">→</a>]
        </p>
      </div>
      <nebula-client class="main-footer-nebula" palette="#0ad591 #ff2b75 #ffb833 #0ad591 #0ad591 #4d4aff #0ad591" width="40" height="10">
        <canvas style="filter: contrast(1.5)"></canvas>
        <div class="nebula-noise"></div>
      </nebula-client>
      <a class="main-footer-top-btn" href="#top" aria-label="Back to top">^</a>
    </footer>
  </div>






  <script type="module" async="" defer="" src="/scripts/reactions.js"></script>
  <script type="module" async="" defer="" src="/scripts/sap-demo.js"></script>
  <script defer="" src="/scripts/blog-media.js"></script>
  <script defer="" src="/scripts/blog-header.js"></script>
  <script type="module" async="" defer="" src="/scripts/nebula.js"></script>
  <script defer="" src="/scripts/main-footer-main-header.js"></script>
  <script defer="" async="">
  (() => {
    for (const button of document.querySelectorAll(".blog-rss-link-button")) {
      button.addEventListener("click", (e) => {
        const copied = copy();
        if (copied) button.textContent = "Copied";
      });
    }

    async function copy() {
      const href = document.querySelector(".blog-rss-link-a").href;
      try {
        await navigator.clipboard.writeText(href);
        return true;
      } catch (e) {}
      return false;
    }
  })();
</script>
  <script defer="" src="/scripts/card-grid-item.js"></script>
  <script defer="">
        (()=> {
          const abcDemo = document.querySelector("#abc-demo");
          const intersectsAbReturn = document.querySelectorAll(".abc-demo-intersects-ab-return");
          const intersectsBcReturn = document.querySelectorAll(".abc-demo-intersects-bc-return");
          const intersectsAcReturn = document.querySelectorAll(".abc-demo-intersects-ac-return");
          const intersectsAcRun = document.querySelectorAll(".abc-demo-intersects-ac-run");
          const intersectsAcSkip = document.querySelectorAll(".abc-demo-intersects-ac-skip");
          
          abcDemo.addEventListener("simulate", throttle((event) => {
            const [A, B, C] = event.balls;
            setText(intersectsAbReturn, String(A.x + A.radius > B.x - B.radius));
            setText(intersectsBcReturn, String(B.x + B.radius > C.x - C.radius));
            setText(
              intersectsAcReturn,
              String(Math.hypot(A.x - C.x, A.y - C.y) < A.radius + C.radius)
            );
            const acRuns = (A.x + A.radius > B.x - B.radius) || (B.x + B.radius > C.x - C.radius);
            setShow(intersectsAcRun, acRuns);
            setShow(intersectsAcSkip, !acRuns);
          }));

          function setText(elements, text) {
            for (const element of elements)
              if (element.textContent !== text)
                element.textContent = text;
          }

          function setShow(elements, show) {
            for (const element of elements)
              if ((element.offsetParent != null) !== show)
                element.style.display = show ? "block" : "none";
          }

          function throttle(func, ms = 100) {
            let lastTime = Date.now();
            return (...args) => {
              if (Date.now() - lastTime < ms) return;
              lastTime = Date.now();
              func(...args);
            };
          }
        })();
      </script>
</body>
</html>