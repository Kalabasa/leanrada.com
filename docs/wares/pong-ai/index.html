<html lang="en">
<head>
    <title>Pong AI Â· leanrada.com</title>
    <script async="" src="https://unpkg.com/perlin-noise-3d@0.5.4/dist/perlin-noise-3d.min.js"></script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" type="image/png" href="/favicon.png">
    <script async="" src="https://cdn.jsdelivr.net/gh/Kalabasa/analytics/analytics.js"></script>
    <style>
        @font-face {
            font-family: "Space Mono";
            src: url("/fonts/SpaceMono-Regular.ttf") format("truetype");
        }

        @font-face {
            font-family: "Space Mono";
            font-style: italic;
            src: url("/fonts/SpaceMono-Italic.ttf") format("truetype");
        }

        @font-face {
            font-family: "Miriam Libre";
            src: url("/fonts/MiriamLibre-Regular.ttf") format("truetype");
        }

        @font-face {
            font-family: "Miriam Libre";
            font-weight: bold;
            src: url("/fonts/MiriamLibre-Bold.ttf") format("truetype");
        }

        :root {
            --default-font: "Space Mono", monaco, Consolas, Lucida Console, monospace;
            --reading-font: "Miriam Libre", Futura, "Trebuchet MS", Arial, sans-serif;

            --bg-clr: #111;
            --card-clr: #222;
            --clr0-light: #54f8c1;
            --clr0: #0ad591;
            --clr0-dark: #018b5d;
            --clr1: #df2063;

            --text-clr: #fff;
            --text2-clr: #999;

            --ease: cubic-bezier(0.8, 0, 1, 1);
        }

        body {
            margin: 0;
            min-height: 100vh;
            font-family: var(--default-font, monospace);
            font-size: 15px;
            font-display: swap;
            background-color: var(--bg-clr, #111);
            color: var(--text-clr, #fff);
            overflow-x: hidden;
        }

        .page-wrapper {
            display: flex;
            flex-direction: column;
            min-height: 100%;
        }

        .page-wrapper-content {
            flex: 1 1 auto;
        }
    </style>
    <style>
        nebula-client>canvas {
            width: 100%;
            height: 100%;
        }
    </style>
    <style>
        .main-footer-link {
            text-decoration: none;
        }

        .main-footer-link-icon {
            width: 32px;
            height: 32px;
            image-rendering: pixelated;
        }

        .main-footer-link-icon:hover {
            filter: invert(1);
        }
    </style>
    <style>
        .main-footer {
            position: relative;
            display: flex;
            justify-content: space-between;
            gap: 60px;
            padding: 60px calc(max(60px, 50vw - 600px)) 60px;
            font-size: 15px;
            font-weight: bold;
            background: var(--clr0);
            color: #000;
            overflow: hidden;
            content-visibility: auto;
            contain-intrinsic-height: 220x;
        }

        .main-footer-links-heading {
            margin: 0 0 18px;
            font-size: inherit;
        }

        .main-footer-line {
            margin: 0 0 18px;
        }

        .main-footer-nav {
            color: #000;
        }

        .main-footer-nav:hover {
            color: #fff;
        }

        .main-footer-content-part {
            z-index: 1;
        }

        .main-footer-nebula {
            position: absolute;
            left: -30%;
            top: -30%;
            width: 160%;
            height: 160%;
            z-index: 0;
        }

        .main-footer-top-btn {
            display: block;
            z-index: 2;
            position: absolute;
            right: 0;
            top: 0;
            width: 72px;
            height: 36px;
            padding-right: 9px;
            box-sizing: border-box;
            display: flex;
            justify-content: center;
            align-items: center;
            border: none;
            border-bottom-left-radius: 18px;
            background: var(--bg-clr);
            text-decoration: none;
            color: var(--clr0-light);
            font: inherit;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
        }

        .main-footer-top-btn:hover {
            color: var(--clr1);
        }

        .main-footer-top-btn::before {
            content: "";
            position: absolute;
            right: 0;
            top: 0;
            width: 36px;
            height: 18px;
            border-top-right-radius: 18px;
            transform: translateX(-72px);
            box-shadow: 18px 0 0 var(--bg-clr);
        }

        @media (max-width: 700px) {
            .main-footer {
                flex-direction: column-reverse;
            }
        }
    </style>
    <style>
        .main-header {
            position: sticky;
            top: 0;
            width: 100%;
            height: 60px;
            padding: 0 calc(25% - 150px);
            z-index: 100;
            box-sizing: border-box;
            pointer-events: none;
        }

        .main-header.float {
            position: fixed;
        }

        .main-header-bar {
            position: relative;
            display: flex;
            justify-content: space-evenly;
            align-items: flex-end;
            height: 100%;
        }

        .main-header-item {
            display: inline-flex;
            justify-content: center;
            align-items: center;
            width: 6ch;
            height: 36px;
            padding: 0 18px;
            border-radius: 18px;
            font-size: 15px;
            font-weight: bold;
            letter-spacing: 1px;
            text-decoration: none;
            text-transform: uppercase;
            color: #fff;
            backdrop-filter: blur(8px);
            background-image: linear-gradient(60deg, #fff2 60%, transparent 60%);
            background-repeat: no-repeat;
            background-size: 220% 100%;
            background-position: 115%;
            pointer-events: all;
            transition: background-position 0.2s var(--ease);
        }

        .main-header-item:hover {
            background-image: linear-gradient(60deg,
                    #fff2 50%,
                    #fff 50%,
                    #fff 60%,
                    transparent 60%);
            background-position: 0%;
        }

        .main-header-item.select {
            background: #fff2;
        }

        .main-header-icon {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            image-rendering: pixelated;
            object-fit: cover;
            object-position: 0 0;
            filter: invert(1);
            backdrop-filter: blur(8px) invert(1);
            pointer-events: all;
        }

        .main-header-icon:hover {
            object-position: 100% 0;
        }

        @media (max-width: 450px) {
            .main-header-icon {
                display: none;
            }
        }

        .main-header-indicator {
            position: absolute;
            width: 6px;
            height: 6px;
            left: 50%;
            top: calc(100% + 12px);
            transform: translate(-50%, -50%);
            /* border acts as extended touch area */
            border: solid 6mm transparent;
            border-left-width: 45vw;
            border-right-width: 45vw;
            border-radius: 50%;
            background: #fff;
            background-clip: padding-box;
            opacity: 0;
            transition: opacity 50ms;
        }

        .main-header.hidden .main-header-indicator {
            opacity: 0.8;
            pointer-events: all;
        }
    </style>
    <style>
        .blog-page {
            display: flex;
            justify-content: center;
            overflow: hidden;
        }

        .content {
            padding: 60px 18px;
            width: 100%;
            max-width: 700px;
            font-family: var(--reading-font, sans-serif);
            font-size: 16px;
            line-height: 2.2;
            letter-spacing: 0.02em;
            color: #ddd;
            box-sizing: border-box;
        }

        .markdown>h1,
        .markdown>h2,
        .markdown>h3,
        .markdown>h4,
        .markdown>h5,
        .markdown>h6 {
            font-family: var(--default-font, monospace);
            font-weight: lighter;
            font-style: italic;
            line-height: 1.6;
            letter-spacing: 0.04em;
            margin: 48px 0 36px;
        }

        .markdown>h1 {
            text-align: center;
            font-size: 200%;
        }

        .markdown>h2 {
            font-size: 150%;
        }

        .markdown>h3,
        .markdown>h4,
        .markdown>h5,
        .markdown>h6 {
            font-size: 120%;
            font-weight: bold;
        }

        .markdown>p {
            margin: 36px 0;
        }

        .markdown>hr {
            width: 36px;
            margin: 90px auto;
            border: solid 1.5px #ccc;
            background: #ccc;
            border-radius: 3px;
        }

        .markdown code:not([class]):not([class]) {
            display: inline-block;
            padding: 0 6px;
            border-radius: 6px;
            font-family: var(--default-font, monospace);
            font-size: 15px;
            background: var(--card-clr);
        }

        .markdown>pre:not([class])>code:not([class]) {
            display: block;
            padding: 18px;
            border-radius: 18px;
            line-height: 1.6;
            font-size: 15px;
            overflow-x: auto;
        }

        .markdown>blockquote {
            position: relative;
            margin: 0;
            padding: 18px 24px;
            border-radius: 18px;
            border: solid 1px var(--clr0);
            font-size: 21px;
        }

        .markdown>blockquote::before {
            content: "";
            position: absolute;
            right: 100%;
            top: 0;
            height: 24px;
            width: 24px;
            border-bottom: solid 1px var(--clr0);
            box-sizing: border-box;
        }

        .markdown>blockquote::after {
            content: "";
            position: absolute;
            right: 100%;
            top: 24px;
            bottom: 18px;
            width: 24px;
            border-top-right-radius: 24px;
            border: solid var(--clr0);
            border-width: 1px 1px 0 0;
            box-shadow: 9px 0 0 var(--bg-clr), 18px 0 0 var(--bg-clr);
            box-sizing: border-box;
        }

        .markdown>blockquote> :first-child {
            margin-top: 0;
        }

        .markdown>blockquote> :last-child {
            margin-bottom: 0;
        }

        .markdown>blockquote cite {
            display: block;
            margin-top: 12px;
            font-size: 15px;
            font-style: inherit;
        }

        .markdown>blockquote cite::before {
            content: "â€”";
        }

        .markdown>iframe,
        .markdown>p>iframe {
            max-width: calc(100vw - 18px);
            border: none;
            border-radius: 18px;
            background: #fff;
        }

        .markdown .center {
            text-align: center;
        }

        .markdown .center-flex {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        /* todo? convert to component <blog-bleed>, reuse across <blog-media> */
        .markdown .bleed {
            position: relative;
            left: 50%;
            width: 100vh;
            max-width: max(min(100vw, 800px), 80vw);
            transform: translateX(-50%);
        }

        /* todo: convert to component <caption>, reuse across <blog-media> */
        .markdown .caption {
            display: block;
            font-size: 15px;
        }
    </style>
    <style>
        .text-link {
            color: var(--clr0-light, #fff);
        }

        .text-link:visited {
            color: var(--clr0, #fff);
        }
    </style>
    <style>
        .box-note {
            display: block;
            padding: 12px 18px;
            border-radius: 12px;
            border: solid 2px var(--clr0-dark);
            box-sizing: border-box;
        }
    </style>
    <style>
        .blog-media {
            position: relative;
            text-align: center;
            /* external margin because itâ€™s expected to be in an article */
            margin: 36px 0;
        }

        .blog-media-bleed {
            margin: 90px 0;
            max-height: 80vh;
        }

        .blog-media-element {
            display: inline-block;
            max-width: 100%;
            max-height: 80vh;
            border-radius: 18px;
            box-sizing: border-box;
        }

        .blog-media-bleed .blog-media-element {
            position: relative;
            left: 50%;
            max-width: max(min(100vw, 800px), 80vw);
            transform: translateX(-50%);
        }

        .blog-media-windowed .blog-media-element {
            border-radius: 0;
        }

        .blog-media-caption {
            display: block;
            font-size: 15px;
        }
    </style>
    <script src="/scripts/common.js"></script>
</head>


<body>

    <div class="page-wrapper">
        <header class="main-header">
            <div class="main-header-bar">
                <a href="/" class="main-header-item ">Home</a>
                <a href="/wares/" class="main-header-item select">Wares</a>
                <img class="main-header-icon" src="/icons/yay_sheet.png" alt="">
                <a href="/art/" class="main-header-item ">Art</a>
                <a href="/notes/" class="main-header-item ">Notes</a>
                <div class="main-header-indicator"></div>
            </div>
        </header>
        <div class="page-wrapper-content">

            <div class="blog-page">
                <div class="content">

                    <!-- prettier-ignore -->
                    <div class="markdown">
                        <h1 id="pong-ai">Pong AI</h1>
                        <div class="blog-media blog-media-default">
                            <img srcset="/wares/pong-ai/media/pongai1_664.generated.png 664w" sizes=" 664px" class="blog-media-element" alt="screenshot" src="/wares/pong-ai/media/pongai1.png" spec="100% [664) 664" loading="lazy" width="100%" height="" style="aspect-ratio: 1.2; background: #080808">
                        </div>

                        <h2 id="neural-networks--genetic-algorithms">Neural networks &amp; genetic algorithms</h2>
                        <p><a target="_blank" class="text-link " href="https://en.wikipedia.org/wiki/Neural_network">Neural nets</a> have been around since the 1950s/60s. This Pong AI experiment was done back in 2014, around the time when a revival in neural networks was accelerating, that later brought about the deep learning, modern artificial intelligence that we associate with the term "AI" nowadays.</p>
                        <p>The Pong AI here, hovewer, has nothing to do with that deep stuff. I was largely unaware of those new developments in AI back then. This one is a very simple implementation of a 3-layer <a target="_blank" class="text-link " href="https://en.wikipedia.org/wiki/Feedforward_neural_network">feedforward neural network</a>.</p>
                        <p>The inputs of the network are ball position, heading, paddle position, etc. and the outputs directly control the paddle.</p>
                        <div class="blog-media blog-media-default">
                            <img srcset="/wares/pong-ai/media/net_664.generated.png 664w" sizes=" 664px" class="blog-media-element" alt="network visualization" src="/wares/pong-ai/media/net.png" spec="100% [664) 664" loading="lazy" width="100%" height="" style="aspect-ratio: 0.7477203647416414; background: #080808"><span class="blog-media-caption">Visualization of the network. Sorry about the pixelation (it was a product of that time).</span>
                        </div>

                        <p>Instead of the usual <a target="_blank" class="text-link " href="https://en.wikipedia.org/wiki/Backpropagation">backpropagation</a>, the learning method I used here was a <a target="_blank" class="text-link " href="https://en.wikipedia.org/wiki/Genetic_algorithm">genetic algorithm</a>. Itâ€™s an evolutionary algorithm that mimics natural selection, reproduction, and mutation to optimize the neural networkâ€™s weights. This was how the Pong "AI" learned.</p>
                        <p>To illustrate the learning process, letâ€™s look at how the AI performs in different stages of learnedness.</p>
                        <p>Hereâ€™s an early-generation AI:</p>
                        <p><span class="box-note "><em>Note: The AI controls the left paddle. Ignore the right one; itâ€™s just an automated paddle.</em></span></p>
                        <div class="blog-media blog-media-default">
                            <video class="blog-media-element" muted="" autoplay="" loop="" aria-label="video of a generation 2 AI">
                                <source src="/wares/pong-ai/media/gen2.mp4">
                                <a href="/wares/pong-ai/media/gen2.mp4">video of a generation 2 AI</a>
                            </video><span class="blog-media-caption">Generation 2</span>
                        </div>

                        <p>As you can see, at this stage, its behaviour is still random with little to no awareness of the ball.</p>
                        <p>Sometimes it gets lucky and catches the ball, surviving another volley! This behaviour is rewarded by higher chances of reproduction. The longest surviving AIs in that generation reproduce more to populate the next generation.</p>
                        <div class="blog-media blog-media-default">
                            <video class="blog-media-element" muted="" autoplay="" loop="" aria-label="video of a generation 19 AI">
                                <source src="/wares/pong-ai/media/gen19.mp4">
                                <a href="/wares/pong-ai/media/gen19.mp4">video of a generation 19 AI</a>
                            </video><span class="blog-media-caption">Generation 19</span>
                        </div>

                        <p>After a few generations, good behaviour emerges while bad behaviour dies out due to natural selection. We can see in generation 19 that it has evolved a behaviour where it tries to follow the ball.</p>
                        <p>Now, Pong is a very simple game. If you just follow the ball constantly, you wonâ€™t lose. At about 20 generations the AI has mastered this strategy and is surviving significantly longer. One can conclude that ball-following is the perfect strategy.</p>
                        <p>Or is it? ðŸ¤”</p>
                        <p>What if the ball was faster than the paddle? Then the paddle wouldnâ€™t be able to keep up and the ball-following strategy will fail.</p>
                        <p>And thatâ€™s exactly what I did. I sped up the ball beyond the paddleâ€™s max speed. Hereâ€™s how the AI adapted:</p>
                        <div class="blog-media blog-media-default">
                            <video class="blog-media-element" muted="" autoplay="" loop="" aria-label="video of a generation 54 AI">
                                <source src="/wares/pong-ai/media/gen54s.mp4">
                                <a href="/wares/pong-ai/media/gen54s.mp4">video of a generation 54 AI</a>
                            </video><span class="blog-media-caption">Generation 54 with faster ball</span>
                        </div>

                        <p>At generation 54, with a faster ball, the AI has learned to <em>predict</em> the ball!</p>
                        <p>It also seems to reposition itself near the middle after every volley as if getting ready for the next shot.</p>
                        <p>This was a pretty cool result! I hadnâ€™t expected this, especially considering how limited / noisy inputs were (in my human eyes, at least).</p>
                        <p>Beyond the ball-predicting strategy, I wasnâ€™t able to discover any more breakthroughs with the AIâ€™s behaviour. I mean, ball prediction is pretty much the true perfect strategy, regardless of ball speed. At this point I was satisfied with the experiment and moved on to something else.</p>
                        <p>Bonus video! Very fast ball, generation 700+:</p>
                        <div class="blog-media blog-media-default">
                            <video class="blog-media-element" muted="" autoplay="" loop="" aria-label="video with very fast ball">
                                <source src="/wares/pong-ai/media/bv.mp4">
                                <a href="/wares/pong-ai/media/bv.mp4">video with very fast ball</a>
                            </video>
                        </div>

                    </div>

                </div>
            </div>

        </div>
        <footer class="main-footer">
            <div class="main-footer-content-part">
                <p class="main-footer-line">
                    <a target="_self" class="main-footer-nav" href="/">Home</a> Â·
                    <a target="_self" class="main-footer-nav" href="/wares/">Software</a> Â·
                    <a target="_self" class="main-footer-nav" href="/art/">Art</a> Â·
                    <a target="_self" class="main-footer-nav" href="/notes/">Notes</a> Â·
                    <a target="_self" class="main-footer-nav" href="/misc/">Misc</a>
                </p>
                <p class="main-footer-line">(C) 2023 Lean Rada</p>
            </div>
            <div class="main-footer-content-part">
                <h2 class="main-footer-links-heading">On the web</h2>
                <a target="_blank" class="main-footer-link" href="https://www.linkedin.com/in/leanrada/">
                    <img class="main-footer-link-icon" alt="LinkedIn" src="/icons/linkedin.png" loading="lazy">
                </a>
                <a target="_blank" class="main-footer-link" href="https://codepen.io/kalabasa">
                    <img class="main-footer-link-icon" alt="CodePen" src="/icons/codepen.png" loading="lazy">
                </a>
                <a target="_blank" class="main-footer-link" href="https://stackoverflow.com/users/3144156/kalabasa">
                    <img class="main-footer-link-icon" alt="Stack Overflow" src="/icons/stackoverflow.png" loading="lazy">
                </a>
                <a target="_blank" class="main-footer-link" href="https://github.com/Kalabasa" rel="me">
                    <img class="main-footer-link-icon" alt="GitHub" src="/icons/github.png" loading="lazy">
                </a>
            </div>


            <nebula-client class="main-footer-nebula" palette="#0ad591 #ff2b75 #ffb833 #0ad591 #0ad591 #4d4aff #0ad591" width="40" height="10">
                <canvas style="filter: contrast(1.5)">
                </canvas></nebula-client>
            <a class="main-footer-top-btn" href="#top" aria-label="Back to top">^</a>
        </footer>
    </div>
    <script defer="" src="/scripts/nebula-main-footer-main-header.js"></script>
    <script defer="">
        (() => {
            const mainHeader = document.querySelector(".main-header");
            const indicator = document.querySelector(".main-header-indicator");

            let currentY = 0;
            let currentYTarget = 0;

            let mouseHovering = false;

            let isTouch = false;
            let lastScrollY = window.scrollY;
            let lastCursorY = 0;
            window.addEventListener("scroll", debounce(onScroll));
            window.addEventListener("mousemove", debounce(onMouseMove, 100));
            window.addEventListener("touchstart", onWindowTouchStart);
            window.addEventListener("touchmove", onWindowTouchMove);
            mainHeader.addEventListener("touchstart", onTouchStart);

            function onScroll(event) {
                const dy = window.scrollY - lastScrollY;

                // move with the page
                currentY -= dy;
                if (currentY > 0) {
                    currentY = 0;
                } else if (currentY < -mainHeader.offsetHeight) {
                    currentY = -mainHeader.offsetHeight;
                }

                currentYTarget = currentY;
                updateDOM();

                lastScrollY = window.scrollY;
            }

            function onMouseMove(event) {
                if (isTouch) return;

                const dy = event.clientY - lastCursorY;

                // show when mouse goes near the top
                const scaledDy = Math.sign(dy) * Math.log1p(Math.abs(dy)) * 20;
                if (dy < 0 && event.clientY + scaledDy < mainHeader.offsetHeight) {
                    currentYTarget = 0;
                    mouseHovering = true;
                } else if (
                    mouseHovering &&
                    dy > 0 &&
                    event.clientY > mainHeader.offsetHeight * 4
                ) {
                    currentYTarget = Math.max(-window.scrollY, -mainHeader.offsetHeight);
                    mouseHovering = false;
                }

                updateDOM();
                lastCursorY = event.clientY;
            }

            function onWindowTouchStart(event) {
                isTouch = true;
                lastCursorY = event.touches[0].clientY;
            }

            function onWindowTouchMove(event) {
                const dy = event.touches[0].clientY - lastCursorY;

                // move with touch but only if at edge
                if (window.scrollY <= 0 && dy > 0) {
                    currentY += dy;
                    if (currentY >= 0) {
                        currentY = 0;
                        document.body.style.overscrollBehaviorY = null;
                    } else if (currentY < 0) {
                        document.body.style.overscrollBehaviorY = "none";
                    }

                    currentYTarget = currentY;
                    updateDOM();
                }

                lastCursorY = event.touches[0].clientY;
            }

            function onTouchStart(event) {
                currentYTarget = 0;
                updateDOM();
                console.log("onTouchStart");
            }

            const updateDOM = debounce(() => {
                mainHeader.style.transform = `translateY(${currentY.toFixed(2)}px)`;

                const isHidden = currentY < -mainHeader.offsetHeight * 0.8;
                mainHeader.classList.toggle("hidden", isHidden);

                if (Math.abs(currentY - currentYTarget) > 1) {
                    currentY += (currentYTarget - currentY) * 0.2;
                    requestAnimationFrame(updateDOM);
                } else {
                    currentY = currentYTarget;
                }
            });

            if (mainHeader.classList.contains("prehide")) {
                document.body.style.overscrollBehaviorY = "none";
                currentY = currentYTarget = -mainHeader.offsetHeight;
                updateDOM();
            }

            function debounce(fn, ms = 0) {
                let recentlyFired = false;
                return (...args) => {
                    if (recentlyFired) return;
                    recentlyFired = true;
                    if (ms === 0) {
                        requestAnimationFrame(() => (recentlyFired = false));
                    } else {
                        setTimeout(() => (recentlyFired = false), ms);
                    }
                    return fn(...args);
                };
            }
        })();
    </script>
    <script defer="" src="/scripts/blog-media.js"></script>
</body>
</html>