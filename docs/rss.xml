<?xml version="1.0" encoding="UTF-8"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0">
    <channel>
        <title><![CDATA[leanrada.com notes]]></title>
        <description><![CDATA[leanrada.com notes]]></description>
        <link>https://leanrada.com</link>
        <generator>RSS for Node</generator>
        
        <atom:link href="https://leanrada.com/rss.xml" rel="self" type="application/rss+xml"/>
        <item>
            <title><![CDATA[AI art is not generative art]]></title>
            <description><![CDATA[
<p><strong>AI art is not <em>generative art</em></strong> (clickbait title). While the technical definition says that one is a subset of the other, I think it‚Äôs useful to distinguish between these two categories.</p>

<p><strong>Why I‚Äôm writing this in the first place ‚Äî</strong> Starting 2022, the term ‚Äúgenerative art‚Äù had been progressively becoming synonymous with art produced by AI text-to-image systems. As a consumer and producer of (traditional) generative art, it was becoming a bit annoying to browse generative art content on the internet. Whether through tags like <code>#generativeart</code> or communities like <code>r/generative</code>, spaces are being flooded with AI-generated images which I and many others are not interested in. End rant.</p>

<p><span>In 2024, things are a bit different. AI art is now commonly referred to as ‚ÄòAI art‚Äô. I shouldn‚Äôt have procrastinated writing this post for so long.</span></p>

<p>There are also cases where generative artists are pressured to relabel their art, so as to not be mistaken for being AI (and avoid the silly AI witch hunts). It‚Äôs an unfortunate niche pressured to be nichey-er.</p>

<p>At this point you may be asking, what‚Äôs the difference anyway? Well, that‚Äôs the point of this post. It‚Äôs kinda like animals vs humans. While technically &amp; scientifically, humans are (a subset of) animals; in daily life ‚Äúanimals‚Äù usually mean non-human animals, as in ‚Äúanimal lover‚Äù and ‚Äúanimal rights‚Äù. I digress.</p>

<h2 id="section-overview">Section overview</h2>

<p>This article looks at the similarities and differences between (traditional) generative art and text-to-image AI art in <span>different</span> <span>angles</span>. Skip to different sections if you want.</p>

<ol>
              <li><a target="_self" href="https://leanrada.com/notes/ai-art-not-generative-art/#history?ref=rss">History</a></li>
              <li><a target="_self" href="https://leanrada.com/notes/ai-art-not-generative-art/#the-craft?ref=rss">Craft</a></li>
              <li><a target="_self" href="https://leanrada.com/notes/ai-art-not-generative-art/#the-process?ref=rss">Process</a></li>
            </ol>

<h2 id="history">History</h2>

<p>Tracing the history of each practice may offer insights and nuance. Don‚Äôt worry, there are pictures! <del>And interactive things!</del> <small>(too lazy to implement interactive things for now)</small></p>

<p><span>This is not a comprehensive history of either field. The dates are probably off by a couple years. Btw, this timeline layout is better viewed on a large screen.</span></p>
1940s

                  The first artificial neural networks were proposed; abstract machines modeled after biological neurons (brain cells).

                
<img srcset="/notes/ai-art-not-generative-art/neurons_664.generated.png 664w" sizes=" 664px" alt="Diagrams of a human neuron and an artificial neuron" src="https://leanrada.com/notes/ai-art-not-generative-art/neurons.png?ref=rss" spec="100% [664) 664" loading="lazy" width="100%" height="">
1950s
<h3>The Perceptron</h3>

<p><a target="_blank" href="https://en.wikipedia.org/wiki/Frank_Rosenblatt">Frank Rosenblatt</a> built a relatively simple neural network that can be trained, called the <em>perceptron</em>.</p>

<p>The perceptron was designed for image recognition. The perceptron looks at some input (an image) and decides from a set of pre-learned classes of images, which kind of image it is.</p>
1960s
<h3>Conceptual art</h3>

<p>Artist <a target="_blank" href="https://en.wikipedia.org/wiki/Sol_LeWitt#Wall_drawings">Sol LeWitt</a> started doing something called wall drawings, sets of instructions that produce abstract drawings. These can be thought of as precursors to generative art.</p>
<blockquote>‚Äú<strong>Wall Drawing #797.</strong> <i>The first drafter has a black marker and makes an irregular horizontal line near the top of the wall. Then the second drafter tries to copy it (without touching it) using a red marker. The third drafter does the same, using a yellow marker. The fourth drafter does the same using a blue marker. Then the second drafter followed by the third and fourth copies the last line drawn until the bottom of the wall is reached.</i>‚Äù</blockquote>
<img srcset="/notes/ai-art-not-generative-art/lewitt_664.generated.jpg 664w" sizes=" 664px" alt="Picture of Wall Drawing #797" src="https://leanrada.com/notes/ai-art-not-generative-art/lewitt.jpg?ref=rss" spec="100% [664) 664" loading="lazy" width="100%" height="">
<span>Product of Wall Drawing #797, executed from instructions written by LeWitt.</span>
<p>"The idea becomes a machine that makes the art." (Paragraphs on Conceptual Art, 1967) It‚Äôs not quite <em>generative art</em> but it‚Äôs close. Besides, LeWitt called it something else: <strong>‚Äòconceptual art‚Äô</strong>.</p>
1960s
<h3>Code art</h3>

<p><a target="_blank" href="https://en.wikipedia.org/wiki/Vera_Moln%C3%A1r">Vera Moln√°r</a> brought us closer to modern generative art by actually using computers and writing code to generate artworks.</p>

<img srcset="/notes/ai-art-not-generative-art/molnar_664.generated.jpg 664w" sizes=" 664px" alt="Picture of art of Vera Moln√°r" src="https://leanrada.com/notes/ai-art-not-generative-art/molnar.jpg?ref=rss" spec="100% [664) 664" loading="lazy" width="100%" height="">
<span>Vera Moln√°r</span>1970s
<h3>AI winter ‚õÑ</h3>

<p>The limitations of relatively primitive AI and weak computing power back then resulted in massive disappointment about AI. Budgets were cut. R&amp;D slowed down. Hype was lost.</p>

<p>The Perceptron did not achieve self-awareness.</p>
1990s
<p>Since 1990s, artists began meeting in generative art conferences and the artistic community started converging on a shared definition of generative art.</p>
<blockquote><strong>Generative art ‚Äî</strong> work that has been produced by the execution, usually by a computer system, of a set of rules or procedures determined by the artist.</blockquote>2010s
<h3>Deep learning</h3>

<p>The intersection of advancements in computing power, improved machine learning algorithms, and huge ever-growing datasets of digital things resulted in bigger and better neural networks. The great potential of AI was reignited. The start of the <strong>deep learning revolution</strong>.</p>

<p>Image recognition, picture captioning, automated language translation, text-to-speech, speech-to-text, etc. got seriously buffed.</p>

<img srcset="/notes/ai-art-not-generative-art/deepdream_664.generated.jpg 664w" sizes=" 664px" alt="Picture of DeepDream output" src="https://leanrada.com/notes/ai-art-not-generative-art/deepdream.jpg?ref=rss" spec="100% [664) 664" loading="lazy" width="100%" height="">
<span>Google‚Äôs DeepDream exploits image recognition feeding into digital pareidolia. It can be considered early AI art, but it‚Äôs quite different from modern AI art.</span>
<h3>Generative networks</h3>

<p>Due to deep learning, we had advancements in generative networks, which are networks that can generate new data on their own instead of simply being a complex input-output mapping.</p>

<p>This appears to be the start of the <strong>image synthesis</strong> wave.</p>

<p>
                    <img srcset="/notes/ai-art-not-generative-art/thisperson_100.generated.jpg 100w" sizes=" 100px" alt="Portrait of a person" src="https://leanrada.com/notes/ai-art-not-generative-art/thisperson.jpg?ref=rss" spec="100"> Here is a fake person generated by a generative adversarial network (GAN) trained specifically on portraits. Tap the face to regenerate a new one from <a target="_blank" href="https://www.thispersondoesnotexist.com/">thispersondoesnotexist.com</a>.
                  </p>
2015
<h3>Text to image</h3>

<p>The first modern text-to-image model was introduced.</p>

<p>It was called <strong>alignDRAW</strong>.</p>

<p>It can generate images from <em>natural language descriptions</em>, making these machines massively accessible as the general public could simply type in what they wanted to see.</p>

<img srcset="/notes/ai-art-not-generative-art/aligndraw_664.generated.jpg 664w" sizes=" 664px" alt="8 blurry images of a white blob on a green background" src="https://leanrada.com/notes/ai-art-not-generative-art/aligndraw.jpg?ref=rss" spec="100% [664) 664" loading="lazy" width="100%" height="">
<span>alignDRAW‚Äôs output for ‚ÄúA toilet seat sits open in
                      the grass field.‚Äù</span>2021
<p><strong><a target="_blank" href="https://en.wikipedia.org/wiki/DALL-E">DALL¬∑E</a></strong> was revealed by OpenAI. Another text-to-image model, and it became famous. (Or, rather it was made famous by ‚ÄúDALL-E mini‚Äù which was <em>viral</em>.)</p>

<img srcset="/notes/ai-art-not-generative-art/dalle_664.generated.png 664w" sizes=" 664px" alt="Image of a toilet seat in a field" src="https://leanrada.com/notes/ai-art-not-generative-art/dalle.png?ref=rss" spec="100% [664) 664" loading="lazy" width="100%" height="">
<span>DALL¬∑E‚Äôs output for ‚ÄúA toilet seat sits open in the grass field.‚Äù</span>2022
<p>Meanwhile, 2022 saw a burst of NFTs, most of which have been associated with generative art.</p>

<p>Honestly, some of them are on the borderline shallow end of generative art, Mad Libs-style images generated from shufflings of pre-drawn hairstyles, sunglasses, and clothes. Automated dress-up. They are more akin to the <a target="_blank" href="https://en.wikipedia.org/wiki/Musikalisches_W%C3%BCrfelspiel">musical dice game</a>.</p>

<img srcset="/notes/ai-art-not-generative-art/apes_664.generated.png 664w" sizes=" 664px" alt="Images resembling the Bored Apes collection of images" src="https://leanrada.com/notes/ai-art-not-generative-art/apes.png?ref=rss" spec="100% [664) 664" loading="lazy" width="100%" height="">
<span>Typical images associated with NFTs</span>2022
<p>Text-to-image models were approaching the quality of real images. Generated artworks were approaching the quality of human art.</p>

<img srcset="/notes/ai-art-not-generative-art/house_664.generated.png 664w" sizes=" 664px" alt="Image of a painting of a house" src="https://leanrada.com/notes/ai-art-not-generative-art/house.png?ref=rss" spec="100% [664) 664" loading="lazy" width="100%" height="">
<span>AI-generated painting</span>2020s
<p>Today, we see different techniques and tools to make generative art, from straight up canvas coding, to frameworks like <a target="_blank" href="https://p5js.org/">p5.js</a>, to full-blown authoring software like <a target="_blank" href="https://derivative.ca/">TouchDesigner</a> and <a target="_blank" href="https://www.sidefx.com/">Houdini</a>.</p>

<img srcset="/notes/ai-art-not-generative-art/qql_664.generated.jpg 664w" sizes=" 664px" alt="Abstract art composed of many non-overlapping small circles" src="https://leanrada.com/notes/ai-art-not-generative-art/qql.jpg?ref=rss" spec="100% [664) 664" loading="lazy" width="100%" height="">
<span>An output of the QQL algorithm which uses the p5.js library</span>2020s
<p>Tools to make AI art and images have been heavily commercialised, with online image generation services provided by OpenAI/Microsoft, Google, and Midjourney. There are also local models for advanced users and tinkerers.</p>

<img srcset="/notes/ai-art-not-generative-art/midjournee_664.generated.png 664w" sizes=" 664px" alt="Screenshot of an online image generator" src="https://leanrada.com/notes/ai-art-not-generative-art/midjournee.png?ref=rss" spec="100% [664) 664" loading="lazy" width="100%" height="">
<span>Microsoft‚Äôs image creator which at the time used the DALL¬∑E 3 model</span>
<p>So. AI art is a relatively new movement borne out of general image synthesizers. This was made possible since visual artworks are images too. Meanwhile, there have been decades of development and refinement in (traditional) generative art, techniques, and algorithms.</p>

<p>The terminology may overlap (generative networks ~ generative art), but these are just labels. You may call them whatever you want, but they‚Äôre still <strong>separate art movements that cannot be historically reconciled</strong>.</p>

<p><span>By the way, I don‚Äôt care if you want to call them ‚Äòart‚Äô or not. That‚Äôs not the point of this post. If it bothers you, please imagine that all instances of the word ‚Äòart‚Äô were replaced with ‚Äòimage‚Äô. Same for the word ‚Äòartist‚Äô.</span></p>

<h2 id="the-craft">The craft</h2>

<p>OK so, whatever sure, history is in the past. Why don‚Äôt we look at it in terms of what artists are doing today. What do they do? What do they practise to improve?</p>

<h3 id="unique-skills">Unique skills</h3>

<p>Both practices involve some unique skills that are not in common with the other. They each have their own defining skills.</p>
<table>
                <tbody>
                  <tr>
                    <th>Generative artists</th>
                    <th>AI artists</th>
                  </tr>
                  <tr>
                    <td>
                      programming<br>
                      math / geometry / trigonometry<br>
                    </td>
                    <td>
                      prompting<br>
                      curation / training<br>
                      data science<br>
                    </td>
                  </tr>
                </tbody>
              </table>
<p><strong>Generative art</strong> involves programming and uses math (usually geometry or trigonometry) to create graphics. A good undertanding of functions and their domains and ranges and how they compose together is essential, especially when utilising random number generators.</p>

<img srcset="/notes/ai-art-not-generative-art/math_664.generated.png 664w" sizes=" 664px" alt="" src="https://leanrada.com/notes/ai-art-not-generative-art/math.png?ref=rss" spec="100% [664) 664" loading="lazy" width="100%" height="">
<span>Typical generative art math</span>
<p>Beyond these core skills, there are a lot of areas generative artists could expand into, like graph theory, simulations, fractals, image processing, and other algorithms.</p>

<img srcset="/notes/ai-art-not-generative-art/pathways_664.generated.png 664w" sizes=" 664px" alt="" src="https://leanrada.com/notes/ai-art-not-generative-art/pathways.png?ref=rss" spec="100% [664) 664" loading="lazy" width="100%" height="">
<span><span slot="caption">
                  <a target="_blank" href="https://www.fxhash.xyz/generative/slug/scattered-pathways">Scattered Pathways</a> by Nate Nolting.<br>Generative art using a graph pathfinding algorithm
                </span></span>
<p><strong>AI art</strong>, on the other hand, is heavy on prompt engineering. It could be as simple as writing English descriptions, or as precise as inputting parameterised labels if the tool allows for it.</p>
<b><u>Prompt:</u></b> Dog, (Artist Name, Artist Name), Masterpiece, Studio Quality, 6k, glowing, axe, mecha, science_fiction, solo, weapon, jungle, green_background, nature, outdoors, solo, tree, weapon, mask, dynamic lighting, detailed shading, digital texture painting
              <br><b><u>Negative prompt:</u></b> un-detailed skin, semi-realistic, cgi, 3d, render, sketch, cartoon, drawing, ugly eyes, (out of frame:1.3), worst quality, low quality, jpeg artifacts, cgi, sketch, cartoon, drawing, (out of frame:1.1)
              <br><b><u>Parameters:</u></b> Steps: 50, Sampler: Euler a, CFG scale: 7.0, Seed: 1579799523, Face restoration, Size: 512x512

            <span>Example prompt with advanced parameters (e.g. for StableDiffusion)</span>
<p>Beyond writing prompts, there are several tools that allow more control like influencing certain compositional elements. AI artists could also train or fine-tune models by curating image-label datasets as extra training data.</p>

<img srcset="/notes/ai-art-not-generative-art/control_664.generated.png 664w" sizes=" 664px" alt="" src="https://leanrada.com/notes/ai-art-not-generative-art/control.png?ref=rss" spec="100% [664) 664" loading="lazy" width="100%" height="">
<span><span slot="caption">
                  Images generated with <a target="_blank" href="https://github.com/lllyasviel/ControlNet">ControlNet</a>, controlling the general shape of the subject.
                </span></span>
<p>There seems to be little to no transferable skills between these practices. Sure, you can program some scripts to automate parts of an AI art workflow, or add an AI filter step to an otherwise procedurally-generated image. But there is no inherent overlap.</p>

<p>At the highest level, it is the difference between computer science vs data science. At the lowest, it is the difference between coding and writing English.</p>

<p>That‚Äôs why you can‚Äôt just ask an AI artist to please create an interactive audio-reactive visualisation for your music video, or <a target="_blank" href="https://www.cityartsydney.com.au/artwork/high-water/">a public art installation that reacts to the weather</a>. Likewise, you can‚Äôt expect a generative artist to easily generate photorealistic art in seconds.</p>

<h3 id="skills-in-common">Skills in common</h3>

<p>One big thing that‚Äôs common between these practices is the need to curate. Since both practices involve chaos and randomness, a curation step is almost always required before finishing a work. Curation requires artistic vision, which could be considered a skill in itself.</p>
<table aria-label="Venn-diagram showing curation &amp; artistic vision in the intersection between Generative artists and AI artists">
                <tbody>
                  <tr>
                    <td>
                      <b>Generative<br>artists</b>
                    </td>
                    <td>
                      <div>
                        curation<br>
                        artistic vision
                      </div>
                    </td>
                    <td>
                      <b>AI<br>artists</b>
                    </td>
                  </tr>
                </tbody>
              </table>
<p><strong>What‚Äôs curation?</strong> As one finishes a piece, they usually generate multiple outputs by running the process with different seeds or starting parameters. These produce different variations, from which the best one(s) are selected for publishing, discarding the rest. That‚Äôs curation.</p>

<p>Alternatively, you might refine and iterate your prompt / program until the generated outputs satisfy your artistic vision.</p>

<img srcset="/notes/ai-art-not-generative-art/uncurated_664.generated.png 664w" sizes=" 664px" alt="" src="https://leanrada.com/notes/ai-art-not-generative-art/uncurated.png?ref=rss" spec="100% [664) 664" loading="lazy" width="100%" height="">
<span>Uncurated set of outputs from a generative art algorithm</span>
<img srcset="/notes/ai-art-not-generative-art/ai-outputs_664.generated.png 664w" sizes=" 664px" alt="" src="https://leanrada.com/notes/ai-art-not-generative-art/ai-outputs.png?ref=rss" spec="100% [664) 664" loading="lazy" width="100%" height="">
<span>AI image generators usually generate multiple outputs at a time for you to curate.</span>
<p>It could be argued that having artistic vision and doing iterations are pretty common to all arts, and so those alone don‚Äôt make generative art and AI art any more similar to each other than any other art.</p>

<p><span><strong>Disclaimer:</strong> I‚Äôm not very good at AI image generation. I don‚Äôt have first-hand experience of the advanced skills that I mentioned like fancy prompt engineering or fine-tuning. (Though I did train a different type of <a target="_blank" href="https://leanrada.com/wares/pong-ai?ref=rss">neural network</a> before).</span></p>

<p>Overall, the significant differences in skillsets mean that <strong>generative artists and AI artists are not interchangeable</strong>, and the same should go for their respective arts.</p>

<h2 id="the-process">The process</h2>

<p>Finally, let‚Äôs attack the subject from the POV of processes and systems.</p>

<p>Setting aside the question of whether Art is Product or Process, let us indulge in these animations of art in the process of being products.</p>

<video src="https://leanrada.com/notes/ai-art-not-generative-art/diffusion.mp4?ref=rss" muted="" autoplay="" loop="" aria-label="">
                  Video: | Source: /notes/ai-art-not-generative-art/diffusion.mp4
                </video>
<span>AI art being formed via denoising</span>
<video src="https://leanrada.com/notes/ai-art-not-generative-art/flowers.mp4?ref=rss" muted="" autoplay="" loop="" aria-label="">
                  Video: | Source: /notes/ai-art-not-generative-art/flowers.mp4
                </video>
<span>Generative art being formed via procedural strokes</span>
<p>Most modern AI image generators are based on diffusion models ‚Äî they form images via <strong>‚Äòdenoising‚Äô</strong>. The animation above (left) shows the sequence of steps to progressively denoise a pure noise image into something coherent based on a prompt. The prompt for the above generation specifically was <i>‚Äòcherry blossom branches against a clear blue sky‚Äô</i>.</p>

<p>The denoising process is a black box, an inscrutable network of billions of artificial neurons trained to generate coherent arrays of pixels.</p>

<p>Generative art algorithms, on the other hand, are relatively more hand-crafted, less magical. Explicit instructions are written to draw every element in the piece. This is apparent in the above animation (right) where each stroke is individually drawn according to the artist‚Äôs rules. <i>This particular animation was from <strong><a target="_blank" href="https://www.fxhash.xyz/generative/slug/the-soul-of-flowers">The Soul of Flowers</a></strong> by Che-Yu Wu.</i></p>

<p>In fact, it‚Äôs impossible to not have total control of the art because programming is precise. You have to artificially create <em>whim</em> (i.e. randomness) to produce dynamic results. For example, a quivering brush stroke must be backed by a mathematical rule such as Gaussian or Brownian noise.</p>

<p>It comes down to the explainability or transparency of the process. One is a black box. The other is literally the instructions to create the art. The level of control is just a consequence of the intelligibility of the process. It‚Äôs easier to control something that is understandable.</p>

<p>On an opposite note, AI artists can be thought of as high-level artistic directors who don‚Äôt concern themselves with the rendering of mid- to low-level details. Unlike AI art, generative artists must always specify the exact procedure for both the broad strokes and the fine details.</p>

<h3 id="system-diagrams">System diagrams</h3>

<p>Beyond the processes themselves, art interacts with the context of its creation. And there is a lot to unpack here, especially for AI art. I‚Äôll use diagrams to illustrate the context of the creation process.</p>

<img srcset="/notes/ai-art-not-generative-art/gen-system_664.generated.png 664w" sizes=" 664px" alt="" src="https://leanrada.com/notes/ai-art-not-generative-art/gen-system.png?ref=rss" spec="100% [664) 664" loading="lazy" width="100%" height="">
<span>The generative artist writes the program that renders the piece of art</span>
<p><strong>In the generative art process,</strong> there are three components at the minimum: the artist, the program, and the rendered output.</p>

<p>They may use libraries or frameworks as part of the program, but the artist ultimately writes the specific steps or rules which the program would execute at a certain level of abstraction.</p>

<img srcset="/notes/ai-art-not-generative-art/ai-system_664.generated.png 664w" sizes=" 664px" alt="" src="https://leanrada.com/notes/ai-art-not-generative-art/ai-system.png?ref=rss" spec="100% [664) 664" loading="lazy" width="100%" height="">
<span>The AI artist prompts the model trained from the dataset to produce the piece of art</span>
<p><strong>In AI art,</strong> there are four components to the process at the minimum: the artist, the model, the rendered output, and <em>the dataset</em>.</p>

<p>Comparing the generative art process with the AI art process, there is an immediate difference. Unlike AI art, <strong>generative art don‚Äôt need datasets</strong>.</p>

<p>And it‚Äôs a controversial thing, <strong>the dataset</strong>. The data used to train a text-to-image model can consist of billions of images, usually scraped from the internet and includes other artworks by other artists.</p>

<p>If you consider that the model has been influenced by a lot of other images on the web, then the question of how important the AI artist‚Äôs influence over the final piece is raised. <em>Was that chiaroscuro an artistic choice, or an emergent byproduct of the model? Were those bold paint strokes intentional, or just some style produced by the model?</em></p>

<p>In AI art, there is confusion over which elements were expressed by the artist and which by the machine. Utlimately, there comes a question of who worked out the art of the artwork.</p>

<p>Leaving the contentious topic of datasets aside, there is another point, but not as essential, of <strong>who authored the main program</strong>. Who created the most crucial piece of the system?</p>

<p>Generative art programs are usually created by the artists themselves, while AI art programs are usually created by AI researchers (plus datasets), only to be used as a product by AI artists. One makes the machine that makes the art, the other uses a machine to make the art.</p>

<p>Of course, AI artists could train (not just fine-tune!) their own models, if they have a big enough dataset and some machine learning know-how. That‚Äôs why I said it‚Äôs not an essential point.</p>

<h2 id="conclusion">Conclusion</h2>

<p>The point is that these are separate <em>art mediums</em>. Or <em>art movements</em>, if you will. The histories, the crafts, and the processes point to the same conclusion ‚Äî they are no more similar than oil painting is to photography, or a film director to an animator.</p>

<p><span>Some aspects of the post have probably been outdated by the time I publish this post. I‚Äôll still include them in the post because why not. The stand may be pointless, but the points still stand.</span></p>

<p>P.S. a similar thing: <a target="_blank" href="https://cryptoisnotcryptocurrency.com">cryptoisnotcryptocurrency.com</a>, <a target="_blank" href="https://en.wikipedia.org/wiki/Crypto_naming_controversy">Wikipedia article</a>.</p>

<p><span>P.P.S. I‚Äôm still refining this post. Let‚Äôs say it‚Äôs in Beta.</span>
            </p>
]]></description>
            <link>https://leanrada.com/notes/ai-art-not-generative-art?ref=rss</link>
            <guid isPermaLink="true">https://leanrada.com/notes/ai-art-not-generative-art?ref=rss</guid>
            <pubDate>Mon, 25 Mar 2024 00:00:00 GMT</pubDate>
        </item>
        <item>
            <title><![CDATA[
              
                htmz story
              
            ]]></title>
            <description><![CDATA[
<p>This post is not the usual programming post. It‚Äôs been an interesting week, I guess.</p>

<p>I just finished my mini side-project <a target="_blank" href="https://leanrada.com/leanrada.com/htmz?ref=rss"><strong>htmz</strong></a>, a snippet / library / microframework / whatever for HTML whose main feature was that it only weighed a total of <strong>181 bytes</strong>. It almost fits inside a single ‚Äòtweet‚Äô (wait, the limit is now 280 not 140?).</p>

<p>Here is the entire framework in its final form:</p>

<pre><code><span><span><span>&lt;</span>iframe</span> <span>hidden</span> <span>name</span><span><span>=</span>htmz</span> <span><span>onload</span><span><span>=</span><span>"</span><span><span>setTimeout</span><span>(</span><span>(</span><span>)</span><span>=&gt;</span>
document<span>.</span><span>querySelector</span><span>(</span>contentWindow<span>.</span>location<span>.</span>hash<span>||</span><span>null</span><span>)</span>
<span>?.</span><span>replaceWith</span><span>(</span><span>...</span>contentDocument<span>.</span>body<span>.</span>childNodes<span>)</span><span>)</span></span><span>"</span></span></span><span>&gt;</span></span><span><span><span>&lt;/</span>iframe</span><span>&gt;</span></span></code></pre>

<p>See the <a target="_blank" href="https://leanrada.com/leanrada.com/htmz?ref=rss">project documentation</a> for more info on what it does.</p>

<p>I <a target="_blank" href="https://news.ycombinator.com/item?id=39429370">posted it on Hacker News</a>, went to sleep because it was 3am at that point. Then the next morning it was at the top of HN!</p>

<img srcset="/notes/htmz-story/hn_585.generated.png 585w,/notes/htmz-story/hn_664.generated.png 664w" sizes="not (min-width:664px) 585px, 664px" alt="screenshot of HN. Stories from February 19, 2024. 1. Show HN: htmz ‚Äì a low power tool for HTML (leanrada.com). 1017 points by Kalabasa 9 days ago | 242 comments" src="https://leanrada.com/notes/htmz-story/hn.png?ref=rss" spec="100% [664) 664" loading="lazy" width="100%" height="">

<p>I didn‚Äôt expect this at all. But naturally I rushed to the comments section which quickly grew too numerous for me to read. They were generally positive, and acknowledged the project‚Äôs hackyness and elegance (these adjectives usually mean opposite things). It was pretty cool! The top comment in the thread sums it up.</p>

<p>A bunch of common themes were raised. I guess I‚Äôll write about them in this post.</p>

<h2 id="why-htmz">Why htmz?</h2>

<p>htmz was initially inspired by <a target="_blank" href="https://htmx.org/">htmx</a>, another web library/framework. One of htmx‚Äôs main features was that it provides the capability for any element, not just the entire window, to be the target for update by an HTTP request (e.g. by clicking a link you load a partial HTML update to the page).</p>

<img srcset="/notes/htmz-story/htmx_573.generated.png 573w,/notes/htmz-story/htmx_664.generated.png 664w" sizes="not (min-width:664px) 573px, 664px" alt="Why should you only be able to replace the entire screen? By removing these constraints, htmx completes HTML as a hypertext." src="https://leanrada.com/notes/htmz-story/htmx.png?ref=rss" spec="100% [664) 664" loading="lazy" width="100%" height="">

<p>I wondered for a bit then remembered that we already have <strong>iframes</strong>, a native HTML way for links to update not just the entire window, but a ‚Äòpart‚Äô of the page. Granted, iframes are limited and not as dynamic as some of htmx‚Äôs operations like appends and deletions.</p>

<p>So I set out to make an iframe-only solution to this class of problems. htmz initially stood for <strong>‚Äòhtmx zero‚Äô</strong> or something like that, because you need exactly zero JavaScript to be able to use iframes, while htmx stood at around 16 kB compressed (decompresses to a total of 48 kB of JavaScript!).</p>

<h2 id="principles">Principles</h2>

<p>The initial premise was that browsers already offer much of the required functionality out of the box. Unfortunately, iframes have lots of limitations and a bit of JS is needed after all. As the solution evolved, I needed to keep the amount of JS in check, otherwise I‚Äôd just reinvent existing libraries.</p>

<p>The main principle became ‚Äúlean on existing browser functionality‚Äù. This meant, among other things:</p>

<ul>
              <li><strong>No click handlers.</strong> Browsers can handle clicks by themselves. No need for JS to intercept and babysit every interaction.</li>
              <li><strong>No AJAX / fetch.</strong> Browsers can fetch HTML resources by themselves. In fact, this is a primary function of a browser!</li>
              <li><strong>No DOM parsing.</strong> Browsers can load HTML by themselves. In fact, this is a primary function‚Ä¶</li>
              <li><strong>No extra attributes.</strong> Scanning for and parsing extra attributes is a lot of JS.</li>
            </ul>

<p>I ended up with minimal JS that transplants content from the iframe into the main document. That was the only thing browsers don‚Äôt do (yet).</p>

<p>The only exception to this rule was the <code>setTimeout</code> wrapper which is to prevent browsers from automatically scrolling to the updated content on click. (It‚Äôs optional!)</p>

<p>Since the solution was not zero JS anymore, htmz was backronymised as <em><b>H</b>tml with <b>T</b>argeted <b>M</b>anipulation <b>Z</b>ones</em>.</p>

<h2 id="was-it-a-joke">Was it a joke?</h2>

<p><em>(short answer: maybe)</em></p>

<p>Starting with the name itself, htmz sounded like a parody of the more popular htmx. I thought it was obvious that this project was just a fun hack to share.</p>

<p>But some people took it too seriously. I know, this is HN, where serious startups and stuff are posted daily. Or rather, this is the Internet.</p>

<p>I was reminded of <a target="_blank" href="https://en.wikipedia.org/wiki/Poe%27s_law">Poe‚Äôs law</a>. On the other hand, the initial documentation for the project did give mixed vibes (it was a half-joke half-solution project after all). And the marketing bits were too good for the project‚Äôs own good.</p>

<img srcset="/notes/htmz-story/logo_200.generated.png 200w,/notes/htmz-story/logo_664.generated.png 664w" sizes="not (min-width:664px) 200px, 664px" alt="" src="https://leanrada.com/notes/htmz-story/logo.png?ref=rss" spec="100% [664) 664" loading="lazy" width="100%" height="">
<span>This project has a favicon while htmx.org has none. Marketing overload! But really, I just enjoy polishing the little details in projects.</span>
<p>Orrr maybe I‚Äôm the only one who finds humour in a section called ‚ÄòInstalling‚Äô that, instead of telling you to install a package, tells you to simply copy a snippet. Orrr what about when ‚ÄòExtensions‚Äô are not plugins but code you actually have to write yourself‚Ä¶ Ha! Get it? üòÇüòÇüòÇ Subversion of expectations, anyone? No? OK, fine‚Ä¶</p>

<p>In any case, I had my fun writing these aspects of the project!</p>

<p>I made an npm package for good measure:</p>

<img srcset="/notes/htmz-story/npm_597.generated.png 597w,/notes/htmz-story/npm_664.generated.png 664w" sizes="not (min-width:664px) 597px, 664px" alt="For npm enjoyers, use the following npm commands to automate the simple process of copying the snippet. For maximum npm enjoyment, this npm package contains 25 bonus dependencies!" src="https://leanrada.com/notes/htmz-story/npm.png?ref=rss" spec="100% [664) 664" loading="lazy" width="100%" height="">

<h2 id="code-golfing">Code golfing</h2>

<p>Some commenters pointed out insights which led to significant reductions in the size of the snippet. Some even made pull requests, that I reviewed and merged (Am I an ‚Äòopen-source maintainer‚Äô yet?).</p>

<p>My initial release started with <strong>181</strong> bytes:</p>

<pre><code><span><span><span>&lt;</span>iframe</span> <span>hidden</span> <span>name</span><span><span>=</span>htmz</span> <span><span>onload</span><span><span>=</span><span>"</span><span><span>setTimeout</span><span>(</span><span>(</span><span>)</span><span>=&gt;</span>
document<span>.</span><span>querySelector</span><span>(</span><span>this</span><span>.</span>contentWindow<span>.</span>location<span>.</span>hash<span>||</span><span>':not(*)'</span><span>)</span>
<span>?.</span><span>replaceWith</span><span>(</span><span>...</span><span>this</span><span>.</span>contentDocument<span>.</span>body<span>.</span>childNodes<span>)</span><span>)</span></span><span>"</span></span></span><span>&gt;</span></span><span><span><span>&lt;/</span>iframe</span><span>&gt;</span></span></code></pre>

<p>Turns out <code>':not(*)'</code> is <em>not</em> necessary as a selector fallback. <code>querySelector</code> can accept null! Down to <strong>176</strong> bytes:</p>

<pre><code><span><span><span>&lt;</span>iframe</span> <span>hidden</span> <span>name</span><span><span>=</span>htmz</span> <span><span>onload</span><span><span>=</span><span>"</span><span><span>setTimeout</span><span>(</span><span>(</span><span>)</span><span>=&gt;</span>
document<span>.</span><span>querySelector</span><span>(</span><span>this</span><span>.</span>contentWindow<span>.</span>location<span>.</span>hash<span>||</span><span>null</span><span>)</span>
<span>?.</span><span>replaceWith</span><span>(</span><span>...</span><span>this</span><span>.</span>contentDocument<span>.</span>body<span>.</span>childNodes<span>)</span><span>)</span></span><span>"</span></span></span><span>&gt;</span></span><span><span><span>&lt;/</span>iframe</span><span>&gt;</span></span></code></pre>

<p>Apparently, <code>this</code> is also unnecessary within inline attribute scripts when referring to the element it‚Äôs attached to. Now down to <strong>166</strong> bytes (its final form as of today):</p>

<pre><code><span><span><span>&lt;</span>iframe</span> <span>hidden</span> <span>name</span><span><span>=</span>htmz</span> <span><span>onload</span><span><span>=</span><span>"</span><span><span>setTimeout</span><span>(</span><span>(</span><span>)</span><span>=&gt;</span>
document<span>.</span><span>querySelector</span><span>(</span>contentWindow<span>.</span>location<span>.</span>hash<span>||</span><span>null</span><span>)</span>
<span>?.</span><span>replaceWith</span><span>(</span><span>...</span>contentDocument<span>.</span>body<span>.</span>childNodes<span>)</span><span>)</span></span><span>"</span></span></span><span>&gt;</span></span><span><span><span>&lt;/</span>iframe</span><span>&gt;</span></span></code></pre>

<p>That‚Äôs about 90% of the original! I‚Äôm pretty sure this could be reduced further (<code>setTimeout</code> isn‚Äôt strictly required) but I left it as it was. This code golfing diversion has been fun and I learned about HTML spec stuff that I wouldn‚Äôt normally discover in my day job as a React framework user.</p>

<h2 id="knowledge-sharing">Knowledge sharing</h2>

<p>Some commenters shared similar approaches and techniques. Some tips / workarounds on how to best utilise the snippet were thrown around. There were even discussions in the project‚Äôs Issue tracker on GitHub.</p>

<p><span>For one, the new <a target="_blank" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Sec-Fetch-Dest">Sec-Fetch-Dest</a> header that someone mentioned is pretty cool. It lets the server know if the request is for an iframe or for a new tab, etc. Pretty handy for <em>hypertext</em> servers!</span></p>

<p>I learned lots and, not wanting to get these learnings lost into the archives, incorporated these tips into the main documentation, into the examples/demos, and some even became real-ish <a target="_blank" href="https://leanrada.com/leanrada.com/htmz/extensions?ref=rss">extensions</a>:</p>

<img srcset="/notes/htmz-story/extensions_621.generated.png 621w,/notes/htmz-story/extensions_664.generated.png 664w" sizes="not (min-width:664px) 621px, 664px" alt="Screenshot of the Extensions page" src="https://leanrada.com/notes/htmz-story/extensions.png?ref=rss" spec="100% [664) 664" loading="lazy" width="100%" height="">

<p>It‚Äôs a multi-way exchange. htmz and its iframe shenanigans have apparently inspired the creation of new HTML frameworks, such as <a target="_blank" href="https://github.com/joeldrapper/morphlex">morphlex</a> and <a target="_blank" href="https://github.com/callionica/htmf">htmf</a>. I also saw people taking the idea into different directions, like using <a target="_blank" href="https://zenn.dev/kawarimidoll/articles/33316cf9caa465">iframes to lazy-load HTML partials</a>. I feel happy about having inspired people! There are even some who said so via the <a target="_self" href="https://leanrada.com/guestbook?ref=rss">guestbook</a>, which was especially nice!</p>

<h2 id="future">Future</h2>

<p>I think the htmz story is done and I‚Äôm already looking forward to my next project (the 7DRL challenge). It‚Äôs still getting some mentions in blogs, podcasts, here and there, but it‚Äôs not like I‚Äôm gonna turn this into some serious full-time open-source project with versions and releases and (lack of) funds and all that jazz.</p>

<p>GitHub activity (stars, issues, PRs) have slowed down as well. There‚Äôs not much you can work with 166 characters, after all.</p>

<p>But the idea lives on; may the snippet proliferate! :D</p>

<img srcset="/notes/htmz-story/stars_664.generated.png 664w" sizes=" 664px" alt="Chart of htmz‚Äôs number of GitHub stars over time" src="https://leanrada.com/notes/htmz-story/stars.png?ref=rss" spec="100% [664) 664" loading="lazy" width="100%" height="">
]]></description>
            <link>https://leanrada.com/notes/htmz-story?ref=rss</link>
            <guid isPermaLink="true">https://leanrada.com/notes/htmz-story?ref=rss</guid>
            <pubDate>Fri, 01 Mar 2024 00:00:00 GMT</pubDate>
        </item>
        <item>
            <title><![CDATA[Pure CSS single-page app routing]]></title>
            <description><![CDATA[
<p>You‚Äôre probably a busy person, so here‚Äôs the CSS:</p>

<pre><code><span>section:not(:target)</span> <span>{</span>
  <span>display</span><span>:</span> none<span>;</span>
<span>}</span></code></pre>

<p><strong>Demo:</strong> <a target="_blank" href="https://leanrada.com/notes/pure-css-spa-router/example1?ref=rss">Open in a new tab</a>
            </p>
<iframe src="example1/"></iframe>My App<a target="_blank" href="https://leanrada.com/notes/pure-css-spa-router/example1?ref=rss">Open in a new tab</a>
<h2 id="explanation">Explanation</h2>

<p>The <a target="_blank" href="https://developer.mozilla.org/en-US/docs/Web/CSS/:target"><code>:target</code></a> CSS selector selects the element that is targeted by the URL fragment.</p>

<p>Combined with <code>:not</code>, we can hide sections that are <em>not</em> referenced by the URL fragment.</p>

<p>Just as JS routers use the fragment to hide/show sections in the DOM, this ‚ÄúCSS router‚Äù uses the same fragment to hide/show sections in the DOM.</p>

<h2 id="experiment-default-section">Experiment: Default section</h2>

<p>Notice that the example above doesn‚Äôt start with the Home section. The content is blank initially. This is because on initial page load we don‚Äôt have a URL fragment to begin with.</p>

<p>We need to make an exception for the Home section.</p>

<p>Let‚Äôs start by not hiding the <code>#home</code> section by default. Only hide <code>#home</code> if there‚Äôs a specific <code>:target</code> section.</p>

<pre><code><span><span>-</span><span> section:not(:target) {
</span></span><span><span>+</span><span> section:not(#home, :target),
</span><span>+</span><span> :root:has(:target) #home {
</span></span><span><span> </span><span>   display: none;
</span><span> </span><span> }</span></span></code></pre>

<p><strong>Demo v2:</strong> <a target="_blank" href="https://leanrada.com/notes/pure-css-spa-router/example2?ref=rss">Open in a new tab</a>
            </p>
<iframe src="example2/"></iframe>My App<a target="_blank" href="https://leanrada.com/notes/pure-css-spa-router/example2?ref=rss">Open in a new tab</a>
<h2 id="experiment-nested-routes">Experiment: Nested routes</h2>

<p>One thing that makes most client-side routers modular is the ability to nest routes. We can do the same with CSS.</p>

<pre><code><span><span>-</span><span> section:not(:target) {
</span></span><span><span>+</span><span> section:not(:target, :has(:target)) {
</span></span><span><span> </span><span>   display: none;
</span><span> </span><span> }</span></span></code></pre>

<p><strong>Demo v3: This demo is best when you <a target="_blank" href="https://leanrada.com/notes/pure-css-spa-router/example3?ref=rss">view it in a separate tab</a></strong>
            </p>
<iframe src="example3/"></iframe>My App<a target="_blank" href="https://leanrada.com/notes/pure-css-spa-router/example3?ref=rss">Open in a new tab</a>
<h2 id="parameterised-routes">Parameterised routes?</h2>

<p>The ultimate feature for client-side routers is to dynamically catch routes with parameters like for example <code>/post/:id</code>.</p>

<p>Since HTML is static, there‚Äôs no real way to do this with CSS. ‚òπ</p>

<p>Unless‚Ä¶ you could render all possible <code>:id</code> values in the markup and use it like you would nested routes.</p>

<pre><code><span>&lt;!-- ... --&gt;</span>
<span><span><span>&lt;</span>section</span> <span>id</span><span><span>=</span><span>"</span>post/128<span>"</span></span><span>&gt;</span></span><span>&lt;!-- ... --&gt;</span><span><span><span>&lt;/</span>section</span><span>&gt;</span></span>
<span><span><span>&lt;</span>section</span> <span>id</span><span><span>=</span><span>"</span>post/129<span>"</span></span><span>&gt;</span></span><span>&lt;!-- ... --&gt;</span><span><span><span>&lt;/</span>section</span><span>&gt;</span></span>
<span><span><span>&lt;</span>section</span> <span>id</span><span><span>=</span><span>"</span>post/130<span>"</span></span><span>&gt;</span></span><span>&lt;!-- ... --&gt;</span><span><span><span>&lt;/</span>section</span><span>&gt;</span></span>
<span>&lt;!-- ... --&gt;</span></code></pre>

<p>But that‚Äôd be like putting the entire database in HTML. And if you had multiple parameters in the route, it would be combinatorial explosion. So, nope. üëã
            </p>
]]></description>
            <link>https://leanrada.com/notes/pure-css-spa-router?ref=rss</link>
            <guid isPermaLink="true">https://leanrada.com/notes/pure-css-spa-router?ref=rss</guid>
            <pubDate>Tue, 27 Feb 2024 00:00:00 GMT</pubDate>
        </item>
        <item>
            <title><![CDATA[getDuolingoStreak()]]></title>
            <description><![CDATA[
<p>How to fetch your Duolingo streak using an unconfirmed API on duolingo.com:</p>

<pre><code><span>function</span> <span>getDuolingoStreak</span><span>(</span><span>username</span><span>)</span> <span>{</span>
  <span>const</span> res <span>=</span> <span>await</span> <span>fetch</span><span>(</span>
    <span><span>`</span><span>https://www.duolingo.com/2017-06-30/users?username=</span><span><span>${</span>username<span>}</span></span><span>&amp;fields=streak,streakData%7BcurrentStreak,previousStreak%7D%7D</span><span>`</span></span>
  <span>)</span><span>;</span>
  <span>const</span> data <span>=</span> <span>await</span> res<span>.</span><span>json</span><span>(</span><span>)</span><span>;</span>
  <span>const</span> userData <span>=</span> data<span>.</span>users<span>[</span><span>0</span><span>]</span><span>;</span>
  <span>// I didn't know which of these fields matter, so I just get the max of them.</span>
  <span>const</span> streak <span>=</span> Math<span>.</span><span>max</span><span>(</span>
    userData<span>?.</span>streak <span>??</span> <span>0</span><span>,</span>
    userData<span>?.</span>streakData<span>?.</span>currentStreak<span>?.</span>length <span>??</span> <span>0</span><span>,</span>
    userData<span>?.</span>streakData<span>?.</span>previousStreak<span>?.</span>length <span>??</span> <span>0</span>
  <span>)</span><span>;</span>
  <span>return</span> streak<span>;</span>
<span>}</span></code></pre>

                134
<img alt="" src="https://leanrada.com/misc/streak.png?ref=rss" loading="lazy">
This card is live ;)<br>That‚Äôs my current max streak.
<p>I can then render this data into a card like that. I put one of these cards in the <a target="_self" href="https://leanrada.com/misc?ref=rss">/misc/</a> section.</p>

<p>Let‚Äôs look at the API itself. <code>www.duolingo.com/2017-06-30</code> seems to be the API prefix, which is a bit weird. What is <code>2017-06-30</code>? <a target="_blank" href="https://en.wikipedia.org/wiki/Portal:Current_events/2017_June_30">What happened on that date?</a> Maybe the Duolingo team used <a target="_blank" href="https://calver.org/">a date-based versioning</a> at the time?</p>

<p>In any case, big thanks to the Duolingo team for keeping this apparently-6-year-old public API alive and accessible.</p>

<p>The query parameters for the <code>/users</code> endpoint are interesting. It‚Äôs similar to <a target="_blank" href="https://graphql.org/">GraphQL</a> where you can specify exactly which fields you want in the response. You can even specify specific sub-fields within objects, using some kind of a DSL in the <code>fields</code> parameter.</p>

<p>The <code>fields</code> parameter in the above query, when decoded, is <code>fields=streak,streakDate{currentStreak,previousStreak}}</code>. Fields are comma-delimited and objects are enclosed in braces. This could actually be GraphQL! There is an extra closing brace at the end which seems necessary for the request to be successful.
            </p>
]]></description>
            <link>https://leanrada.com/notes/get-duolingo-streak?ref=rss</link>
            <guid isPermaLink="true">https://leanrada.com/notes/get-duolingo-streak?ref=rss</guid>
            <pubDate>Wed, 07 Feb 2024 00:00:00 GMT</pubDate>
        </item>
        <item>
            <title><![CDATA[Writing a single-file website with Rust]]></title>
            <description><![CDATA[
<p>At the company I work for, there is something called a ‚Äúprofessional education leave‚Äù, which lets me take a day off to learn something new or attend conferences or whatever professional education means. I took the opportunity to learn the <a target="_blank" href="https://www.rust-lang.org/"><strong>Rust</strong></a> programming language.</p>

<p>I didn‚Äôt want to follow tutorials, so I thought of a project to learn with, which ended up being ‚Äúmake a single-file website web server‚Äù. It was inspired by the article <a target="_blank" href="https://j3s.sh/thought/my-website-is-one-binary.html"><strong>my website is one binary</strong> by j3s</a>.</p>

<h2 id="rust-first-impressions">Rust first impressions</h2>

<pre><code>fn <span>main</span><span>(</span><span>)</span> <span>{</span>
  println<span>!</span><span>(</span><span>"Hello World!"</span><span>)</span><span>;</span>
<span>}</span></code></pre>

<p>My first impression was that it is a mature programming language that is crazy about compile-time stuff. For example, the above <code>println!</code> call is a <em>macro</em>, which expands to something more verbose‚Ä¶ Apparently, with macros you can also make full-blown <a target="_blank" href="https://doc.rust-lang.org/rust-by-example/macros/dsl.html">DSL</a>s that are directly embedded in Rust code.</p>

<p>The <code>rustc</code> compiler‚Äôs error messages were very good.</p>

<p>I think I haven‚Äôt really dived deep enough to discover the standout features that I keep hearing about like memory management safety. So unfortunately I didn‚Äôt get the hype at this time.</p>

<h2 id="building-a-web-server">Building a web server</h2>

<p>The standard Rust library provides a TCP module, but no HTTP one. So it‚Äôs a level lower than NodeJS, which is understandable.</p>

<p>I didn‚Äôt want to implement the HTTP protocol, so I searched for an HTTP library.</p>

<p>I found <a target="_blank" href="https://github.com/tomaka/rouille"><strong>rouille</strong></a>, a web micro-framework. I installed it via <code>cargo</code> which is like <code>npm</code> but for Rust.</p>

<p>It was really easy to get it set up and running.</p>

<p>For starters, I made two pages: <code>/</code> and <code>/about</code>.</p>

<pre><code><span>// main.rs</span>
use rouille<span>:</span><span>:</span>Response<span>;</span>
use rouille<span>:</span><span>:</span>router<span>;</span>

mod pages <span>{</span>
  pub mod index<span>;</span>
  pub mod about<span>;</span>
<span>}</span>

fn <span>main</span><span>(</span><span>)</span> <span>{</span>
  rouille<span>:</span><span>:</span><span>start_server</span><span>(</span><span>"0.0.0.0:8080"</span><span>,</span> move <span>|</span>request<span>|</span> <span>{</span>
    let response <span>=</span> router<span>!</span><span>(</span>request<span>,</span>
      <span>(</span>GET<span>)</span> <span>(</span><span>/</span><span>)</span> <span>=</span><span>&gt;</span> <span>{</span>
        pages<span>:</span><span>:</span>index<span>:</span><span>:</span><span>page</span><span>(</span>request<span>)</span>
      <span>}</span><span>,</span>

      <span>(</span>GET<span>)</span> <span>(</span><span>/</span>about<span>)</span> <span>=</span><span>&gt;</span> <span>{</span>
        pages<span>:</span><span>:</span>about<span>:</span><span>:</span><span>page</span><span>(</span>request<span>)</span>
      <span>}</span><span>,</span>

      _ <span>=</span><span>&gt;</span> Response<span>:</span><span>:</span><span>empty_404</span><span>(</span><span>)</span>
    <span>)</span><span>;</span>

    <span>return</span> response<span>;</span>
  <span>}</span><span>)</span><span>;</span>
<span>}</span></code></pre>

<p>Notice the <code>router!</code> macro! Apparently it allows me to write <code>GET</code> and the routes <code>/</code> and <code>/about</code> plainly into code. Those aren‚Äôt strings! Nor are they Rust keywords! It‚Äôs macro magic. It‚Äôs even more magical than Kotlin‚Äôs lambdas. I think this is a powerful but dangerous tool which could make learning Rust codebases harder. I like it though. Instead of parsing these routes at runtime, errors can be caught at compile time.</p>

<h2 id="rust-modules">Rust modules</h2>

<p>One little snag was that Rust‚Äôs module system was a little confusing, coming from ES6 where everything is explicit.</p>

<p>In Rust, modules map to files. Module naming and hierarchy follows the filesystem structure.</p>

<p>I didn‚Äôt fully understand modules properly but it seems that I can use the <code>mod</code> keyword to import modules. And that was enough knowledge to proceed with the project.</p>

<p>In the above code I separated the code that renders the pages into separate files in <code>pages/index.rs</code> and <code>pages/about.rs</code>. To import them in the main file, I had this declaration at the top:</p>

<pre><code>mod pages <span>{</span>
  pub mod index<span>;</span>
  pub mod about<span>;</span>
<span>}</span></code></pre>

<p>As I defined a top-level <code>page()</code> function in each of these files, calling them from the main file would be something like this: <code>pages::index::page(request)</code>.</p>

<h2 id="rendering-html">Rendering HTML</h2>

<p>The top-level <code>page</code> functions simply return static HTML <code>Response</code>s for now.</p>

<p>Here‚Äôs one that handles the root <code>/</code> route:</p>

<pre><code><span>// pages/index.rs</span>
use rouille<span>:</span><span>:</span>Request<span>;</span>
use rouille<span>:</span><span>:</span>Response<span>;</span>

pub fn <span>page</span><span>(</span>_request<span>:</span> <span>&amp;</span>Request<span>)</span> <span>-</span><span>&gt;</span> Response <span>{</span>
  <span>return</span> Response<span>:</span><span>:</span><span>html</span><span>(</span>r#"<span>&lt;</span><span>!</span>doctype html<span>&gt;</span>
    <span>&lt;</span>title<span>&gt;</span>Tiny site<span>&lt;</span><span>/</span>title<span>&gt;</span>
    <span>&lt;</span>h1<span>&gt;</span>Hello<span>,</span> world<span>!</span><span>&lt;</span><span>/</span>h1<span>&gt;</span>
    <span>&lt;</span>p<span>&gt;</span>Welcome to my tiny site<span>!</span><span>&lt;</span><span>/</span>p<span>&gt;</span>
    <span>&lt;</span>a href<span>=</span><span>"/about"</span><span>&gt;</span>About<span>&lt;</span><span>/</span>a<span>&gt;</span>
  "#<span>)</span><span>;</span>
<span>}</span></code></pre>

<p>Which renders this page:</p>
<iframe srcdoc="
<!doctype html>
<title>Tiny site</title>
<h1>Hello, world!</h1>
<p>Welcome to my tiny site!</p>
<a href=&quot;/about&quot;>About</a>
<base href=&quot;about:blank&quot;/>">
            </iframe>
<p>To avoid repetitively escaping double quotes in HTML, I used the raw string literal which looks <code>r#"something like this"#</code> to write the HTML response in Rust.</p>

<h2 id="html-templates--components">HTML templates / components</h2>

<p>I haven‚Äôt done this, but I imagine components or ‚Äúincludes‚Äù can be implemented by simply calling component functions normally and concatenating the resulting HTML fragments together. Nothing fancy required, for a tiny website.</p>

<p>I wonder if there are templating systems that take advantage of Rust‚Äôs compile-time macros. A quick search revealed a lot of them. In fact, that seems to be the ‚ÄúRust way‚Äù of doing HTML templates. One example is <a target="_blank" href="https://maud.lambda.xyz/">Maud</a>:</p>

<pre><code>html<span>!</span> <span>{</span>
  article data<span>-</span>index<span>=</span><span>"12345"</span> <span>{</span>
    h1 <span>{</span> <span>"My blog"</span> <span>}</span>
    tag<span>-</span>cloud <span>{</span> <span>"pinkie pie pony cute"</span> <span>}</span>
  <span>}</span>
<span>}</span></code></pre>

<p>That looks a lot like Jetpack Compose in Kotlin. Seems like fun way to write HTML. I fear I might be taken by a strange mood and convert my entire website into Rust. I guess paid hosting for non-static sites would be a good deterrent.</p>

<h2 id="conclusion">Conclusion</h2>

<p>That was a nice dip into Rust. I‚Äôm still interested in the hyped-up features like memory management but I guess an HTML web server wouldn‚Äôt need much of those things after all. Maybe the next Rust learning exercise would be something like a small video game. Now that‚Äôs something that would require memory management and algorithms.</p>

<p>Here‚Äôs the repo for my tiny web server in Rust: <a target="_blank" href="https://github.com/Kalabasa/tala"><strong>github.com/Kalabasa/tala</strong></a>.
            </p>
]]></description>
            <link>https://leanrada.com/notes/single-file-website-rust?ref=rss</link>
            <guid isPermaLink="true">https://leanrada.com/notes/single-file-website-rust?ref=rss</guid>
            <pubDate>Sat, 30 Dec 2023 00:00:00 GMT</pubDate>
        </item>
        <item>
            <title><![CDATA[2023 in review]]></title>
            <description><![CDATA[
<p>What happened in 2023? Stuff happened.</p>

<h2 id="2023-website-redesign-üé®">2023 website redesign üé®</h2>

<p>Feb 2023, I redesigned <a target="_self" href="https://leanrada.com/wares/personal-website?ref=rss">my site</a>, with a goal of making it more personal instead of just being a mere portfolio.</p>

<img srcset="/wares/personal-website/media/v4_664.generated.png 664w" sizes=" 664px" alt="screenshot of 2023 website" src="https://leanrada.com/wares/personal-website/media/v4.png?ref=rss" spec="100% [664) 664" loading="lazy" width="100%" height="">

<p>It came with a blog section, which made me start writing a blog.</p>

<h2 id="started-a-blog-üñä">Started a blog üñä</h2>
<blockquote>
              <p>‚ÄúI‚Äôm starting a blog!</p>
              <p>I‚Äôve done some blogging in the past (for gamedev), and I already do write-ups for my projects, so I think it‚Äôd be good to officially keep a blog!</p>
              <p>I have some ideas to populate the first few posts, then we‚Äôll see how it goes from there.</p>
              <p>Watch this space!‚Äù</p>
              <p><cite>First blog post on the new site (now unpublished), 24 Feb 2023</cite></p>
            </blockquote>
<p>Well, it went well! In 2023 I had:</p>
12 posts
              1.6k visits
              
<p>The hottest posts were:</p>

<ul>
              <li>üî• <a target="_self" href="https://leanrada.com/notes/sweep-and-prune?ref=rss"><strong>Sort, sweep, and prune: Collision detection algorithms</strong></a></li>
              <li>üî• <a target="_self" href="https://leanrada.com/notes/dynamic-patrol-stealth-games?ref=rss"><strong>Dynamic patrol behaviour in stealth games with Markov chains</strong></a></li>
            </ul>

<p>It is a nice new hobby and something I shall continue. üôå</p>

<h2 id="side-projects-üíª">Side projects üíª</h2>

<p>This year I launched two webapps, <a target="_self" href="https://leanrada.com/wares/portabl.ink?ref=rss">portabl.ink</a> and <a target="_self" href="https://leanrada.com/guhit-kudlit?ref=rss">GuhitKudlit</a>!</p>

<img srcset="/notes/2023-review/portabl.ink_664.generated.png 664w" sizes=" 664px" alt="screenshot of portablink" src="https://leanrada.com/notes/2023-review/portabl.ink.png?ref=rss" spec="100% [664) 664" loading="lazy" width="100%" height="">
portabl.ink
<p><strong>Portablink</strong> was just a fun experiment without much utility. I don‚Äôt have analytics on it so I don‚Äôt know if anyone visits it. We‚Äôll see if I renew the domain.</p>

<img srcset="/notes/2023-review/guhit-kudlit_664.generated.png 664w" sizes=" 664px" alt="screenshot of GuhitKudlit" src="https://leanrada.com/notes/2023-review/guhit-kudlit.png?ref=rss" spec="100% [664) 664" loading="lazy" width="100%" height="">
GuhitKudlit - Baybayin calligraphy generator
<p><strong>GuhitKudlit</strong> did great and is getting regular visitors coming from Google. From the Google Search Console report, it looks like there is demand for baybayin translation and generation or tattoos or whatever. I might rewrite this site properly if it sees more use.</p>

<h2 id="personal--misc-‚ú®">Personal / Misc ‚ú®</h2>

<ul>
              <li>üíº Got a new job. Still a software engineer.</li>
              <li>üéÆ Finally finished <a target="_blank" href="https://zelda.nintendo.com/tears-of-the-kingdom/"><strong>Tears of the Kingdom</strong></a>.</li>
              <li>üéÆ Replayed <strong>Splinter Cell: Chaos Theory</strong>. First was around 15 years ago.</li>
              <li>üéì Began an attempt to learn the Japanese language.</li>
            </ul>

<h3 id="steam-ü´ß">Steam ü´ß</h3>

<p>Here‚Äôs a bit of my <strong>Steam Year in Review</strong>:</p>

<img srcset="/notes/2023-review/steam-spider_664.generated.png 664w" sizes=" 664px" alt="This spider graph shows the kinds of games you spent the most time in 2023. MOBA, 3; Card Battler, 1.7; Puzzle Platformer, 1.3; Automation, 1; Stealth, 3.8; Platformer, 2.6" src="https://leanrada.com/notes/2023-review/steam-spider.png?ref=rss" spec="100% [664) 664" loading="lazy" width="100%" height="">

<p>MOBA, Platformer, and Stealth‚Ä¶ I guess I can conclude that I played a diverse range of games this year? This graph is missing the roguelike category though.</p>

<img srcset="/notes/2023-review/steam_664.generated.png 664w" sizes=" 664px" alt="Dota 2, Splinter Cell: Chaos Theory, Portal 2, Monster Train, Noita, Peglin, Braid, FTL, Factorio, Black Mesa" src="https://leanrada.com/notes/2023-review/steam.png?ref=rss" spec="100% [664) 664" loading="lazy" width="100%" height="">
<span>Most played games on Steam in order</span>
<p>Apparently, I played a lot of <strong>Dota</strong>. I don‚Äôt even remember playing it this year.</p>

<p>You might have noticed the bias for the <a target="_blank" href="https://en.wikipedia.org/wiki/Roguelike">roguelike genre</a>. Shoutout to <a target="_blank" href="https://store.steampowered.com/app/881100/Noita/"><strong>Noita</strong></a>, <a target="_blank" href="https://store.steampowered.com/app/212680/FTL_Faster_Than_Light/"><strong>FTL</strong></a>, and <a target="_blank" href="https://store.steampowered.com/app/1102190/Monster_Train/"><strong>Monster Train</strong></a>. Great games.</p>

<h3 id="spotify-üéµ">Spotify üéµ</h3>

<p>Here‚Äôs a nonsensical thing from my <strong>Spotify Wrapped</strong> ‚Äî <em>My Top Artists</em> in 2023:</p>

<img srcset="/notes/2023-review/spotify_664.generated.jpg 664w" sizes=" 664px" alt="My top artists on Spotify." src="https://leanrada.com/notes/2023-review/spotify.jpg?ref=rss" spec="100% [664) 664" loading="lazy" width="" height="100%">

<p><a target="_blank" href="https://open.spotify.com/artist/5oOhM2DFWab8XhSdQiITry"><strong>Tycho</strong></a> is chillwave ambient IDM downtempo post-rock instrumental music. Nice listening.</p>

<p><a target="_blank" href="https://open.spotify.com/artist/7pnSUizGuS2tAW2yCAhafn"><strong>Vanilla</strong></a> is instrumental hip hop soul-sampling electronic music. Nice grooves.</p>

<p>The third artist is me, so it doesn‚Äôt count.</p>

<p>I don‚Äôt actually know who the fourth artist is. I‚Äôll explain below.</p>

<p><a target="_blank" href="https://open.spotify.com/artist/0rFHElzeddB9ymDjgpBENX"><strong>Lamp</strong></a> is a Japanese band making indie pop jazz pop bossa nova J-pop music. I like the chord progressions.</p>

<p><span>I think I use Spotify a bit differently than most people. I don‚Äôt primarily listen to <em>artists</em>. I just use the playlists, especially the dynamic <strong>Discover Weekly</strong> playlist. As such, ‚Äútop artists‚Äù don‚Äôt really make sense. These top 5 artists don‚Äôt make up a majority of my listens. Accidentally listening to any artist‚Äôs song twice skyrockets them to my ‚Äútop artists‚Äù list. Nonetheless, there are some exceptional artists that I discover and do replay from time to time; some were mentioned above.</span></p>

<h2 id="conclusion-üí°">Conclusion üí°</h2>

<p>The year two thousand and twenty-three was definitely one of the years of all time.</p>
]]></description>
            <link>https://leanrada.com/notes/2023-review?ref=rss</link>
            <guid isPermaLink="true">https://leanrada.com/notes/2023-review?ref=rss</guid>
            <pubDate>Mon, 25 Dec 2023 00:00:00 GMT</pubDate>
        </item>
        <item>
            <title><![CDATA[
              
                My personalised 55% split keyboard
              
            ]]></title>
            <description><![CDATA[<p><em>For RSS readers: This article contains interactive content available on the <a href="https://leanrada.com/notes/my-personalised-keyboard?ref=rss">original post on leanrada.com</a>.</em></p>

<p>I‚Äôve been using my <a target="_blank" href="https://github.com/kata0510/Lily58"><strong>Lily58 split keyboard</strong></a> for more than a year now. It‚Äôs a compact 58-key split keyboard with column-staggered keys, 55% the size of a standard 104-key keyboard.</p>

<p>Thanks to the open-source firmware/framework <a target="_blank" href="https://qmk.fm/">QMK</a>, I customised it and programmed it to my satisfaction. I figured now‚Äôs a good time to post about my layout so far.</p>

<img srcset="/notes/my-personalised-keyboard/photo_664.generated.jpg 664w" sizes=" 664px" alt="" src="https://leanrada.com/notes/my-personalised-keyboard/photo.jpg?ref=rss" spec="100% [664) 664" loading="lazy" width="100%" height="">
<span>The keyboard in question</span>
<h2 id="quick-rundown">Quick rundown</h2>

<p><strong>Hardware:</strong> Split keyboard with 58 keys in total. A 32√ó128 pixel OLED screen on each half. Both halves are connected by wire, and the whole thing is wired USB-C to the computer.</p>

<p><strong>Software:</strong> It runs the QMK firmware, which I used to implement 7-8 layers and several custom functions. I customised the heck out of my keyboard‚Äôs firmware.</p>

<h2 id="the-basics">The basics</h2>

<pre>Interactive content: <a href="https://leanrada.com/notes/my-personalised-keyboard?ref=rss">Visit the website to play with interactive content!</a>
Alternative text: Lily58 keyboard layout diagram
  Left hand:
    „ÄîEsc „Äï„Äî ‚åÉ[ „Äï„Äî ‚åÉ] „Äï„Äî‚åÉ‚áßTab„Äï„Äî‚åÉTab„Äï„Äî    „Äï
    „Äî ?  „Äï„Äî q  „Äï„Äî w  „Äï„Äî f  „Äï„Äî p  „Äï„Äî b  „Äï
    „ÄîTab „Äï„Äî a  „Äï„Äî r  „Äï„Äî s  „Äï„Äî t  „Äï„Äî g  „Äï
    „Äî +  „Äï„Äî z  „Äï„Äî x  „Äï„Äî c  „Äï„Äî d  „Äï„Äî v  „Äï
    „Äî ‚åÉ  „Äï„ÄîL(s)„Äï„Äî ‚ùñ  „Äï„Äî ‚ê£  „Äï„Äî ‚óÜ  „Äï
  Right hand:
    „ÄîL(e)„Äï„ÄîWksp‚Üê„Äï„ÄîWksp‚Üë„Äï„ÄîWksp‚Üì„Äï„ÄîWksp‚Üí„Äï„Äî ‚å´  „Äï
    „Äî j  „Äï„Äî l  „Äï„Äî u  „Äï„Äî y  „Äï„Äî =  „Äï„Äî '  „Äï
    „Äî m  „Äï„Äî n  „Äï„Äî e  „Äï„Äî i  „Äï„Äî o  „Äï„Äî ‚Üµ  „Äï
    „Äî k  „Äï„Äî h  „Äï„Äî .  „Äï„Äî ,  „Äï„Äî /  „Äï„Äî -  „Äï
    „Äî ‚óÜ  „Äï„Äî ‚ê£  „Äï„ÄîL(n)„Äï„ÄîL(#)„Äï„ÄîL(f)„Äï</pre>

<p>This is the <em>base layer</em> of my keyboard, where all the typing happens primarily.</p>

<p>Largely in the middle lies the alphabet. Instead of the usual QWERTY layout, it‚Äôs in a layout called <a target="_blank" href="https://colemakmods.github.io/mod-dh/"><strong>Colemak-DH</strong></a>. It took some time to get used to but I appreciate how easier it was for typing (in English), as the most common letters are in the home row.</p>

<pre>Interactive content: <a href="https://leanrada.com/notes/my-personalised-keyboard?ref=rss">Visit the website to play with interactive content!</a>
Alternative text: Lily58 keyboard layout diagram with highlighted keys
  Left hand:
    „ÄîEsc „Äï„Äî ‚åÉ[ „Äï„Äî ‚åÉ] „Äï„Äî‚åÉ‚áßTab„Äï„Äî‚åÉTab„Äï„Äî    „Äï
    „Äî ?  „Äï„Äò q  „Äô„Äò w  „Äô„Äò f  „Äô„Äò p  „Äô„Äò b  „Äô
    „ÄîTab „Äï„Äò a  „Äô„Äò r  „Äô„Äò s  „Äô„Äò t  „Äô„Äò g  „Äô
    „Äî +  „Äï„Äò z  „Äô„Äò x  „Äô„Äò c  „Äô„Äò d  „Äô„Äò v  „Äô
    „Äî ‚åÉ  „Äï„ÄîL(s)„Äï„Äî ‚ùñ  „Äï„Äî ‚ê£  „Äï„Äî ‚óÜ  „Äï
  Right hand:
    „ÄîL(e)„Äï„ÄîWksp‚Üê„Äï„ÄîWksp‚Üë„Äï„ÄîWksp‚Üì„Äï„ÄîWksp‚Üí„Äï„Äî ‚å´  „Äï
    „Äò j  „Äô„Äò l  „Äô„Äò u  „Äô„Äò y  „Äô„Äò =  „Äô„Äî '  „Äï
    „Äò m  „Äô„Äò n  „Äô„Äò e  „Äô„Äò i  „Äô„Äò o  „Äô„Äî ‚Üµ  „Äï
    „Äò k  „Äô„Äò h  „Äô„Äò .  „Äô„Äò ,  „Äô„Äò /  „Äô„Äî -  „Äï
    „Äî ‚óÜ  „Äï„Äî ‚ê£  „Äï„ÄîL(n)„Äï„ÄîL(#)„Äï„ÄîL(f)„Äï</pre>
Alphabetic input
<p>The alphabet is flanked by the familiar <kbd>Esc</kbd>, <kbd>‚å´</kbd>, <kbd>‚Üµ</kbd>, and <kbd>Tab</kbd> keys, only to be punctuated by some of the common <em>punctuations</em>.</p>

<p>The bottom row gives access to hidden <em>layers</em> which can be activated by holding down the layer <kbd>L(*)</kbd> keys. More on layers later.</p>

<pre>Interactive content: <a href="https://leanrada.com/notes/my-personalised-keyboard?ref=rss">Visit the website to play with interactive content!</a>
Alternative text: Lily58 keyboard layout diagram with highlighted keys
  Left hand:
    „ÄîEsc „Äï„Äî ‚åÉ[ „Äï„Äî ‚åÉ] „Äï„Äî‚åÉ‚áßTab„Äï„Äî‚åÉTab„Äï„Äî    „Äï
    „Äî ?  „Äï„Äî q  „Äï„Äî w  „Äï„Äî f  „Äï„Äî p  „Äï„Äî b  „Äï
    „ÄîTab „Äï„Äî a  „Äï„Äî r  „Äï„Äî s  „Äï„Äî t  „Äï„Äî g  „Äï
    „Äî +  „Äï„Äî z  „Äï„Äî x  „Äï„Äî c  „Äï„Äî d  „Äï„Äî v  „Äï
    „Äò ‚åÉ  „Äô„ÄòL(s)„Äô„Äò ‚ùñ  „Äô„Äò ‚ê£  „Äô„Äî ‚óÜ  „Äï
  Right hand:
    „ÄîL(e)„Äï„ÄîWksp‚Üê„Äï„ÄîWksp‚Üë„Äï„ÄîWksp‚Üì„Äï„ÄîWksp‚Üí„Äï„Äî ‚å´  „Äï
    „Äî j  „Äï„Äî l  „Äï„Äî u  „Äï„Äî y  „Äï„Äî =  „Äï„Äî '  „Äï
    „Äî m  „Äï„Äî n  „Äï„Äî e  „Äï„Äî i  „Äï„Äî o  „Äï„Äî ‚Üµ  „Äï
    „Äî k  „Äï„Äî h  „Äï„Äî .  „Äï„Äî ,  „Äï„Äî /  „Äï„Äî -  „Äï
    „Äî ‚óÜ  „Äï„Äò ‚ê£  „Äô„ÄòL(n)„Äô„ÄòL(#)„Äô„ÄòL(f)„Äô</pre>
Layer keys, <em>Space</em><kbd>‚ê£</kbd> bar, and primary modifiers <code>Control</code>/<code>Command</code>
<p>The top row is where it gets interesting. Here we have <em>single-key shortcuts</em>.</p>

<pre>Interactive content: <a href="https://leanrada.com/notes/my-personalised-keyboard?ref=rss">Visit the website to play with interactive content!</a>
Alternative text: Lily58 keyboard layout diagram with highlighted keys
  Left hand:
    „ÄîEsc „Äï„Äò ‚åÉ[ „Äô„Äò ‚åÉ] „Äô„Äò‚åÉ‚áßTab„Äô„Äò‚åÉTab„Äô„Äî    „Äï
    „Äî ?  „Äï„Äî q  „Äï„Äî w  „Äï„Äî f  „Äï„Äî p  „Äï„Äî b  „Äï
    „ÄîTab „Äï„Äî a  „Äï„Äî r  „Äï„Äî s  „Äï„Äî t  „Äï„Äî g  „Äï
    „Äî +  „Äï„Äî z  „Äï„Äî x  „Äï„Äî c  „Äï„Äî d  „Äï„Äî v  „Äï
    „Äî ‚åÉ  „Äï„ÄîL(s)„Äï„Äî ‚ùñ  „Äï„Äî ‚ê£  „Äï„Äî ‚óÜ  „Äï
  Right hand:
    „ÄîL(e)„Äï„ÄòWksp‚Üê„Äô„ÄòWksp‚Üë„Äô„ÄòWksp‚Üì„Äô„ÄòWksp‚Üí„Äô„Äî ‚å´  „Äï
    „Äî j  „Äï„Äî l  „Äï„Äî u  „Äï„Äî y  „Äï„Äî =  „Äï„Äî '  „Äï
    „Äî m  „Äï„Äî n  „Äï„Äî e  „Äï„Äî i  „Äï„Äî o  „Äï„Äî ‚Üµ  „Äï
    „Äî k  „Äï„Äî h  „Äï„Äî .  „Äï„Äî ,  „Äï„Äî /  „Äï„Äî -  „Äï
    „Äî ‚óÜ  „Äï„Äî ‚ê£  „Äï„ÄîL(n)„Äï„ÄîL(#)„Äï„ÄîL(f)„Äï</pre>
Top row: shortcuts
<p>On the left hand top row we have ‚Äúuniversal‚Äù shortcuts for navigating within an application: Back, Forward, Previous tab, and Next tab.</p>

<video src="https://leanrada.com/notes/my-personalised-keyboard/appnav.mp4?ref=rss" muted="" autoplay="" loop="" aria-label="">
                Video: | Source: /notes/my-personalised-keyboard/appnav.mp4
              </video>
<span>Using the application navigation keys.</span>
<ul>
              <li><kbd>‚åÉ[</kbd> - Back</li>
              <li><kbd>‚åÉ]</kbd> - Forward</li>
              <li><kbd>‚åÉ‚áßTab</kbd> - Previous tab</li>
              <li><kbd>‚åÉTab</kbd> - Next tab</li>
            </ul>

<p>They‚Äôre compatible with most web browsers and code editors. Really handy when surfing the web or when tracing code across multiple files.</p>

<p>On the other <em>hand</em>, we have <kbd>Wksp‚Üê</kbd> and <kbd>Wksp‚Üí</kbd>, shortcuts for switching between workspaces (a.k.a. spaces and virtual desktops in macOS and Windows, respectively).</p>

<video src="https://leanrada.com/notes/my-personalised-keyboard/wksp.mp4?ref=rss" muted="" autoplay="" loop="" aria-label="demo video of using the workspace switcher keys">
                Video: demo video of using the workspace switcher keys | Source: /notes/my-personalised-keyboard/wksp.mp4
              </video>

<p><kbd>Wksp‚Üë</kbd> and <kbd>Wksp‚Üì</kbd> are bound to desktop-specific actions like Expos√© in macOS. I don‚Äôt actually remember their exact purposes because they‚Äôre not consistent across OSes.</p>

<h2 id="home-row-modifiers">Home row modifiers</h2>

<pre>Interactive content: <a href="https://leanrada.com/notes/my-personalised-keyboard?ref=rss">Visit the website to play with interactive content!</a>
Alternative text: Lily58 keyboard layout diagram with highlighted keys
  Left hand:
    „ÄîEsc „Äï„Äî ‚åÉ[ „Äï„Äî ‚åÉ] „Äï„Äî‚åÉ‚áßTab„Äï„Äî‚åÉTab„Äï„Äî    „Äï
    „Äî ?  „Äï„Äî q  „Äï„Äî w  „Äï„Äî f  „Äï„Äî p  „Äï„Äî b  „Äï
    „ÄîTab „Äï„Äòa/‚áß „Äô„Äòr/‚åò „Äô„Äòs/‚å• „Äô„Äòt/‚åÉ „Äô„Äî g  „Äï
    „Äî +  „Äï„Äî z  „Äï„Äî x  „Äï„Äî c  „Äï„Äî d  „Äï„Äî v  „Äï
    „Äî ‚åÉ  „Äï„ÄîL(s)„Äï„Äî ‚ùñ  „Äï„Äî ‚ê£  „Äï„Äî ‚óÜ  „Äï
  Right hand:
    „ÄîL(e)„Äï„ÄîWksp‚Üê„Äï„ÄîWksp‚Üë„Äï„ÄîWksp‚Üì„Äï„ÄîWksp‚Üí„Äï„Äî ‚å´  „Äï
    „Äî j  „Äï„Äî l  „Äï„Äî u  „Äï„Äî y  „Äï„Äî =  „Äï„Äî '  „Äï
    „Äî m  „Äï„Äòn/‚åÉ „Äô„Äòe/‚å• „Äô„Äòi/‚åò „Äô„Äòo/‚áß „Äô„Äî ‚Üµ  „Äï
    „Äî k  „Äï„Äî h  „Äï„Äî .  „Äï„Äî ,  „Äï„Äî /  „Äï„Äî -  „Äï
    „Äî ‚óÜ  „Äï„Äî ‚ê£  „Äï„ÄîL(n)„Äï„ÄîL(#)„Äï„ÄîL(f)„Äï</pre>
Tap/Hold dual purpose home row keys
<p>The home row on the keyboard is where the fingers rest by default. As such, the home row on my keyboard serves a second purpose besides alphabetic input. Some of them can be held down to activate <em>modifiers</em> such as <code>Control</code>, <code>Alt</code>, and <code>Super</code>.</p>

<p>For example, the key <kbd>a</kbd> activates <code>Shift</code> when held down, while a tap produces the letter <code>a</code>.</p>

<p>Home row modifiers make keyboard shortcuts much more comfortable, in contrast to the awkward contortions you have to perform on regular keyboards.</p>

<p>This makes use of the <a target="_blank" href="https://docs.qmk.fm/#/mod_tap"><strong>Mod-Tap</strong></a> feature from the QMK framework, a.k.a. Tap/Hold keys.</p>

<p><span>The home row mods, among other things, were inspired by the famous <a target="_blank" href="https://github.com/manna-harbour/miryoku"><strong>Miryoku</strong></a> layout. Credits to Manna Harbour for designing the Miryoku layout.</span></p>

<h2 id="layers">Layers</h2>

<p>I use <strong>layers</strong> due to the limited number of physical keys on the keyboard. Inputs such as numbers and symbols have to be organised into separate layers. I can switch between these layers either through dedicated layer keys or programmatically.</p>

<p>Here are the layers I ended up with:</p>

<ol>
              <li>Alphabet (Default)</li>
              <li><img alt="" src="https://leanrada.com/notes/my-personalised-keyboard/shift_layer_oled.png?ref=rss"> Shifted alphabet (Uppercase)</li>
              <li><img alt="" src="https://leanrada.com/notes/my-personalised-keyboard/symbol_layer_oled.png?ref=rss"> Symbols</li>
              <li><img alt="" src="https://leanrada.com/notes/my-personalised-keyboard/navigation_layer_oled.png?ref=rss"> Navigation / manipulation</li>
              <li><img alt="" src="https://leanrada.com/notes/my-personalised-keyboard/number_layer_oled.png?ref=rss"> Numbers</li>
              <li><img alt="" src="https://leanrada.com/notes/my-personalised-keyboard/function_layer_oled.png?ref=rss"> Functions</li>
              <li><img alt="" src="https://leanrada.com/notes/my-personalised-keyboard/emoji_layer_oled.png?ref=rss"> Emojis</li>
            </ol>

<p><span>Btw, the OLED screen is programmed to show the current layer.</span></p>

<p>Let‚Äôs dive into each layer in the following sections. ü§ø</p>

<h2 id="shift-layer-">Shift layer <img alt="" src="https://leanrada.com/notes/my-personalised-keyboard/shift_layer_oled.png?ref=rss"></h2>

<pre>Interactive content: <a href="https://leanrada.com/notes/my-personalised-keyboard?ref=rss">Visit the website to play with interactive content!</a>
Alternative text: Lily58 keyboard layout diagram
  Left hand:
    „ÄîEsc „Äï„Äî ~  „Äï„Äî @  „Äï„Äî #  „Äï„Äî %  „Äï„Äî    „Äï
    „Äî !  „Äï„Äî Q  „Äï„Äî W  „Äï„Äî F  „Äï„Äî P  „Äï„Äî B  „Äï
    „ÄîTab „Äï„Äî A  „Äï„Äî R  „Äï„Äî S  „Äï„Äî T  „Äï„Äî G  „Äï
    „Äî    „Äï„Äî Z  „Äï„Äî X  „Äï„Äî C  „Äï„Äî D  „Äï„Äî V  „Äï
    „Äî    „Äï„Äî    „Äï„Äî    „Äï„Äî ‚áß  „Äï„Äî    „Äï
  Right hand:
    „Äî    „Äï„Äî ^  „Äï„Äî &amp;  „Äï„Äî |  „Äï„Äî \  „Äï„Äî ‚å´  „Äï
    „Äî J  „Äï„Äî L  „Äï„Äî U  „Äï„Äî Y  „Äï„Äî _  „Äï„Äî "  „Äï
    „Äî M  „Äï„Äî N  „Äï„Äî E  „Äï„Äî I  „Äï„Äî O  „Äï„Äî ‚Üµ  „Äï
    „Äî K  „Äï„Äî H  „Äï„Äî :  „Äï„Äî ;  „Äï„Äî *  „Äï„Äî    „Äï
    „Äî    „Äï„Äî ‚ê£  „Äï„Äî    „Äï„Äî    „Äï„Äî    „Äï</pre>
Interactive diagram! Click the highlighted <kbd>‚áß</kbd> layer activation key above to toggle between the base layer and the Shift layer.
<p>The <strong>Shift layer</strong> is just a shifted or uppercase version of the base layer. You know, like when you hold <em>Shift</em> on a regular keyboard! This layer is activated by holding down the left <em>Space</em> key <kbd>‚ê£</kbd> instead of the <em>Shift</em> key. It‚Äôs another Tap/Hold key. Tapping <em>Space</em> <kbd>‚ê£</kbd> inputs a <em>space character</em>, while holding it activates the Shift layer.</p>

<p>Some of my shifted punctuations differ from their counterparts in a regular QWERTY keyboard. Like how <kbd>?</kbd> shifts into <kbd>!</kbd>, <kbd>.</kbd> to <kbd>:</kbd>, <kbd>,</kbd> to <kbd>;</kbd>, etc‚Ä¶</p>

<p><span>I used this great <a target="_blank" href="https://getreuer.info/posts/keyboards/custom-shift-keys/index.html"><strong>Custom Shift Keys</strong> library</a> from Pascal Getreuer to customise the shifted values.</span></p>

<h2 id="symbols-">Symbols <img alt="" src="https://leanrada.com/notes/my-personalised-keyboard/symbol_layer_oled.png?ref=rss"></h2>

<pre>Interactive content: <a href="https://leanrada.com/notes/my-personalised-keyboard?ref=rss">Visit the website to play with interactive content!</a>
Alternative text: Lily58 keyboard layout diagram with highlighted keys
  Left hand:
    „Äò    „Äô„Äò    „Äô„Äò    „Äô„Äò    „Äô„Äò    „Äô„Äò    „Äô
    „Äò `  „Äô„Äò \  „Äô„Äò $  „Äô„Äò {  „Äô„Äò }  „Äô„Äò    „Äô
    „Äò &lt;  „Äô„Äò =  „Äô„Äò -  „Äô„Äò (  „Äô„Äò )  „Äô„Äò &gt;  „Äô
    „Äò    „Äô„Äò    „Äô„Äò    „Äô„Äò [  „Äô„Äò ]  „Äô„Äò    „Äô
    „Äî    „Äï„ÄòL(s)„Äô„Äî    „Äï„Äî    „Äï„Äî    „Äï
  Right hand:
    „Äî    „Äï„Äî    „Äï„Äî    „Äï„Äî    „Äï„Äî    „Äï„Äî    „Äï
    „Äî    „Äï„Äî    „Äï„Äî    „Äï„Äî    „Äï„Äî    „Äï„Äî    „Äï
    „Äî    „Äï„Äò ‚åÉ  „Äô„Äò ‚å•  „Äô„Äò ‚åò  „Äô„Äò ‚áß  „Äô„Äî    „Äï
    „Äî    „Äï„Äî    „Äï„Äî    „Äï„Äî    „Äï„Äî    „Äï„Äî    „Äï
    „Äî    „Äï„Äî    „Äï„Äî    „Äï„Äî    „Äï„Äî    „Äï</pre>

<p>The <strong>Symbol layer</strong> is activated by holding the dedicated <em>Symbol layer key</em> <kbd>L(s)</kbd> with the left thumb. Matching the thumb, the symbols are laid out on the left-hand side only. The right-hand side defaults to home row mods.</p>

<p>There‚Äôs a bit of special programming that I added for this layer. The parentheses, brackets, braces, and angle brackets ‚Äî or the "enclosure" keys ‚Äî have a nifty little shortcut in them for a smoother coding experience.</p>

<video src="https://leanrada.com/notes/my-personalised-keyboard/closing-bracket-reposition.mp4?ref=rss" muted="" autoplay="" loop="" aria-label="">
                Video: | Source: /notes/my-personalised-keyboard/closing-bracket-reposition.mp4
              </video>
<span>Caret repositioning in brackets</span>
<p>What it does exactly is it lets me automatically reposition the caret or cursor inside the brackets without the need for arrow keys. The arrow keys are on a separate layer, and layer-switching has an overhead.</p>

<p>The trigger for it is simple: if I still have the opening symbol‚Äôs key held down as I release the closing symbol‚Äôs key, it repositions. Otherwise, it types normally. This way I can control whether I want to quickly reposition or not.</p>

<pre>Interactive content: <a href="https://leanrada.com/notes/my-personalised-keyboard?ref=rss">Visit the website to play with interactive content!</a>
Alternative text: interactive simulation of bracket keyboard input</pre>
Demo! You‚Äôll need a keyboard for this.<br>To trigger caret repositioning, hold <kbd>1</kbd>, press <kbd>2</kbd>, release <kbd>2</kbd>, before releasing <kbd>1</kbd>. It‚Äôs a reversing motion, mirroring the cursor‚Äôs movements.
<h2 id="navigation-">Navigation <img alt="" src="https://leanrada.com/notes/my-personalised-keyboard/navigation_layer_oled.png?ref=rss"></h2>

<pre>Interactive content: <a href="https://leanrada.com/notes/my-personalised-keyboard?ref=rss">Visit the website to play with interactive content!</a>
Alternative text: Lily58 keyboard layout diagram with highlighted keys
  Left hand:
    „Äî    „Äï„Äî    „Äï„Äî    „Äï„Äî    „Äï„Äî    „Äï„Äî    „Äï
    „Äî    „Äï„Äî    „Äï„Äî    „Äï„Äî    „Äï„Äî    „Äï„Äî    „Äï
    „Äî    „Äï„Äò ‚áß  „Äô„Äò ‚åò  „Äô„Äò ‚å•  „Äô„Äò ‚åÉ  „Äô„Äî    „Äï
    „Äî    „Äï„Äî    „Äï„Äî    „Äï„Äî    „Äï„Äî    „Äï„Äî    „Äï
    „Äî    „Äï„Äî    „Äï„Äî    „Äï„Äî    „Äï„Äî    „Äï
  Right hand:
    „Äò    „Äô„Äò    „Äô„Äò    „Äô„Äò‚áßTab„Äô„ÄòTab „Äô„Äò ‚å´  „Äô
    „Äò W‚å´ „Äô„Äò W‚Üê „Äô„ÄòWSel„Äô„Äò    „Äô„Äò W‚Üí „Äô„Äò    „Äô
    „Äò ‚å¶  „Äô„Äò ‚Üê  „Äô„Äò ‚Üë  „Äô„Äò ‚Üì  „Äô„Äò ‚Üí  „Äô„Äò ‚Üµ  „Äô
    „Äò    „Äô„ÄòHome„Äô„ÄòPgUp„Äô„ÄòPgDn„Äô„ÄòEnd „Äô„Äò    „Äô
    „Äî    „Äï„Äî    „Äï„ÄòL(n)„Äô„Äî    „Äï„Äî    „Äï</pre>

<p>The <strong>Navigation / manipulation layer</strong> provides the arrow keys, page navigation keys, and word navigation, all on the right side. Some text manipulation functions are here as well. This layer is especially useful when editing text.</p>

<p>On the home row sit the arrow keys. These probably are among the the most used keys ever.</p>

<pre>Interactive content: <a href="https://leanrada.com/notes/my-personalised-keyboard?ref=rss">Visit the website to play with interactive content!</a>
Alternative text: Lily58 keyboard layout diagram with highlighted keys
  Left hand:
    „Äî    „Äï„Äî    „Äï„Äî    „Äï„Äî    „Äï„Äî    „Äï„Äî    „Äï
    „Äî    „Äï„Äî    „Äï„Äî    „Äï„Äî    „Äï„Äî    „Äï„Äî    „Äï
    „Äî    „Äï„Äî ‚áß  „Äï„Äî ‚åò  „Äï„Äî ‚å•  „Äï„Äî ‚åÉ  „Äï„Äî    „Äï
    „Äî    „Äï„Äî    „Äï„Äî    „Äï„Äî    „Äï„Äî    „Äï„Äî    „Äï
    „Äî    „Äï„Äî    „Äï„Äî    „Äï„Äî    „Äï„Äî    „Äï
  Right hand:
    „Äî    „Äï„Äî    „Äï„Äî    „Äï„Äî‚áßTab„Äï„ÄîTab „Äï„Äî ‚å´  „Äï
    „Äî W‚å´ „Äï„Äî W‚Üê „Äï„ÄîWSel„Äï„Äî    „Äï„Äî W‚Üí „Äï„Äî    „Äï
    „Äî ‚å¶  „Äï„Äò ‚Üê  „Äô„Äò ‚Üë  „Äô„Äò ‚Üì  „Äô„Äò ‚Üí  „Äô„Äî ‚Üµ  „Äï
    „Äî    „Äï„ÄîHome„Äï„ÄîPgUp„Äï„ÄîPgDn„Äï„ÄîEnd „Äï„Äî    „Äï
    „Äî    „Äï„Äî    „Äï„ÄîL(n)„Äï„Äî    „Äï„Äî    „Äï</pre>

<p><span>Yes, the Up and Down arrows are in that order ‚Äî opposite of Vim style. I think it‚Äôs more logical this way.</span></p>

<p>Above the arrow keys are the <em>word navigation</em> keys. These operate on <em>words</em> rather than individual letters.</p>

<pre>Interactive content: <a href="https://leanrada.com/notes/my-personalised-keyboard?ref=rss">Visit the website to play with interactive content!</a>
Alternative text: Lily58 keyboard layout diagram with highlighted keys
  Left hand:
    „Äî    „Äï„Äî    „Äï„Äî    „Äï„Äî    „Äï„Äî    „Äï„Äî    „Äï
    „Äî    „Äï„Äî    „Äï„Äî    „Äï„Äî    „Äï„Äî    „Äï„Äî    „Äï
    „Äî    „Äï„Äî ‚áß  „Äï„Äî ‚åò  „Äï„Äî ‚å•  „Äï„Äî ‚åÉ  „Äï„Äî    „Äï
    „Äî    „Äï„Äî    „Äï„Äî    „Äï„Äî    „Äï„Äî    „Äï„Äî    „Äï
    „Äî    „Äï„Äî    „Äï„Äî    „Äï„Äî    „Äï„Äî    „Äï
  Right hand:
    „Äî    „Äï„Äî    „Äï„Äî    „Äï„Äî‚áßTab„Äï„ÄîTab „Äï„Äî ‚å´  „Äï
    „Äò W‚å´ „Äô„Äò W‚Üê „Äô„ÄòWSel„Äô„Äò    „Äô„Äò W‚Üí „Äô„Äî    „Äï
    „Äî ‚å¶  „Äï„Äî ‚Üê  „Äï„Äî ‚Üë  „Äï„Äî ‚Üì  „Äï„Äî ‚Üí  „Äï„Äî ‚Üµ  „Äï
    „Äî    „Äï„ÄîHome„Äï„ÄîPgUp„Äï„ÄîPgDn„Äï„ÄîEnd „Äï„Äî    „Äï
    „Äî    „Äï„Äî    „Äï„ÄîL(n)„Äï„Äî    „Äï„Äî    „Äï</pre>

<p>The <kbd>W‚Üê</kbd> and <kbd>W‚Üí</kbd> keys, for instance, let you move the cursor one word at a time.</p>

<video src="https://leanrada.com/notes/my-personalised-keyboard/word-jump.mp4?ref=rss" muted="" autoplay="" loop="" aria-label="">
                Video: | Source: /notes/my-personalised-keyboard/word-jump.mp4
              </video>
<span>Moving the cursor, one word at a time</span>
<p>Word navigation works by using a lesser-known feature native to most desktop operating systems, which does exactly that ‚Äî jumping to the next or previous word. On macOS, it‚Äôs the keyboard shortcuts <code>Option+Left</code> and <code>Option+Right</code>. On Linux, <code>Control+Left</code> and <code>Control+Right</code>. Depending on the current OS, these shortcuts are mapped to the word navigation <kbd>W‚Üê</kbd> and <kbd>W‚Üí</kbd> keys.</p>

<p>One of the other word keys is the <strong>Select Word</strong> <kbd>WSel</kbd> key, which selects the current word under the caret.</p>

<video src="https://leanrada.com/notes/my-personalised-keyboard/word-sel.mp4?ref=rss" muted="" autoplay="" loop="" aria-label="Word selection demo">
                Video: Word selection demo | Source: /notes/my-personalised-keyboard/word-sel.mp4
              </video>

<p>The <em>Select Word</em> key itself is just a macro. It‚Äôs composed of the following sequence of keystrokes:</p>

<ol>
              <li><kbd>W‚Üê</kbd></li>
              <li><kbd>W‚Üí</kbd></li>
              <li>Hold <code>Shift</code></li>
              <li><kbd>W‚Üê</kbd></li>
              <li>Release <code>Shift</code></li>
            </ol>

<p>Which results in a selection spanning the nearest word boundaries around the caret. There are edge cases with this macro (literally), but they‚Äôre not that annoying. This macro has been extremely useful.</p>

<p>The <strong>Delete Word</strong> <kbd>W‚å´</kbd> key is just the <em>Select Word</em> macro + <em>Backspace</em> <kbd>‚å´</kbd>.</p>

<p>These word navigation functions greatly increase text and code editing efficiency.</p>

<h2 id="numbers-">Numbers <img alt="" src="https://leanrada.com/notes/my-personalised-keyboard/number_layer_oled.png?ref=rss"></h2>

<pre>Interactive content: <a href="https://leanrada.com/notes/my-personalised-keyboard?ref=rss">Visit the website to play with interactive content!</a>
Alternative text: Lily58 keyboard layout diagram
  Left hand:
    „Äî    „Äï„Äî    „Äï„Äî    „Äï„Äî    „Äï„Äî    „Äï„Äî    „Äï
    „Äî    „Äï„Äî    „Äï„Äî    „Äï„Äî    „Äï„Äî    „Äï„Äî    „Äï
    „Äî    „Äï„Äî ‚áß  „Äï„Äî ‚åò  „Äï„Äî ‚å•  „Äï„Äî ‚åÉ  „Äï„Äî    „Äï
    „Äî    „Äï„Äî    „Äï„Äî    „Äï„Äî    „Äï„Äî    „Äï„Äî    „Äï
    „Äî    „Äï„Äî    „Äï„Äî    „Äï„Äî    „Äï„Äî    „Äï
  Right hand:
    „Äî    „Äï„Äî    „Äï„Äî    „Äï„Äî *  „Äï„Äî /  „Äï„Äî ‚å´  „Äï
    „Äî    „Äï„Äî    „Äï„Äî 7  „Äï„Äî 8  „Äï„Äî 9  „Äï„Äî -  „Äï
    „Äî    „Äï„Äî 0  „Äï„Äî 4  „Äï„Äî 5  „Äï„Äî 6  „Äï„Äî ‚Üµ  „Äï
    „Äî    „Äï„Äî +  „Äï„Äî 1  „Äï„Äî 2  „Äï„Äî 3  „Äï„Äî .  „Äï
    „Äî    „Äï„Äî    „Äï„Äî    „Äï„ÄîL(#)„Äï„Äî    „Äï</pre>

<p>This layer contains numbers and some arithmetic operators laid out like a numpad on the right hand side. Convenient when doing calculations. Nothing special here.</p>

<h2 id="functions-">Functions <img alt="" src="https://leanrada.com/notes/my-personalised-keyboard/function_layer_oled.png?ref=rss"></h2>

<pre>Interactive content: <a href="https://leanrada.com/notes/my-personalised-keyboard?ref=rss">Visit the website to play with interactive content!</a>
Alternative text: Lily58 keyboard layout diagram
  Left hand:
    „Äî    „Äï„ÄîQWERTY„Äï„Äî    „Äï„Äî    „Äï„Äî    „Äï„Äî    „Äï
    „Äî    „Äï„Äî    „Äï„ÄîLinux„Äï„Äî    „Äï„ÄîmacOS„Äï„Äî    „Äï
    „Äî    „Äï„Äî ‚áß  „Äï„Äî ‚åò  „Äï„Äî ‚å•  „Äï„Äî ‚åÉ  „Äï„Äî    „Äï
    „Äî    „Äï„Äî    „Äï„Äî    „Äï„Äî    „Äï„Äî    „Äï„Äî    „Äï
    „Äî    „Äï„Äî    „Äï„Äî    „Äï„Äî    „Äï„Äî    „Äï
  Right hand:
    „Äî    „Äï„Äî    „Äï„Äîüîâ- „Äï„Äîüîä+ „Äï„ÄîüîÖ- „Äï„ÄîüîÜ+ „Äï
    „Äî    „Äï„Äî    „Äï„Äî ‚èÆÔ∏è „Äï„Äî ‚èØÔ∏è „Äï„ÄîPrtScr„Äï„Äî ‚è≠Ô∏è „Äï
    „Äî    „Äï„Äî üîá „Äï„ÄîFB0 „Äï„ÄîFB1 „Äï„ÄîFB2 „Äï„ÄîFB3 „Äï
    „Äî    „Äï„Äî    „Äï„Äî    „Äï„Äî    „Äï„Äî    „Äï„Äî    „Äï
    „Äî    „Äï„Äî    „Äï„Äî    „Äï„Äî    „Äï„ÄîL(f)„Äï</pre>

<p>The <strong>Function layer</strong> contains ‚Äúfunctions‚Äù, or things that do stuff instead of inputting text. Volume buttons, brightness buttons, media controls, you name it.</p>

<p>And of course, the <em>Function</em> keys themselves (i.e., <code>F1</code>, <code>F2</code>, <code>F3</code>, ‚Ä¶, <code>F12</code>) can be accessed from this layer, but they‚Äôre a <em>bit</em> hidden. The Function keys are entered through the four bit keys <kbd>FB0</kbd>, <kbd>FB1</kbd>, <kbd>FB2</kbd>, and <kbd>FB3</kbd> in a <em>bitwise</em> manner.</p>

<pre>Interactive content: <a href="https://leanrada.com/notes/my-personalised-keyboard?ref=rss">Visit the website to play with interactive content!</a>
Alternative text: Lily58 keyboard layout diagram with highlighted keys
  Left hand:
    „Äî    „Äï„ÄîQWERTY„Äï„Äî    „Äï„Äî    „Äï„Äî    „Äï„Äî    „Äï
    „Äî    „Äï„Äî    „Äï„ÄîLinux„Äï„Äî    „Äï„ÄîmacOS„Äï„Äî    „Äï
    „Äî    „Äï„Äî ‚áß  „Äï„Äî ‚åò  „Äï„Äî ‚å•  „Äï„Äî ‚åÉ  „Äï„Äî    „Äï
    „Äî    „Äï„Äî    „Äï„Äî    „Äï„Äî    „Äï„Äî    „Äï„Äî    „Äï
    „Äî    „Äï„Äî    „Äï„Äî    „Äï„Äî    „Äï„Äî    „Äï
  Right hand:
    „Äî    „Äï„Äî    „Äï„Äîüîâ- „Äï„Äîüîä+ „Äï„ÄîüîÖ- „Äï„ÄîüîÜ+ „Äï
    „Äî    „Äï„Äî    „Äï„Äî ‚èÆÔ∏è „Äï„Äî ‚èØÔ∏è „Äï„ÄîPrtScr„Äï„Äî ‚è≠Ô∏è „Äï
    „Äî    „Äï„Äî üîá „Äï„ÄòFB0 „Äô„ÄòFB1 „Äô„ÄòFB2 „Äô„ÄòFB3 „Äô
    „Äî    „Äï„Äî    „Äï„Äî    „Äï„Äî    „Äï„Äî    „Äï„Äî    „Äï
    „Äî    „Äï„Äî    „Äï„Äî    „Äï„Äî    „Äï„ÄîL(f)„Äï</pre>

<p>To illustrate the Function keys‚Äô <strong>bitwise input method</strong>, take <code>F10</code> as an example. The number <strong>10</strong> equals 2<sup><strong>1</strong></sup>&nbsp;+&nbsp;2<sup><strong>3</strong></sup>, corresponding to bits 1 and 3. Therefore, to input <code>F10</code>, you simultaneously press the bit 1 key <kbd>FB1</kbd> and the bit 3 key <kbd>FB3</kbd>!</p>

<pre>Interactive content: <a href="https://leanrada.com/notes/my-personalised-keyboard?ref=rss">Visit the website to play with interactive content!</a>
Alternative text: interactive simulation of bitwise keyboard input</pre>
Demo! Here, the bit keys are mapped to QWER. You‚Äôll need a keyboard for this.
<p>More details and demos in <a target="_blank" href="https://leanrada.com/notes/developing-bitwise-input-method?ref=rss">this post about how the bitwise input works</a>.</p>

<p>On the left side we have the OS switchers, providing the <kbd>macOS</kbd> &amp; <kbd>Linux</kbd> modes. The selected OS determines a lot of things, such as the primary modifier (either <code>Control</code> or <code>Command</code>) and some desktop shortcuts.</p>

<pre>Interactive content: <a href="https://leanrada.com/notes/my-personalised-keyboard?ref=rss">Visit the website to play with interactive content!</a>
Alternative text: Lily58 keyboard layout diagram with highlighted keys
  Left hand:
    „Äî    „Äï„ÄòQWERTY„Äô„Äî    „Äï„Äî    „Äï„Äî    „Äï„Äî    „Äï
    „Äî    „Äï„Äî    „Äï„ÄòLinux„Äô„Äò    „Äô„ÄòmacOS„Äô„Äî    „Äï
    „Äî    „Äï„Äî ‚áß  „Äï„Äî ‚åò  „Äï„Äî ‚å•  „Äï„Äî ‚åÉ  „Äï„Äî    „Äï
    „Äî    „Äï„Äî    „Äï„Äî    „Äï„Äî    „Äï„Äî    „Äï„Äî    „Äï
    „Äî    „Äï„Äî    „Äï„Äî    „Äï„Äî    „Äï„Äî    „Äï
  Right hand:
    „Äî    „Äï„Äî    „Äï„Äîüîâ- „Äï„Äîüîä+ „Äï„ÄîüîÖ- „Äï„ÄîüîÜ+ „Äï
    „Äî    „Äï„Äî    „Äï„Äî ‚èÆÔ∏è „Äï„Äî ‚èØÔ∏è „Äï„ÄîPrtScr„Äï„Äî ‚è≠Ô∏è „Äï
    „Äî    „Äï„Äî üîá „Äï„ÄîFB0 „Äï„ÄîFB1 „Äï„ÄîFB2 „Äï„ÄîFB3 „Äï
    „Äî    „Äï„Äî    „Äï„Äî    „Äï„Äî    „Äï„Äî    „Äï„Äî    „Äï
    „Äî    „Äï„Äî    „Äï„Äî    „Äï„Äî    „Äï„ÄîL(f)„Äï</pre>

<p>I don‚Äôt use Windows, so I didn‚Äôt support it.</p>

<p>Finally, the <kbd>QWERTY</kbd> button. Its function should be obvious enough, but we‚Äôll get to that later.</p>

<h2 id="emojis-">Emojis <img alt="" src="https://leanrada.com/notes/my-personalised-keyboard/emoji_layer_oled.png?ref=rss"></h2>

<pre>Interactive content: <a href="https://leanrada.com/notes/my-personalised-keyboard?ref=rss">Visit the website to play with interactive content!</a>
Alternative text: Lily58 keyboard layout diagram
  Left hand:
    „ÄîCancel„Äï„Äî    „Äï„Äî    „Äï„Äî    „Äï„Äî    „Äï„Äî    „Äï
    „Äî    „Äï„Äî üò≠ „Äï„Äî üëã „Äï„Äî ü•∫ „Äï„Äî üéâ „Äï„Äî    „Äï
    „Äî    „Äï„Äî üòÇ „Äï„Äî üòÉ „Äï„Äî üôÇ „Äï„Äî ü§î „Äï„Äî    „Äï
    „Äî    „Äï„Äî    „Äï„Äî    „Äï„Äî    „Äï„Äî    „Äï„Äî    „Äï
    „Äî    „Äï„Äî    „Äï„Äî    „Äï„Äî    „Äï„Äî    „Äï
  Right hand:
    „ÄîL(e)„Äï„Äî ‚Äò  „Äï„Äî ‚Äô  „Äï„Äî ‚Äú  „Äï„Äî ‚Äù  „Äï„Äî ‚ùå  „Äï
    „Äî    „Äï„Äî üëà „Äï„Äî ‚òù  „Äï„Äî üëá „Äï„Äî üëâ „Äï„Äî üëç „Äï
    „Äî    „Äï„Äî ‚Üê  „Äï„Äî ‚Üë  „Äï„Äî ‚Üì  „Äï„Äî ‚Üí  „Äï„Äî ‚úî  „Äï
    „Äî    „Äï„Äî ‚¨Ö  „Äï„Äî ‚¨Ü  „Äï„Äî ‚¨á  „Äï„Äî ‚û°  „Äï„Äî ‚úÖ  „Äï
    „Äî    „Äï„Äî    „Äï„Äî    „Äï„Äî    „Äï„Äî    „Äï</pre>

<p>Yep, an <strong>Emoji layer</strong>! üòÉ <span>‚¨Ö I typed that with my keyboard!</span> And other useful Unicode symbols.</p>

<p>I mapped the emojis so they line up with the base layer. For instance, üéâ is on the same position as <kbd>p</kbd>, which can stand for ‚Äúparty‚Äù. üëã on <kbd>w</kbd>ave. ü§î on <kbd>t</kbd>hink. <code>‚úî</code> on <code>Enter</code>, and so on. Meanwhile, the arrow symbols correspond to the arrow keys in the Navigation layer.</p>

<p>The Emoji layer works a bit differently. It‚Äôs a <a target="_blank" href="https://docs.qmk.fm/#/one_shot_keys">one-shot layer</a> in QMK terms. That is, you don‚Äôt have to hold down the layer key <kbd>L(e)</kbd> to keep the layer active. It stays active until you select an emoji or you cancel. This allows the Emoji layer key to be tucked in the top corner without sacrificing comfort.</p>

<p>Being a one-shot layer also opens up the possibility of a new gesture, <em>double tap</em>. I‚Äôve set it so that double tapping the Emoji key launches the desktop-level <strong>emoji picker</strong> for all of my other emoji needs.</p>

<img srcset="/notes/my-personalised-keyboard/emoji-picker_664.generated.png 664w" sizes=" 664px" alt="" src="https://leanrada.com/notes/my-personalised-keyboard/emoji-picker.png?ref=rss" spec="100% [664) 664" loading="lazy" width="100%" height="">
<span>macOS Character Viewer (left) and Linux-based emoji-picker (right)</span>
<p>On macOS, it‚Äôs <code>Command+Control+Space</code> to bring up Character Viewer. On Windows (hypothetically), that‚Äôd be <code>Super+.</code> for the ‚Äúemoji keyboard‚Äù. On Linux there is no standard emoji picker, so I installed one and bound it to some arbitrary shortcut. I‚Äôm not liking how the Linux one looks, but it‚Äôs what it is.</p>

<h2 id="oled-üì∫">OLED üì∫</h2>

<img srcset="/notes/my-personalised-keyboard/oled_664.generated.jpg 664w" sizes=" 664px" alt="close-up photo of the OLED screen" src="https://leanrada.com/notes/my-personalised-keyboard/oled.jpg?ref=rss" spec="100% [664) 664" loading="lazy" width="100%" height="">

<p>I drew and implemented my own graphics for the keyboard‚Äôs built-in OLED. You‚Äôve seen some of them from the examples above. The OLED shows the current active layer, the current OS mode, and any active modifiers.</p>

<img srcset="/notes/my-personalised-keyboard/legend_600.generated.png 600w,/notes/my-personalised-keyboard/legend_664.generated.png 664w" sizes="not (min-width:664px) 600px, 664px" alt="OLED icons legend" src="https://leanrada.com/notes/my-personalised-keyboard/legend.png?ref=rss" spec="100% [664) 664" loading="lazy" width="100%" height="">

<p>It has been a struggle to make legible tile graphics at a very low resolution, but I think they turned out fine for my purposes.</p>

<h2 id="layer-lock-üîí">Layer lock üîí</h2>

<p>Sometimes it gets tiring to hold down a layer key for long. Like when browsing a web page, I would want to have Page Down and Page Up readily accessible.</p>

<p><em>Layer Lock</em> to the rescue. I used another of Getreuer‚Äôs modular QMK libraries, the <a target="_blank" href="https://getreuer.info/posts/keyboards/layer-lock/index.html"><strong>Layer Lock library</strong></a>, which was really easy to plug in.</p>

<h2 id="gaming-mode--qwerty-üéÆ">Gaming mode / QWERTY üéÆ</h2>

<pre>Interactive content: <a href="https://leanrada.com/notes/my-personalised-keyboard?ref=rss">Visit the website to play with interactive content!</a>
Alternative text: Lily58 keyboard layout diagram
  Left hand:
    „ÄîEsc „Äï„Äî 1  „Äï„Äî 2  „Äï„Äî 3  „Äï„Äî 4  „Äï„Äî 5  „Äï
    „Äî `  „Äï„Äî Q  „Äï„Äî W  „Äï„Äî E  „Äï„Äî R  „Äï„Äî T  „Äï
    „ÄîTab „Äï„Äî A  „Äï„Äî S  „Äï„Äî D  „Äï„Äî F  „Äï„Äî G  „Äï
    „Äî ‚áß  „Äï„Äî Z  „Äï„Äî X  „Äï„Äî C  „Äï„Äî V  „Äï„Äî B  „Äï
    „Äî ‚åÉ  „Äï„Äî ‚å•  „Äï„Äî ‚ùñ  „Äï„Äî ‚ê£  „Äï„Äî    „Äï
  Right hand:
    „Äî 6  „Äï„Äî 7  „Äï„Äî 8  „Äï„Äî 9  „Äï„Äî 0  „Äï„Äî ‚å´  „Äï
    „Äî Y  „Äï„Äî U  „Äï„Äî I  „Äï„Äî O  „Äï„Äî P  „Äï„Äî -  „Äï
    „Äî H  „Äï„Äî J  „Äï„Äî K  „Äï„Äî L  „Äï„Äî ‚Üë  „Äï„Äî ‚Üµ  „Äï
    „Äî N  „Äï„Äî M  „Äï„Äî .  „Äï„Äî ‚Üê  „Äï„Äî ‚Üì  „Äï„Äî ‚Üí  „Äï
    „ÄîCancel„Äï„Äî ‚ê£  „Äï„Äî ‚óÜ  „Äï„Äî    „Äï„ÄîChat„Äï</pre>

<p>I play video games on my computer. Games almost always default to a QWERTY layout, and I couldn‚Äôt be bothered to remap the keybindings to my own keyboard layout.</p>

<p>Thus, <strong>QWERTY mode</strong>.</p>

<p>The interesting bit here is the <kbd>Chat</kbd> key, which temporarily activates the base layer for the purpose of chatting in-game. Upon sending a message (on <code>Enter</code>), it reverts back to QWERTY mode so I can get back to the action in no time.</p>

<p>It‚Äôs not perfect. When gaming with a mouse, I don‚Äôt have access to the right half of the keyboard, as it becomes either too far or inconvenient to reach. It‚Äôs a problem if, say, I needed to press the number <kbd>6</kbd> to activate the 6th item in my inventory.</p>

<p>Often I end up remapping keybindings anyway, just to fit them within the left half.</p>

<h2 id="conclusion">Conclusion</h2>

<p>Programming my keyboard was definitely worth it. You see, I get wrist and upper back pain sometimes. Part of the job, I guess. It helps to have a split keyboard, so I can position my arms and hands in a natural position.</p>

<h3 id="ergonomics">Ergonomics</h3>

<p>In a regular keyboard, you kinda squeeze your hands together, and the wrists insists on twisting which plants the seeds of suffering and despair. That wouldn‚Äôt be a problem if each hand has its own separate half of the keyboard as in a split keyboard.</p>

<img srcset="/notes/my-personalised-keyboard/desk_664.generated.jpg 664w" sizes=" 664px" alt="" src="https://leanrada.com/notes/my-personalised-keyboard/desk.jpg?ref=rss" spec="100% [664) 664" loading="lazy" width="100%" height="">
<span>My desk setup.</span>
<p>The distance between both halves can also be <span aria-label="widened">&nbsp;w&nbsp;i&nbsp;d&nbsp;e&nbsp;n&nbsp;e&nbsp;d&nbsp;</span> which, in turn, widens my shoulders and counters the slouch of the upper back. <em>Fight the slouch, to fight the ouch</em>. It also helps that overall finger movement is reduced, thanks to the customised keyboard layout.</p>

<h3 id="layout">Layout</h3>

<p>It wasn‚Äôt easy adjusting to a completely new keyboard layout. I even made <a target="_blank" href="https://leanrada.com/notes/my-personalised-keyboard/layers.pdf?ref=rss">cheatsheets</a> for my own reference. I only got comfortable with it after about 2 months of daily use. Today, I still don‚Äôt type as fast as I was before with QWERTY, and I don‚Äôt think I ever will be, but I choose comfort over speed. :)</p>

<p>A lot of people say they found it difficult to come back to a regular QWERTY keyboard (like when using a laptop away from their desks), but I did not find it difficult myself. Somehow, I retained my QWERTY muscle memory. I‚Äôm guessing it‚Äôs because I used a completely different layout, Colemak, on my split keyboard so my brain didn‚Äôt confuse it with my existing QWERTY pathways.</p>

<p>It‚Äôs also interesting that I struggled typing with QWERTY on <em>this</em> keyboard (I used QWERTY at first before trying Colemak). And that it was easier to learn Colemak than relearn QWERTY on this keyboard.</p>

<p>I think it‚Äôs like how you don‚Äôt confuse using a mouse with using a touchpad ‚Äî <em>they‚Äôre different pathways</em>. So my advice is to use a completely different layout when trying out a new ortholinear or split keyboard.</p>

<h3 id="fun">Fun</h3>

<p>There‚Äôs a fun aspect to it too. Well, if tinkering with a keyboard and optimising it is your idea of fun‚Ä¶ I knew I was going to like having a programmable keyboard because of my experience with the Steam Controller which was a kind of a programmable controller in a sense. I might have overdone it with the layers, but in the end it works for me.</p>

<p>As a bonus, I get to practice my C programming skills!</p>

<p>tl;dr:</p>

<ul>
              <li>Comfort üëç</li>
              <li>Speed ‚ùå</li>
              <li>Efficiency ‚úÖ</li>
              <li>‚ÄúFun‚Äù ‚úÖ</li>
              <li>Coding practice ‚úÖ</li>
            </ul>
]]></description>
            <link>https://leanrada.com/notes/my-personalised-keyboard?ref=rss</link>
            <guid isPermaLink="true">https://leanrada.com/notes/my-personalised-keyboard?ref=rss</guid>
            <pubDate>Fri, 01 Dec 2023 00:00:00 GMT</pubDate>
        </item>
        <item>
            <title><![CDATA[Baybayin calligraphy generator]]></title>
            <description><![CDATA[
<h1 id="guhitkudlit">GuhitKudlit</h1>

<img srcset="/wares/guhit-kudlit/pakita_664.generated.png 664w" sizes=" 664px" alt="preview" src="https://leanrada.com/wares/guhit-kudlit/pakita.png?ref=rss" spec="100% [664) 664" loading="lazy" width="100%" height="">

<h2 id="baybayin-calligraphy-generator">Baybayin calligraphy generator</h2>

<p><a target="_blank" href="https://leanrada.com/guhit-kudlit/">GuhitKudlit</a> is a webapp that generates <em>baybayin</em> calligraphy.</p>

<p><a target="_blank" href="https://en.wikipedia.org/wiki/Baybayin">Baybayin</a> is an ancient writing system used in the Philippines, mostly for the Tagalog language. I‚Äôve always been fascinated by Philippine languages, and this project was just another fruit of that curiosity.</p>
<aside>
              <div>
                <div>Project details</div>
                <a target="_blank" tag="a" href="https://leanrada.com/guhit-kudlit/">
                  Open the app
                </a>
              </div>
              <div>
                <div>
                  <div>released</div>
                  <div>2023</div>
                </div>
                <div>
                  <div>role</div>
                  <div>creator</div>
                </div>
                <div>
                  <div>platform</div>
                  <div>Web</div>
                </div>
                <div>
                  <div>tech</div>
                  <div>JS</div>
                </div>
              </div>
            </aside>
<img srcset="/wares/guhit-kudlit/guhit_664.generated.png 664w" sizes=" 664px" alt="Generated baybayin calligraphy of the word ‚Äòguhit‚Äô" src="https://leanrada.com/wares/guhit-kudlit/guhit.png?ref=rss" spec="100% [664) 664" loading="lazy" width="100%" height="">
<span>Output of GuhitKudlit for the word ‚Äòguhit‚Äô</span>
<p>The name comes from <em>‚Äòguhit‚Äô</em> meaning line or drawing, and <em>‚Äòkudlit‚Äô</em> meaning tick or small mark.</p>

<p>You see, baybayin is an <a target="_blank" href="https://en.wikipedia.org/wiki/Abugida">abugida</a> and in baybayin, the <em>kudlit</em> is used to signify the vowel of a character.</p>

<img srcset="/wares/guhit-kudlit/baybayin-chart_664.generated.png 664w" sizes=" 664px" alt="chart of baybayin characters" src="https://leanrada.com/wares/guhit-kudlit/baybayin-chart.png?ref=rss" spec="100% [664) 664" loading="lazy" width="100%" height="">
<span>Chart of baybayin characters from Wikimedia</span>
<p>The program is divided into two functions: <strong>transliteration</strong> and <strong>calligraphy</strong>. The transliteration process converts ASCII input to baybayin glyphs, and the calligraphy function draws those glyphs onto the canvas using the <a target="_blank" href="https://p5js.org/">p5.js library</a>.</p>

<h2 id="transliteration">Transliteration</h2>

<p>The transliteration algorithm that converts ASCII text to baybayin glyphs is quite simple (or should I say, simplistic?). It processes the input letter-by-letter, and produces output one syllable at a time.</p>

<video src="https://leanrada.com/wares/guhit-kudlit/transliteration.mp4?ref=rss" muted="" autoplay="" loop="" aria-label="video of transliteration">
                Video: video of transliteration | Source: /wares/guhit-kudlit/transliteration.mp4
              </video>

<p>This works great for Tagalog words, not so much for English which has arbitrary rules on syllables &amp; pronunciation. Thus, the converter was only intended to primarily work in Tagalog.</p>

<p>For example, Tagalog doesn‚Äôt have a letter for the ‚Äúj‚Äù sound (Compare Japanese, which has no direct ‚ÄúL‚Äù sound). The transliteration function deliberately does not handle these cases to avoid misspellings and false assumptions. If you attempt to put in foreign letters, an error will stop you.</p>

<img srcset="/wares/guhit-kudlit/ceres_498.generated.png 498w,/wares/guhit-kudlit/ceres_664.generated.png 664w" sizes="not (min-width:664px) 498px, 664px" alt="screenshot of error message, saying 'Cannot unambiguously convert this letter. There is no direct baybayin equivalent for the said letter. You can write it first in the Tagalog alphabet (abakada).'" src="https://leanrada.com/wares/guhit-kudlit/ceres.png?ref=rss" spec="100% [664) 664" loading="lazy" width="100%" height="">

<p>One thing I‚Äôve noticed in other baybayin converters online was that their outputs were <em>opaque</em>. That is, if you can‚Äôt read baybayin, you can‚Äôt verify the output. This would sometimes trick people into getting silly mispelled tattoos and stuff. While that‚Äôs their fault for being ignorant, we can do better.</p>

<img srcset="/wares/guhit-kudlit/tilapia_486.generated.png 486w,/wares/guhit-kudlit/tilapia_664.generated.png 664w" sizes="not (min-width:664px) 486px, 664px" alt="example of syllabication. tilapia, ti-la-pi-ya" src="https://leanrada.com/wares/guhit-kudlit/tilapia.png?ref=rss" spec="100% [664) 664" loading="lazy" width="100%" height="">

<p>GuhitKudlit makes the transliteration process transparent by showing the resulting syllabication, which one-to-one maps to baybayin glyphs. This should allow users to double-check their results and make adjustments.</p>

<p>The module had a single-file test suite:</p>

<pre><code><span>import</span> <span>{</span> baybayin <span>}</span> <span>from</span> <span>"./baybay.mjs"</span><span>;</span>

<span>// Karaniwan</span>
<span>dapat</span><span>(</span><span>baybayin</span><span>(</span><span>"aso"</span><span>)</span><span>)</span><span>.</span><span>ay</span><span>(</span><span>[</span><span>"a"</span><span>,</span> <span>"su"</span><span>]</span><span>)</span><span>;</span>
<span>dapat</span><span>(</span><span>baybayin</span><span>(</span><span>"pusa"</span><span>)</span><span>)</span><span>.</span><span>ay</span><span>(</span><span>[</span><span>"pu"</span><span>,</span> <span>"sa"</span><span>]</span><span>)</span><span>;</span>
<span>dapat</span><span>(</span><span>baybayin</span><span>(</span><span>"araw"</span><span>)</span><span>)</span><span>.</span><span>ay</span><span>(</span><span>[</span><span>"a"</span><span>,</span> <span>"da"</span><span>,</span> <span>"w"</span><span>]</span><span>)</span><span>;</span>
<span>dapat</span><span>(</span><span>baybayin</span><span>(</span><span>"elepante"</span><span>)</span><span>)</span><span>.</span><span>ay</span><span>(</span><span>[</span><span>"i"</span><span>,</span> <span>"li"</span><span>,</span> <span>"pa"</span><span>,</span> <span>"n"</span><span>,</span> <span>"ti"</span><span>]</span><span>)</span><span>;</span>
<span>dapat</span><span>(</span><span>baybayin</span><span>(</span><span>"bantay"</span><span>)</span><span>)</span><span>.</span><span>ay</span><span>(</span><span>[</span><span>"ba"</span><span>,</span> <span>"n"</span><span>,</span> <span>"ta"</span><span>,</span> <span>"y"</span><span>]</span><span>)</span><span>;</span>
<span>dapat</span><span>(</span><span>baybayin</span><span>(</span><span>"daan"</span><span>)</span><span>)</span><span>.</span><span>ay</span><span>(</span><span>[</span><span>"da"</span><span>,</span> <span>"a"</span><span>,</span> <span>"n"</span><span>]</span><span>)</span><span>;</span>
<span>dapat</span><span>(</span><span>baybayin</span><span>(</span><span>"doon"</span><span>)</span><span>)</span><span>.</span><span>ay</span><span>(</span><span>[</span><span>"du"</span><span>,</span> <span>"u"</span><span>,</span> <span>"n"</span><span>]</span><span>)</span><span>;</span>
<span>dapat</span><span>(</span><span>baybayin</span><span>(</span><span>"biik"</span><span>)</span><span>)</span><span>.</span><span>ay</span><span>(</span><span>[</span><span>"bi"</span><span>,</span> <span>"i"</span><span>,</span> <span>"k"</span><span>]</span><span>)</span><span>;</span>
<span>dapat</span><span>(</span><span>baybayin</span><span>(</span><span>"kailan"</span><span>)</span><span>)</span><span>.</span><span>ay</span><span>(</span><span>[</span><span>"ka"</span><span>,</span> <span>"i"</span><span>,</span> <span>"la"</span><span>,</span> <span>"n"</span><span>]</span><span>)</span><span>;</span>
<span>dapat</span><span>(</span><span>baybayin</span><span>(</span><span>"baon"</span><span>)</span><span>)</span><span>.</span><span>ay</span><span>(</span><span>[</span><span>"ba"</span><span>,</span> <span>"u"</span><span>,</span> <span>"n"</span><span>]</span><span>)</span><span>;</span>
<span>dapat</span><span>(</span><span>baybayin</span><span>(</span><span>"baul"</span><span>)</span><span>)</span><span>.</span><span>ay</span><span>(</span><span>[</span><span>"ba"</span><span>,</span> <span>"u"</span><span>,</span> <span>"l"</span><span>]</span><span>)</span><span>;</span>
<span>dapat</span><span>(</span><span>baybayin</span><span>(</span><span>"kain"</span><span>)</span><span>)</span><span>.</span><span>ay</span><span>(</span><span>[</span><span>"ka"</span><span>,</span> <span>"i"</span><span>,</span> <span>"n"</span><span>]</span><span>)</span><span>;</span>
<span>dapat</span><span>(</span><span>baybayin</span><span>(</span><span>"upuan"</span><span>)</span><span>)</span><span>.</span><span>ay</span><span>(</span><span>[</span><span>"u"</span><span>,</span> <span>"pu"</span><span>,</span> <span>"a"</span><span>,</span> <span>"n"</span><span>]</span><span>)</span><span>;</span>

<span>// Di normal na baybay</span>
<span>dapat</span><span>(</span><span>baybayin</span><span>(</span><span>"tilapia"</span><span>)</span><span>)</span><span>.</span><span>ay</span><span>(</span><span>[</span><span>"ti"</span><span>,</span> <span>"la"</span><span>,</span> <span>"pi"</span><span>,</span> <span>"ya"</span><span>]</span><span>)</span><span>;</span>
<span>dapat</span><span>(</span><span>baybayin</span><span>(</span><span>"durian"</span><span>)</span><span>)</span><span>.</span><span>ay</span><span>(</span><span>[</span><span>"du"</span><span>,</span> <span>"di"</span><span>,</span> <span>"ya"</span><span>,</span> <span>"n"</span><span>]</span><span>)</span><span>;</span>

<span>// Bigkas na iba sa baybay</span>
<span>dapat</span><span>(</span><span>baybayin</span><span>(</span><span>"ng"</span><span>)</span><span>)</span><span>.</span><span>ay</span><span>(</span><span>[</span><span>"na"</span><span>,</span> <span>"ng"</span><span>]</span><span>)</span><span>;</span>
<span>dapat</span><span>(</span><span>baybayin</span><span>(</span><span>"mga"</span><span>)</span><span>)</span><span>.</span><span>ay</span><span>(</span><span>[</span><span>"ma"</span><span>,</span> <span>"nga"</span><span>]</span><span>)</span><span>;</span>
<span>// ...</span></code></pre>

<p>(Yes, I wrote all the code for this project in Tagalog)</p>

<p>The transliteration process is just one half of the program. It took me a a while to code it, but what I really wanted to make was the drawing algorithm. While transliteration is essential for a good user experience, the real show starts with the calligraphy algorithm.</p>

<h2 id="calligraphy">Calligraphy</h2>

<p>Once we have a sequence of baybayin glyphs, we can start drawing them on the canvas.</p>

<p>The calligraphy algorithm goes like this (heavily simplified):</p>

<ol start="0">
              <li>A brush head is simulated in 2D space. It has position, size, velocity, pressure, and other properties.</li>
              <li>The brush is continuously pulled along the canvas following the strokes of the current glyph. This simulation mimics natural movement and momentum.</li>
              <li>When the current glyph is finished, the brush head moves down the next available space to start drawing the next glyph, and so on.</li>
            </ol>

<video src="https://leanrada.com/wares/guhit-kudlit/calligraphy.mp4?ref=rss" muted="" autoplay="" loop="" aria-label="video of calligraphy algorithm in action">
                Video: video of calligraphy algorithm in action | Source: /wares/guhit-kudlit/calligraphy.mp4
              </video>

<p>There are four preset calligraphy styles. These variations are created by changing the parameters of the brush simulation, like acceleration, pressure, etc.</p>

<img srcset="/wares/guhit-kudlit/styles_664.generated.png 664w" sizes=" 664px" alt="screenshot of different calligraphy styles" src="https://leanrada.com/wares/guhit-kudlit/styles.png?ref=rss" spec="100% [664) 664" loading="lazy" width="100%" height="">
<span>Different styles starting from top-left, clockwise: Modern, Classic, Dry brush, Chisel tip</span>
<p>To define the vertices or waypoints that the brush head would follow, I started by decomposing baybayin into individual strokes and identified the common structural elements.</p>

<p>You know how Latin characters have something called ‚Äútypography anatomy‚Äù? Things like ascenders, descenders, stems, bars, etc? These are elements common across Latin letters, like how the loop in ‚Äòb‚Äô is the same loop as in ‚Äòp‚Äô, just with a different stem.</p>

<img srcset="/wares/guhit-kudlit/latin-parts_664.generated.png 664w" sizes=" 664px" alt="Elements of Latin typography, partial anatomy" src="https://leanrada.com/wares/guhit-kudlit/latin-parts.png?ref=rss" spec="100% [664) 664" loading="lazy" width="100%" height="">

<p>Well, I tried to decompose baybayin in a similar way. A big inspiration came from others who have done the same before, like <a target="_blank" href="https://nordenx.blogspot.com/2014/04/saving-baybayin-through-technology.html">Nordenx</a>. However, for my specific purpose of constructing baybayin forms programmatically, my decomposition strategy is more about the reuse of common elements.</p>

<img srcset="/wares/guhit-kudlit/baybayin-parts_664.generated.png 664w" sizes=" 664px" alt="Elements of Baybayin typography, partial anatomy" src="https://leanrada.com/wares/guhit-kudlit/baybayin-parts.png?ref=rss" spec="100% [664) 664" loading="lazy" width="100%" height="">

<p>Here‚Äôs a partial list of the typographical building blocks that I ended up with:</p>

<img srcset="/wares/guhit-kudlit/baybayin-elements_664.generated.png 664w" sizes=" 664px" alt="My version of elements of Baybayin typography" src="https://leanrada.com/wares/guhit-kudlit/baybayin-elements.png?ref=rss" spec="100% [664) 664" loading="lazy" width="100%" height="">

<p>The decomposition is more apparent in code:</p>

<pre><code><span>const</span> talaguhitan <span>=</span> <span>{</span>
  <span>"a"</span><span>:</span> <span>[</span>
    <span>...</span>guhitYa<span>,</span>
    <span>[</span>guhitTuwid<span>,</span> <span>0.0</span><span>,</span> <span>0.4</span><span>,</span> <span>0.2</span><span>,</span> <span>0.4</span><span>,</span> <span>0.05</span><span>,</span> <span>-</span><span>0.05</span><span>,</span> <span>PUTOL</span><span>]</span><span>,</span>
  <span>]</span><span>,</span>
  <span>"i"</span><span>:</span> <span>[</span>
    <span>[</span>guhitAlon<span>,</span> <span>0.0</span><span>,</span> <span>0.2</span><span>,</span> <span>1.0</span><span>,</span> <span>0.2</span><span>,</span> <span>0.0</span><span>,</span> <span>0.1</span><span>,</span> <span>PUTOL</span><span>]</span><span>,</span>
    <span>[</span>guhitUlap<span>,</span> <span>0.0</span><span>,</span> <span>0.5</span><span>,</span> <span>1.0</span><span>,</span> <span>0.5</span><span>,</span> <span>0.0</span><span>,</span> <span>0.2</span><span>,</span> <span>PUTOL</span><span>]</span><span>,</span>
  <span>]</span><span>,</span>
  <span>"u"</span><span>:</span> <span>[</span>
    <span>[</span>guhitIlog<span>,</span> <span>0.3</span><span>,</span> <span>0.0</span><span>,</span> <span>0.3</span><span>,</span> <span>1.0</span><span>,</span> <span>0.4</span><span>,</span> <span>0.0</span><span>,</span> <span>PUTOL</span><span>]</span><span>,</span>
  <span>]</span><span>,</span>
  <span>"b"</span><span>:</span> <span>[</span>
    <span>[</span>guhitBundok<span>,</span> <span>0.0</span><span>,</span> <span>0.8</span><span>,</span> <span>0.5</span><span>,</span> <span>0.2</span><span>,</span> <span>1.0</span><span>,</span> <span>0.7</span><span>,</span> <span>0.1</span><span>,</span> <span>0.1</span><span>]</span><span>,</span>
    <span>[</span>guhitUlap<span>,</span> <span>DUGTONG</span><span>,</span> <span>DUGTONG</span><span>,</span> <span>0.05</span><span>,</span> <span>0.7</span><span>,</span> <span>0.0</span><span>,</span> <span>0.3</span><span>,</span> <span>PUTOL</span><span>]</span><span>,</span>
  <span>]</span><span>,</span>
  <span>// ...</span></code></pre>

<p>In the above code, baybayin glyphs (represented by Latin character keys) are defined by an array of elements. The numbers next to each element are parameters that vary the position &amp; form of the element.</p>

<p>Looking at <em>‚Äòb‚Äô</em> (·úä), we can see that it‚Äôs composed of a <code>guhitBundok</code> connected (<code>DUGTONG</code>) to a <code>guhitUlap</code> below it. (‚Äúguhit‚Äù means stroke in this case)</p>

<pre><code><span>"b"</span><span>:</span> <span>[</span>
  <span>[</span>guhitBundok<span>,</span> <span>0.0</span><span>,</span> <span>0.8</span><span>,</span> <span>0.5</span><span>,</span> <span>0.2</span><span>,</span> <span>1.0</span><span>,</span> <span>0.7</span><span>,</span> <span>0.1</span><span>,</span> <span>0.1</span><span>]</span><span>,</span>
  <span>[</span>guhitUlap<span>,</span> <span>DUGTONG</span><span>,</span> <span>DUGTONG</span><span>,</span> <span>0.05</span><span>,</span> <span>0.7</span><span>,</span> <span>0.0</span><span>,</span> <span>0.3</span><span>,</span> <span>PUTOL</span><span>]</span><span>,</span>
<span>]</span><span>,</span></code></pre>

<p>Sometimes a character can even reuse another character, like <em>‚Äòa‚Äô</em> (·úÄ) which is just <em>‚Äòya‚Äô</em> (·úå) with an extra <code>guhitTuwid</code> (straight stroke).</p>

<pre><code><span>"a"</span><span>:</span> <span>[</span>
  <span>...</span>guhitYa<span>,</span>
  <span>[</span>guhitTuwid<span>,</span> <span>0.0</span><span>,</span> <span>0.4</span><span>,</span> <span>0.2</span><span>,</span> <span>0.4</span><span>,</span> <span>0.05</span><span>,</span> <span>-</span><span>0.05</span><span>,</span> <span>PUTOL</span><span>]</span><span>,</span>
<span>]</span><span>,</span></code></pre>

<img srcset="/wares/guhit-kudlit/nagpaambon_664.generated.png 664w" sizes=" 664px" alt="Baybayin of the word ‚Äònagpaambon‚Äô" src="https://leanrada.com/wares/guhit-kudlit/nagpaambon.png?ref=rss" spec="100% [664) 664" loading="lazy" width="100%" height="">
<span>Decomposition of baybayin in the word ·úà·úÑ·úï·úâ·úÄ·úã·úï·úä·úì·úà·úï (‚Äònagpaambon‚Äô, ‚Äòmade something be rained on‚Äô)</span>
<p>You probably have inferred that these vertices are hardcoded, so the resulting calligraphy is not as dynamic as you might expect. One quick fix I added was to slightly warp them in certain directions with a bit of randomness, but it‚Äôs not great. This is something I could improve upon in a future iteration ‚Äî e.g., make the brush movement purposeful, or arrange vertices with respect to other vertices across the whole word.</p>

<h2 id="end-note">End note</h2>

<p>This was a project that was hastily launched as a proof-of-concept. It was fun, but the codebase got quite spaghetti. The concept seems mildly successful, since it is now getting regular visitors (though, I have no idea what they actually do with it, I haven‚Äôt seen an output of this in the wild). Anyway, since this webapp looks useful, I intend to rewrite it with a better and more dynamic calligraphy algorithm. Maybe.</p>

<img srcset="/wares/guhit-kudlit/padayon_664.generated.png 664w" sizes=" 664px" alt="Generated baybayin calligraphy of the word ‚Äòpadayon‚Äô" src="https://leanrada.com/wares/guhit-kudlit/padayon.png?ref=rss" spec="100% [664) 664" loading="lazy" width="100%" height="">
<span>This post wouldn‚Äôt be complete without writing the now-clich√©d word ‚Äòpadayon‚Äô in baybayin.</span>]]></description>
            <link>https://leanrada.com/wares/guhit-kudlit?ref=rss</link>
            <guid isPermaLink="true">https://leanrada.com/wares/guhit-kudlit?ref=rss</guid>
            <pubDate>Mon, 30 Oct 2023 00:00:00 GMT</pubDate>
        </item>
        <item>
            <title><![CDATA[Debug CSS boxes with this bookmarklet]]></title>
            <description><![CDATA[
<p>Here‚Äôs a quick &amp; simple way to show all element bounds on a page.</p>

<pre><code><span>javascript</span><span>:</span><span>(</span>a<span>=</span><span>(</span>d<span>=</span>document<span>)</span><span>.</span><span>createElement</span><span>(</span><span>'style'</span><span>)</span><span>)</span><span>.</span>innerHTML<span>=</span><span>'*{outline:solid 1px red}'</span><span>;</span>d<span>.</span>head<span>.</span><span>append</span><span>(</span>a<span>)</span></code></pre>

<p>The bookmarklet: <a target="_self" href="https://leanrada.com/notes/debug-css-boxes-bookmarklet/javascript:(a=(d=document).createElement('style')).innerHTML='*{outline:solid 1px red}';d.head.append(a)?ref=rss"><strong>‚ñ§outlinify</strong></a></p>

<img srcset="/notes/debug-css-boxes-bookmarklet/example_664.generated.png 664w" sizes=" 664px" alt="example of a website with element outlines visible" src="https://leanrada.com/notes/debug-css-boxes-bookmarklet/example.png?ref=rss" spec="100% [664) 664" loading="lazy" width="100%" height="">
<span>Example result on threads.net</span>
<p>Not sure how to use it? Save or <em>drag</em> the following link into your bookmarks:</p>
<a target="_self" tag="aa" href="https://leanrada.com/notes/debug-css-boxes-bookmarklet/javascript:(a=(d=document).createElement('style')).innerHTML='*{outline:solid 1px red}';d.head.append(a)?ref=rss">
                ‚ñ§outlinify
              </a>‚òù
<video src="https://leanrada.com/notes/debug-css-boxes-bookmarklet/drag.web.mp4?ref=rss" muted="" autoplay="" loop="" aria-label="video of dragging the bookmarklet into the bookmarks bar">
                  Video: video of dragging the bookmarklet into the bookmarks bar | Source: /notes/debug-css-boxes-bookmarklet/drag.web.mp4
                </video>

<p>If you prefer different styles:</p>

<ul>
              <li>Dashed: <a target="_self" tag="aa" href="https://leanrada.com/notes/debug-css-boxes-bookmarklet/javascript:(a=(d=document).createElement('style')).innerHTML='*{outline:dashed 1px red}';d.head.append(a)?ref=rss">
                  ‚ñ§outlinify
                </a></li>
              <li>Dotted: <a target="_self" tag="aa" href="https://leanrada.com/notes/debug-css-boxes-bookmarklet/javascript:(a=(d=document).createElement('style')).innerHTML='*{outline:dotted 1px red}';d.head.append(a)?ref=rss">
                  ‚ñ§outlinify
                </a></li>
            </ul>
]]></description>
            <link>https://leanrada.com/notes/debug-css-boxes-bookmarklet?ref=rss</link>
            <guid isPermaLink="true">https://leanrada.com/notes/debug-css-boxes-bookmarklet?ref=rss</guid>
            <pubDate>Sun, 15 Oct 2023 00:00:00 GMT</pubDate>
        </item>
        <item>
            <title><![CDATA[
                
                  Compressing a website into a URL
                
              ]]></title>
            <description><![CDATA[<p><em>For RSS readers: This article contains interactive content available on the <a href="https://leanrada.com/notes/compressing-websites-into-urls?ref=rss">original post on leanrada.com</a>.</em></p>

<p>This post explains how <a target="_blank" href="https://portabl.ink"><strong>portabl.ink</strong></a> works. Portablink is a tool that creates self-contained compressed web pages in a single link. Check <a target="_self" href="https://leanrada.com/wares/portabl.ink?ref=rss">portablink project page</a> for more info.</p>

<p>tl;dr: It uses <strong>data URLs</strong> containing <strong>compressed data</strong> which is bundled with its own <strong>decompression instructions</strong>.</p>

<h2 id="data-urls">Data URLs</h2>

<p>In case you aren‚Äôt familiar with <a target="_blank" href="https://en.wikipedia.org/wiki/Data_URI_scheme"><strong>data URLs</strong></a>, they are URLs whose contents are in the URL itself. They all start with <code>data:</code>. Here, let me show you with this <em>interactive</em> mock browser:</p>

<pre>Interactive content: <a href="https://leanrada.com/notes/compressing-websites-into-urls?ref=rss">Visit the website to play with interactive content!</a>
Alternative text: browser demo</pre>

<p><em>(Hint: edit the URL in the address bar!)</em></p>

<p>When you load a data URL, the browser shows the content embedded in the URL directly.</p>
<blockquote>
              <p>So, that‚Äôs it? Website in a URL?&nbsp;‚Äî Use data URLs! Easy!</p>
            </blockquote>
<p>Wait, there‚Äôs more! The portablink tool does some more things than just putting your HTML in a data URL. The tool also <strong>compresses</strong> your content so you don‚Äôt end up with humongous URLs.</p>

<h2 id="compression">Compression</h2>

<p>Within a data URL, the tool bundles both the compressed data <em>and</em> the instructions needed to decompress and bootstrap that data. This produces a self-contained, compressed document in a single portable link that can be decompressed and rendered by any modern browser.</p>

<p>Here‚Äôs an example URL generated by the tool:</p>

<pre><code>data:text/html,<span><span><span>&lt;</span>body</span> <span><span>onload</span><span><span>=</span><span>"</span><span>fetch<span><span>`</span><span>data:;base64,fVTfb5swEH7PX+HxUIFiEpJu0pRgpK0P68OyX8pDpSibDJhwqbGZbdrQpP/7DI7WpluDZPv8fb7Pd8dBXJqKJ3HJaJ7EBgxnyRJEi5aQhYbaIVk8dvhgEGvTdgZCqczbvV0RykHXnLazgrPdvEe2jTZQtGEmhWHCzDI7MeU4ymEjQjCs0id4Yc+GBa2At7MGQiUbkbMce9eg6AaERAuqGvRJmhIy9E3JLx7+3kB2q6nI8ZWsCqkMpXhBxZYqwN4HBZSjH04GLZbevxD6KHnu4SsbUmpdtGxUxkIrqMNaSdwbmikouggf7RhtFOSnSXeIS6CzQpuWhQ2zqfOmEnqmWM2o8S/xpFCBO3gPuSln76O7CoRDSgab0jyDusvSxhgp9k/F0fDAZtN3T24cBAuPvpGDUqlypmZacshRhFJOs9tTwZkwZZiVwHP/UgT4/3g4CfbP9ELOChMe4653rwqK4dtTPyPrl27x+NhC1nI913VSEudwhzJOtSZeV0mv67HY3YAgJ14UeUk8dsBLbnKGm57hoskZzTPc9AwXTc9onuGmJ1w8tvXoagTVBmmVEc9DUjClpCLegDODAG/xLa6wIqsIT/B0jUty8buRZg7CHrxeLj67LTZKkAg/kFxmTWW/uFFX8FW5HuB7UpNEM7OEisnG+L9IsqecKePXQ+dsm1XoN84O5i8VyMMjnkRRMMCU+DaggCT2ja/ccTcPYbi1N2XEah+Jm2NcbvnqlvWoorVvw/HVSMuK+S1J1IjdMdX6O5JQf4fboLuS1MHhcMK0ePcKszvDTMO/XBBc0Kqe99O9b/cD1UcDXQidsbVhpSRJR1Jk3P5zumRS63w4+N1yrPvNMZWVLfhPMlnjzLfSPu0rY59B/4L7Zh/3/9w/</span><span>`</span></span><span>.</span><span>then</span><span>(</span><span>a</span><span>=&gt;</span><span>new</span> <span>Response</span><span>(</span>a<span>.</span>body<span>.</span><span>pipeThrough</span><span>(</span><span>new</span> <span>DecompressionStream</span><span>(</span><span><span>`</span><span>deflate-raw</span><span>`</span></span><span>)</span><span>)</span><span>)</span><span>.</span><span>text</span><span>(</span><span>)</span><span>.</span><span>then</span><span>(</span><span>a</span><span>=&gt;</span>document<span>.</span>documentElement<span>.</span>innerHTML<span>=</span>a<span>)</span><span>)</span></span><span>"</span></span></span><span>&gt;</span></span></code></pre>

<p>The URL above is 1,078 bytes. It was compressed from a source doc of size 1.37 KB, which is a 23% compression!</p>

<p>Btw, the above URL loads a simple tic-tac-toe web game. See for yourself by copying it into your browser‚Äôs address bar.</p>

<h2 id="so-how-does-it-work">So, how does it work?</h2>

<p>The embedded document contains a singular <code>&lt;body&gt;</code> tag with an <code>onload</code> callback. The callback itself contains the main script that will decompress and render the desired content.</p>

<p>A small point: Why <code>onload</code>? Well, it‚Äôs shorter than using a <code>&lt;script&gt;</code> tag.</p>

<pre><code>A: <span><span><span>&lt;</span>body</span> <span><span>onload</span><span><span>=</span><span>"</span><span><span>/* code */</span></span><span>"</span></span></span><span>&gt;</span></span>
B: <span><span><span>&lt;</span>script</span><span>&gt;</span></span><span><span><span>/* code */</span></span></span><span><span><span>&lt;/</span>script</span><span>&gt;</span></span></code></pre>

<p>The closing tag is optional for <code>body</code> but not for <code>script</code>. In the end, the <code>body</code> tag wins by 1 character! Every character - in a URL - is precious.</p>
<span>
              <code>&lt;img onerror="..."&gt;</code> would‚Äôve worked as well, having equal length as the <code>body</code> option.
            </span>
<p>Now, with that out of the way, let‚Äôs break the main script down. I‚Äôll plop the prettified code here first, then explain the interesting bits.</p>

<pre><code><span>fetch</span><span>(</span>
  <span><span>`</span><span>data:;base64,fVTfb5swEH7PX+HxUIFiEpJu0pRgpK0P68OyX8pDpSibDJhwqbGZbdrQpP/7DI7WpluDZPv8fb7Pd8dBXJqKJ3HJaJ7EBgxnyRJEi5aQhYbaIVk8dvhgEGvTdgZCqczbvV0RykHXnLazgrPdvEe2jTZQtGEmhWHCzDI7MeU4ymEjQjCs0id4Yc+GBa2At7MGQiUbkbMce9eg6AaERAuqGvRJmhIy9E3JLx7+3kB2q6nI8ZWsCqkMpXhBxZYqwN4HBZSjH04GLZbevxD6KHnu4SsbUmpdtGxUxkIrqMNaSdwbmikouggf7RhtFOSnSXeIS6CzQpuWhQ2zqfOmEnqmWM2o8S/xpFCBO3gPuSln76O7CoRDSgab0jyDusvSxhgp9k/F0fDAZtN3T24cBAuPvpGDUqlypmZacshRhFJOs9tTwZkwZZiVwHP/UgT4/3g4CfbP9ELOChMe4653rwqK4dtTPyPrl27x+NhC1nI913VSEudwhzJOtSZeV0mv67HY3YAgJ14UeUk8dsBLbnKGm57hoskZzTPc9AwXTc9onuGmJ1w8tvXoagTVBmmVEc9DUjClpCLegDODAG/xLa6wIqsIT/B0jUty8buRZg7CHrxeLj67LTZKkAg/kFxmTWW/uFFX8FW5HuB7UpNEM7OEisnG+L9IsqecKePXQ+dsm1XoN84O5i8VyMMjnkRRMMCU+DaggCT2ja/ccTcPYbi1N2XEah+Jm2NcbvnqlvWoorVvw/HVSMuK+S1J1IjdMdX6O5JQf4fboLuS1MHhcMK0ePcKszvDTMO/XBBc0Kqe99O9b/cD1UcDXQidsbVhpSRJR1Jk3P5zumRS63w4+N1yrPvNMZWVLfhPMlnjzLfSPu0rY59B/4L7Zh/3/9w/</span><span>`</span></span>
<span>)</span>
<span>.</span><span>then</span><span>(</span><span>compressedHtml</span> <span>=&gt;</span>
  <span>new</span> <span>Response</span><span>(</span>
    compressedHtml<span>.</span>body
      <span>.</span><span>pipeThrough</span><span>(</span><span>new</span> <span>DecompressionStream</span><span>(</span><span><span>`</span><span>deflate-raw</span><span>`</span></span><span>)</span><span>)</span>
  <span>)</span>
  <span>.</span><span>text</span><span>(</span><span>)</span>
  <span>.</span><span>then</span><span>(</span><span>html</span> <span>=&gt;</span>
    document<span>.</span>documentElement<span>.</span>innerHTML <span>=</span> html
  <span>)</span>
<span>)</span></code></pre>

<h3 id="1-fetchdatabase64fvtfb5sweh">1. fetch(`data:;base64,fVTfb5swEH...`)</h3>

<p>The first thing you‚Äôll notice is the huge chunk of base64-encoded data wrapped in a <code>fetch()</code> call.</p>

<p>The encoded data is the compressed HTML which has been prepared by a complementary compression script. Since compressed data is binary, it has been encoded in a text-friendly format for it to be a valid URL. Base64, an encoding that‚Äôs native to the web, was used for this purpose.</p>

<p>To decode the base64 data, instead of using the standard <a target="_blank" href="https://developer.mozilla.org/en-US/docs/Web/API/atob"><code>atob()</code></a> function, <code>fetch()</code> was used. <code>fetch</code> sees the <code>;base64</code> flag in that data URL and decodes it natively. </p>

<p>While it accomplishes the same thing as <code>atob</code>, <code>fetch</code> is slightly better, because:</p>

<ol>
              <li><code>fetch()</code> outputs a stream, the format needed for decompression later.</li>
              <li>Code size. We‚Äôre optimising for the total URL length. The <code>atob</code> method requires <a target="_blank" href="https://developer.mozilla.org/en-US/docs/Glossary/Base64#the_unicode_problem">extra massaging for Unicode</a>.</li>
            </ol>

<p>Here‚Äôs a quick length comparison. A is fetch. B is atob. Below is a character ruler with markings.</p>

<pre><code><span>A</span><span>:</span> fetch<span><span>`</span><span>data:;base64,dVo=</span><span>`</span></span><span>.</span><span>then</span><span>(</span><span>a</span><span>=&gt;</span>a<span>.</span>body<span>)</span>
<span>B</span><span>:</span> <span>new</span> <span>Blob</span><span>(</span><span>[</span>Uint8Array<span>.</span><span>from</span><span>(</span>atob<span><span>`</span><span>dVo=</span><span>`</span></span><span>,</span><span>a</span><span>=&gt;</span>a<span>.</span><span>codePointAt</span><span>(</span><span>0</span><span>)</span><span>)</span><span>]</span><span>)</span><span>.</span><span>stream</span><span>(</span><span>)</span>
                                          <span>^</span>                           <span>^</span>
                                          <span>A</span>                           <span>B</span>
   <span>0</span>        <span>10</span>        <span>20</span>        <span>30</span>        <span>40</span>        <span>50</span>        <span>60</span>       
   <span>12345678901234567890123456789012345678901234567890123456789012345678</span></code></pre>

<p>The <code>atob()</code> method requires additional 28 characters!</p>
<span>
              <strong><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Template_literals#tagged_templates">Tagged templates</a></strong> can be abused here to save a couple of characters. Instead of <code>fetch("abc")</code>, we can use <code>fetch`abc`</code>!
            </span>
<p>Here is the code described so far:</p>

<pre><code><span><span> </span> <span>/* wrap the compressed data in base64 */</span>
<span> </span> <span>fetch</span><span>(</span><span><span>`</span><span>data:;base64,fVTfb5swEH7PX+HxUIFiEpJu0pRgpK0P68Oy...</span><span>`</span></span><span>)</span>
<span> </span> <span>.</span><span>then</span><span>(</span><span>compressedHtml</span> <span>=&gt;</span>
<span> </span>   <span>/* a binary stream of the compressed data is given by body */</span>
<span> </span>   compressedHtml<span>.</span>body
<span> </span> <span>)</span></span></code></pre>

<h3 id="2-bodypipethroughnew-decompressionstream">2. body.pipeThrough(new DecompressionStream(...))</h3>

<p>Next thing to note is the <code>DecompressionStream</code> class. This is from the new <a target="_blank" href="https://developer.mozilla.org/en-US/docs/Web/API/Compression_Streams_API"><strong>Compression Streams API</strong></a> which allows browser native compression and decompression. This saves a lot of decompression code from being bundled with the URL.</p>

<p>As of writing, this API can only consume streams. That‚Äôs why the code required streams.</p>

<p>Continuing. The <code>body</code> stream containing the compressed data is piped through the decompressor, which results in the uncompressed, original HTML string - in a <em>stream</em>.</p>

<pre><code><span><span> </span> <span>fetch</span><span>(</span><span><span>`</span><span>data:;base64,fVTfb5swEH7PX+HxUIFiEpJu0pRgpK0P68Oy...</span><span>`</span></span><span>)</span>
<span> </span> <span>.</span><span>then</span><span>(</span><span>compressedHtml</span> <span>=&gt;</span>
</span><span><span>-</span>   compressedHtml<span>.</span>body
</span><span><span>+</span>   <span>/* this results in a stream of the original HTML */</span>
<span>+</span>   compressedHtml<span>.</span>body
<span>+</span>     <span>.</span><span>pipeThrough</span><span>(</span><span>new</span> <span>DecompressionStream</span><span>(</span><span><span>`</span><span>deflate-raw</span><span>`</span></span><span>)</span><span>)</span>
</span><span><span> </span> <span>)</span></span></code></pre>

<p><code>deflate-raw</code> is the compression algorithm. The same algorithm must be specified for both compression and decompression.</p>

<p>To convert the decompressed stream to a usable <em>string</em>, we can use...</p>

<h3 id="3-new-responsestreamtext">3. new Response(stream).text()</h3>

<p>We can abuse the native <a target="_blank" href="https://developer.mozilla.org/en-US/docs/Web/API/Response="><strong>Response</strong></a> class‚Äôs <code>text()</code> function to convert the stream into a string.</p>

<pre><code><span><span> </span> <span>fetch</span><span>(</span><span><span>`</span><span>data:;base64,fVTfb5swEH7PX+HxUIFiEpJu0pRgpK0P68Oy...</span><span>`</span></span><span>)</span>
<span> </span> <span>.</span><span>then</span><span>(</span><span>compressedHtml</span> <span>=&gt;</span>
</span><span><span>+</span>   <span>/* a Response wrapper will be used to decode into text */</span>
<span>+</span>   <span>new</span> <span>Response</span><span>(</span>
</span><span><span> </span>     compressedHtml<span>.</span>body
<span> </span>       <span>.</span><span>pipeThrough</span><span>(</span><span>new</span> <span>DecompressionStream</span><span>(</span><span><span>`</span><span>deflate-raw</span><span>`</span></span><span>)</span><span>)</span>
</span><span><span>+</span>   <span>)</span>
<span>+</span>   <span>/* decode stream into text */</span>
<span>+</span>   <span>.</span><span>text</span><span>(</span><span>)</span>
</span><span><span> </span> <span>)</span></span></code></pre>

<h3 id="4-documentdocumentelementinnerhtml--html">4. document.documentElement.innerHTML = html</h3>

<p>Finally, the uncompressed HTML in string form is assigned to the whole document. <code>document.write(html)</code> could have been used here, but some browsers don‚Äôt like this function. <code>innerHTML</code> works equivalently well.</p>

<p>This brings us to the final form:</p>

<pre><code><span><span> </span> <span>fetch</span><span>(</span><span><span>`</span><span>data:;base64,fVTfb5swEH7PX+HxUIFiEpJu0pRgpK0P68Oy...</span><span>`</span></span><span>)</span>
<span> </span> <span>.</span><span>then</span><span>(</span><span>compressedHtml</span> <span>=&gt;</span>
<span> </span>   <span>new</span> <span>Response</span><span>(</span>
<span> </span>     compressedHtml<span>.</span>body
<span> </span>       <span>.</span><span>pipeThrough</span><span>(</span><span>new</span> <span>DecompressionStream</span><span>(</span><span><span>`</span><span>deflate-raw</span><span>`</span></span><span>)</span><span>)</span>
<span> </span>   <span>)</span>
<span> </span>   <span>.</span><span>text</span><span>(</span><span>)</span>
</span><span><span>+</span>   <span>.</span><span>then</span><span>(</span><span>html</span> <span>=&gt;</span>
<span>+</span>     <span>/* replace page with decoded html */</span>
<span>+</span>     document<span>.</span>documentElement<span>.</span>innerHTML <span>=</span> html
<span>+</span>   <span>)</span>
</span><span><span> </span> <span>)</span></span></code></pre>

<p>I‚Äôm pretty sure the above code could be minified further, but this is the smallest I could make it.</p>

<h2 id="preparing-the-compressed-code">Preparing the compressed code</h2>

<p>The above describes the process of <em>decompressing</em> the base64-encoded compressed HTML. Where does that compressed HTML string come from?</p>

<p>The following function creates the base64-encoded compressed string from an input HTML:</p>

<pre><code><span>async</span> <span>function</span> <span>formatPayload</span><span>(</span><span>html</span><span>)</span> <span>{</span>
  <span>const</span> compressed <span>=</span> <span>await</span> <span>new</span> <span>Response</span><span>(</span>
    <span>new</span> <span>Blob</span><span>(</span><span>[</span>html<span>]</span><span>)</span>
      <span>.</span><span>stream</span><span>(</span><span>)</span>
      <span>.</span><span>pipeThrough</span><span>(</span><span>new</span> <span>CompressionStream</span><span>(</span><span>'deflate-raw'</span><span>)</span><span>)</span>
  <span>)</span><span>.</span><span>arrayBuffer</span><span>(</span><span>)</span><span>;</span>
  <span>return</span> <span>btoa</span><span>(</span>String<span>.</span><span>fromCharCode</span><span>(</span><span>...</span><span>new</span> <span>Uint8Array</span><span>(</span>compressed<span>)</span><span>)</span><span>)</span><span>;</span>
<span>}</span></code></pre>

<p>This function is called at authoring time.</p>

<p><span>It‚Äôs important to compress the data first before encoding it in base64. Doing it in the wrong order results in a larger size! This is because base64 messes with the byte (octet) alignment but the compression algorithm works in terms of bytes. In addition, base64 encoding in itself inflates the data by 33%.</span></p>

<h2 id="demo">Demo</h2>

<p>This demo was made using the portablink‚Äôs core library <code>https://portabl.ink/pack.js</code>.</p>

<p>Edit the HTML below!</p>
<textarea id="demoHTML" rows="8"></textarea>‚¨á<textarea id="demoURL" rows="8" readonly=""></textarea><script type="module" async="" defer="" src="/scripts/notes_compressing_websites_into_urls_index_html.js"></script>
<p><span>Note: If your input is not compressible enough, the overhead of bundling the decompression code might not be worth it. The tool may decide to use plain text, whichever is smaller.</span></p>

<p>Check out the full-fledged tool at <a target="_blank" href="https://portabl.ink"><strong>portabl.ink</strong></a>! It‚Äôs got a WYSIWYG editor, pretty pages, and more!</p>

<h2 id="conclusion">Conclusion</h2>

<p>Portablink was a fun weekend project (actually about a week). I learned about new Web APIs and some <a target="_blank" href="https://en.wikipedia.org/wiki/Code_golf">code golfing</a> techniques. I launched a ‚Äúproduct‚Äù!</p>

<p>Potential improvement(s):</p>

<ul>
              <li>Use <a target="_blank" href="https://github.com/kevinAlbs/Base122">Base122</a> for more compression. We‚Äôre not restricted to ASCII anymore. We can use a larger range of characters than base64. This adds a significant amount of decoder code though.</li>
              <li>Better authoring experience.</li>
            </ul>

<p>Limitation(s):</p>

<ul>
              <li>Data URLs, while portable, are a poor way to share links. Browsers restrict navigation to data URLs. Apps don‚Äôt accept them. These URLs are presumed to be malicious nowadays.</li>
            </ul>
]]></description>
            <link>https://leanrada.com/notes/compressing-websites-into-urls?ref=rss</link>
            <guid isPermaLink="true">https://leanrada.com/notes/compressing-websites-into-urls?ref=rss</guid>
            <pubDate>Tue, 10 Oct 2023 00:00:00 GMT</pubDate>
        </item>
        <item>
            <title><![CDATA[Introducing portabl.ink]]></title>
            <description><![CDATA[
<p>I just released a small weekend project called <a target="_blank" href="https://portabl.ink">portabl.ink</a>. It‚Äôs a tool to compress whole web pages into a self-contained portable link.</p>

<p>Try it out online at <a target="_blank" href="https://portabl.ink">portabl.ink</a>!</p>

<img srcset="/notes/introducing-portabl.ink/hero_664.generated.png 664w" sizes=" 664px" alt="screenshot" src="https://leanrada.com/notes/introducing-portabl.ink/hero.png?ref=rss" spec="100% [664) 664" loading="lazy" width="100%" height="">

<p>For some examples and more details, read the <a target="_self" href="https://leanrada.com/wares/portabl.ink?ref=rss">project page</a>.</p>

<p>Next, I will write another post on how it works under-the-hood. Stay tuned!
            </p>
]]></description>
            <link>https://leanrada.com/notes/introducing-portabl.ink?ref=rss</link>
            <guid isPermaLink="true">https://leanrada.com/notes/introducing-portabl.ink?ref=rss</guid>
            <pubDate>Mon, 25 Sep 2023 00:00:00 GMT</pubDate>
        </item>
        <item>
            <title><![CDATA[
                
                  Sort, sweep, and prune: Part&nbsp;2
                
              ]]></title>
            <description><![CDATA[<p><em>For RSS readers: This article contains interactive content available on the <a href="https://leanrada.com/notes/sweep-and-prune-2?ref=rss">original post on leanrada.com</a>.</em></p>

<p>In the <a target="_self" href="https://leanrada.com/notes/sweep-and-prune?ref=rss">first part</a>, we figured that sorting lets us exploit the transitive property of inequality to optimise the number of pairwise tests.</p>

<p>We ended up with - let‚Äôs call it a <strong>‚Äúsimplified version‚Äù</strong>, of the full sweep-and-prune algorithm.</p>

<p>This part explores the more sophisticated versions of sweep-and-prune.</p>

<img srcset="/notes/sweep-and-prune-2/sophisticated_250.generated.png 250w" sizes=" 250px" alt="Classy rageface" src="https://leanrada.com/notes/sweep-and-prune-2/sophisticated.png?ref=rss" spec="250" loading="lazy" width="100%" height="">
<span>Sophisticated sip and prune.</span>
<h2 id="proper-sweep-and-prune-üßê">Proper sweep-and-prune üßê</h2>

<p>Let‚Äôs see how the original version tackled the problem (Not sure which one‚Äôs original, tbh).</p>

<p>First, sorting widthy objects.</p>

<p>To account for the width of objects while keeping the benefits of unambiguous sort order, we track the left and the right edges of each object as two separate points.</p>

<p>This is done by maintaining a separate <strong>array of edge points</strong> corresponding to the objects‚Äô left &amp; right edges.</p>

<p>See how it works by playing with this <span>draggable</span> demo. The left and right edges of each ball are visualised. These edge points are stored in a sorted array shown below the box.</p>

<pre>Interactive content: <a href="https://leanrada.com/notes/sweep-and-prune-2?ref=rss">Visit the website to play with interactive content!</a>
Alternative text: interactive diagram showing a specific mechanism</pre>

              Sorted array of edges:
              
<p>Of course, we need to initialise the edge data and continually keep them in sync with the objects. I‚Äôll leave that out as an implementation detail.</p>

<pre><code><span>// todo: extract 2 edges from each object into the array</span>
<span>let</span> <span>edges</span><span>:</span> Array<span>&lt;</span><span>{</span>
  <span>object</span><span>:</span> Object<span>;</span>  <span>// parent object</span>
  <span>x</span><span>:</span> number<span>;</span>       <span>// x-coordinate</span>
  <span>isLeft</span><span>:</span> boolean<span>;</span> <span>// true if left edge. false if right</span>
<span>}</span><span>&gt;</span><span>;</span></code></pre>

<p>This sorted array of edges is all we need to facilitate the reduction of unnecessary pairwise tests.</p>

<h3 id="index-as-position-position-as-index">Index as position, position as index</h3>

<p>Remember the <code>intersects()</code> function? Let‚Äôs focus only on the x-axis checks:</p>

<pre><code><span>function</span> <span>intersects</span><span>(</span><span>object1<span>,</span> object2</span><span>)</span> <span>{</span>
  <span>return</span> object1<span>.</span>left <span>&lt;</span> object2<span>.</span>right
      <span>&amp;&amp;</span> object1<span>.</span>right <span>&gt;</span> object2<span>.</span>left
      <span>/* ... */</span><span>;</span>
<span>}</span></code></pre>

<p>We can replace these x-coordinate comparisons with a new approach based on array indices. Since we have a sorted array of every object‚Äôs left and right points, finding x-overlaps can be done via index-based searches rather than global pairwise testing.</p>

<p>Take one ball for example. Get the indices of its left and right points, and you can simply run in between those two points in the array to find all x-overlapping objects! This is a very fast linear operation.</p>

<p>Here‚Äôs a viz. Try <span>dragging</span> the <span>highlighted ball</span> below and observe the edges enclosed visually and in the sorted array:</p>

<pre>Interactive content: <a href="https://leanrada.com/notes/sweep-and-prune-2?ref=rss">Visit the website to play with interactive content!</a>
Alternative text: interactive diagram showing a specific mechanism</pre>

              Sorted array of edges:
              
<p>The above is a simple 1-to-n overlap detection (which is flawed, btw). For n-to-n overlap detection, turns out there is a neat way to find all overlapping pairs in a single pass!</p>

<h2 id="chapter-2-sweeping">Chapter 2. Sweeping</h2>

<p>To generalise the above to an n-interval overlap scan, imagine a vertical line sweeping across the whole space from left to right. The sweep line keeps track of the objects it is currently touching.</p>

<p>Let‚Äôs see what that looks like without collision:</p>

<pre>Interactive content: <a href="https://leanrada.com/notes/sweep-and-prune-2?ref=rss">Visit the website to play with interactive content!</a>
Alternative text: demo of the collision detection algorithm using 'sap-nativesort' strategy</pre>

                Objects touching the line are lit up in <span>pink</span>.
              
<p>As for the implementation, the line is merely a metaphor. It‚Äôs just a visualisation of an iteration through the sorted list of edges.</p>

<p>To keep track of objects touching the line, we maintain a set called <span><code>touching</code></span> in code.</p>

<p>Whenever the line runs into an object (a left edge), the object is added to the set. Likewise, whenever it exits an object (right edge), the object is removed from the set.</p>

<pre><code><span>sort</span><span>(</span>edges<span>)</span><span>;</span>

<span>const</span> touching <span>=</span> <span>new</span> <span>Set</span><span>(</span><span>)</span><span>;</span>
<span>for</span> <span>(</span><span>const</span> edge <span>of</span> edges<span>)</span> <span>{</span>
  <span>if</span> <span>(</span>edge<span>.</span>isLeft<span>)</span> <span>{</span>
    <span>// entering an object</span>
    touching<span>.</span><span>add</span><span>(</span>edge<span>.</span>object<span>)</span><span>;</span>
  <span>}</span> <span>else</span> <span>{</span>
    <span>// exiting an object</span>
    touching<span>.</span><span>delete</span><span>(</span>edge<span>.</span>object<span>)</span><span>;</span>
  <span>}</span>
<span>}</span></code></pre>

<p>Once we have the sweep working, detecting overlaps is easy‚Ä¶</p>

<p>üëâ Whenever the sweep line enters a new object (a left edge), in addition to inserting it to <code>touching</code>, we can mark it as overlapping with the rest of the objects in <code>touching</code>.</p>

<p>Watch closely whenever the line enters a ball while the line is <code>touching</code> other balls. Detected overlaps are highlighted:</p>

<pre>Interactive content: <a href="https://leanrada.com/notes/sweep-and-prune-2?ref=rss">Visit the website to play with interactive content!</a>
Alternative text: demo of the collision detection algorithm using 'sap-nativesort' strategy</pre>

                X-overlapping pairs are highlighted <span aria-label="a connecting green line"></span> as the line sweeps.
              
<p>Here‚Äôs the updated code for detecting and reporting overlaps:</p>

<pre><code><span><span> </span> <span>sort</span><span>(</span>edges<span>)</span><span>;</span>
<span> </span> 
<span> </span> <span>const</span> touching <span>=</span> <span>new</span> <span>Set</span><span>(</span><span>)</span><span>;</span>
<span> </span> <span>for</span> <span>(</span><span>const</span> edge <span>of</span> edges<span>)</span> <span>{</span>
<span> </span>   <span>if</span> <span>(</span>edge<span>.</span>isLeft<span>)</span> <span>{</span>
<span> </span>     <span>// entering an object</span>
</span><span><span>+</span>     
<span>+</span>     <span>// the new object is overlapping with the existing ones</span>
<span>+</span>     <span>for</span> <span>(</span><span>const</span> other <span>of</span> touching<span>)</span> <span>{</span>
<span>+</span>       <span>onOverlapX</span><span>(</span>other<span>,</span> edge<span>.</span>object<span>)</span><span>;</span>
<span>+</span>     <span>}</span>
<span>+</span>     
</span><span><span> </span>     touching<span>.</span><span>add</span><span>(</span>edge<span>.</span>object<span>)</span><span>;</span>
<span> </span>   <span>}</span> <span>else</span> <span>{</span>
<span> </span>     <span>// exiting an object</span>
<span> </span>     touching<span>.</span><span>delete</span><span>(</span>edge<span>.</span>object<span>)</span><span>;</span>
<span> </span>   <span>}</span>
<span> </span> <span>}</span></span></code></pre>

<h2 id="chapter-3-pruning">Chapter 3. Pruning</h2>

<p><code>onOverlapX()</code> is called whenever two balls are overlapping in the x dimension. What about the other dimension, <em>y</em>? What if we‚Äôre working with 3D, how about <em>z</em>?</p>

<p>Don‚Äôt worry; the sweep is just a broad-phase test, a way to <em>prune</em> candidate pairs in bulk. There will be a narrow-phase test to determine exactly the intersections in each of the remaining pairs.</p>

<p><code>onOverlapX()</code> can be hooked up to an exact intersection test like the full <code>intersects()</code> function earlier. Or, since we already know that the argument pair overlaps in <em>x</em>, we can just check for <em>y</em>.</p>

<pre><code><span>onOverlapX</span> <span>=</span> <span>function</span><span>(</span><span>object1<span>,</span> object2</span><span>)</span> <span>{</span>
  <span>// just check for y</span>
  <span>if</span> <span>(</span>object1<span>.</span>top <span>&lt;</span> object2<span>.</span>bottom
   <span>&amp;&amp;</span> object1<span>.</span>bottom <span>&gt;</span> object2<span>.</span>top<span>)</span> <span>{</span>
    <span>collide</span><span>(</span>object1<span>,</span> object2<span>)</span><span>;</span>
  <span>}</span>
<span>}</span></code></pre>

<p>While the above formula works for most games, a more precise and time-consuming check could be done at this level since most candidates have already been pruned. Our ball example would work better with the following circle intersection test using the <a target="_blank" href="https://en.wikipedia.org/wiki/Euclidean_distance">Euclidean distance formula</a>:</p>

<pre><code><span>onOverlapX</span> <span>=</span> <span>function</span><span>(</span><span>object1<span>,</span> object2</span><span>)</span> <span>{</span>
  <span>// compute circle-to-circle intersection</span>
  <span>const</span> distance <span>=</span> <span>sqrt</span><span>(</span>
      <span>(</span>object1<span>.</span>x <span>-</span> object2<span>.</span>x<span>)</span> <span>**</span> <span>2</span>
    <span>+</span> <span>(</span>object1<span>.</span>y <span>-</span> object2<span>.</span>y<span>)</span> <span>**</span> <span>2</span>
  <span>)</span><span>;</span>
  <span>if</span> <span>(</span>distance <span>&lt;</span> object1<span>.</span>radius <span>+</span> object2<span>.</span>radius<span>)</span> <span>{</span>
    <span>bounce</span><span>(</span>object1<span>,</span> object2<span>)</span><span>;</span>
  <span>}</span>
<span>}</span></code></pre>

<p>Finally, the demo:</p>

<pre>Interactive content: <a href="https://leanrada.com/notes/sweep-and-prune-2?ref=rss">Visit the website to play with interactive content!</a>
Alternative text: demo of the collision detection algorithm using 'sap-nativesort' strategy</pre>

                Ball sim using sweep-and-prune. <code>onOverlapX()</code> calls highlighted <span aria-label="a connecting green line"></span>.
              
<p>Notice that it behaves very similarly to the simplified version. It limits tests to x-overlapping pairs.</p>

<p><span>The sweep-and-prune algorithm is also known as sort-and-sweep.</span></p>

<h3 id="note-for-higher-dimensions">Note for higher dimensions</h3>

<p>There is a variant which performs the <strong>sweep for each axis</strong>, not just <em>x</em>. For example in 3D, it maintains three <em>separate</em> sorted lists of edges for x, y, and z. Indeed, this is how the full sweep-and-prune implementation works as described in the <a target="_blank" href="https://ecommons.cornell.edu/handle/1813/7115">original paper by D. Baraff</a>. Object pairs are flagged for overlaps separately per dimension. Pairs flagged in all dimensions would be considered intersecting.</p>

<p>This is the advantage the full sweep-and-prune has over the simplified ‚Äúsorted pairwise‚Äù version. It can prune in multiple dimensions!</p>

<pre>Interactive content: <a href="https://leanrada.com/notes/sweep-and-prune-2?ref=rss">Visit the website to play with interactive content!</a>
Alternative text: demo of the collision detection algorithm using 'sap-swap-2d' strategy</pre>

                2D sweep-and-prune. Only pairs with overlapping <a target="_blank" href="https://en.wikipedia.org/wiki/Bounding_volume#:~:text=axis%2Daligned%20bounding%20box">AABBs</a> are tested <span aria-label="a connecting green line"></span>.
              
<h2 id="performance-of-sweep-and-prune">Performance of sweep-and-prune</h2>

<p><a id="comparisons"></a>Here‚Äôs a side-by-side comparison of the strategies we‚Äôve covered so far! Observe the amount of intersection checks required per frame. üîç</p>

<pre>Interactive content: <a href="https://leanrada.com/notes/sweep-and-prune-2?ref=rss">Visit the website to play with interactive content!</a>
Alternative text: demo of the collision detection algorithm using 'pairwise' strategy</pre>
Global pairwise
<pre>Interactive content: <a href="https://leanrada.com/notes/sweep-and-prune-2?ref=rss">Visit the website to play with interactive content!</a>
Alternative text: demo of the collision detection algorithm using 'sap-nativesort' strategy</pre>
1D sweep and prune
<pre>Interactive content: <a href="https://leanrada.com/notes/sweep-and-prune-2?ref=rss">Visit the website to play with interactive content!</a>
Alternative text: demo of the collision detection algorithm using 'sap-swap-2d' strategy</pre>
2D sweep and prune
<p>Let‚Äôs analyse the time complexity of 1D sweep-and-prune. üëì</p>

<p>The sort step, again, is <em>O(n log n)</em>.</p>

<p>The sweep, which is a linear pass with an inner loop for overlaps, should be <em>O(n&nbsp;+&nbsp;m)</em> in the average case. Again, <em>m</em> is the number of overlaps.</p>

<pre><code><span>function</span> <span>sweepAndPrune</span><span>(</span><span>edges</span><span>)</span> <span>{</span>
  <span>// O(n log n)</span>
  <span>sort</span><span>(</span>edges<span>)</span><span>;</span>

  <span>const</span> touching <span>=</span> <span>new</span> <span>Set</span><span>(</span><span>)</span><span>;</span>

  <span>// O(n + m)</span>
  <span>for</span> <span>(</span><span>const</span> edge <span>of</span> edges<span>)</span> <span>{</span>
    <span>if</span> <span>(</span>edge<span>.</span>isLeft<span>)</span> <span>{</span>
      <span>// O(1) at best; O(m/n) on average; O(n) at worst</span>
      <span>for</span> <span>(</span><span>const</span> other <span>of</span> touching<span>)</span> <span>{</span>
        <span>onOverlapX</span><span>(</span>other<span>,</span> edge<span>.</span>object<span>)</span><span>;</span>
      <span>}</span>
      touching<span>.</span><span>add</span><span>(</span>edge<span>.</span>object<span>)</span><span>;</span> 
    <span>}</span> <span>else</span> <span>{</span>
      touching<span>.</span><span>delete</span><span>(</span>edge<span>.</span>object<span>)</span><span>;</span>
    <span>}</span>
  <span>}</span>
<span>}</span></code></pre>

<p>So this sweep-and-prune is <em><strong>O(n log n + m)</strong></em>.</p>

<p>That‚Äôs great, but it‚Äôs the same as simplified sweep-and-prune but with more code and more state to keep tabs on. <em>Can we improve it further?</em></p>

<h2 id="small-detail-big-improvement">Small detail, big improvement</h2>

<p>Again, let‚Äôs ask the question: Where is redundant work being done here?</p>

<p>Let‚Äôs look at the sort step, which is the bottleneck of the algorithm according to the analysis.</p>

<p>The following is a visualisation of the sorting of the edges array, using an optimised <a target="_blank" href="https://en.wikipedia.org/wiki/Quicksort">quicksort</a> (n&nbsp;log&nbsp;n):</p>

<pre>Interactive content: <a href="https://leanrada.com/notes/sweep-and-prune-2?ref=rss">Visit the website to play with interactive content!</a>
Alternative text: demo of the collision detection algorithm using 'sap-quicksort' strategy</pre>

                Sort <span>comparisons</span> and <span>swaps</span> are highlighted. The fixed lines at the top are edge array positions, connected to actual ball edge x positions below. Line crossings signal incorrect order.
              
<p>You can see that most of the time, the sort does nothing at all! The list is almost always <strong>already sorted from the previous frame</strong>.</p>

<p>Even when it becomes unsorted, it usually just takes a couple of swaps to be sorted again. There won‚Äôt be more than a few object boundaries changing places in one time step.</p>

<p>Fortunately, the subject of sorting algorithms is well-researched. We‚Äôre dealing with the special quality of being <em>nearly-sorted</em>. And one great choice for sorting nearly-sorted lists is <a target="_blank" href="https://en.wikipedia.org/wiki/Insertion_sort"><strong>insertion sort</strong></a>!</p>

<pre><code><span>function</span> <span>insertionSort</span><span>(</span><span>edges</span><span>)</span> <span>{</span>
  <span>for</span> <span>(</span><span>let</span> i <span>=</span> <span>1</span><span>;</span> i <span>&lt;</span> edges<span>.</span>length<span>;</span> i<span>++</span><span>)</span> <span>{</span>
    <span>for</span> <span>(</span><span>let</span> j <span>=</span> i <span>-</span> <span>1</span><span>;</span> j <span>&gt;=</span> <span>0</span><span>;</span> j<span>--</span><span>)</span> <span>{</span>
      <span>if</span> <span>(</span>edges<span>[</span>j<span>]</span><span>.</span>x <span>&lt;</span> edges<span>[</span>j <span>+</span> <span>1</span><span>]</span><span>.</span>x<span>)</span> <span>break</span><span>;</span>
      <span>[</span>edges<span>[</span>j<span>]</span><span>,</span> edges<span>[</span>j <span>+</span> <span>1</span><span>]</span><span>]</span> <span>=</span> <span>[</span>edges<span>[</span>j <span>+</span> <span>1</span><span>]</span><span>,</span> edges<span>[</span>j<span>]</span><span>]</span><span>;</span>
    <span>}</span>
  <span>}</span>
<span>}</span></code></pre>

<p>Insertion sort has a running time of <em>O(n)</em> at best when the list is already sorted or nearly-sorted, and <em>O(n<sup>2</sup>)</em> at worst when the list is in reverse. We can argue that the average case is <em><strong>O(n)</strong></em>, since the list is almost always sorted due to the previous frame‚Äôs sort.</p>

<p>Here‚Äôs insertion sort in action:</p>

<pre>Interactive content: <a href="https://leanrada.com/notes/sweep-and-prune-2?ref=rss">Visit the website to play with interactive content!</a>
Alternative text: demo of the collision detection algorithm using 'sap-insertionsort' strategy</pre>

                Sort <span>comparisons</span> and <span>swaps</span> are highlighted.
              
<p>Look at it go!</p>

<p>By switching to insertion sort, we‚Äôve reduced the overall average running time of sweep-and-prune to <em><strong>O(n&nbsp;+&nbsp;m)</strong></em>! Awesome!</p>
<span>
              <b>Caveat:</b> It‚Äôs important to consider the primary axis of sweep-and-prune due to the sweeps plus the nature of insertion sort. It should be the axis where objects are most widely distributed to minimize swaps and overlaps.
            </span>
<p>Of course, don‚Äôt forget about our simplified sweep-and-prune from the first part. Since it has a sort step as well, we can make it insertion sort too. So it can also be <em>O(n&nbsp;+&nbsp;m)</em>! Can we ever top that?</p>

<h2 id="sweeps-and-swaps">Sweeps and swaps</h2>

<p>Well, there is yet another way to optimise this algorithm! Hold on to your balloons, it‚Äôs about to get quite dense. ü™®</p>

<p>Look at the insertion sort example above. You can observe that <span>swaps</span> happen when and only <strong>when an edge point passes through another edge point</strong>.</p>

<p>The event where an edge point passes another can be classified into four cases:</p>
<table>
                <thead>
                  <tr>
                    <th>Case</th>
                    <th>Description</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td><code>)‚Üî(</code></td>
                    <td>R edge from the west swaps with L edge from the east.</td>
                  </tr>
                  <tr>
                    <td><code>(‚Üî)</code></td>
                    <td>L edge from the west swaps with R edge from the east.</td>
                  </tr>
                  <tr>
                    <td><code>(‚Üî(</code></td>
                    <td>L edges swap.</td>
                  </tr>
                  <tr>
                    <td><code>)‚Üî)</code></td>
                    <td>R edges swap.</td>
                  </tr>
                </tbody>
              </table>
<p>Each swap scenario can mean something significant. Let‚Äôs look more closely into each case. </p>

<h3 id="case-‚Üî-entering">case )‚Üî(. ‚ÄúEntering‚Äù</h3>

<video src="https://leanrada.com/notes/sweep-and-prune-2/swap-rl.mp4?ref=rss" muted="" autoplay="" loop="" aria-label="Animation of a R edge swapping with a L edge">
                Video: Animation of a R edge swapping with a L edge | Source: /notes/sweep-and-prune-2/swap-rl.mp4
              </video>

<p>When a right edge from the west swaps with a left edge from the east, we can infer that the corresponding balls are <strong>initiating an overlap</strong>.</p>

<h3 id="case-‚Üî-exiting">case (‚Üî). ‚ÄúExiting‚Äù</h3>

<video src="https://leanrada.com/notes/sweep-and-prune-2/swap-lr.mp4?ref=rss" muted="" autoplay="" loop="" aria-label="Animation of a L edge swapping with a R edge">
                Video: Animation of a L edge swapping with a R edge | Source: /notes/sweep-and-prune-2/swap-lr.mp4
              </video>

<p>Conversely, when a left edge from the west swaps with a right edge from the east, the corresponding balls <strong>cease to overlap</strong>.</p>

<h3 id="cases-‚Üî-and-‚Üî">cases (‚Üî( and )‚Üî)</h3>

<video src="https://leanrada.com/notes/sweep-and-prune-2/swap-ll.mp4?ref=rss" muted="" autoplay="" loop="" aria-label="Animation of a L edge swapping with a L edge">
                Video: Animation of a L edge swapping with a L edge | Source: /notes/sweep-and-prune-2/swap-ll.mp4
              </video>

<p>Edges of the same polarity can swap without affecting the overlappedness of their corresponding balls. We can ignore these ones.</p>

<h2 id="swaps-and-sweeps">Swaps and sweeps</h2>

<p>Based on these swap events we can reframe the mechanics of sweep-and-prune in a new perspective, a bottom-up way centred around the swaps.</p>

<p>A fun way to think about it is to pretend that a right edge is equivalent to a <em>localised</em> sweep line. In that sense, the right edge <em>is</em> the line sweeping over these other left edges.</p>

<video src="https://leanrada.com/notes/sweep-and-prune-2/swap-as-sweep.mp4?ref=rss" muted="" autoplay="" loop="" aria-label="Animation a line sweep vs animation of an edge swap">
                Video: Animation a line sweep vs animation of an edge swap | Source: /notes/sweep-and-prune-2/swap-as-sweep.mp4
              </video>
<span>An edge can be thought of as a local sweep line.</span>
<p>Just as in a global sweep, passing over left edges will mark the corresponding balls as ‚Äútouching‚Äù; in right-edge-as-a-local-sweep version, <em>swapping</em> left edges will mark its ball as overlapping with the right edge‚Äôs ball.</p>

<p>In the global sweep, there is a global <code>touching</code> set keeping track of which balls are in contact with the sweep line. In local swaps, we keep track of overlaps <em>per ball</em>. (More precisely, per pair.)</p>

<p>Lastly, in the global sweep, a right edge means the end of contact with a ball. In a local swap, a left edge passing over a right edge means the same thing. The corresponding balls are unmarked as overlapping.</p>

<p>Essentially, instead of a global sweep line, small local ‚Äúsweeps‚Äù happen around each ball. Swaps become mini-sweeps.</p>

<p>Thus we arrive at the one-dimensional sweep-and-prune‚Äôs final form:</p>

<pre><code><span>function</span> <span>init</span><span>(</span><span>)</span> <span>{</span>
  overlapping <span>=</span> <span>new</span> <span>Map</span><span>(</span><span>)</span>
<span>}</span>

<span>function</span> <span>sweepAndPrune</span><span>(</span><span>edges</span><span>)</span> <span>{</span>
  <span>// Insertion sort</span>
  <span>for</span> <span>(</span><span>let</span> i <span>=</span> <span>1</span><span>;</span> i <span>&lt;</span> edges<span>.</span>length<span>;</span> i<span>++</span><span>)</span> <span>{</span>
    <span>for</span> <span>(</span><span>let</span> j <span>=</span> i <span>-</span> <span>1</span><span>;</span> j <span>&gt;=</span> <span>0</span><span>;</span> j<span>--</span><span>)</span> <span>{</span>
      <span>if</span> <span>(</span>edges<span>[</span>j<span>]</span><span>.</span>x <span>&lt;</span> edges<span>[</span>j <span>+</span> <span>1</span><span>]</span><span>.</span>x<span>)</span> <span>break</span><span>;</span>

      <span>// Swap</span>
      <span>[</span>edges<span>[</span>j<span>]</span><span>,</span> edges<span>[</span>j <span>+</span> <span>1</span><span>]</span><span>]</span> <span>=</span> <span>[</span>edges<span>[</span>j <span>+</span> <span>1</span><span>]</span><span>,</span> edges<span>[</span>j<span>]</span><span>]</span><span>;</span>

      <span>// --- Code up until this point is plain insertion sort ---</span>

      <span>// These two edges have just swapped places, process it...</span>
      <span>const</span> edge1 <span>=</span> edges<span>[</span>j<span>]</span><span>;</span>
      <span>const</span> edge2 <span>=</span> edges<span>[</span>j <span>+</span> <span>1</span><span>]</span><span>;</span>

      <span>if</span> <span>(</span>edge1<span>.</span>isLeft <span>&amp;&amp;</span> <span>!</span>edge2<span>.</span>isLeft<span>)</span> <span>{</span> <span>// case R-L ‚Üí L-R</span>
        <span>// Mark as overlapping</span>
        overlapping<span>.</span><span>set</span><span>(</span>
          <span>key</span><span>(</span>edge1<span>,</span> edge2<span>)</span><span>,</span>
          <span>[</span>edge1<span>.</span>ball<span>,</span> edge2<span>.</span>ball<span>]</span>
        <span>)</span><span>;</span>
      <span>}</span> <span>else</span> <span>if</span> <span>(</span><span>!</span>edge1<span>.</span>isLeft <span>&amp;&amp;</span> edge2<span>.</span>isLeft<span>)</span> <span>{</span> <span>// case L-R ‚Üí R-L</span>
        <span>// Unmark as overlapping</span>
        overlapping<span>.</span><span>delete</span><span>(</span><span>key</span><span>(</span>edge1<span>,</span> edge2<span>)</span><span>)</span><span>;</span>
      <span>}</span>
    <span>}</span>
  <span>}</span>

  <span>return</span> overlapping<span>.</span><span>values</span><span>(</span><span>)</span><span>;</span>
<span>}</span></code></pre>

<p>It‚Äôs essentially insertion sort hooked up to track overlaps.</p>

<p>Let‚Äôs see it in action:</p>

<pre>Interactive content: <a href="https://leanrada.com/notes/sweep-and-prune-2?ref=rss">Visit the website to play with interactive content!</a>
Alternative text: demo of the collision detection algorithm using 'sap-swap' strategy</pre>

<p>While it behaves the same and has the same time complexity as the preceding variants, I‚Äôm guessing it‚Äôs practically much more efficient in terms of processing speed. In video games where every frame has a processing budget, the actual speed matters, not just the scalability. As always, benchmarking will determine the real practical measurement of speed. (Disclaimer: I haven‚Äôt done any benchmarks!)</p>

<h2 id="quick-comparisons">Quick comparisons</h2>
<table>
                <thead>
                  <tr>
                    <th>Algorithm</th>
                    <th>Average time</th>
                    <th>Best time</th>
                    <th>Space</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>Global pairwise</td>
                    <td>O(n<sup>2</sup>)</td>
                    <td>O(n<sup>2</sup>)</td>
                    <td>O(1)</td>
                  </tr>
                  <tr>
                    <td>Sorted pairwise (quicksort)</td>
                    <td>O(n log n + m)</td>
                    <td>O(n log n)</td>
                    <td>O(1)</td>
                  </tr>
                  <tr>
                    <td>Sorted pairwise (insertion)</td>
                    <td>O(n + m)</td>
                    <td>O(n)</td>
                    <td>O(1)</td>
                  </tr>
                  <tr>
                    <td>Sweep-and-prune (quicksort)</td>
                    <td>O(n log n + m)</td>
                    <td>O(n)</td>
                    <td>O(n)</td>
                  </tr>
                  <tr>
                    <td>Sweep-and-prune (insertion)</td>
                    <td>O(n + m)</td>
                    <td>O(n)</td>
                    <td>O(n)</td>
                  </tr>
                  <tr>
                    <td>Sweep-and-prune (final)</td>
                    <td>O(n + m)</td>
                    <td>O(n)</td>
                    <td>O(n&nbsp;+&nbsp;m)</td>
                  </tr>
                </tbody>
              </table>
<p>n = number of balls, m = number of collisions</p>

<p>(todo: Add benchmark here. I‚Äôm a little lazy right now. üò∫)</p>

<p>The real measure of speed lies in real measurements on real hardware!</p>
<blockquote data-embed-locale="en-EN" data-embed-theme="dark" data-embed-showedits="false" data-embed-created="2024-03-16T14:19:12.213Z" data-embed-height="740"><a href="https://www.reddit.com/r/ProgrammerHumor/comments/ncb11u/stop_doing_algorithm_analysis/">Stop Doing Algorithm Analysis</a><br> by<a href="https://www.reddit.com/user/theawesomenachos/">u/theawesomenachos</a> in<a href="https://www.reddit.com/r/ProgrammerHumor/">ProgrammerHumor</a></blockquote>
<h2 id="appendix">Appendix</h2>

<p>Things I‚Äôve noted or realised while writing this post:</p>

<ul>
              <li>General algorithm design insights<ul>
                  <li>Pre-sorting a list can replace a bunch of inequality checks, and unlocks:<ul>
                      <li>Some power when linearly scanning over the list</li>
                      <li>Faster range / adjacency checks</li>
                      <li>(unrelated, but good to bring up) Binary search</li>
                    </ul>
                  </li>
                  <li>Different sorting algorithms have situational strengths.</li>
                </ul>
              </li>
              <li>Big O, while useful, can only go so far when analysing performance.</li>
              <li>I might need a frontend framework for my blog now, at least for the interactive demos.<ul>
                  <li>Vanilla JS is starting to get scary with bigger demos like these.</li>
                  <li><code>.mjs</code> is pretty good though.</li>
                </ul>
              </li>
            </ul>

<p>Bonus demo, 25 balls! It‚Äôs a ball party ‚öΩ‚öæüèÄüèê</p>

<pre>Interactive content: <a href="https://leanrada.com/notes/sweep-and-prune-2?ref=rss">Visit the website to play with interactive content!</a>
Alternative text: demo of the collision detection algorithm using 'sap-swap-2d' strategy</pre>
]]></description>
            <link>https://leanrada.com/notes/sweep-and-prune-2?ref=rss</link>
            <guid isPermaLink="true">https://leanrada.com/notes/sweep-and-prune-2?ref=rss</guid>
            <pubDate>Sun, 06 Aug 2023 00:00:00 GMT</pubDate>
        </item>
        <item>
            <title><![CDATA[
                
                  Sort, sweep, and prune: Collision detection algorithms
                
              ]]></title>
            <description><![CDATA[<p><em>For RSS readers: This article contains interactive content available on the <a href="https://leanrada.com/notes/sweep-and-prune?ref=rss">original post on leanrada.com</a>.</em></p>

<p>Sweep-and-prune is my go-to algorithm when I want to quickly implement collision detection for a game. I think it‚Äôs an awesome and elegant algorithm, so I wrote a post about it.</p>

<p>This post is lengthy with many examples and explanations, thus split into two parts. You can jump to specific bits using this special springboard:</p>

<ul>
              <li><strong>Part 1:</strong> <a target="_self" href="https://leanrada.com/notes/sweep-and-prune?ref=rss">Simplified version</a>
                <ul>
                  <li>üîç <a target="_self" href="https://leanrada.com/notes/sweep-and-prune/#comparisons?ref=rss">Visual comparison</a></li>
                  <li>üìù <a target="_self" href="https://leanrada.com/notes/sweep-and-prune/#code1?ref=rss">Code</a></li>
                </ul>
              </li>
              <li><strong>Part 2:</strong> <a target="_self" href="https://leanrada.com/notes/sweep-and-prune-2?ref=rss">Sophisticated versions</a>
                <ul>
                  <li>üîç <a target="_self" href="https://leanrada.com/notes/sweep-and-prune-2/#comparisons?ref=rss">Visual comparison</a></li>
                  <li>üìù <a target="_self" href="https://leanrada.com/notes/sweep-and-prune-2/#final-code?ref=rss">Final code</a></li>
                </ul>
              </li>
            </ul>

<p>As for the rest of the post, I try to paint a picture of what I think are first principles and show it with <strong>interactive demos</strong>! Let‚Äôs go!</p>
<hr>
<h2 id="collision-detection">Collision detection</h2>

<p>As you may know, the problem of collision detection is pretty common in video game programming. It‚Äôs a prerequisite to the implementation of certain game mechanics or simulations.</p>

<img alt="video of mario with goombas bumping into each other" src="https://leanrada.com/notes/sweep-and-prune/mario.gif?ref=rss" loading="lazy" width="100%" height="">
<span>Goombas colliding</span>
<p>Some of these mechanics include: preventing characters from passing through each other, <a target="_blank" href="https://youtu.be/Ky69PjyHCqg">goombas</a> turning around when bumping into another, big cells eating smaller cells in <a target="_blank" href="https://agar.io/">agar.io</a>, or just about any game physics. All of these need some kind of collision detection.</p>

<img alt="video of agar.io with cells eating smaller cells" src="https://leanrada.com/notes/sweep-and-prune/agario.gif?ref=rss" loading="lazy" width="100%" height="">
<span>Cells consuming smaller cells on contact</span>
<p>Here I‚Äôll cover several related approaches, starting with the simplest and building up to the <a target="_blank" href="https://en.wikipedia.org/wiki/Sweep_and_prune"><strong>sweep-and-prune</strong></a> algorithm. I won‚Äôt cover other approaches, such as space partitioning or spatial tree subdivision.</p>

<p>Balls.</p>

<p>I‚Äôll use this <strong>rigid-body ball simulation</strong> as a recurring example to demonstrate the algorithms throughout the post:</p>

<pre>Interactive content: <a href="https://leanrada.com/notes/sweep-and-prune?ref=rss">Visit the website to play with interactive content!</a>
Alternative text: demo of the collision detection algorithm using 'sap-nativesort' strategy</pre>

<p>Alright, let‚Äôs dive in! How do we detect these collisions?</p>

<h2 id="naive-approach-üê•">Naive approach üê•</h2>

<p>The straightforward solution is to test every potential pair of objects for collision. That is, <em>check every ball against every other ball</em>.</p>

<pre><code><span>// for each ball</span>
<span>for</span> <span>(</span><span>let</span> i <span>=</span> <span>0</span><span>;</span> i <span>&lt;</span> balls<span>.</span>length<span>;</span> i<span>++</span><span>)</span> <span>{</span>
  <span>const</span> ball1 <span>=</span> balls<span>[</span>i<span>]</span><span>;</span>
  <span>// check each of the other balls</span>
  <span>for</span> <span>(</span><span>let</span> j <span>=</span> i <span>+</span> <span>1</span><span>;</span> j <span>&lt;</span> balls<span>.</span>length<span>;</span> j<span>++</span><span>)</span> <span>{</span>
    <span>const</span> ball2 <span>=</span> balls<span>[</span>j<span>]</span><span>;</span>
    <span>// check for collision</span>
    <span>if</span> <span>(</span><span>intersects</span><span>(</span>ball1<span>,</span> ball2<span>)</span><span>)</span> <span>{</span>
      <span>bounce</span><span>(</span>ball1<span>,</span> ball2<span>)</span><span>;</span>
    <span>}</span>
  <span>}</span>
<span>}</span></code></pre>

<p>Note in the above code that the inner loop starts at <code>i + 1</code> to prevent duplicate pairs from being counted (A-B vs B-A). Other than that, it‚Äôs a pretty simple solution.</p>

<p>These checks are done on every time step, ensuring that balls will bounce exactly when they collide.</p>

<p>Here‚Äôs a slowed-down, highlighted simulation, showing pairs being tested for intersection per time step:</p>

<pre>Interactive content: <a href="https://leanrada.com/notes/sweep-and-prune?ref=rss">Visit the website to play with interactive content!</a>
Alternative text: demo of the collision detection algorithm using 'pairwise' strategy</pre>

                Pairs are highlighted <span aria-label="a connecting green line"></span> when being tested via <code>intersects()</code>.
              
<p>And it works. But if we had more than just a handful of balls we would start seeing performance issues.</p>

<h2 id="performance-or-lack-thereof">Performance, or lack thereof</h2>

<p>This naive algorithm runs in <em><strong>O(n<sup>2</sup>)</strong></em> time in <a target="_blank" href="https://en.wikipedia.org/wiki/Big_O_notation">Big O terms</a>. That is, for an input of <em>n</em> balls, the algorithm‚Äôs running time grows proportionally to the <em>square</em> of the input <em>n</em>. That‚Äôs a lot! üìà</p>

<p>This is because for <em>n</em> balls, there are around <em>(n&nbsp;*&nbsp;(n-1))/2</em> pairs to test, or <em>0.5n<sup>2</sup>&nbsp;-&nbsp;0.5n</em>. For example, if n = 5 there would be a total of 10 pairs. For n = 10, there would be 45 pairs. For n = 15, 105 pairs (!). And so on‚Ä¶ Using Big O notation, we can simplify this information into a compact expression <em>‚ÄúO(n<sup>2</sup>)‚Äù</em></p>

<p>To (painfully) demonstrate how the performance scales badly for bigger inputs, here‚Äôs a simulation with n&nbsp;=&nbsp;20:</p>

<pre>Interactive content: <a href="https://leanrada.com/notes/sweep-and-prune?ref=rss">Visit the website to play with interactive content!</a>
Alternative text: demo of the collision detection algorithm using 'pairwise' strategy</pre>

                20 balls = 190 pairs to test
              
<p>That‚Äôs a lot of tests per frame! Clearly, the naive solution does not scale well for large numbers of objects.</p>

<p>How can we improve this solution?</p>
<span>
              <p>The worst case running time for <em>any</em> collision detection algorithm is always <em>O(n<sup>2</sup>)</em>. That‚Äôs when all objects intersect simultaneously and you have no choice but to process each of the n<sup>2</sup> collisions.</p>
              <p>Thus, it‚Äôs more practical to compare the average and best cases.</p>
              <p>Having said that, the naive algorithm is still <em>Œò(n<sup>2</sup>)</em> for <em>any</em> case, no matter the number of actual collisions. A lot of room for improvement!</p>
            </span>
<h2 id="prologue-improving-the-solution">Prologue: Improving the solution</h2>

<p>Usually when optimising algorithms, you wanna find <strong>redundant or unnecessary work</strong>. Then find a way to consolidate that redundancy. (That sounded corporate-ish.)</p>

<p>A good place to start would be the <code>intersects()</code> function since it is called for every candidate pair. If we take the <a target="_blank" href="https://gdbooks.gitbooks.io/3dcollisions/content/Chapter2/static_aabb_aabb.html">typical object intersection test</a> to be its implementation, we get a bunch of these <strong>inequality checks</strong>:</p>

<pre><code><span>function</span> <span>intersects</span><span>(</span><span>object1<span>,</span> object2</span><span>)</span> <span>{</span>
  <span>// compare objects' bounds to see if they overlap</span>
  <span>return</span> object1<span>.</span>left <span>&lt;</span> object2<span>.</span>right
      <span>&amp;&amp;</span> object1<span>.</span>right <span>&gt;</span> object2<span>.</span>left
      <span>&amp;&amp;</span> object1<span>.</span>top <span>&lt;</span> object2<span>.</span>bottom
      <span>&amp;&amp;</span> object1<span>.</span>bottom <span>&gt;</span> object2<span>.</span>top<span>;</span>
<span>}</span></code></pre>

<p>In the above code, the <code>intersects()</code> function checks if two objects intersect by comparing their opposing bounds for each direction. (Refer to <a target="_blank" href="https://developer.mozilla.org/en-US/docs/Games/Techniques/3D_collision_detection#aabb_vs._aabb">this MDN article</a> for a better explanation.)</p>

<p>We can break the test down to its constituent checks:</p>

<ol>
              <li><code>object1.left &lt; object2.right</code></li>
              <li><code>object1.right &gt; object2.left</code></li>
              <li><code>object1.top &lt; object2.bottom</code></li>
              <li><code>object1.bottom &gt; object2.top</code></li>
            </ol>

<p>Each check is solely concerned with one particular axis in a specific direction.</p>

<p>Here‚Äôs the key thing: Due to the <code>&amp;&amp;</code> operator‚Äôs <a target="_blank" href="https://en.wikipedia.org/wiki/Short-circuit_evaluation">short-circuit evaluation</a>, if any one of these checks turns out to be false, then the overall test will immediately evaluate to false.</p>

<p>Our goal then is to generalise the case where at least <em>one</em> of these checks is false across many tests as possible.</p>

<p><span>It‚Äôs the same idea as the <a target="_blank" href="https://personal.math.vt.edu/mrlugo/sat.html">separating axis theorem</a>, which implies that two objects can‚Äôt be colliding if there‚Äôs at least one axis where their shadows don‚Äôt overlap.</span></p>

<p>Let‚Äôs say we focus only on the second check - <code>object1.right &gt; object2.left</code>. Don‚Äôt worry about the rest of the checks. As hinted above, optimising in just one axis can still make a big difference later, so we‚Äôll focus on this single check for now.</p>

<img srcset="/notes/sweep-and-prune/surprise-tool_200.generated.jpg 200w" sizes=" 200px" alt="Still of a cartoon mouse saying, 'that‚Äôs a surprise tool that can help us later'" src="https://leanrada.com/notes/sweep-and-prune/surprise-tool.jpg?ref=rss" spec="200" loading="lazy" width="100%" height="">

<p>Let‚Äôs look at it in the context of multiple objects. Consider three objects - A, B, and C - in this horizontal configuration:</p>

<img srcset="/notes/sweep-and-prune/abc_527.generated.png 527w,/notes/sweep-and-prune/abc_664.generated.png 664w" sizes="not (min-width:664px) 527px, 664px" alt="Three objects, from left to right: A, B, and C" src="https://leanrada.com/notes/sweep-and-prune/abc.png?ref=rss" spec="100% [664) 664" loading="lazy" width="100%" height="">

<p>There are three potential pairs to be checked here: A-B, B-C, and A-C. Remember, we‚Äôre trying to find redundant work. Pretend we‚Äôre running all the pairs through the check, like so:</p>

<pre><code><span>A</span><span>.</span>right <span>&gt;</span> <span>B</span><span>.</span>left <span>// returns false</span>
<span>B</span><span>.</span>right <span>&gt;</span> <span>C</span><span>.</span>left <span>// returns false</span>
<span>A</span><span>.</span>right <span>&gt;</span> <span>C</span><span>.</span>left <span>// returns false</span></code></pre>

<p>See any redundant work? Maybe abstractify it a little‚Ä¶</p>

<pre><code><span>A</span> <span>&gt;</span> <span>B</span> <span>// returns false</span>
<span>B</span> <span>&gt;</span> <span>C</span> <span>// returns false</span>
<span>A</span> <span>&gt;</span> <span>C</span> <span>// returns false</span></code></pre>

<p>Voil√†. Due to the <a target="_blank" href="https://www.mathwords.com/t/transitive_property_inequalities.htm"><strong>transitive property of inequality</strong></a>, realise that we don‚Äôt need to run the <strong>third test</strong>! <em>If we know that <code>A&nbsp;&gt;&nbsp;B</code> and <code>B&nbsp;&gt;&nbsp;C</code> are both <code>false</code>, then we would know that <code>A&nbsp;&gt;&nbsp;C</code> is <code>false</code> as well.</em></p>
<blockquote>
              <p>‚ÄúIf <i>a ‚â§ b</i> and <i>b ‚â§ c</i>, then <i>a ‚â§ c</i>.‚Äù
                <cite>the transitive property of inequality</cite>
              </p>
            </blockquote>
<p>So in this example, we don‚Äôt really need to run <code>intersects(A, C)</code>.</p>

<pre><code><span>// 1. Test A-B</span>
<span>intersects</span><span>(</span><span>A</span><span>,</span> <span>B</span><span>)</span> <span>// A.right &gt; B.left evals to false.</span>

<span>// 2. Test B-C</span>
<span>intersects</span><span>(</span><span>B</span><span>,</span> <span>C</span><span>)</span> <span>// B.right &gt; C.left evals to false.</span>

<span>// 3. Infer that A.right &gt; C.left is false.</span>
<span>// ‚à¥ Therefore I don‚Äôt need to call intersects(A, C)</span>
<span>// to know that it will return false.</span></code></pre>

<p>We‚Äôve skipped one <code>intersects()</code> call for free! ‚ú®</p>
<span>
              I‚Äôm handwaving the fact that <code>P.left ‚â§ P.right</code> is implied for any object P. Nevertheless, working those details out would just mean more transitivity.
            </span>
<p>You might be wondering how this contrived example could apply to general n-body collision detection. A smart reader such as you might also have realised that this skip only works if A, B, and C are in a <strong>particular order</strong>.</p>

<p>What particular order? Try <span>dragging</span> the balls below to see when the optimisation applies and when it does not:</p>

<pre>Interactive content: <a href="https://leanrada.com/notes/sweep-and-prune?ref=rss">Visit the website to play with interactive content!</a>
Alternative text: interactive diagram showing a specific mechanism</pre>

<pre><code><span>// LIVE OUTPUT:</span>
<span>intersects</span><span>(</span><span>A</span><span>,</span> <span>B</span><span>)</span> <span>// A.right &gt; B.left evals to <span>false</span></span>
<span>intersects</span><span>(</span><span>B</span><span>,</span> <span>C</span><span>)</span> <span>// B.right &gt; C.left evals to <span>false</span></span>
<span><span>intersects</span><span>(</span><span>A</span><span>,</span> <span>C</span><span>)</span> <span>// Can‚Äôt skip, returns <span>false</span></span></span><span>// Deduce that intersects(A, C) will be <span>false</span></span></code></pre>

<p><span><strong>Tip:</strong> Drag the balls so that they‚Äôre horizontally spaced out in this order: A‚ÄëB‚ÄëC</span></p>

<p>While it‚Äôs true that this skip only works when A, B, and C are ordered, remember that these labels are <em>arbitrary</em>! What if we simply decided to always call the leftmost ball A, the middle ball B, and the rightmost C? Then the optimisation would always be applicable! üååüß†</p>

<p>But wait‚Ä¶ labeling objects according to some logical ordering is essentially ‚ú®<strong>sorting</strong>‚ú®! What if we sorted the list of objects every time? Would the number of skipped tests be worth the cost of sorting?</p>

<h2 id="chapter-1-sorting">Chapter 1. Sorting</h2>

<p>Sorting, inequalities, and optimisation go hand in hand in hand. <em>A sorted list allows us to exploit the transitive property of inequality en masse.</em></p>

<img srcset="/notes/sweep-and-prune/sorted_664.generated.png 664w" sizes=" 664px" alt="a[0] ‚â§ a[1] ‚â§ a[2] ‚â§ ... ‚â§ a[n-1]" src="https://leanrada.com/notes/sweep-and-prune/sorted.png?ref=rss" spec="100% [664) 664" loading="lazy" width="100%" height="">
<span>The inequality relationships of elements in a sorted list.</span>
<p><span>Even if we had to sort the list of objects every frame, the quickest general sorting algorithm runs in <em>O(n log n)</em> time which is certainly lower than <em>O(n<sup>2</sup>)</em>.</span></p>

<p>As shown by the tri-object example above, to achieve the power to skip tests we need to sort the list of objects by x position.</p>

<p>However, objects aren‚Äôt zero-width points. They‚Äôre <em>widthy</em>, by which I mean having a size thus occupying an interval in the x-axis, also known as ‚Äúwidth‚Äù. How can one unambiguously sort by x position if objects span intervals in the x-axis?</p>

<h2 id="sort-by-min-x">Sort by min x</h2>

<p>A solution to sorting widthy objects is to sort them by their <strong>minimum x</strong> (their left edge‚Äôs x-coordinate). This technique can be applied to improve the naive approach.</p>

<p>It involves minimal modifications to the O(n<sup>2</sup>) solution. But it will result in a good chunk of tests skipped. I‚Äôll explain later.</p>

<p>First, the modified code:</p>

<pre><code><span><span>+</span> <span>// sort by min x</span>
<span>+</span> <span>sortByLeft</span><span>(</span>balls<span>)</span><span>;</span>
<span>+</span> 
</span><span><span> </span> <span>// for each ball</span>
<span> </span> <span>for</span> <span>(</span><span>let</span> i <span>=</span> <span>0</span><span>;</span> i <span>&lt;</span> balls<span>.</span>length<span>;</span> i<span>++</span><span>)</span> <span>{</span>
<span> </span>   <span>const</span> ball1 <span>=</span> balls<span>[</span>i<span>]</span><span>;</span>
<span> </span>   <span>// check each of the other balls</span>
<span> </span>   <span>for</span> <span>(</span><span>let</span> j <span>=</span> i <span>+</span> <span>1</span><span>;</span> j <span>&lt;</span> balls<span>.</span>length<span>;</span> j<span>++</span><span>)</span> <span>{</span>
<span> </span>     <span>const</span> ball2 <span>=</span> balls<span>[</span>j<span>]</span><span>;</span>
</span><span><span>+</span> 
<span>+</span>     <span>// stop when too far away</span>
<span>+</span>     <span>if</span> <span>(</span>ball2<span>.</span>left <span>&gt;</span> ball1<span>.</span>right<span>)</span> <span>break</span><span>;</span>
<span>+</span> 
</span><span><span> </span>     <span>// check for collision</span>
<span> </span>     <span>if</span> <span>(</span><span>intersects</span><span>(</span>ball1<span>,</span> ball2<span>)</span><span>)</span> <span>{</span>
<span> </span>       <span>bounce</span><span>(</span>ball1<span>,</span> ball2<span>)</span><span>;</span>
<span> </span>     <span>}</span>
<span> </span>   <span>}</span>
<span> </span> <span>}</span></span></code></pre>

<p>It‚Äôs mostly the same as the naive solution, differing only in two extra lines of code.</p>

<p>The first line <code>sortByLeft(balls)</code> simply sorts the list, with ranking based on the balls‚Äô left edge x-coords.</p>

<pre><code><span>function</span> <span>sortByLeft</span><span>(</span><span>balls</span><span>)</span> <span>{</span>
  balls<span>.</span><span>sort</span><span>(</span><span>(</span><span>a<span>,</span>b</span><span>)</span> <span>=&gt;</span> a<span>.</span>left <span>-</span> b<span>.</span>left<span>)</span><span>;</span>
<span>}</span></code></pre>

<p>And in the inner loop, there is now this break:</p>

<pre><code><span>if</span> <span>(</span>ball2<span>.</span>left <span>&gt;</span> ball1<span>.</span>right<span>)</span> <span>break</span><span>;</span></code></pre>

<p>Let‚Äôs break that down.</p>

<p>First, we know that the list is sorted, so the following statement
              holds true for any positive integer
              <code>c</code>:
            </p>

<p>
              <code>balls[<span>j</span> + <span>c</span>].left <span>&gt;=</span> balls[<span>j</span>].left</code>
            </p>

<p>The break condition, which is derived from the first operand of the intersection test, if true indicates early that the current pair being tested for intersection would fail:</p>

<p>
              <code>balls2.left <span>&gt;</span> ball1.right</code><br>
              or <code>balls[<span>j</span>].left <span>&gt;</span> ball1.right</code>
            </p>

<p>But there are more implications. If it was true, then by combining the above two inequations‚Ä¶</p>

<p>
              <code>balls[<span>j</span> + <span>c</span>].left <span>&gt;=</span> balls[<span>j</span>].left <span>&gt;</span> ball1.right</code>
            </p>

<p>And by transitive property, the following statement would also be true!</p>

<p>
              <code>balls[<span>j</span> + <span>c</span>].left <span>&gt;</span> ball1.right</code>
            </p>

<p>Which means the intersection tests of balls at
              <code>balls[<span>j</span> + <span>c</span>]</code>
              would also fail. We know this without needing to test those balls individually. A range of balls have been eliminated from testing!
            </p>

<p>In conclusion, when the current <em>ball2</em>
              <code>balls[<span>j</span>]</code>
              stops overlapping with the current <em>ball1</em>, then any further <em>ball2</em>s in the iteration
              <code>balls[<span>j</span> + <span>c</span>]</code>
              would be guaranteed to not overlap <em>ball1</em> as well. In other words, we stop the inner loop when it gets too far away.
            </p>

<p>Finally, here‚Äôs a demo:</p>

<pre>Interactive content: <a href="https://leanrada.com/notes/sweep-and-prune?ref=rss">Visit the website to play with interactive content!</a>
Alternative text: demo of the collision detection algorithm using 'simple-sap' strategy</pre>

                Pairs highlighted <span aria-label="a connecting green line"></span> when tested by <code>intersects()</code>.
              
<p>Pretty cool, right! It‚Äôs much faster now.</p>

<p>Some observations:</p>

<ul>
              <li>Since the list is sorted, the tests are performed from left to right.</li>
              <li>More importantly, it visibly does fewer tests than the naive approach. üìâ This is due the above optimisation which effectively limits pairs to those that overlap in the x-axis!</li>
            </ul>

<p>Let‚Äôs analyse the time complexity. üëì</p>

<p>The sort - if we take the "fastest" sorting algorithm, like mergesort or quicksort - would add an <em>O(n log n)</em> term.</p>

<p>The two-level loop, now with an early break, would average out to <em>O(n&nbsp;+&nbsp;m)</em> where <em>m</em> is the total number of x-overlaps. This could degenerate into n<sup>2</sup> but as mentioned above, it‚Äôs more useful to look at the average and best cases. At best, the loop would be <em>O(n)</em>, wasting no excess processing when there are no overlaps. On average it‚Äôs <em>O(n&nbsp;+&nbsp;m)</em>.</p>

<p><span>The average case refers to a world where objects are mostly evenly distributed and only a couple intersections per object is happening. I think this is a reasonable assumption for a relatively simple video game like a platformer or side-scroller.</span></p>

<p>Here‚Äôs the code with running time annotations:</p>

<pre><code><span>// O(n log n)</span>
<span>sortByLeft</span><span>(</span>balls<span>)</span><span>;</span>

<span>// O(n + m)</span>
<span>for</span> <span>(</span><span>let</span> i <span>=</span> <span>0</span><span>;</span> i <span>&lt;</span> balls<span>.</span>length<span>;</span> i<span>++</span><span>)</span> <span>{</span>
  <span>const</span> ball1 <span>=</span> balls<span>[</span>i<span>]</span><span>;</span>
  <span>// O(1) at best; O(m/n) on average; O(n) at worst</span>
  <span>for</span> <span>(</span><span>let</span> j <span>=</span> i <span>+</span> <span>1</span><span>;</span> j <span>&lt;</span> balls<span>.</span>length<span>;</span> j<span>++</span><span>)</span> <span>{</span>
    <span>const</span> ball2 <span>=</span> balls<span>[</span>j<span>]</span><span>;</span>
    <span>if</span> <span>(</span>ball2<span>.</span>left <span>&gt;</span> ball1<span>.</span>right<span>)</span> <span>break</span><span>;</span>
    <span>if</span> <span>(</span><span>intersects</span><span>(</span>ball1<span>,</span> ball2<span>)</span><span>)</span> <span>{</span>
      <span>bounce</span><span>(</span>ball1<span>,</span> ball2<span>)</span><span>;</span>
    <span>}</span>
  <span>}</span>
<span>}</span></code></pre>

<p>Adding those together we get <em><strong>O(n&nbsp;log&nbsp;n&nbsp;+&nbsp;m)</strong></em>.</p>

<p>This is a super good improvement over the naive approach‚Äôs <em>O(n<sup>2</sup>)</em>, because <strong>[1]</strong> <em>n&nbsp;log&nbsp;n</em> is <a target="_blank" href="https://bigocheatsheet.com/">much smaller</a> than <em>n<sup>2</sup></em> and <strong>[2]</strong> it is partially output-based - depending on the number of overlaps, it does not process more than necessary.</p>
<a target="_blank" href="https://www.bigocheatsheet.com">
              <div>
                <img alt="" src="https://www.bigocheatsheet.com/img/big-o-complexity-chart.png" loading="lazy"><span>bigocheatsheet.com</span>
              </div>
            </a>
<p>Furthermore, the choice of sorting algorithm could be improved. We‚Äôll look into that in the next part (somehow better than <em>n&nbsp;log&nbsp;n</em>!).</p>
<span>
              If you got this far trying to find a decent collision detection algorithm, then you can stop reading and take the above design! It‚Äôs the perfect balance between programming effort and running time performance. If you are curious how this develops or just want to see more interactive demos, read on to the next part.
            </span>
<h2 id="visual-comparison">Visual comparison</h2>

<p><a id="comparisons"></a>Here‚Äôs a side-by-side comparison of the strategies we‚Äôve covered so far! Observe the amount of intersection tests required per frame. üîç n = 10</p>

<pre>Interactive content: <a href="https://leanrada.com/notes/sweep-and-prune?ref=rss">Visit the website to play with interactive content!</a>
Alternative text: demo of the collision detection algorithm using 'pairwise' strategy</pre>
Global pairwise
<pre>Interactive content: <a href="https://leanrada.com/notes/sweep-and-prune?ref=rss">Visit the website to play with interactive content!</a>
Alternative text: demo of the collision detection algorithm using 'sap-nativesort' strategy</pre>
Sorted pairwise
<p>(Not shown: the cost of sorting. Let‚Äôs just say the intersection test is sufficiently expensive.)</p>

<p>Aaand that concludes the first part. Those two lines of code definitely were the MVPs.</p>

<p>How will it compare to the more advanced versions?</p>

<p><a target="_self" href="https://leanrada.com/notes/sweep-and-prune-2?ref=rss">Continued in part 2.</a>
            </p>
]]></description>
            <link>https://leanrada.com/notes/sweep-and-prune?ref=rss</link>
            <guid isPermaLink="true">https://leanrada.com/notes/sweep-and-prune?ref=rss</guid>
            <pubDate>Sat, 05 Aug 2023 00:00:00 GMT</pubDate>
        </item>
        <item>
            <title><![CDATA[Volley ball game in pure CSS]]></title>
            <description><![CDATA[
<p>I don‚Äôt know why I did this, but it was fun / funny.</p>

<p>This is a volley ball / tennis game implemented purely using HTML and CSS. Features real-time action gameplay and score counting.</p>

<p>üëâ See the Pen <a target="_blank" href="https://codepen.io/kalabasa/pen/MWzmPXb">Pure CSS Volley Game</a> on CodePen!</p>

<video src="https://leanrada.com/notes/pure-css-volley-ball-game/video.web.mp4?ref=rss" muted="" autoplay="" loop="" aria-label="video of CSS volley ball video game">
                Video: video of CSS volley ball video game | Source: /notes/pure-css-volley-ball-game/video.web.mp4
              </video>
]]></description>
            <link>https://leanrada.com/notes/pure-css-volley-ball-game?ref=rss</link>
            <guid isPermaLink="true">https://leanrada.com/notes/pure-css-volley-ball-game?ref=rss</guid>
            <pubDate>Mon, 03 Jul 2023 00:00:00 GMT</pubDate>
        </item>
        <item>
            <title><![CDATA[
                
                  Dynamic patrol behaviour with Markov chains
                
              ]]></title>
            <description><![CDATA[<p><em>For RSS readers: This article contains interactive content available on the <a href="https://leanrada.com/notes/dynamic-patrol-stealth-games?ref=rss">original post on leanrada.com</a>.</em></p>

<p>Hi, this post is about a game AI algorithm for stealth games.</p>

<p>But first, here‚Äôs a preview demo! Full demo at the end of this post. In between, I‚Äôll explain the background, the process, and the results!</p>

<p><pre>Interactive content: <a href="https://leanrada.com/notes/dynamic-patrol-stealth-games?ref=rss">Visit the website to play with interactive content!</a>
Alternative text: interactive demo of the dynamic patrol algorithm</pre></p>

<h2 id="background">Background</h2>

<p>I enjoy stealth games. However, I felt like the genre has become formulaic. Nowadays, we have standardised light, shadow, and noise mechanics. We almost always get discrete levels of alertness where on one end NPCs have wallhacks while on the other, NPCs have amnesia.</p>

<img srcset="/notes/dynamic-patrol-stealth-games/sc_664.generated.jpg 664w" sizes=" 664px" alt="Screenshot of Splinter Cell" src="https://leanrada.com/notes/dynamic-patrol-stealth-games/sc.jpg?ref=rss" spec="100% [664) 664" loading="lazy" width="100%" height="">
<span>Screenshot of Splinter Cell: Chaos Theory from mobygames.com. This game is good.</span>
<p>The most immersion-breaking moment for me was when you get spotted, the subsequent investigation consists solely of staring at the ground where you were last seen. Like when you get spotted at an entrance to a room, guards will just stare at the doorway. <em>Why not check inside the room?</em></p>

<p><span>Yeah, I know, game designers don‚Äôt deem smart game AI ‚Äúfun‚Äù. But an easy predictable game is no fun! Whatever, I just wanted to share this prototype.</span></p>

<p>What was lacking in stealth game AI is inference - the ability to infer that when a target enters a room, then they subsequently must be inside the room.</p>

<h2 id="a-room-and-a-hallway">A room and a hallway</h2>

<p>As an example, here are a room and a hallway with a doorway in between, modelled as a <a target="_blank" href="https://en.wikipedia.org/wiki/Graph">graph</a>:</p>

<img srcset="/notes/dynamic-patrol-stealth-games/room-graph_300.generated.png 300w" sizes=" 300px" alt="Node graph representing a room node, a doorway node, and hallway nodes" src="https://leanrada.com/notes/dynamic-patrol-stealth-games/room-graph.png?ref=rss" spec="300" loading="lazy" width="100%" height="">

<p>If we assign a number to each node representing the probability that the target (the player) is there, we can start making inferences of where the target could be at later times.</p>

<p>Let‚Äôs say the target was just seen in room <em>R</em>. At that exact moment, there is complete certainty that the target is there, so node <em>R</em> will be assigned a probability of <strong>1.0</strong>.</p>

<img srcset="/notes/dynamic-patrol-stealth-games/room-graph-r1_300.generated.png 300w" sizes=" 300px" alt="Node graph representing the room node with 1.0, the doorway node with 0.0, and hallway nodes with 0.0" src="https://leanrada.com/notes/dynamic-patrol-stealth-games/room-graph-r1.png?ref=rss" spec="300" loading="lazy" width="100%" height="">

<p>After that moment however, the certainty fades. Because the target could have exited the room next, or maybe they stayed.</p>

<p>The graph is recalculated to reflect this uncertainty by distributing the probability value of <strong>1.0</strong> from node <em>R</em> to each possible choice of node - <em>D</em> (exit) and <em>R</em> (stay). We don‚Äôt know the likeliness of either happening so we can just assume equal chances, giving them <strong>0.5</strong> each.</p>

<img srcset="/notes/dynamic-patrol-stealth-games/room-graph-r1d1_300.generated.png 300w" sizes=" 300px" alt="Node graph representing the room node with 0.5, the doorway node with 0.5, and hallway nodes with 0.0" src="https://leanrada.com/notes/dynamic-patrol-stealth-games/room-graph-r1d1.png?ref=rss" spec="300" loading="lazy" width="100%" height="">

<p>Now there is 50% probability that the target is in the room, and 50% in the doorway. This process is repeated for each node over time to calculate the target‚Äôs potential location at any given moment.</p>

<p>Let‚Äôs do another iteration. The next one is a bit tricky, but it‚Äôs all calculated the same. We just need to calculate the distribution from each node <em>in parallel</em>, like so:</p>

<img srcset="/notes/dynamic-patrol-stealth-games/room-graph-r1d1t_300.generated.png 300w" sizes=" 300px" alt="Node graph representing the distribution from previous state" src="https://leanrada.com/notes/dynamic-patrol-stealth-games/room-graph-r1d1t.png?ref=rss" spec="300" loading="lazy" width="100%" height="">
<span>Split the probabilities per node to each possible choice (including staying).</span>
<img srcset="/notes/dynamic-patrol-stealth-games/room-graph-r5d5h2_300.generated.png 300w" sizes=" 300px" alt="Node graph representing the room node with 0.42, the doorway node with 0.42, and the hallway node H1 directly next to the doorway with 0.16" src="https://leanrada.com/notes/dynamic-patrol-stealth-games/room-graph-r5d5h2.png?ref=rss" spec="300" loading="lazy" width="100%" height="">
<span>Then sum up the values that arrived in each node.</span>
<p><strong>Explanation of above:</strong> The <strong>0.5</strong> at <em>R</em> is split into two, giving <strong>0.5 / 2 = 0.25</strong> each to <em>R</em> and <em>D</em>. Meanwhile, the <strong>0.5</strong> at <em>D</em> is split into three, giving <strong>0.5 / 3 ‚âà 0.16</strong> each to <em>R</em>, <em>D</em>, and <em>H1</em>. Then node values are added together in a separate step after the split.</p>

<p>After some time, we will get a picture of where the target is likely to be and a smarter game AI can utilise this to send guards on a more realistic investigation route.</p>

<p>Another iteration and we get this:</p>

<img srcset="/notes/dynamic-patrol-stealth-games/room-graph-final_300.generated.png 300w" sizes=" 300px" alt="Node graph representing the room node with 0.35, the doorway node with 0.39, hallway nodes H0 and H2 with 0.04, and H1 with 0.18" src="https://leanrada.com/notes/dynamic-patrol-stealth-games/room-graph-final.png?ref=rss" spec="300" loading="lazy" width="100%" height="">
<span>The state after some time</span>
<p>What I‚Äôve just described is some generalisation of a <strong><a target="_blank" href="https://en.wikipedia.org/wiki/Markov_chain">Markov chain</a></strong>. Well, it‚Äôs not exactly accurate to call it that since the Markov chain is just one part of the algorithm. You‚Äôll see why in the next section.</p>

<p><span><strong>Disclaimer:</strong> I wasn‚Äôt thinking about Markov chains while developing this algorithm. The first version back in 2013 was based on crude counting and was more like a potential field. (Btw, it was in <a target="_blank" href="https://en.wikipedia.org/wiki/Adobe_Flash">Flash</a>.) The Markov chain concept that I learned (2023) helped me make the calculations more accurate and the numbers more realistic.</span></p>

<h2 id="observer-effect">Observer effect</h2>

<p>Suppose a guard did come to investigate the nearest highest probability node (the doorway <em>D</em>). Coming from the south, the guard just saw the doorway and the immediate hallway in their field of vision - There are two possibilities: Either <strong>(1)</strong> they saw nothing, or <strong>(2)</strong> they saw <em>the target</em>.</p>

<p>In case <strong>(1)</strong> where the guard saw nothing, we need to update the seen nodes according to the guard‚Äôs a posteriori observation.</p>

<img srcset="/notes/dynamic-patrol-stealth-games/observe-none_300.generated.png 300w" sizes=" 300px" alt="Node graph with observed nodes having 0.0" src="https://leanrada.com/notes/dynamic-patrol-stealth-games/observe-none.png?ref=rss" spec="300" loading="lazy" width="100%" height="">
<span>After observation</span>
<p>The nodes that were seen having no target at their locations are forced to a probability of <strong>0.0</strong>, because if you think about it, that makes sense. The remaining nodes are then scaled so that they still add up to a total of <strong>1.0</strong> (This is an invariant in any case).</p>

<p>To illustrate, here‚Äôs a table that details each intermediate step:</p>
<table>
                  <thead>
                    <tr>
                      <th>Node</th>
                      <th>Prior<br>probabilities</th>
                      <th>Values after<br>observation</th>
                      <th>Final values<br>after rescaling</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td>R</td>
                      <td>0.35</td>
                      <td>0.35</td>
                      <td><strong>0.9</strong></td>
                    </tr>
                    <tr>
                      <td>D</td>
                      <td>0.39</td>
                      <td><strong>0</strong></td>
                      <td>0</td>
                    </tr>
                    <tr>
                      <td>H0</td>
                      <td>0.04</td>
                      <td>0.04</td>
                      <td><strong>0.1</strong></td>
                    </tr>
                    <tr>
                      <td>H1</td>
                      <td>0.18</td>
                      <td><strong>0</strong></td>
                      <td>0</td>
                    </tr>
                    <tr>
                      <td>H2</td>
                      <td>0.04</td>
                      <td><strong>0</strong></td>
                      <td>0</td>
                    </tr>
                  </tbody>
                </table>
<p>After updating the probabilities, the state of the graph tells us that the target is around 90% likely to be in the room <em>R</em> and 10% in the far hallway <em>H0</em>.</p>

<p>The game AI can simply send the guard to the highest node based on the updated probabilities (this case, the room <em>R</em>). It can do this again and again, which will result in a seemingly organic and responsive searching behaviour from the AI guard. No predefined patrol routes needed.</p>

<p><span>Another way to go about this is to keep track of probabilities in the form of rational numbers - separately tracking the numerators and the denominators. You only need to store the numerator per node, while there is one global denominator, which is the sum of all the numerators. This is what I did for my demo implementation.</span></p>
<hr>
<p>In case <strong>(2)</strong> where the guard saw the target, a similar but more drastic approach applies. The node containing the target is assigned <strong>1.0</strong> while <em>the rest of the nodes in the whole graph</em> are cleared back to <strong>0.0</strong>. The target can only be in one place at at a time!</p>

<img srcset="/notes/dynamic-patrol-stealth-games/observe-target_300.generated.png 300w" sizes=" 300px" alt="Node graph with observed target in node having 1.0" src="https://leanrada.com/notes/dynamic-patrol-stealth-games/observe-target.png?ref=rss" spec="300" loading="lazy" width="100%" height="">
<span>After observation of target</span>
<p>It stays that way as long as the guard can see the target. When the guard loses sight of the target again, we just continue the Markov inference and the probability values will spread again like a wave. The cycle of chasing, investigation, and hiding continues.</p>
<span>
              Similar to quantum mechanics, an act of observation collapses the superposition. There seems to be an underlying mathematical truth that spans across Markov chains, quantum mechanics, Bayesian networks, and video game mechanics. :P
            </span>
<p>It‚Äôs best to just see it in action. Play with the demo in the following section.</p>

<h2 id="demo">Demo</h2>

<p>I implemented this algorithm in JavaScript so you can play with it right here. In this implementation, the world is a 2D grid where each tile is a node in the Markov graph.</p>

<p>Click a tile to command the target (the green character <img src="https://leanrada.com/notes/dynamic-patrol-stealth-games/demo/target.png?ref=rss" alt="">) to move. A blue fog will indicate the probabilities of each tile.</p>

<p>Have fun playing hide and seek!</p>

<p><pre>Interactive content: <a href="https://leanrada.com/notes/dynamic-patrol-stealth-games?ref=rss">Visit the website to play with interactive content!</a>
Alternative text: interactive demo of the dynamic patrol algorithm</pre></p>

<p><span><strong>Tip:</strong> Press <code>P</code> to toggle visibility of the probability field. Press <code>N</code> to toggle numbers between none, percentage, and log-scale. (Keyboard only)</span></p>

<h2 id="conclusions">Conclusions</h2>

<ul>
              <li>Emergent behaviours can be described:<ul>
                  <li>Chasing: Upon losing vision, the guard starts chasing in the direction where you ran away (without the guard actually seeing where you are).</li>
                  <li>Searching: As the chase continues, the path begins branching, and the probability dilutes. The guard gradually transitions from chasing behaviour to a searching behaviour.</li>
                  <li>Patrolling: As the probability distribution approaches equilibrium, the guard devolves into a plain patrol.</li>
                  <li>There is a spectrum from chasing to patrolling.</li>
                </ul>
              </li>
              <li>The probability spreading process can be drastically sped-up by implementing Markov chain transitions using matrix multiplication with a transition matrix.<ul>
                  <li>Matrix multiplication is <a target="_blank" href="https://en.wikipedia.org/wiki/Embarrassingly_parallel">embarrasingly parallel</a>.</li>
                </ul>
              </li>
              <li>The search route quality can be improved significantly. Currently it just sets the tile with the highest potential as the destination with an A* pathfinder, resetting the process whenever the tile becomes invalid.<ul>
                  <li>One improvement might involve incorporating the potential field as weights in the pathfinding algorithm itself to generate a more efficient and sweeping route.</li>
                </ul>
              </li>
            </ul>

<p>Sadly, the name <a target="_blank" href="https://github.com/mxgmn/WaveFunctionCollapse">‚ÄúWave Function Collapse‚Äù</a> has already been claimed by a different video game algorithm, so I can‚Äôt give this one a cool quantum name anymore.</p>
<hr>
<p><strong>Bonus demo! 2 guards.</strong></p>

<p><pre>Interactive content: <a href="https://leanrada.com/notes/dynamic-patrol-stealth-games?ref=rss">Visit the website to play with interactive content!</a>
Alternative text: interactive demo of the dynamic patrol algorithm</pre></p>

<p>Special thanks:</p>

<ul>
              <li><img src="https://leanrada.com/notes/dynamic-patrol-stealth-games/demo/target.png?ref=rss" alt=""> Ally Gator as ‚ÄúThe Target‚Äù</li>
              <li><img src="https://leanrada.com/notes/dynamic-patrol-stealth-games/demo/guard.png?ref=rss" alt=""> Metal Head as ‚ÄúGuard 1‚Äù</li>
              <li><img src="https://leanrada.com/notes/dynamic-patrol-stealth-games/demo/guard.png?ref=rss" alt=""> Rust Bucket as ‚ÄúGuard 2‚Äù</li>
              <li><a target="_blank" href="https://bitbucket.org/umbraprojekt/mrpas">bitbucket/umbraprojekt/mrpas</a> for guards‚Äô vision <img src="https://leanrada.com/notes/dynamic-patrol-stealth-games/demo/guard.png?ref=rss" alt="">ü™ß<img src="https://leanrada.com/notes/dynamic-patrol-stealth-games/demo/guard.png?ref=rss" alt=""></li>
              <li><a target="_blank" href="https://github.com/qiao/PathFinding.js">github/qiao/PathFinding.js</a> for giving directions üß≠</li>
            </ul>

<p><strong>Update:</strong> Related stuff I found:</p>

<ul>
              <li><a target="_blank" href="https://youtu.be/eFP0_rkjwlY?t=842">Predicting Pac-Man ghosts with Markov chains [YouTube]</a>
                <ul>
                  <li>As mentioned above, I had a crude counting-based solution before, but the concept of Markov chains made it more accurate. This video is where I got the idea of applying Markov chains to a grid.</li>
                </ul>
              </li>
              <li><a target="_blank" href="https://ojs.aaai.org/index.php/AIIDE/article/download/7425/7308/10903">Dynamic Guard Patrol in Stealth Games [academic, PDF]</a>
                <ul>
                  <li>Accompanying video: <a target="_blank" href="https://youtu.be/9FyaMM7l2EU">YouTube</a></li>
                  <li>I found this after writing this post. The paper uses a similar potential field idea, but only tracks <em>staleness</em>. It behaves similarly to the Markov chain‚Äôs equilibrium state, but it cannot produce chasing behaviours.</li>
                </ul>
              </li>
            </ul>
]]></description>
            <link>https://leanrada.com/notes/dynamic-patrol-stealth-games?ref=rss</link>
            <guid isPermaLink="true">https://leanrada.com/notes/dynamic-patrol-stealth-games?ref=rss</guid>
            <pubDate>Sat, 01 Jul 2023 00:00:00 GMT</pubDate>
        </item>
        <item>
            <title><![CDATA[A review of all IDEs I‚Äôve ever used]]></title>
            <description><![CDATA[
<h2>Notepad.exe</h2>
<span>
          üü† Hey! Sometimes the review is embedded <em>inside</em> the editor UI,
          like this one. Watch out for the insides!
        </span>
            ._____________.<br>
            | notepad.exe |<br>
            |________[7/10]<br>
<p>
              Ah, Notepad, the default text editor in Microsoft Windows XP, my OS
              not-by-choice back when I didn‚Äôt know what ‚Äúprogramming‚Äù was and
              only cared about making mods for a game called Clonk. The game used
              a C-like language, but I didn‚Äôt know that nor anything about syntax
              and syntax coloring and other good editor stuff.
            </p>

<p>
              However, it got the job done. You open a file, you save it. It‚Äôs
              compatible with any programming language, any build tool. In fact
              it‚Äôs not incompatible with anything! Except Unix line endings.
            </p>

<p>
              Due to its simplicity and speed (tho it‚Äôs not really fast when large
              files), I give it a 7/10. Note that Windowses 7/10 being the only
              good versions of Windows is purely coincidental.
            </p>

<h2>Macromedia Flash 8</h2>

<img srcset="/misc/ide-reviews/macromedia-flash-8_800.generated.png 800w" sizes=" 800px" alt="screenshot of Macromedia Flash 8" src="https://leanrada.com/misc/ide-reviews/macromedia-flash-8.png?ref=rss" spec="100% [800) 800" loading="lazy">

<details>
          <summary>What is Macromedia Flash?</summary>
          <strong>
            <a target="_blank" href="https://en.wikipedia.org/wiki/Adobe_Flash">
              Macromedia Flash</a></strong>, or just Flash, was a Web browser plugin that everyone had back in
          the day before JS was powerful enough. It was used for animations,
          interactive experiences, Web games, Web ads, YouTube, you name it. It
          was the platform of all webapps before the term webapp became a thing.
          It was also the name of the authoring software, or IDE.
        </details>

<p>
          This IDE, as you can see, was very much focused on the
          <strong>graphics and animation</strong> part of the authoring
          experience, not so much on the programming side of rich Web
          applications. Scripts existed merely as augmentation of objects in the
          scene.
        </p>

<p>
          I didn‚Äôt care for the graphical, scene-graph-oriented development and
          preferred pure programming with text and text files. Same reason why I
          don‚Äôt like the Unity Editor. So it‚Äôs a <strong>6/10</strong> for me.
        </p>

<h2>FlashDevelop</h2>

            .______________.<br>
            | FlashDevelop |<br>
            |_________[9/10]<br>
<p>
              FlashDevelop was a code-first Flash IDE. My first experience
              <span>with</span> a
              <span>‚Äúreal‚Äù</span> programming IDE
              <span>with</span> refactoring, build
              configurations, logging, libraries, and more.
            </p>

<p>
              I like how it renders code <span>in</span> bitmap
              fonts. Very crisp <span>in</span> the old CRT
              monitors <span>with</span> 800x600 screen
              resolution. I customized it
              <span>with</span> some downloaded programming
              fonts too.
            </p>

<p>
              Extremely lightweight compared to the alternative Adobe Flash.
              It<span>‚Äôs simple and fast. Plus code completion, snippets, and
                REFACTORING IN ActionScript!? It‚Äô</span>s a high 9/10.
            </p>

<p>
              My only problem was when some clients wanted the .fla file
              (Adobe<span>‚Äôs file format for Flash projects). But that‚Äô</span>s not a real problem.
            </p>

<h2>Code::Blocks</h2>

            // .______________.<br>
            // | Code::Blocks |<br>
            // |_________[6/10]<br>
<p>
              /* The only reason why I used Code::Blocks in the first place was
              that it was the IDE recommended for my first programming course when
              I was taking up CS. It was also preinstalled on the university
              compsci lab computers.
            </p>

<p>
              It‚Äôs fine. UI was not so great...? I found the build configuration
              setup confusing and so just ran gcc using cli. Then again it was my
              first time writing C, and (as I find out later in my career) build
              configs are always confusing.
            </p>

<p>I rate it a good 6/10. */</p>
<span>
          üí° Did you know that I manually did syntax highlighting for these
          in-editor reviews? At this point it became too tedious so I just made
          the text a code comment.
        </span>
<h2>vi</h2>

<p>
          I use
          <a target="_blank" href="https://en.wikipedia.org/wiki/Vi">vi</a> to
          write commit messages. It was git that trapped me in vi in the first
          place. I never really learned to use the advanced commands in vi, as I
          only use it to write in English - as in commit messages.
        </p>

<p>
          My rating would be <code>export EDITOR=nano</code>.
        </p>

<h2>Eclipse</h2>

<img srcset="/misc/ide-reviews/eclipse_800.generated.png 800w" sizes=" 800px" alt="screenshot of Eclipse" src="https://leanrada.com/misc/ide-reviews/eclipse.png?ref=rss" spec="100% [800) 800" loading="lazy">
<em>
          image stolen from
          <a target="_blank" href="https://draculatheme.com/">draculatheme.com</a>
        </em>
<p>
          Eclipse was <em>the</em> Java IDE a few years back. It was even the
          official IDE for developing Android apps for a while. How the mighty
          have
          <a target="_blank" href="https://movingfulcrum.com/the-fall-of-eclipse/">fallen</a>.
        </p>

<p>
          I used Eclipse throughout college for Java courses, and in my first job
          working on Java backends and Android apps. It was a very big app, in
          terms of features and memory usage.
        </p>

<p>
          Unfortunately, it was really slow. It‚Äôs like waiting for an eclipse. At
          work, I used to come in at like 9:30AM, boot up the computer, start up
          Eclipse, then immediately go get some snacks. After 5 minutes the toast
          is ready. 10 minutes later, Eclipse becomes usable and I could finally
          work.
        </p>

<p>
          It‚Äôs a <strong>4/10</strong> for me, due to slow performance. I‚Äôd rather
          use a text editor, if I only knew how the JARs and the APKs got built.
        </p>

<h2>Android Studio</h2>

<img srcset="/misc/ide-reviews/android-studio_800.generated.png 800w" sizes=" 800px" alt="screenshot of Android Studio" src="https://leanrada.com/misc/ide-reviews/android-studio.png?ref=rss" spec="100% [800) 800" loading="lazy">
<em>image from Wikimedia Commons</em>
<p>
          Android Studio saved my productivity as an Android dev. Sadly, that
          meant no more snacks while starting up the IDE. And no more naps while
          compiling. I guess JetBrains saved the Android development experience as
          a whole, from Android Studio to Kotlin and Compose.
        </p>

<p>
          It was still kinda slow at startup (?), ‚Äòcause of all the indexing going
          on. JetBrains really redefined IDEs with their Indexing Development
          Environments.
        </p>

<p>
          Still pretty good and still getting better. Search anywhere is awesome.
          The refactoring shortcuts are great. Android tools unmatched. Good
          <strong>9/10</strong>. (Only problem is memory usage üëé)
        </p>

<h2>Sublime Text</h2>

            .______________.<br>
            | Sublime Text |<br>
            |________[10/10]<br>
<p>
              Best text editor. Not an IDE per se, but it could be. Very snappy.
              Simple and easy-to-use with some advanced tricks.
            </p>

<p>
              I believe they also invented the minimap. Both the minimap and the
              command palette are super useful features. It‚Äôs also quite
              customizable and could be turned into a semi-IDE with build
              commands.
            </p>

<p>
              Due to Sublime Text I‚Äôve grown to love the simpler, more
              minimalistic tools. It‚Äôs life-changing. 10/10
            </p>

<h2>Visual Studio Code</h2>

            ._________.<br>
            | VS Code |<br>
            |___[<span>10/10</span>]<br>
<p>
              VS Code is the new Sublime Text. This has been my main tool in many
              projects for a long time now.
            </p>

<p>
              Sublime Text is still faster, I think, but I haven‚Äôt really compared
              them in a long time. I still use Sublime Text keybindings though.
              Muscle memory.
            </p>

<p>
              As a web dev, I like the built-in web browser so I could just open
              the page I‚Äôm working on and its source code side-by-side. And
              TypeScript / JavaScript support is strong.
            </p>

<p>
              Even outside of web development, the plugin marketplace is very
              extensive, and almost every language / workflow is supported.
            </p>

<h2>Cider V</h2>

<p>
          Cider V is an internal cloud-based editor used at Google. It‚Äôs like this
          <a target="_blank" href="https://github.dev/Kalabasa/kalabasa.github.io/blob/src/src/site/misc/ide-reviews/index.html">cloud-based code editor</a>, but for Google‚Äôs internal monorepo. It‚Äôs based on VS Code and pretty
          much behaves just like VS Code but with internal extensions.
        </p>

<p>
          The best thing about it is its
          <a target="_blank" href="https://ai.googleblog.com/2022/07/ml-enhanced-code-completion-improves.html">AI-powered autocomplete</a>, trained on Google‚Äôs own huge repository of code. Most (not all) of
          the time it just suggests what‚Äôs in my mind before it even exists in my
          mind.
        </p>

<img src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEj4vLV_OWhGUw9u2badD0ZlCFdl1mwBlYzQCQ_XRTtCyu2DKy-yGZhKgnRvruSrAdqQOpThDNi0lbpHjSn5b18aqJ-pJnvCZTEOgrpyVO75CWGTugrrN4e_RY65v_bUdLkOvmDBI9v2j3qA7pWaUAeorGXUzAYHShoNff52lK1lSd2u1seEOSn9JW7hvg/s1043/image5.gif" alt="demo of autcompletion" loading="lazy">

<p>
          However, the normal dumb autcompletion sometimes doesn‚Äôt work (or is
          slow?) which gets frustrating. tbf, I get that in VS Code too when
          working on very large projects.
        </p>

<p>
          I haven‚Äôt used GitHub Copilot + VS Code so I don‚Äôt have a reference for
          comparison. I rate this <strong>9/10</strong>.
        </p>

<h2>IntelliJ IDEA Community Edition</h2>

<img srcset="/misc/ide-reviews/idea_800.generated.png 800w" sizes=" 800px" alt="screenshot of IntelliJ IDEA" src="https://leanrada.com/misc/ide-reviews/idea.png?ref=rss" spec="100% [800) 800" loading="lazy">
<em>image from IntelliJ</em>
<p>
          Great Java and Kotlin IDE. I love the refactoring tools. Also, the data
          flow analysis tool is great for debugging.
        </p>

<p>
          But it‚Äôs slow and heavy sometimes. Must be the indexing. For me, a slow
          tool really ruins the flow of work and decreases productivity. IDEA
          makes up for it due to its features, so it‚Äôs tolerable.
        </p>

<p>
          As a Java IDE (without the Android goodness of Android Studio), it only
          gets
          <strong>8.5/10</strong>.
        </p>

<h2>IntelliJ IDEA Ultimate Edition</h2>

<img srcset="/misc/ide-reviews/idea_800.generated.png 800w" sizes=" 800px" alt="screenshot of IntelliJ IDEA" src="https://leanrada.com/misc/ide-reviews/idea.png?ref=rss" spec="100% [800) 800" loading="lazy">
<em>image from IntelliJ</em>
<p>
          This is the paid version of the above. Uh, I really didn‚Äôt notice any
          difference from the Community edition besides the splash screen. It‚Äôs
          rated <strong>8.5/$</strong>.
        </p>
<span>
          That‚Äôs all for now. I will update this page as I use more IDEs. üèÑ
        </span>]]></description>
            <link>https://leanrada.com/misc/ide-reviews?ref=rss</link>
            <guid isPermaLink="true">https://leanrada.com/misc/ide-reviews?ref=rss</guid>
            <pubDate>Wed, 21 Jun 2023 00:00:00 GMT</pubDate>
        </item>
        <item>
            <title><![CDATA[
                
                  Pure CSS tic-tac-toe with game AI
                
              ]]></title>
            <description><![CDATA[<p><em>For RSS readers: This article contains interactive content available on the <a href="https://leanrada.com/notes/pure-css-tictactoe-ai?ref=rss">original post on leanrada.com</a>.</em></p>

<p>As a software developer, I‚Äôm always looking for new and fun ways to challenge myself. Some time ago, I decided to implement tic-tac-toe with AI using only <strong>HTML</strong> and <strong>CSS</strong>. That is, no JavaScript! I already knew about the possibility of advanced CSS interactions (e.g. fancy checkboxes), but I wanted to see how far I could take it.</p>

<p>Here‚Äôs a CodePen of it! Can you beat a style sheet in a game of tic-tac-toe?</p>

<p data-height="700" data-theme-id="dark" data-default-tab="result" data-slug-hash="oVMOZK" data-user="kalabasa">
              <span>See the Pen <a href="https://codepen.io/kalabasa/pen/oVMOZK">
                  Pure CSS Tic Tac Toe AI</a> by Kalabasa (<a href="https://codepen.io/kalabasa">@kalabasa</a>)
                on <a href="https://codepen.io">CodePen</a>.</span>
            </p>

<p>In this post, I‚Äôll write about the steps I took to make it, starting with the fundamentals.</p>
<span>
              Disclaimer: This was an experiment only. Never do this in production code!
            </span>
<h2 id="building-blocks">Building blocks</h2>

<p>Before starting to build anything complex, it‚Äôs important to start small and think about the basic elements. Unlike JavaScript, HTML and CSS are declarative languages. We can‚Äôt have procedures or functions, control flow, if-statements, and the like. Instead what we have are markup and rules. We‚Äôll build upon these rules to create complex game logic.</p>

<p>For starters, let‚Äôs do something that‚Äôs fairly common on the web: <strong>custom checkbox styles</strong>.</p>
<label><input type="checkbox"><span></span> Check this out</label><small>(Hey, these demos are interactive!)</small>
<p>To do this, we need an extra element for the checkbox visuals, like an empty span element.</p>

<pre><code><span><span><span>&lt;</span>label</span><span>&gt;</span></span>
  <span><span><span>&lt;</span>input</span> <span>type</span><span><span>=</span><span>"</span>checkbox<span>"</span></span> <span>/&gt;</span></span> <span><span><span>&lt;</span>span</span><span>&gt;</span></span><span><span><span>&lt;/</span>span</span><span>&gt;</span></span> Check this out
<span><span><span>&lt;/</span>label</span><span>&gt;</span></span></code></pre>

<p>On the CSS side, the real checkbox input is hidden, while the span is styled as a checkbox in its stead.</p>

<p>Now here‚Äôs the important part, we‚Äôll use the <code>:checked</code> pseudo-class and the <strong>sibling combinator</strong> <code>~</code> to make it all work. The checked pseudo-class selector reacts to the checkbox input‚Äôs state, while the sibling combinator makes it possible to apply the styles on the separate fake checkbox element.</p>

<pre><code><span>input:checked ~ span</span> <span>{</span>
  <span>background-color</span><span>:</span> red<span>;</span>
  <span>transform</span><span>:</span> <span>rotate</span><span>(</span>45deg<span>)</span><span>;</span>
<span>}</span></code></pre>

<p>Custom checkboxes! Easy.</p>

<h3 id="action-at-a-distance">Action at a distance</h3>

<p>The sibling combinator has uses beyond styling boxes next to inputs. We can perform some ‚Äúaction at a distance‚Äù. For example, if you can tick the following ‚ÄúIs it raining‚Äù checkbox, the distant ‚ÄúAdvice‚Äù box reacts:</p>
<input type="checkbox" id="demo2_input"><label for="demo2_input">Is it raining?</label>
<p>As you know, when it rains, water falls down from the sky. This may cause undesired wetness. An umbrella is a device which shields the user from falling particles such as the aforementioned rainwater.</p>
<fieldset>
                <legend>Advice</legend>
                <span>Take an umbrella today!</span>
                <span>No need for an umbrella!</span>
              </fieldset>
<pre><code><span>input:checked ~ .advice .take-umbrella</span> <span>{</span>
    <span>visibility</span><span>:</span> visible<span>;</span>
<span>}</span>
<span>input:checked ~ .advice .no-umbrella</span> <span>{</span>
    <span>visibility</span><span>:</span> hidden<span>;</span>
<span>}</span></code></pre>

<p>As you‚Äôll see later, the sibling combinator <code>~</code> can be very useful for these types of interactions.</p>

<h3 id="the-next-level">The next level</h3>

<p>Let‚Äôs make this system a lot more flexible.</p>

<p>Using the <code>&lt;label&gt;</code>‚Äôs <code>for</code> attribute, we can get even more action at a distance. We can make just about any kind of UI we want!</p>

<p>To demonstrate, I present‚Ä¶ the weather-advice-o-matic! üåà Go ahead, press the button!</p>

<pre>Interactive content: <a href="https://leanrada.com/notes/pure-css-tictactoe-ai?ref=rss">Visit the website to play with interactive content!</a>
Alternative text: demo of CSS-only machine</pre>

<p>The way this generalises is that all the <code>&lt;input&gt;</code>s are placed at the very top of the document. These inputs represent the global state. We can use <code>&lt;label for=‚Ä¶</code> to control those inputs from anywhere, and sibling selectors to react to those inputs anywhere.</p>

<h3 id="or">OR</h3>

<p>A single button is not very exciting, is it? Let‚Äôs add another input and implement an <strong>OR</strong> construct to determine the output. That is, implement "if A or B then C".</p>

<p>In CSS this can be easily achieved by using a <strong>selector list</strong> (comma-separated selectors).</p>

<pre><code><span>input#raining:checked ~ .advice .take-umbrella,
input#sunny:checked ~ .advice .take-umbrella</span> <span>{</span>
  <span>visibility</span><span>:</span> visible<span>;</span>
<span>}</span></code></pre>

<p>Now, weather-advice-o-matic can make decisions based on two parameters!</p>

<pre>Interactive content: <a href="https://leanrada.com/notes/pure-css-tictactoe-ai?ref=rss">Visit the website to play with interactive content!</a>
Alternative text: demo of CSS-only machine</pre>

<p>(If RAINY or SUNNY then UMBRELLA)</p>

<h3 id="and">AND</h3>

<p>How about <strong>AND</strong>? We can implement an AND construct too. This involves chaining the inputs together in a single selector using sibling combinators.</p>

<pre><code><span>input#raining:checked ~ input#windy:checked ~ .advise .take-raincoat</span> <span>{</span>
  <span>visibility</span><span>:</span> visible<span>;</span>
<span>}</span></code></pre>

<p>What‚Äôs this? Weather-advice-o-matic can now make nuanced decisions! Wow! Careful, it might be sentient!!!</p>

<pre>Interactive content: <a href="https://leanrada.com/notes/pure-css-tictactoe-ai?ref=rss">Visit the website to play with interactive content!</a>
Alternative text: demo of CSS-only machine</pre>

<p>(If RAINY and WINDY then RAINCOAT)</p>

<p>Here‚Äôs a summary of what we have so far:</p>

<pre><code><span>/* if A or B then C */</span>
<span>A ~ C,
B ~ C</span> <span>{</span>
  C
<span>}</span>

<span>/* if A and B then C */</span>
<span>A ~ B ~ C</span> <span>{</span>
  C
<span>}</span></code></pre>

<p>Another basic computing operator aside from AND and OR is the <strong>NOT</strong> operator. We don‚Äôt really need that here, but for the record, there‚Äôs the <code>:not()</code> pseudo-class in CSS. You can figure that out.</p>

<h2 id="prototype-three-in-a-row">Prototype: Three-in-a-row</h2>

<p>As a proof of concept and precursor to tic-tac-toe, let‚Äôs look at this three-in-a-row game.</p>

<pre>Interactive content: <a href="https://leanrada.com/notes/pure-css-tictactoe-ai?ref=rss">Visit the website to play with interactive content!</a>
Alternative text: interactive demo of three-in-a-row</pre>

<p>This is a 3x3 array of checkbox inputs. Internally, each box is numbered 1 to 9 starting from the top-left box going left-to-right row-wise.</p>

<p>Here are the rules for implementing the win condition in CSS:</p>

<pre><code><span>#1:checked ~ #2:checked ~ #3:checked ~ .win,
#4:checked ~ #5:checked ~ #6:checked ~ .win,
#7:checked ~ #8:checked ~ #9:checked ~ .win,
#1:checked ~ #4:checked ~ #7:checked ~ .win,
#2:checked ~ #5:checked ~ #8:checked ~ .win,
#3:checked ~ #6:checked ~ #9:checked ~ .win,
#1:checked ~ #5:checked ~ #9:checked ~ .win,
#3:checked ~ #5:checked ~ #7:checked ~ .win</span> <span>{</span>
  <span>visibility</span><span>:</span> visible<span>;</span>
<span>}</span></code></pre>

<p>Yes, it‚Äôs kinda hacky, but that is expected when you force logic into CSS. For comparison, the CSS for tic-tac-toe goes over 9000 lines! I never said it would be clean.</p>

<p>Anyway, these 8 lines correspond to the 8 possible ways to win the game. The 3-input AND rule (remember AND rules?) in each line covers <em>every possible winning combination</em>. The pseudocode in the comment helps illustrate this:</p>

<pre><code><span>/*
 * if
 *      ([#1 marked] and [#2 marked] and [#3 marked]) // top row
 *   or ([#4 marked] and [#5 marked] and [#6 marked]) // middle row
 *   or ([#7 marked] and [#8 marked] and [#9 marked]) // bottom row
 *   .
 *   :
 *   or ([#3 marked] and [#5 marked] and [#7 marked]) // upward diagonal
 * then
 *   [win]
 */</span>
<span>#1:checked ~ #2:checked ~ #3:checked ~ .win,
#4:checked ~ #5:checked ~ #6:checked ~ .win,
#7:checked ~ #8:checked ~ #9:checked ~ .win,
#1:checked ~ #4:checked ~ #7:checked ~ .win,
#2:checked ~ #5:checked ~ #8:checked ~ .win,
#3:checked ~ #6:checked ~ #9:checked ~ .win,
#1:checked ~ #5:checked ~ #9:checked ~ .win,
#3:checked ~ #5:checked ~ #7:checked ~ .win</span> <span>{</span>
  <span>visibility</span><span>:</span> visible<span>;</span>
<span>}</span></code></pre>

<h2 id="taking-turns">Taking turns</h2>

<p>So far, the order of your inputs doesn‚Äôt matter. You can even undo your inputs by unchecking the boxes (Try it above). That won‚Äôt fly in a game of tic-tac-toe, where we take turns incrementally marking the board. No backsies!</p>

<p>We need a way to <strong>‚Äúconsume‚Äù</strong> inputs. We can do this by hiding the inputs or otherwise making them unclickable. This is just a trick, of course, as we can‚Äôt really disable inputs using CSS. But it works fine for the typical mouse and touch users.</p>

<p>So for tic-tac-toe, what I did was define multiple sets of the 3x3 input board, that is, one set of inputs for each turn.</p>

<video src="https://leanrada.com/notes/pure-css-tictactoe-ai/input_sets.mp4?ref=rss" muted="" autoplay="" loop="" aria-label="input sets illustration">
                Video: input sets illustration | Source: /notes/pure-css-tictactoe-ai/input_sets.mp4
              </video>

<p>Stacked on top of each other, each set is only interactable on its turn.</p>

<pre><code><span>/* Disable turn 1 inputs when turn 1 is played */</span>
<span>input[name="turn_1"]:checked ~ input[name="turn_1"]</span> <span>{</span>
    <span>pointer-events</span><span>:</span> none<span>;</span>
<span>}</span>
<span>/* Enable next turn's inputs */</span>
<span>input[name="turn_1"]:checked ~ input[name="turn_2"]</span> <span>{</span>
    <span>pointer-events</span><span>:</span> all<span>;</span>
<span>}</span>
<span>/* And so on... */</span></code></pre>

<p>Here‚Äôs little a demo of sequential inputs:</p>

<p><span>I was only able to implement up to three turns here. The exponential growth of rules has gotten really tedious to write!</span></p>

<pre>Interactive content: <a href="https://leanrada.com/notes/pure-css-tictactoe-ai?ref=rss">Visit the website to play with interactive content!</a>
Alternative text: interactive demo of three-in-a-row</pre>

<p>With the power of sequencing, we‚Äôre starting to recreate the power of state machines and procedural programming!</p>

<img srcset="/notes/pure-css-tictactoe-ai/meme_500.generated.jpg 500w,/notes/pure-css-tictactoe-ai/meme_664.generated.jpg 664w" sizes="not (min-width:664px) 500px, 664px" alt="Look What They Need To Mimic A Fraction Of Our Power meme" src="https://leanrada.com/notes/pure-css-tictactoe-ai/meme.jpg?ref=rss" spec="100% [664) 664" loading="lazy" width="100%" height="">

<h2 id="game-ai">Game AI</h2>
<span>
              I‚Äôm referring to the more specific term ‚Äúgame AI‚Äù here, because the term ‚ÄúAI‚Äù has come to mean some learning machine nowadays. Game AI simply means NPCs or computer-controlled agents.
            </span>
<p>Tic-tac-toe is a <a target="_blank" href="https://en.wikipedia.org/wiki/Solved_game">solved game</a>, which means there exists a perfect strategy. For every move, there is a known optimal counter move.</p>

<p>This is perfect for CSS as it‚Äôs just a bunch of static declarations. We can list all of the optimal moves and directly translate them into CSS declarations!</p>

<p>As a side-effect, the AI would never lose. But that‚Äôs not a bad thing at all. Here, the CSS will style on you.</p>

<p>The rules are essentially a bunch of if-then statements for every scenario. Here are a couple of them:</p>

<h3 id="blocking">Blocking</h3>

<p>Example rule: <em>If <strong>X(1)</strong> and <strong>X(2)</strong> then <strong>O(3)</strong>.</em></p>

<p>In English, if an X was played at box #1 (top-left) and another X is at #2 (top-center), then block the top row by playing O at box #3 (top-right).</p>

<p>(In these examples, X is the player and O is the AI.)</p>

<p>In CSS, that translates to:</p>

<pre><code><span>input[value="1"]:checked
~ input[value="2"]:checked
~ .o3</span> <span>{</span>
  <span>visibility</span><span>:</span> visible<span>,</span>
<span>}</span></code></pre>

<video src="https://leanrada.com/notes/pure-css-tictactoe-ai/blocking.mp4?ref=rss" muted="" autoplay="" loop="" aria-label="blocking rule animation">
                Video: blocking rule animation | Source: /notes/pure-css-tictactoe-ai/blocking.mp4
              </video>

<h3 id="winning-moves">Winning moves</h3>

<p>Another example: <em>If <strong>O(3)</strong> and <strong>O(7)</strong> then <strong>O(5)</strong>.</em></p>

<p>If O is at box #3 (top-right) and another O is at #7 (bottom-left), then win diagonally by playing O at box #5 (center).</p>

<p>Now, this rule needs knowledge of the AI‚Äôs previous moves, but the AI‚Äôs moves aren‚Äôt inputs! The AI‚Äôs state is not encoded in the checkboxes.</p>

<p>But since the AI is deterministic, we already know how those previous <em>O</em>s came about. They‚Äôre just responses to previous inputs as defined in previous rules! So, for example, we can substitute <strong>O(3)</strong> with the inputs that produced it, such as <strong>X(1)</strong> &amp; <strong>X(2)</strong>.</p>

<pre><code><span>/* We know X(1) and X(2) produces O(3), */</span>
<span>/*     and X(1) and X(4) produces O(7). */</span>
<span>/* Therefore, X(1) &amp; X(2) &amp; X(4) is equivalent to O(3) &amp; O(7). */</span>

<span>/* 'if X(1) &amp; X(2) &amp; X(4) then O(5)' is a winning move! */</span>
<span>input[value="1"]:checked
~ input[value="2"]:checked
~ input[value="4"]:checked
.o5</span> <span>{</span>
  <span>visibility</span><span>:</span> visible<span>,</span>
<span>}</span></code></pre>

<p>
              <span>
                ‚ö†Ô∏è Warning: I‚Äôm skipping major details in these code examples, like the existence of turn order, but it doesn‚Äôt really change the essence of these illustrations.
              </span>
            </p>

<p>Alright, so the game AI is really just a bunch of if-statements of the form <em>‚Äúif [inputs leading up to a scenario], then [show optimal response]‚Äù</em>, <strong>for every scenario</strong>. How do we find all the possible scenarios and corresponding optimal moves? Is there a list of all the optimal moves somewhere, like a cheatsheet?</p>

<p>Actually, there is one, but it‚Äôs for humans.</p>
<a target="_blank" href="https://xkcd.com/832/">
              <div>
                <img alt="" src="https://imgs.xkcd.com/comics/tic_tac_toe.png" loading="lazy"><span>xkcd/832</span>
              </div>
            </a>
<p>It‚Äôs not really feasible to write rules based on this by hand, unless you have more than 60,480 hours to spare.</p>

<p>What I did was write some kind of <a target="_blank" href="https://en.wikipedia.org/wiki/Minimax">minimax algorithm</a> to generate all the rules. The algorithm semi-exhaustively searched the game state space, while recording the moves that lead to a win or a draw, and saved those moves as rules.</p>

<p>I lost the original code (trashed it after finishing the project), but here‚Äôs an untested recreation of the algorithm:</p>

<pre><code><span>/**
 * Evaluates a game state having these parameters: last plays of player X,
 * the player who has the current turn, and the current board state.
 *
 * Along the way, prints CSS rules for O's plays.
 *
 * Returns the endgame for O: WIN, LOSS, or a DRAW. Assuming optimal play.
 */</span>
<span>function</span> <span>evaluate</span><span>(</span>xPlays<span>:</span> number<span>[</span><span>]</span><span>,</span> <span>currentTurn</span><span>:</span> <span>'X'</span> <span>|</span> <span>'O'</span><span>,</span> <span>board</span><span>:</span> <span>(</span><span>'X'</span> <span>|</span> <span>'O'</span> <span>|</span> <span>null</span><span>)</span><span>[</span><span>]</span><span>)</span> <span>{</span>

  <span>// checkWinner checks for a 3-in-a-row and returns the winner.</span>
  <span>let</span> winner <span>=</span> <span>checkWinner</span><span>(</span>board<span>)</span>
  <span>if</span> <span>(</span>winner <span>==</span> <span>'X'</span><span>)</span> <span>return</span> <span>LOSS</span>
  <span>else</span> <span>if</span> <span>(</span>winner <span>==</span> <span>'O'</span><span>)</span> <span>return</span> <span>WIN</span>
  <span>else</span> <span>if</span> <span>(</span>xPlays<span>.</span>length <span>==</span> <span>5</span><span>)</span> <span>return</span> <span>DRAW</span> <span>// Board full (5 Xs implies 4 Os)</span>


  <span>if</span> <span>(</span>currentTurn <span>==</span> <span>'O'</span><span>)</span> <span>{</span>
    <span>// Brute-force find the optimal play for O</span>
    <span>let</span> optimal <span>=</span> <span>null</span>
    <span>let</span> winnable <span>=</span> <span>false</span>
    <span>for</span> <span>(</span>i <span>=</span> <span>0</span><span>;</span> i <span>&lt;</span> <span>9</span><span>;</span> i<span>++</span><span>)</span> <span>{</span>
      <span>if</span> <span>(</span>board<span>[</span>i<span>]</span><span>)</span> <span>continue</span>

      board<span>[</span>i<span>]</span> <span>=</span> <span>'O'</span>
      <span>const</span> result <span>=</span> <span>evaluate</span><span>(</span>xPlays<span>,</span> <span>'X'</span><span>,</span> board<span>)</span>
      board<span>[</span>i<span>]</span> <span>=</span> <span>null</span>

      <span>if</span> <span>(</span>result <span>==</span> <span>DRAW</span><span>)</span> <span>{</span>
        <span>// This play will lead to a draw. Save it for now.</span>
        optimal <span>=</span> i
      <span>}</span> <span>else</span> <span>if</span> <span>(</span>result <span>==</span> <span>WIN</span><span>)</span> <span>{</span>
        <span>// This play will lead to a win. This is it.</span>
        optimal <span>=</span> i
        winnable <span>=</span> <span>true</span>
        <span>break</span>
      <span>}</span> <span>// No else. Discard play that would lead to LOSS.</span>
    <span>}</span>

    <span>if</span> <span>(</span>optimal <span>==</span> <span>null</span><span>)</span> <span>{</span>
      <span>// No winning play nor draws found. All paths lead to loss.</span>
      <span>return</span> <span>LOSS</span>
    <span>}</span> <span>else</span> <span>{</span>
      <span>// Optimal play found. Print rule.</span>
      <span>printCSS</span><span>(</span>xPlays<span>,</span> optimal<span>)</span>
      <span>return</span> winnable <span>?</span> <span>WIN</span> <span>:</span> <span>DRAW</span>
    <span>}</span>
  <span>}</span> <span>else</span> <span>{</span> <span>// currentTurn == 'X'</span>
    <span>// We don't know what the player would play</span>
    <span>// So evaluate every possibe play</span>
    <span>let</span> loseable <span>=</span> <span>false</span>
    <span>for</span> <span>(</span>i <span>=</span> <span>0</span><span>;</span> i <span>&lt;</span> <span>9</span><span>;</span> i<span>++</span><span>)</span> <span>{</span>
      <span>if</span> <span>(</span>board<span>[</span>i<span>]</span><span>)</span> <span>continue</span>

      board<span>[</span>i<span>]</span> <span>=</span> <span>'X'</span>
      <span>const</span> result <span>=</span> <span>evaluate</span><span>(</span><span>[</span><span>...</span>xPlays<span>,</span> i<span>]</span><span>,</span> <span>'O'</span><span>,</span> board<span>)</span>
      board<span>[</span>i<span>]</span> <span>=</span> <span>null</span>

      <span>if</span> <span>(</span>result <span>==</span> <span>LOSS</span><span>)</span> loseable <span>=</span> <span>true</span>
    <span>}</span>

    <span>// Assume player plays optimally. If they can win from current state,</span>
    <span>// then immediately presume LOSS. This will factor into O's turn evaluation</span>
    <span>// above, where any play that leads to LOSS is discarded.</span>
    <span>if</span> <span>(</span>loseable<span>)</span> <span>return</span> <span>LOSS</span>

    <span>// Not loseable, either winnable or drawable.</span>
    <span>// Returning DRAW allows both paths to be evaluated.</span>
    <span>return</span> <span>DRAW</span>
  <span>}</span>
<span>}</span></code></pre>

<p>And here‚Äôs the function that outputs CSS for a given rule:</p>

<pre><code><span>/**
 * Print CSS rule for the given game state and O's next play.
 */</span>
<span>function</span> <span>printCSS</span><span>(</span><span><span>xPlays</span><span>:</span> number<span>[</span><span>]</span><span>,</span> <span>oPlay</span><span>:</span> number</span><span>)</span> <span>{</span>
  css <span>+=</span> xPlays
    <span>.</span><span>map</span><span>(</span><span>(</span><span>pos<span>,</span> turn</span><span>)</span> <span>=&gt;</span>
        <span><span>`</span><span>input[name='turn_</span><span><span>${</span>turn<span>}</span></span><span>'][value='</span><span><span>${</span>pos<span>}</span></span><span>']:checked</span><span>`</span></span><span>)</span>
    <span>.</span><span>join</span><span>(</span><span>' ~ '</span><span>)</span>
    <span>+</span> <span><span>`</span><span> ~ .o</span><span><span>${</span>oPlay<span>}</span></span><span>`</span></span>
    <span>+</span> <span>' { visibility: visible; }'</span>
<span>}</span></code></pre>

<p>The CSS output is directly used in the game. Debugging this was a pain, but luckily I only got a couple of miscalculations (if I recall correctly).</p>

<h2 id="conclusion">Conclusion</h2>

<p>It was a very interesting project. I‚Äôm curious how far CSS machines like this could go. A JS to CSS transpiler, perhaps?</p>
<span>
              <strong>See also:</strong> <a target="_blank" href="https://silon.slaks.net/">silon.slaks.net - Adders and logic gates in pure CSS</a> (I found this after writing this article)
            </span>
<p>This project serves as a reminder that there are always new and exciting ways to waste our time doing impractical things, and that sometimes fun solutions come from thinking outside of the (check)box.</p>

<p><a target="_blank" href="https://codepen.io/kalabasa/pen/oVMOZK">Here‚Äôs the link to the CodePen!</a>
            </p>
]]></description>
            <link>https://leanrada.com/notes/pure-css-tictactoe-ai?ref=rss</link>
            <guid isPermaLink="true">https://leanrada.com/notes/pure-css-tictactoe-ai?ref=rss</guid>
            <pubDate>Fri, 05 May 2023 00:00:00 GMT</pubDate>
        </item>
        <item>
            <title><![CDATA[
                
                  Bitwise keyboard input method
                
              ]]></title>
            <description><![CDATA[<p><em>For RSS readers: This article contains interactive content available on the <a href="https://leanrada.com/notes/developing-bitwise-input-method?ref=rss">original post on leanrada.com</a>.</em></p>

<p>This post is about how I achieved the power of 15 keys using just 4 keys on the keyboard. I go over the motivation, the design, and the implementation. At the end, I wrap the solution into a small library. Maybe you‚Äôll find it useful!</p>

<h2 id="rationale">Rationale</h2>

<p>I use a compact keyboard called the <strong>Lily58</strong> as my main keyboard. It‚Äôs a column-staggered split keyboard.</p>

<img srcset="/notes/developing-bitwise-input-method/lily58_664.generated.jpg 664w" sizes=" 664px" alt="Photo of a Lily58 keyboard" src="https://leanrada.com/notes/developing-bitwise-input-method/lily58.jpg?ref=rss" spec="100% [664) 664" loading="lazy" width="100%" height="">
<span>The Lily58 keyboard. Photo from github.com/kata0510/Lily58</span>
<p>As the name implies, it has only 58 buttons instead of the normal 80+ buttons. Space was limited and it was hard to fit all the letters, numbers, symbols, and other unique keys that I need.</p>

<p>The function keys (F1, F2, F3, etc) were particularly cumbersome. I don‚Äôt use them very often, yet they take a lot of space. You can see with my previous function key layout that they‚Äôre not very space-efficient:</p>

<img srcset="/notes/developing-bitwise-input-method/prevlayout_656.generated.png 656w,/notes/developing-bitwise-input-method/prevlayout_664.generated.png 664w" sizes="not (min-width:664px) 656px, 664px" alt="" src="https://leanrada.com/notes/developing-bitwise-input-method/prevlayout.png?ref=rss" spec="100% [664) 664" loading="lazy" width="100%" height="">
<span>My previous layout with function keys on the right half of the keyboard. It‚Äôs on a layer that I call the ‚Äúfunction layer‚Äù.</span>
<p>Luckily, the Lily58 is <strong>programmable</strong>! Using the framework slash firmware called <a target="_blank" href="https://qmk.fm/">QMK</a>, I can program the keyboard to add whatever functionality I wanted. And that‚Äôs exactly how I optimized the function keys‚Äô space usage.</p>

<h2 id="the-scheme">The scheme</h2>

<p>To make space for other keys, I devised a different way to input function keys, a <strong>bitwise input scheme</strong>. In this scheme, you input in terms of bits; there is one key for each bit. For example, take four keys; if we assign them to bits 1, 2, 4, and 8, we can represent any number from 0 to 15 by pressing a combination of those keys.</p>

<pre>Interactive content: <a href="https://leanrada.com/notes/developing-bitwise-input-method?ref=rss">Visit the website to play with interactive content!</a>
Alternative text: interactive simulation of bitwise keyboard input</pre>
Interactive diagram! Click the buttons to toggle the corresponding bits.
<p>With 15 different combinations, we have more than enough inputs to cover the function keys! Each decimal number is directly mapped to a function key in a 1-to-1 correspondence. For example, pressing the bit combination for decimal 1 will input F1, pressing the combination for decimal 2 will input F2, and so on.</p>
<span>
              <p>Did you know that there are 24 function keys in total?</p>
              <p>These are the F1, F2, F3, F4, F5, F6, F7, F8, F9, F10, F11, F12, F13, F14, F15, F16, F18, F19, F20, F21, F22, F23, and F24 keys.</p>
              <p>Bit wise, we‚Äôd need just 5 bits - 5 keys to cover all 24 function keys.</p>
            </span>
<h2 id="implementation">Implementation</h2>

<p>So how does it work? Let‚Äôs dive into the practical details.</p>

<p>First of all, the implementation doesn‚Äôt care about timing, so you can press the buttons as sloppily as you want. The key thing is that the algorithm waits for you to release all the buttons before committing the resulting combination.</p>

<p>To do any of this, we need a way to keep track of the state of the bits. Let‚Äôs use an unsigned integer variable to store it.</p>

<p>When a button is pressed, its corresponding bit is set to 1. But when released, we do not necessarily clear the bit back to 0. There will be a separate mechanism for flushing the accumulated bits.</p>

<p>Let‚Äôs call the variable <code>accumulator</code>.</p>

<pre><code><span><span> </span> static uint8_t accumulator <span>=</span> <span>0</span><span>;</span>
</span>
<span><span> </span> void <span>on_press</span><span>(</span>uint16_t keycode<span>)</span> <span>{</span>
<span> </span>   int index <span>=</span> <span>get_bit_index</span><span>(</span>keycode<span>)</span><span>;</span>
<span> </span>   <span>if</span> <span>(</span>index <span>==</span> <span>-</span><span>1</span><span>)</span> <span>return</span><span>;</span>
</span>
<span><span> </span>   accumulator <span>|</span><span>=</span> <span>(</span><span>1</span> <span>&lt;</span><span>&lt;</span> index<span>)</span><span>;</span>
<span> </span> <span>}</span></span></code></pre>

<p>Now, the accumulated bits will only be evaluated when all of the buttons have been released. A quick way of knowing when that happens is to watch for the last button to be released. To do this, another integer variable tracks how many buttons are currently being pressed.</p>

<pre><code><span><span>+</span> <span>// Keep count of keys being pressed</span>
<span>+</span> static int8_t pressed_keys <span>=</span> <span>0</span><span>;</span>
</span><span><span> </span> static uint8_t accumulator <span>=</span> <span>0</span><span>;</span>
</span>
<span><span> </span> void <span>on_press</span><span>(</span>uint16_t keycode<span>)</span> <span>{</span>
<span> </span>   int index <span>=</span> <span>get_bit_index</span><span>(</span>keycode<span>)</span><span>;</span>
<span> </span>   <span>if</span> <span>(</span>index <span>==</span> <span>-</span><span>1</span><span>)</span> <span>return</span><span>;</span>
</span>
<span><span>+</span>   <span>// Count key being pressed</span>
<span>+</span>   pressed_keys<span>++</span><span>;</span>
<span>+</span>
</span><span><span> </span>   accumulator <span>|</span><span>=</span> <span>(</span><span>1</span> <span>&lt;</span><span>&lt;</span> index<span>)</span><span>;</span>
<span> </span> <span>}</span>
</span>
<span><span>+</span> void <span>on_release</span><span>(</span>uint16_t keycode<span>)</span> <span>{</span>
<span>+</span>   int index <span>=</span> <span>get_bit_index</span><span>(</span>keycode<span>)</span><span>;</span>
<span>+</span>   <span>if</span> <span>(</span>index <span>==</span> <span>-</span><span>1</span><span>)</span> <span>return</span><span>;</span>
<span>+</span>
<span>+</span>   <span>// Count key being released</span>
<span>+</span>   pressed_keys<span>--</span><span>;</span>
<span>+</span> <span>}</span></span></code></pre>

<p>Once the last button is released, it is time to flush the input. The resulting decimal number is mapped to a function key that will finally be sent to the computer.</p>

<pre><code><span><span> </span> void <span>on_release</span><span>(</span>uint16_t keycode<span>)</span> <span>{</span>
<span> </span>   int index <span>=</span> <span>get_bit_index</span><span>(</span>keycode<span>)</span><span>;</span>
<span> </span>   <span>if</span> <span>(</span>index <span>==</span> <span>-</span><span>1</span><span>)</span> <span>return</span><span>;</span>
</span>
<span><span> </span>   pressed_keys<span>--</span><span>;</span>
</span>
<span><span>+</span>   <span>// When all keys have been released, flush the input</span>
<span>+</span>   <span>if</span> <span>(</span>pressed_keys <span>&lt;=</span> <span>0</span><span>)</span> <span>{</span>
<span>+</span>     <span>// Map accumulated value to the corresponding F-key code</span>
<span>+</span>     <span>send_to_computer</span><span>(</span>FUNCTION_KEYS<span>[</span>accumulator<span>]</span><span>)</span><span>;</span>
<span>+</span>
<span>+</span>     <span>// Reset state for next round</span>
<span>+</span>     pressed_keys <span>=</span> <span>0</span><span>;</span>
<span>+</span>     accumulator <span>=</span> <span>0</span><span>;</span>
<span>+</span>   <span>}</span>
</span><span><span> </span> <span>}</span></span></code></pre>

<p>And that‚Äôs about it! This is how I got more space on my keyboard. As a bonus, it forces me to practice converting decimal to binary! üòÇ</p>

<p>Of course, the code shown here skips some details and totally lacks integration with the QMK framework, but you get the gist.</p>

<p>There‚Äôs one limitation to this approach though: you cannot hold down a function key. It will only send the function key at the end when the last button has been released. I haven‚Äôt found a need to hold down function keys so it‚Äôs not a problem for me right now.</p>

<p>I recreated the algorithm in JavaScript/Web as a live demo here! Try it out!</p>

<pre>Interactive content: <a href="https://leanrada.com/notes/developing-bitwise-input-method?ref=rss">Visit the website to play with interactive content!</a>
Alternative text: interactive simulation of bitwise keyboard input</pre>
Demo! You need to use a keyboard for this. Put your input focus on this box and start pressing combinations!
<p><span><strong>Update, 8 months later:</strong> Coming back to this post, I realise that not many people have finger independence and would not find the above combinatorial input very useful. Um, I guess it helps to play the piano. But I believe experienced typists would be able to use it too!</span></p>

<h2 id="how-to-get-it">How to get it</h2>

<p>If you use QMK you can easily integrate this with your own keymap. Here‚Äôs a step-by-step on how you may use this utility:</p>

<h3 id="step-1-define-the-bit-keys">Step 1: Define the bit keys.</h3>

<p>First, define the keys you want to use as bit input in an array called <code>bitwise_f_keys</code>.</p>

<p>For example, if you wanted to repurpose F1, F2, F3, and F4 to represent the four bits, write the following in your <code>keymap.c</code>:</p>

<pre><code>const uint16_t bitwise_f_keys<span>[</span><span>]</span> <span>=</span> <span>{</span> KC_F1<span>,</span> KC_F2<span>,</span> KC_F3<span>,</span> KC_F4 <span>}</span><span>;</span>
uint8_t NUM_BITWISE_F_KEYS <span>=</span>
    <span>sizeof</span><span>(</span>bitwise_f_keys<span>)</span> <span>/</span> <span>sizeof</span><span>(</span>uint16_t<span>)</span><span>;</span></code></pre>

<p>Note: <code>NUM_BITWISE_F_KEYS</code> is also required.</p>

<h3 id="step-2-hook-up-the-library">Step 2: Hook up the library.</h3>

<p>Hook it up by calling <code>process_bitwise_f()</code> at the top of your <code>process_record_user()</code>.</p>

<pre><code>bool <span>process_record_user</span><span>(</span>uint16_t keycode<span>,</span> keyrecord_t <span>*</span>record<span>)</span> <span>{</span>
  <span>if</span> <span>(</span><span>!</span><span>process_bitwise_f</span><span>(</span>keycode<span>,</span> record<span>)</span><span>)</span> <span>return</span> <span>false</span><span>;</span>

  <span>/* ... */</span>

  <span>return</span> <span>true</span><span>;</span>
<span>}</span></code></pre>

<h3 id="step-3-include-the-library-in-your-project">Step 3: Include the library in your project.</h3>

<p>Finally, copy <a target="_blank" href="https://raw.githubusercontent.com/Kalabasa/qmk_firmware/2d1608287bb8b52669255266472975875f7c2423/keyboards/lily58/keymaps/Kalabasa/features/bitwise_f.h"><code>bitwise_f.h</code></a> and <a target="_blank" href="https://raw.githubusercontent.com/Kalabasa/qmk_firmware/2d1608287bb8b52669255266472975875f7c2423/keyboards/lily58/keymaps/Kalabasa/features/bitwise_f.c"><code>bitwise_f.c</code></a> into your keymap directory, and include <code>bitwise_f.c</code> in your <code>rules.mk</code> build file.</p>

<p>Don‚Äôt forget to <code>#include "dir/where/you/copied/bitwise_f.h"</code> in your <code>keymap.c</code>!</p>

<p><span>Props to reddit user u/hakbraley for helping improve the code!</span>
            </p>
]]></description>
            <link>https://leanrada.com/notes/developing-bitwise-input-method?ref=rss</link>
            <guid isPermaLink="true">https://leanrada.com/notes/developing-bitwise-input-method?ref=rss</guid>
            <pubDate>Thu, 16 Mar 2023 00:00:00 GMT</pubDate>
        </item>
        <item>
            <title><![CDATA[
                
                  Simple image recognition with vanilla JavaScript
                
              ]]></title>
            <description><![CDATA[
<p>Hi there! I want to share my experience with an <a target="_blank" href="https://en.wikipedia.org/wiki/Computer_vision#Recognition"><strong>image recognition</strong></a> problem I faced in an art project (It was an <a target="_self" href="https://leanrada.com/wares/dimensions?ref=rss">augmented reality art project</a>).</p>

<img srcset="/notes/simple-image-recognition-vanilla-js/image-recognition_664.generated.png 664w" sizes=" 664px" alt="Image recognition illustration" src="https://leanrada.com/notes/simple-image-recognition-vanilla-js/image-recognition.png?ref=rss" spec="100% [664) 664" loading="lazy" width="100%" height="">
<span>Image recognition problems come in different forms.</span>
<p>As part of the project, I needed a mobile app to be able to recognize a particular art piece. Then it can overlay virtual effects onto the real-world image. The goal was to have a unique and engaging experience!</p>

<video src="https://leanrada.com/notes/simple-image-recognition-vanilla-js/demo.mp4?ref=rss" muted="" autoplay="" loop="" aria-label="Demo video">
                Video: Demo video | Source: /notes/simple-image-recognition-vanilla-js/demo.mp4
              </video>
<span>The app should recognize when the target art piece has been aligned.</span>
<p>There are various solutions available for tackling this problem, ranging from basic histogram matching to advanced convolutional neural networks. There are even libraries that can provide a solution right out of the box! But I decided to take on the challenge of developing my own solution instead of relying on existing tools. Not only did this allow me to learn something new, but it also let me have some fun approaching the problem!</p>

<p><span><strong>TL;DR</strong> - It converts the camera image into a feature vector and then compares that against a predefined target reference.</span></p>

<h2 id="color-and-illumination-theory">Color and illumination theory</h2>

<p>To begin solving the problem, we first need to understand the mechanics. It all starts by capturing an image from the camera.</p>

<p>Now, it‚Äôs important to keep in mind that the camera‚Äôs perception of color can be influenced by various factors. Factors include the lighting conditions in the room or the quality of the camera itself. We need to account for these variables in our solution.</p>

<img srcset="/notes/simple-image-recognition-vanilla-js/tc-vs-pc_664.generated.jpg 664w" sizes=" 664px" alt="diagram" src="https://leanrada.com/notes/simple-image-recognition-vanilla-js/tc-vs-pc.jpg?ref=rss" spec="100% [664) 664" loading="lazy" width="100%" height="">
<span>True color (TC) vs perceived color (PC)</span>
<p>Simply comparing raw pixel data against the target image would likely fail due to the unknown environmental factors. One way of addressing this is to massage the input to isolate the true color from the environmental factors.</p>

<p>For this, I created a graphical model for the perceived color. It‚Äôs roughly based on CGI illumination models. This was the key to making the image recognition algorithm more robust.</p>

<p>Here‚Äôs the equation:</p>

<pre><code>PC = TC * a + b
</code></pre>

<ul>
              <li><code>PC</code> is the color perceived from the camera sensor.</li>
              <li><code>TC</code> (unknown variable) is the true color of the material.</li>
              <li><code>a</code> and <code>b</code> (unknown variables) are parameters that together describe the vague real-world lighting variables like white balance, environmental illumination, camera sensor quality, and other factors.</li>
            </ul>

<p>The algorithm begins by calculating the average colors of three predetermined regions within the image. While these regions are specific to my art piece, you can adapt the algorithm to work with any configuration of (at least) three regions.</p>

<img srcset="/notes/simple-image-recognition-vanilla-js/dimensions_illo2_664.generated.jpg 664w" sizes=" 664px" alt="diagram" src="https://leanrada.com/notes/simple-image-recognition-vanilla-js/dimensions_illo2.jpg?ref=rss" spec="100% [664) 664" loading="lazy" width="100%" height="">
<span>The regions were specifically chosen to capture key features.</span>
<p>Let‚Äôs call the three colors <code>PC1</code>, <code>PC2</code>, and <code>PC3</code>.</p>

<p>To get the average, you can either (1) read over the pixels in those regions and average them, or (2) downsample the image and directly use pixel colors (typically faster). For this case, I used the former, which is reading over the pixels within each region to calculate the average color.</p>

<pre><code><span>// &lt;video&gt; element streams the camera, not shown here how</span>
video <span>=</span> document<span>.</span><span>getElementById</span><span>(</span><span>'video'</span><span>)</span><span>;</span>
<span>// &lt;canvas&gt; to hold a video frame for reading pixels</span>
canvas <span>=</span> document<span>.</span><span>getElementById</span><span>(</span><span>'canvas'</span><span>)</span><span>;</span> 

<span>// Capture a video frame into the canvas</span>
<span>const</span> canvasContext <span>=</span> canvas<span>.</span><span>getContext</span><span>(</span><span>'2d'</span><span>)</span><span>;</span>
canvasContext<span>.</span><span>drawImage</span><span>(</span>video<span>,</span> <span>0</span><span>,</span> <span>0</span><span>,</span> width<span>,</span> height<span>)</span><span>;</span>
<span>const</span> imageData <span>=</span> canvasContext
    <span>.</span><span>getImageData</span><span>(</span><span>0</span><span>,</span> <span>0</span><span>,</span> width<span>,</span> height<span>)</span>
    <span>.</span>data<span>;</span>

<span>// Get the colors</span>
<span>const</span> pc1 <span>=</span> <span>getRegionAverageColor</span><span>(</span>imageData<span>,</span> regionRect1<span>)</span><span>;</span>
<span>const</span> pc2 <span>=</span> <span>getRegionAverageColor</span><span>(</span>imageData<span>,</span> regionRect2<span>)</span><span>;</span>
<span>const</span> pc3 <span>=</span> <span>getRegionAverageColor</span><span>(</span>imageData<span>,</span> regionRect3<span>)</span><span>;</span>

<span>function</span> <span>getRegionAverageColor</span><span>(</span><span>imageData<span>,</span> rect</span><span>)</span> <span>{</span>
  <span>const</span> lineStride <span>=</span> <span>4</span> <span>*</span> width<span>;</span>
  <span>let</span> r <span>=</span> <span>0</span><span>;</span>
  <span>let</span> g <span>=</span> <span>0</span><span>;</span>
  <span>let</span> b <span>=</span> <span>0</span><span>;</span>
  <span>for</span> <span>(</span><span>let</span> j <span>=</span> rect<span>.</span>y<span>;</span> j <span>&lt;</span> rect<span>.</span>y <span>+</span> rect<span>.</span>height<span>;</span> j<span>++</span><span>)</span> <span>{</span>
    <span>for</span> <span>(</span><span>let</span> i <span>=</span> rect<span>.</span>x<span>;</span> i <span>&lt;</span> rect<span>.</span>x <span>+</span> rect<span>.</span>width<span>;</span> i<span>++</span><span>)</span> <span>{</span>
      r <span>+=</span> imageData<span>[</span>j <span>*</span> lineStride <span>+</span> i <span>*</span> <span>4</span><span>]</span> <span>/</span> <span>0xff</span><span>;</span>
      g <span>+=</span> imageData<span>[</span>j <span>*</span> lineStride <span>+</span> i <span>*</span> <span>4</span> <span>+</span> <span>1</span><span>]</span> <span>/</span> <span>0xff</span><span>;</span>
      b <span>+=</span> imageData<span>[</span>j <span>*</span> lineStride <span>+</span> i <span>*</span> <span>4</span> <span>+</span> <span>2</span><span>]</span> <span>/</span> <span>0xff</span><span>;</span>
    <span>}</span>
  <span>}</span>
  <span>const</span> count <span>=</span> rect<span>.</span>width <span>*</span> rect<span>.</span>height<span>;</span>
  <span>return</span> <span>{</span>
    <span>r</span><span>:</span> r <span>/</span> count<span>,</span>
    <span>g</span><span>:</span> g <span>/</span> count<span>,</span>
    <span>b</span><span>:</span> b <span>/</span> count
  <span>}</span><span>;</span>
<span>}</span></code></pre>

<p>Refer to these MDN articles <a target="_blank" href="https://developer.mozilla.org/en-US/docs/Web/API/Canvas_API/Manipulating_video_using_canvas">Manipulating_video_using_canvas</a> and <a target="_blank" href="https://developer.mozilla.org/en-US/docs/Web/API/ImageData">ImageData</a> for details about the Web APIs.</p>

<p>After getting the colors, we can start processing them. First, subtract the top <code>PC1</code> and middle <code>PC2</code> colors, as well as the middle <code>PC2</code> and bottom <code>PC3</code> - like a 1-dimensional convolution. The order of subtraction doesn‚Äôt really matter. This produces two difference colors.</p>

<p>Let‚Äôs call the resulting colors <code>D1</code> and <code>D2</code>:</p>

<img srcset="/notes/simple-image-recognition-vanilla-js/dimensions_illo3_664.generated.jpg 664w" sizes=" 664px" alt="diagram" src="https://leanrada.com/notes/simple-image-recognition-vanilla-js/dimensions_illo3.jpg?ref=rss" spec="100% [664) 664" loading="lazy" width="100%" height="">

<pre><code><span>// To subtract two colors, we subtract each RGB component</span>
<span>const</span> d1 <span>=</span> <span>{</span>
  <span>r</span><span>:</span> pc1<span>.</span>r <span>-</span> pc2<span>.</span>r<span>,</span>
  <span>g</span><span>:</span> pc1<span>.</span>g <span>-</span> pc2<span>.</span>g<span>,</span>
  <span>b</span><span>:</span> pc1<span>.</span>b <span>-</span> pc2<span>.</span>b
<span>}</span><span>;</span>
<span>const</span> d2 <span>=</span> <span>{</span>
  <span>r</span><span>:</span> pc2<span>.</span>r <span>-</span> pc3<span>.</span>r<span>,</span>
  <span>g</span><span>:</span> pc2<span>.</span>g <span>-</span> pc3<span>.</span>g<span>,</span>
  <span>b</span><span>:</span> pc2<span>.</span>b <span>-</span> pc3<span>.</span>b
<span>}</span><span>;</span></code></pre>

<p>Subtracting two perceived colors eliminates the unknown lighting variable <code>b</code>, as demonstrated in the following derivation:</p>

<pre><code>D1 = PC2 - PC1
  = (TC2 * a + b) - (TC1 * a + b)
  = TC2 * a - TC1 * a
  = (TC2 - TC1) * a
</code></pre>

<p>The resulting <code>D1</code> and <code>D2</code> are actually proportional to the true colors. But, they‚Äôre still both influenced by the lighting factor <code>a</code>:</p>

<pre><code>D1 = (TC2 - TC1) * a
D2 = (TC3 - TC2) * a
</code></pre>

<p>To remove the remaining lighting variable <code>a</code>, we can "normalize" the values. That is, divide each by the largest value among them.</p>

<pre><code>N1 = D1 / max(|D1|, |D2|)
N2 = D2 / max(|D1|, |D2|)
</code></pre>

<p>The resulting values <code>N1</code> and <code>N2</code> represent normalized <code>D1</code> and <code>D2</code> respectively.</p>

<img srcset="/notes/simple-image-recognition-vanilla-js/dimensions_illo4_664.generated.jpg 664w" sizes=" 664px" alt="diagram" src="https://leanrada.com/notes/simple-image-recognition-vanilla-js/dimensions_illo4.jpg?ref=rss" spec="100% [664) 664" loading="lazy" width="100%" height="">

<p>And here‚Äôs the code for that:</p>

<pre><code><span>// Get 'max(|D1|, |D2|)'</span>
<span>const</span> d1Magnitude <span>=</span> Math<span>.</span><span>hypot</span><span>(</span>d1<span>.</span>r<span>,</span> d1<span>.</span>g<span>,</span> d1<span>.</span>b<span>)</span><span>;</span>
<span>const</span> d2Magnitude <span>=</span> Math<span>.</span><span>hypot</span><span>(</span>d2<span>.</span>r<span>,</span> d2<span>.</span>g<span>,</span> d2<span>.</span>b<span>)</span><span>;</span>

<span>// Add 0.001 to avoid division by zero</span>
<span>const</span> max <span>=</span> Math<span>.</span><span>max</span><span>(</span>d1Magnitude<span>,</span> d2Magnitude<span>)</span> <span>+</span> <span>0.001</span><span>;</span>

<span>const</span> n1 <span>=</span> <span>{</span>
  <span>r</span><span>:</span> d1<span>.</span>r <span>/</span> max<span>,</span>
  <span>g</span><span>:</span> d1<span>.</span>g <span>/</span> max<span>,</span>
  <span>b</span><span>:</span> d1<span>.</span>b <span>/</span> max<span>,</span>
<span>}</span><span>;</span>
<span>const</span> n2 <span>=</span> <span>{</span>
  <span>r</span><span>:</span> d2<span>.</span>r <span>/</span> max<span>,</span>
  <span>g</span><span>:</span> d2<span>.</span>g <span>/</span> max<span>,</span>
  <span>b</span><span>:</span> d2<span>.</span>b <span>/</span> max<span>,</span>
<span>}</span><span>;</span></code></pre>

<p>I‚Äôm not showing the full derivation here, but normalizing will get rid of the common factor <code>a</code>. The handwavy explanation is, if you divide two values having a common factor, that factor gets canceled out.</p>

<p>Thus, if we expand all the terms:</p>

<pre><code>N1 = (TC2 - TC1) / max(TC2 - TC1, TC3 - TC2)
N2 = (TC3 - TC2) / max(TC2 - TC1, TC3 - TC2)
</code></pre>

<p>The result is that the final values <code>N1</code> and <code>N2</code> are derived purely from true color and are not affected by lighting parameters. <small>According to the model anyway.</small></p>

<p>This whole preprocessing ensures that the algorithm is robust across different lighting conditions and phone cameras, as it only uses true color data.</p>

<img srcset="/notes/simple-image-recognition-vanilla-js/dimensions_tester_664.generated.jpg 664w" sizes=" 664px" alt="" src="https://leanrada.com/notes/simple-image-recognition-vanilla-js/dimensions_tester.jpg?ref=rss" spec="100% [664) 664" loading="lazy" width="100%" height="">
<span>Actual test piece used in development. Even this badly-printed image in poor lighting can be recognized by the algorithm.</span>
<h2 id="feature-vectors">Feature vectors</h2>

<p>At this point, we can start looking at individual RGB values instead of thinking about "colors". You see, colors are just numbers representing red, green, and blue values.</p>

<img srcset="/notes/simple-image-recognition-vanilla-js/rgb_664.generated.png 664w" sizes=" 664px" alt="" src="https://leanrada.com/notes/simple-image-recognition-vanilla-js/rgb.png?ref=rss" spec="100% [664) 664" loading="lazy" width="100%" height="">
<span>A color is composed of RGB values</span>
<p>From the normalized colors <code>N1</code> and <code>N2</code>, we can obtain six numerical values (three from each). These values can be rolled into one combined series of numbers, which we‚Äôll call the <strong>feature vector</strong> of the image. The feature vector can be thought of as a numerical representation of certain characteristics of the image.</p>

<pre><code><span>const</span> featureVector <span>=</span> <span>[</span>
  n1<span>.</span>r<span>,</span>
  n1<span>.</span>g<span>,</span>
  n1<span>.</span>b<span>,</span>
  n2<span>.</span>r<span>,</span>
  n2<span>.</span>g<span>,</span>
  n2<span>.</span>b<span>,</span>
<span>]</span><span>;</span></code></pre>

<p>In short, the feature vector <em>summarizes</em> the image.</p>

<img srcset="/notes/simple-image-recognition-vanilla-js/dimensions_illo5_664.generated.jpg 664w" sizes=" 664px" alt="diagram" src="https://leanrada.com/notes/simple-image-recognition-vanilla-js/dimensions_illo5.jpg?ref=rss" spec="100% [664) 664" loading="lazy" width="100%" height="">

<p>By turning colors into plain numbers, we say goodbye to subjective perceptions of color and enter the objective and computable realm of mathematics.</p>

<p>This reduces the problem of comparing image similarity into a simple numerical comparison. If the numbers match, then the images match!</p>

<p>Now, we just need the feature vector of the <em>target image</em> to compare with. We can precompute the same normalization process on the target image and hardcode the resulting feature vector in the app.</p>

<p>I also got a couple more samples from real photos of the print for good measure.</p>

<pre><code><span>// (original + real sample 1 + real sample 2) / 3</span>
<span>const</span> targetFeatureVector <span>=</span> <span>[</span>
  <span>(</span>
    <span>-</span><span>0.3593924173784146</span> <span>+</span>
    <span>-</span><span>0.3030924568415693</span> <span>+</span>
    <span>-</span><span>0.27620639981601575</span>
  <span>)</span> <span>/</span> <span>3</span><span>,</span>
  <span>(</span>
    <span>-</span><span>0.611915816235142</span> <span>+</span>
    <span>-</span><span>0.590167832630535</span> <span>+</span>
    <span>-</span><span>0.5946857824325745</span>
  <span>)</span> <span>/</span> <span>3</span><span>,</span>
  <span>(</span>
    <span>-</span><span>0.498629075974555</span> <span>+</span>
    <span>-</span><span>0.4975375806689763</span> <span>+</span>
    <span>-</span><span>0.49879828486061084</span>
  <span>)</span> <span>/</span> <span>3</span><span>,</span>
  <span>(</span>
    <span>0.35716016633879705</span> <span>+</span>
    <span>0.4556467533062926</span> <span>+</span>
    <span>0.47164734468790415</span>
  <span>)</span> <span>/</span> <span>3</span><span>,</span>
  <span>(</span>
    <span>0.17718492626963767</span> <span>+</span>
    <span>0.1053991137797178</span> <span>+</span>
    <span>0.13449453064454686</span>
  <span>)</span> <span>/</span> <span>3</span><span>,</span>
  <span>(</span>
    <span>0.2980055137889341</span> <span>+</span>
    <span>0.30589264583678</span> <span>+</span>
    <span>0.2811110391693084</span>
  <span>)</span> <span>/</span> <span>3</span>
<span>]</span><span>;</span></code></pre>

<p>Now that we‚Äôve got the feature vectors for both the camera image and target image, we can compare them apples to apples.</p>

<img srcset="/notes/simple-image-recognition-vanilla-js/dimensions_illo6_664.generated.jpg 664w" sizes=" 664px" alt="diagram" src="https://leanrada.com/notes/simple-image-recognition-vanilla-js/dimensions_illo6.jpg?ref=rss" spec="100% [664) 664" loading="lazy" width="100%" height="">

<p>We can use Euclidean distance as a measure of vector similarity. Remember, vector similarity is our proxy for image similarity!</p>

<pre><code><span>const</span> vectorDistance <span>=</span> Math<span>.</span><span>hypot</span><span>(</span>
  <span>...</span>featureVector<span>.</span><span>map</span><span>(</span>
    <span>(</span><span>value<span>,</span> index</span><span>)</span> <span>=&gt;</span>
        targetFeatureVector<span>[</span>index<span>]</span> <span>-</span> value
  <span>)</span>
<span>)</span><span>;</span>

<span>if</span> <span>(</span>vectorDistance <span>&lt;</span> <span>THRESHOLD</span><span>)</span> <span>{</span>
  <span>// Image recognized!</span>
<span>}</span></code></pre>

<p>If the distance between the two vectors is below a certain threshold, then it‚Äôs a match!</p>

<p>Voil√†! That‚Äôs the algorithm. You take the input image, turn it into a feature vector, and compare it to a precomputed target vector. The whole image detection code totals less than 200 lines and requires no external library! This algorithm was integrated into the AR app that came along with the art exhibition.</p>

<h2 id="conclusion">Conclusion</h2>

<p>So, that‚Äôs the image detection algorithm I developed for my AR art app. It‚Äôs pretty straightforward and efficient, with just a few lines of code. It‚Äôs also fast enough to run in real-time on a phone camera feed, which is nice.</p>

<p>Although it was designed for the specific images I had, you can customize it to suit your needs.</p>

<p>Now, the algorithm does have a few limitations. It doesn‚Äôt take into account the positioning of the input image, so it has to be in the exact orientation as the target image. Also, extreme lighting conditions, irregular shadows, shiny surfaces, and the like might affect its accuracy.</p>

<p>Overall, I‚Äôm pretty happy with how it turned out. While it‚Äôs not a general-purpose algorithm, it solved the problem for my art project perfectly. üòÑ</p>

<h3 id="demo">Demo!</h3>

<p>Want to try out the algorithm? Open this page on a desktop, and then use your phone to scan the QR code in the piece.</p>

<img srcset="/wares/dimensions/media/dimensions_finalset_664.generated.jpg 664w" sizes=" 664px" alt="" src="https://leanrada.com/wares/dimensions/media/dimensions_finalset.jpg?ref=rss" spec="100% [664) 664" loading="lazy" width="100%" height="">
<span>Go to kalabasa.github.io/dimensions/ on your phone if QR doesn‚Äôt work.</span>
<p><span>Want to learn more about the art project that this image detection algorithm was a part of? Check out the <a target="_self" href="https://leanrada.com/wares/dimensions?ref=rss">Dimensions project</a>!</span>
            </p>
]]></description>
            <link>https://leanrada.com/notes/simple-image-recognition-vanilla-js?ref=rss</link>
            <guid isPermaLink="true">https://leanrada.com/notes/simple-image-recognition-vanilla-js?ref=rss</guid>
            <pubDate>Sat, 25 Feb 2023 00:00:00 GMT</pubDate>
        </item>
        <item>
            <title><![CDATA[Neural networks √ó genetic algorithms for Pong]]></title>
            <description><![CDATA[
<h1 id="pong-ai">Pong AI</h1>

<img srcset="/wares/pong-ai/media/pongai1_664.generated.png 664w" sizes=" 664px" alt="screenshot" src="https://leanrada.com/wares/pong-ai/media/pongai1.png?ref=rss" spec="100% [664) 664" loading="lazy" width="100%" height="">

<h2 id="neural-networks--genetic-algorithms">Neural networks &amp; genetic algorithms</h2>

<p><a target="_blank" href="https://en.wikipedia.org/wiki/Neural_network">Neural nets</a> have been around since the 1950s/60s. This Pong AI experiment was done back in 2014, around the time when a revival in neural networks was accelerating, that later brought about the deep learning, modern artificial intelligence that we associate with the term "AI" nowadays.</p>

<p>The Pong AI here, hovewer, has nothing to do with that deep stuff. I was largely unaware of those new developments in AI back then. This one is a very simple implementation of a 3-layer <a target="_blank" href="https://en.wikipedia.org/wiki/Feedforward_neural_network">feedforward neural network</a>.</p>

<p>The inputs of the network are ball position, heading, paddle position, etc. and the outputs directly control the paddle.</p>

<img srcset="/wares/pong-ai/media/net_664.generated.png 664w" sizes=" 664px" alt="network visualization" src="https://leanrada.com/wares/pong-ai/media/net.png?ref=rss" spec="100% [664) 664" loading="lazy" width="100%" height="">
<span>Visualization of the network. Sorry about the pixelation (it was a product of that time).</span>
<p>Instead of the usual <a target="_blank" href="https://en.wikipedia.org/wiki/Backpropagation">backpropagation</a>, the learning method I used here was a <a target="_blank" href="https://en.wikipedia.org/wiki/Genetic_algorithm">genetic algorithm</a>. It‚Äôs an evolutionary algorithm that mimics natural selection, reproduction, and mutation to optimize the neural network‚Äôs weights. This was how the Pong "AI" learned.</p>

<p>To illustrate the learning process, let‚Äôs look at how the AI performs in different stages of learnedness.</p>

<p>Here‚Äôs an early-generation AI:</p>

<p><span><em>Note: The AI controls the left paddle. Ignore the right one; it‚Äôs just an automated paddle.</em></span></p>

<video src="https://leanrada.com/wares/pong-ai/media/gen2.mp4?ref=rss" muted="" autoplay="" loop="" aria-label="video of a generation 2 AI">
                Video: video of a generation 2 AI | Source: /wares/pong-ai/media/gen2.mp4
              </video>
<span>Generation 2</span>
<p>As you can see, at this stage, its behaviour is still random with little to no awareness of the ball.</p>

<p>Sometimes it gets lucky and catches the ball, surviving another volley! This behaviour is rewarded by higher chances of reproduction. The longest surviving AIs in that generation reproduce more to populate the next generation.</p>

<video src="https://leanrada.com/wares/pong-ai/media/gen19.mp4?ref=rss" muted="" autoplay="" loop="" aria-label="video of a generation 19 AI">
                Video: video of a generation 19 AI | Source: /wares/pong-ai/media/gen19.mp4
              </video>
<span>Generation 19</span>
<p>After a few generations, good behaviour emerges while bad behaviour dies out due to natural selection. We can see in generation 19 above that it has evolved a behaviour where it tries to follow the ball.</p>

<p>Now, Pong is a very simple game. If you just follow the ball constantly, you won‚Äôt lose. At about 20 generations the AI has mastered this strategy and is surviving significantly longer. One can conclude that ball-following is the perfect strategy.</p>

<p>Or is it? ü§î</p>

<p>What if the ball was faster than the paddle? Then the paddle wouldn‚Äôt be able to keep up and the ball-following strategy will fail.</p>

<p>And that‚Äôs exactly what I did. I sped up the ball beyond the paddle‚Äôs max speed. Here‚Äôs how the AI adapted:</p>

<video src="https://leanrada.com/wares/pong-ai/media/gen54s.mp4?ref=rss" muted="" autoplay="" loop="" aria-label="video of a generation 54 AI">
                Video: video of a generation 54 AI | Source: /wares/pong-ai/media/gen54s.mp4
              </video>
<span>Generation 54 with faster ball</span>
<p>At generation 54, with a faster ball, the AI has learned to <em>predict</em> the ball!</p>

<p>It also seems to reposition itself near the middle after every volley as if getting ready for the next shot.</p>

<p>This was a pretty cool result! I hadn‚Äôt expected this, especially considering how limited / noisy inputs were (in my human eyes, at least).</p>

<p>Beyond the ball-predicting strategy, I wasn‚Äôt able to discover any more breakthroughs with the AI‚Äôs behaviour. I mean, ball prediction is pretty much the true perfect strategy, regardless of ball speed. At this point I was satisfied with the experiment and moved on to something else.</p>

<p>Bonus video! Very fast ball, generation 700+:</p>

<video src="https://leanrada.com/wares/pong-ai/media/bv.mp4?ref=rss" muted="" autoplay="" loop="" aria-label="video with very fast ball">
                Video: video with very fast ball | Source: /wares/pong-ai/media/bv.mp4
              </video>
]]></description>
            <link>https://leanrada.com/wares/pong-ai?ref=rss</link>
            <guid isPermaLink="true">https://leanrada.com/wares/pong-ai?ref=rss</guid>
            <pubDate>Sat, 18 Feb 2023 00:00:00 GMT</pubDate>
        </item>
    </channel>
</rss>